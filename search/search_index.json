{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"讯联智能 POS 体验版 download","text_tokens":["体验","体验版"," ","智能","pos","讯联","download"],"title":"功能预览","title_tokens":["预览","功能"]},{"location":"#pos-download","text":"","text_tokens":[],"title":"讯联智能 POS 体验版  download","title_tokens":["体验","体验版"," ","智能","pos","讯联","download"]},{"location":"about/","text":"智能 POS 连接的环境 环境 表现形式 生产环境 外网测试环境 内网测试环境","text_tokens":["网","测试","外","形式","环境","表现","的","连接","生产"," ","智能","现形","pos","表现形式","测试环境","内"],"title":"环境地址","title_tokens":["地址","环境"]},{"location":"download/","text":"Sample Download 最新版接入demo下载： demo下载 注意：v2.1.3以及后续sdk版本使用Jcenter管理（ 最新版本:2.5.2 ） compile 'com.cardinfolink.smart.pos:PosSDK:\"latestVersion\"' or <dependency> <groupId>com.cardinfolink.smart.pos</groupId> <artifactId>PosSDK</artifactId> <version>\"latestVersion\"</version> <type>pom</type> </dependency> 版本说明(Change Log) 版本 更新内容 V2.5.2 1. 扫码接口新增单品券功能； 2. 修改交易查询接口逻辑 V2.4.2 1. 新增扫码预授权 V2.4.1 1. 卡交易增加上送地理位置；2. 增加脱机pin交易；3. 修改DCC交易逻辑 V2.2.4 1. 优化了双应用的主控占用体验；2. 更改https证书 V2.2.3 1. 适配新大陆N910设备；2. 订单查询、交易统计、交易结算接口优化升级；3. 打印交易结果时，打印成功、失败条件优化 V2.2.1 1. 银联21号问改造，要求银联卡的消费、预授权交易类型上送硬件序列号，硬件序列号密文等信息用于监管 V2.2.0 1. A8 读取 9F27 TAG 失败优化；2. AID 支持部分匹配；3. aid和ic公钥添加在asset目录中；4. response请求信息优化；5. 激活流程修改 V2.1.8 1. 移除下载参数N900通讯APN设置；2. 适配联迪A8；3. 增加Stetho调试工具；网络相关API优化；4. Bugfix V2.1.7 1. 结算时，打印小票改为只打印合计小票；2. 历史结算，可选择打印详情小票或者合计小票；3. 结算打印后，批次号不能自动加1问题修改；4. 结算数据库优化 V2.1.3 1. 添加CILPayUtil添加工具类方法；2. CFCardSDK中cancelOfBank -> revokeOfBank；3. Trans方法类添加55域、cardType类型；4. N900加入POS-收银机蓝牙通信功能 V2.0.0 1. 增加基于安卓智能手机的纯扫码交易支持；2. 打印回调结果PrinterResult移动到com.cardinfolink.pos.bean包下；3. 按照银联合规信息设计小票 V1.0.4 1. 修复部分bug，提高稳定性 V1.0.2 1. 增加 setTestAddr 和 setProAddr 方法。可以方便更改测试环境和正式环境地址 V1.0.1 1. 增加外部订单号 V1.0.0 1. 第一版讯联 POS SDK , 支持银行卡( IC 卡、磁条卡、非接卡)和扫码(支付宝、微信)交易","text_tokens":["(","位置","应用","体验","银联","包下","8",">","ic","bugfix"," ","硬件","移动","证书","2","不能","提高","compile","详情","，","脱机","bean","结果","消费","stetho","demo","和","中","稳定","选择","打印","apn","历史","据库","最新版","移除","订单","4","密文","setproaddr","groupid","settestaddr","https","自动","21","在","时","a8","数据库","说明","信息","流程","部分","网络","后","n910","sdk","0","方法","基于","方便","监管","version","bug","匹配","v2.5","更改","磁条卡","n900","环境","；","稳定性","v2.0","v2.4","or","等","新版","smart","pom","讯联","优化","response","类","纯","后续","更新","的","添加","设计","手机","调试","地理位置","银联卡","printerresult","读取","公钥","到","download","change","（","1","序列","回调","版本","cardinfolink","v2.1","结算","加","revokeofbank","双","适配","蓝牙","。","磁条","cfcardsdk","改造","相关","工具","条件","trans","新增","收银","pos","测试环境","以及","设备","9f27","或者","能手","了","大陆","单品券","主控","号","注意","aid","com","银行卡","合计","tag","可","7","log","卡","pin","问","可以","第一版","用于","2.5","订单号","支付宝","修复","送","加入","dependency","cancelofbank","接口",",","数据","支持","修改","type","只","通信","逻辑","请求","增加","3","要求","v1.0","单号","智能手机","成功","/","使用","上","目录","参数",".","问题","失败","api","：","v2.2","外部",":","最新","管理","扫码","交易","-","cardtype","地址","升级","交易类型","设置","第一","授权","通讯","联迪","改为","按照","支付","测试","latestversion","sample","'","内容","合规","域","预","5",")","\"","<","统计","激活","接入","定性","）","安卓","cilpayutil","55","新大","序列号","批次","银行","jcenter","新大陆","查询","小票","收银机","dcc","智能","asset","微信","占用","possdk","非接","artifactid","地理","正式","下载","功能","类型","、"],"title":"版本说明与sample下载","title_tokens":["版本","sample","与","下载","说明"]},{"location":"download/#sample-download","text":"最新版接入demo下载： demo下载 注意：v2.1.3以及后续sdk版本使用Jcenter管理（ 最新版本:2.5.2 ） compile 'com.cardinfolink.smart.pos:PosSDK:\"latestVersion\"' or <dependency> <groupId>com.cardinfolink.smart.pos</groupId> <artifactId>PosSDK</artifactId> <version>\"latestVersion\"</version> <type>pom</type> </dependency>","text_tokens":["latestversion",">","'","注意","com","or","新版"," ","smart","pom","\"","<","接入","2","后续","compile","2.5","）","dependency","demo","最新版","type","（","版本","jcenter","cardinfolink","groupid","v2.1","3","/","使用",".","possdk","sdk","：",":","最新","管理","version","artifactid","下载","pos","以及"],"title":"Sample Download","title_tokens":["sample"," ","download"]},{"location":"download/#change-log","text":"版本 更新内容 V2.5.2 1. 扫码接口新增单品券功能； 2. 修改交易查询接口逻辑 V2.4.2 1. 新增扫码预授权 V2.4.1 1. 卡交易增加上送地理位置；2. 增加脱机pin交易；3. 修改DCC交易逻辑 V2.2.4 1. 优化了双应用的主控占用体验；2. 更改https证书 V2.2.3 1. 适配新大陆N910设备；2. 订单查询、交易统计、交易结算接口优化升级；3. 打印交易结果时，打印成功、失败条件优化 V2.2.1 1. 银联21号问改造，要求银联卡的消费、预授权交易类型上送硬件序列号，硬件序列号密文等信息用于监管 V2.2.0 1. A8 读取 9F27 TAG 失败优化；2. AID 支持部分匹配；3. aid和ic公钥添加在asset目录中；4. response请求信息优化；5. 激活流程修改 V2.1.8 1. 移除下载参数N900通讯APN设置；2. 适配联迪A8；3. 增加Stetho调试工具；网络相关API优化；4. Bugfix V2.1.7 1. 结算时，打印小票改为只打印合计小票；2. 历史结算，可选择打印详情小票或者合计小票；3. 结算打印后，批次号不能自动加1问题修改；4. 结算数据库优化 V2.1.3 1. 添加CILPayUtil添加工具类方法；2. CFCardSDK中cancelOfBank -> revokeOfBank；3. Trans方法类添加55域、cardType类型；4. N900加入POS-收银机蓝牙通信功能 V2.0.0 1. 增加基于安卓智能手机的纯扫码交易支持；2. 打印回调结果PrinterResult移动到com.cardinfolink.pos.bean包下；3. 按照银联合规信息设计小票 V1.0.4 1. 修复部分bug，提高稳定性 V1.0.2 1. 增加 setTestAddr 和 setProAddr 方法。可以方便更改测试环境和正式环境地址 V1.0.1 1. 增加外部订单号 V1.0.0 1. 第一版讯联 POS SDK , 支持银行卡( IC 卡、磁条卡、非接卡)和扫码(支付宝、微信)交易","text_tokens":["位置","应用","体验","包下","银联","(","8",">","ic","bugfix"," ","硬件","移动","证书","2","不能","提高","详情","，","脱机","bean","结果","消费","stetho","和","中","稳定","选择","打印","apn","历史","据库","移除","订单","4","密文","setproaddr","settestaddr","https","自动","21","在","时","a8","数据库","信息","流程","部分","网络","后","n910","0","方法","sdk","基于","方便","监管","bug","匹配","v2.5","更改","磁条卡","n900","环境","；","稳定性","v2.0","v2.4","等","讯联","优化","response","类","纯","更新","的","添加","设计","手机","调试","地理位置","银联卡","printerresult","读取","公钥","到","1","序列","回调","版本","cardinfolink","v2.1","结算","加","revokeofbank","双","适配","蓝牙","。","磁条","cfcardsdk","改造","相关","工具","条件","trans","新增","收银","pos","测试环境","设备","9f27","或者","能手","了","大陆","单品券","主控","号","aid","com","银行卡","合计","tag","可","7","pin","卡","问","可以","第一版","用于","订单号","支付宝","修复","送","加入","cancelofbank","接口",",","数据","支持","修改","只","通信","逻辑","请求","增加","3","要求","v1.0","单号","智能手机","成功","上","目录","参数",".","问题","失败","api","外部","v2.2","扫码","交易","-","cardtype","地址","升级","交易类型","设置","第一","授权","通讯","联迪","改为","按照","支付","测试","内容","合规","域","预","5",")","统计","激活","定性","安卓","cilpayutil","55","新大","序列号","批次","银行","新大陆","小票","查询","收银机","dcc","智能","asset","微信","占用","非接","地理","正式","下载","功能","类型","、"],"title":"版本说明(Change Log)","title_tokens":["log","(","change","版本"," ",")","说明"]},{"location":"attached/attachments/","text":"交易应答码表V3(20160811更新) 代码 POS显示(计划实施) 00 交易成功 01 \"01-交易失败请联系发卡行\" 02 \"02-交易失败请联系发卡行\" 03 \"03-无效商户请联系客服\" 04 \"04-卡片异常请换卡重试\" 05 \"05-交易失败请联系发卡行\" 06 \"06-交易失败请联系发卡行\" 07 \"07-卡片异常请换卡重试\" 09 \"09-交易失败请重试\" 12 \"12-发卡行不支持的交易\" 13 \"13-无效金额\" 14 \"14-无效卡号请联系发卡行或换卡重试\" 15 \"15-无此发卡行请换卡重试\" 19 \"19-交易失败请重试\" 20 \"20-交易失败请联系发卡行\" 21 \"21-交易失败请联系发卡行\" 22 \"22-操作有误请重试\" 23 \"23-交易失败请联系发卡行\" 25 \"25-未找到原交易请重试或联系客服\" 30 \"30-格式错误请联系客服\" 31 \"31-交易失败请联系客服\" 33 \"33-过期卡请换卡重试\" 34 \"34-卡片异常请联系发卡行\" 35 \"35-卡片异常请联系发卡行\" 36 \"36-卡片异常请联系发卡行\" 37 \"37-卡片异常请联系发卡行\" 38 \"38-密码错误次数超限\" 39 \"39-交易失败请换卡重试\" 40 \"40-不支持的交易类型请联系客服\" 41 \"41-卡片异常请联系发卡行\" 42 \"42-卡片异常请联系发卡行\" 43 \"43-卡片异常请联系发卡行\" 44 \"44-交易失败请联系发卡行\" 45 \"45-请插卡交易或联系客服\" 51 \"51-余额不足\" 52 \"52-交易失败请换卡重试\" 53 \"53-交易失败请换卡重试\" 54 \"54-过期卡请换卡重试\" 55 \"55-密码错误请重试\" 56 \"56-交易失败请换卡重试\" 57 \"57-卡片异常请联系客服或换卡重试\" 58 \"58-未授权的交易请联系客服\" 59 \"59-卡片异常请联系发卡行\" 60 \"60-卡片异常请联系发卡行\" 61 \"61-超出金额限制请联系客服或换卡重试\" 62 \"62-卡片异常请联系发卡行\" 63 \"63-交易失败请联系发卡行\" 64 \"64-交易失败请联系发卡行\" 65 \"65-交易次数超限请联系发卡行\" 66 \"66-交易失败请联系客服\" 67 \"67-卡片异常请联系发卡行\" 68 \"68-交易超时请重试\" 75 \"75-密码错误次数超限\" 76 \"76-交易失败请联系发卡行\" 77 \"77-交易失败请联系客服\" 78 \"78-交易失败请换卡重试\" 79 \"79-脱机交易对账不平请重传数据或联系客服\" 80 \"80-交易失败请联系客服\" 81 \"81-交易失败请联系客服\" 83 \"83-交易失败请联系客服\" 84 \"84-交易失败请联系客服\" 85 \"85-交易失败请联系客服\" 86 \"86-交易失败请联系客服\" 88 \"88-交易失败请联系客服\" 89 \"89-交易失败请联系客服\" 90 \"90-交易失败请稍后重试\" 91 \"91-交易失败请稍后重试\" 92 \"92-交易失败请稍后重试\" 93 \"93-交易失败请联系发卡行\" 94 \"94-交易失败请稍后重试\" 95 \"95-交易失败请稍后重试\" 96 \"96-系统异常请联系客服\" 97 \"97-无效终端请联系客服或检查配置\" 98 \"98-交易超时请重试\" 99 \"99-交易失败请联系客服\" A0 \"A0-请重新签到或联系客服\" B1 \"B1-卡片异常请联系客服或换卡重试\" C0 \"C0-核销失败\" C1 \"C1-卡券已被核销\" C2 \"C2-卡券已过期\" C3 \"C3-无效的卡券\" C4 \"C4-券状态异常\" C5 \"C5-未到卡券使用时间\" C6 \"C6-商户不能使用该卡券\" C7 \"C7-金额太小不可参与优惠\" C8 \"C8-此卡券不能使用此方式进行支付\" C9 \"C9-交易失败，请联系客服\" CA \"CA-付款码与卡券指定支付方式不符\" CB \"CB-卡券订单不存在\" CC \"CC-交易失败请联系客服\" CD \"CD-卡券订单已支付\" L1 \"L1-交易额度超限请联系客服\" L2 \"L2-交易额度超限请联系客服\" L3 \"L3-交易额度超限请联系客服\" RA \"RA-交易失败请联系客服\" RB \"RB-交易失败请联系客服\" RC \"RC-交易失败请联系客服\" RD \"RD-交易失败请联系客服\" Y0 \"Y0-付款码错误或过期，请重试\" Y1 \"Y1-交易失败请联系客服\" Y2 \"Y2-未开通此支付方式，请联系客服\" Y3 \"Y3-订单不存在，请重试\" Y4 \"Y4-未开通此支付方式，请联系客服\" Y5 \"Y5-退款失败，商家账户余额不足\" Y6 \"Y6-退款金额超过原订单金额\" Y7 \"Y7-交易失败请联系客服\" Y8 \"Y8-不支持的交易类型请联系客服\" Y9 \"Y9-订单已关闭或取消\" YA \"YA-交易失败请联系客服\" YB \"YB-交易失败请联系客服\" YC \"YC-交易失败请联系客服\" YD \"YD-交易失败请联系客服\" YE \"YE-该交易类型不能执行此操作\" YF \"YF-该交易类型不能执行此操作\" YG \"YG-原交易已退款\" YH \"YH-只能隔天退款\" YJ \"YJ-不支持的卡类型，请换卡或绑新卡\" YK \"YK-只能撤销当天交易\" YL \"YL-顾客账户状态异常\" YM \"YM-商家账户状态异常\" YN \"YN-付款码与交易渠道不符\" YP \"YP-交易失败请联系客服\" YQ \"YQ-软件版本过低，请升级\" YR \"YR-付款金额小于最低限额\" YS \"YS-交易失败请联系客服\" YT \"YT-姓名校验错误\" YU \"YU-对同一用户操作过于频繁，请稍后重试\" YV \"YV-购汇金额或币种错误\" YW \"YW-额度超限\" YX \"YX-顾客关闭相关功能\" YY \"YY-交易失败请重试\" YZ \"YZ-交易失败请联系客服\" Z0 \"Z0-交易失败请联系客服\" Z1 \"Z1-交易失败请联系客服\" Z2 \"Z2-未授权的交易请联系客服\" Z3 \"Z3-交易失败请联系客服\" Z4 \"Z4-交易失败请联系客服\" Z5 \"Z5-交易失败请联系客服\" Z6 \"Z6-卖家买家账号相同，不能进行交易\" Z7 \"Z7-商户未签约请联系客服\" Z8 \"Z8-交易失败请重试\" Z9 \"Z9-商户未授权请联系客服\" ZA \"ZA-交易失败，请更换支付方式\" ZB \"ZB-交易失败请重试或联系客服\" ZC \"ZC-交易失败请联系客服\" ZD \"ZD-未授权交易请联系客服\" ZE \"ZE-该商户暂无退款权限请联系客服\" ZF \"ZF-交易异常，如有扣款，款项稍后退回\" ZG \"ZG-交易失败，请重试\" ZH \"ZH-交易失败请联系客服\" ZI \"ZI-直接进入扫码流程显示流程界面\" ZJ \"ZJ-直接进入扫码流程显示流程界面\" ZK \"ZK-交易失败请联系客服\" ZL \"ZL-交易失败请联系客服\" ZM \"ZM-买家付款额度超限\" ZN \"ZN-商家收款额度超限\" ZP \"ZP-超出每日限额，请联系客服\" ZQ \"ZQ-提升限额申请正在审核中\" ZR \"ZR-交易失败，请联系客服\" ZS \"ZS-不支持该交易类型，请联系客服\" ZT \"ZT-交易失败请联系客服\" ZU \"ZU-交易失败请联系客服\" ZV \"ZV-未开通此支付方式，请联系客服\" ZY \"ZY-用户取消支付，请重新发起交易\" ZZ \"ZZ-交易失败请联系客服\" 交易应答码表V2(智能POS) 注1:银行卡的09和扫码的09有区别 注2:位置应答码展示为 \"XX-交易失败-请联系客服\" 代码 意义 原因/采取的措施 说明 POS显示(计划实施) 00 承兑或交易成功 承兑或交易成功 交易成功 交易成功 01 查发卡行 查发卡行 交易失败-请联系发卡行 01交易失败-请联系客服 02 查发卡行的特殊条件 可电话向发卡行查询 交易失败-请联系发卡行 02交易失败-请联系客服 03 无效商户 商户需要在银行或中心登记 商户未登记 03无效商户-请联系客服 04 没收卡 操作员没收卡 没收卡-请联系收单行 04卡片异常-请联系客服或换卡重试 05 不予承兑 发卡不予承兑 交易失败-请联系发卡行 05交易失败-请联系客服 06 出错 发卡行故障 交易失败-请联系发卡行 06交易失败-请联系客服 07 特殊条件下没收卡 特殊条件下没收卡 没收卡-请联系收单行 07卡片异常-请联系客服或换卡重试 09 请求正在处理中 重新提交交易请求 交易失败-请重试 09请重新操作 12 无效交易 发卡行不支持的交易 交易失败-请联系发卡行 12无效交易-请联系客服 13 无效金额 金额为0 或太大 交易金额超限-请重试 13无效金额-请联系客服 14 无效卡号 卡种未在中心登记或读卡号有误 无效卡号-请联系发卡行 14无效卡号-请联系客服或换卡重试 15 无此发卡行 此发卡行未与中心开通业务 此卡不能受理 15无此发卡行-请联系客服或换卡重试 19 重新送入交易 刷卡读取数据有误-可重新刷卡 交易失败-请联系发卡行 19交易失败-请重试 20 无效应答 无效应答 交易失败-请联系发卡行 20交易失败-请联系客服 21 不做任何处理 不做任何处理 交易失败-请联系发卡行 21交易失败-请联系客服 22 怀疑操作有误 POS状态与中心不符-可重新签到 操作有误-请重试 22操作有误-请重试 23 不可接受的交易费 不可接受的交易费 交易失败-请联系发卡行 23交易失败-请联系客服 25 未能找到文件上记录 发卡行未能找到有关记录 交易失败-请联系发卡行 25无效交易-请联系客服 30 格式错误 格式错误 交易失败-请联系发卡行 30格式错误-请联系客服 31 不支持的银行 此发卡方未与中心开通业务 此卡不能受理 31银行未联网-请联系客服 33 过期的卡 过期的卡-操作员可以没收 过期卡-请联系发卡行 33过期卡-请换卡重试 34 有作弊嫌疑 有作弊嫌疑的卡-操作员可以没收 没收卡-请联系收单行 34卡片异常-请换卡重试 35 受卡方与安全保密部门联系 有作弊嫌疑的卡-操作员可以没收 没收卡-请联系收单行 35卡片异常--请换卡重试 36 受限制的卡 有作弊嫌疑的卡-操作员可以没收 此卡有误-请换卡重试 36卡片异常--请换卡重试 37 受卡方呼受理方安全保密部门(没收卡) 有作弊嫌疑的卡-操作员可以没收 没收卡-请联系收单行 37卡片异常-请换卡重试 38 超过允许的PIN试输入 密码错次数超限-操作员可以没收 密码错误次数超限 38密码错误次数超限 39 无此信用卡账户 可能刷卡操作有误 交易失败-请联系发卡行 39交易失败-请重试 40 请求的功能尚不支持 发卡行不支持的交易类型 交易失败-请联系发卡行 40不支持的交易类型 41 丢失卡 挂失的卡- 操作员可以没收 没收卡-请联系收单行 41卡片异常-请换卡重试 42 无此账户 发卡行找不到此账户 交易失败-请联系发卡方 42卡片异常-请联系客服 43 被窃卡 被窃卡- 操作员可以没收 没收卡-请联系收单行 43卡片异常-请换卡重试 44 无此投资账户 可能刷卡操作有误 交易失败-请联系发卡行 44交易失败-请联系客服或换卡重试 45 请插卡交易 45请插卡交易 51 无足够的存款 账户内余额不足 余额不足-请查询 51余额不足 52 无此支票账户 无此支票账户 交易失败-请联系发卡行 52交易失败-请联系客服 53 无此储蓄卡账户 无此储蓄卡账户 交易失败-请联系发卡行 53交易失败-请联系客服 54 过期的卡 过期的卡 过期卡-请联系发卡行 54过期卡-请换卡重试 55 不正确的PIN 密码输错 密码错-请重试 55密码错误-请重试 56 无此卡记录 发卡行找不到此账户 交易失败-请联系发卡行 56交易失败-请联系客服 57 不允许持卡人进行的交易 不允许持卡人进行的交易 交易失败-请联系发卡行 57未授权的交易-请联系客服 58 不允许终端进行的交易 该商户不允许进行的交易 终端无效-请联系收单行或银联 58未授权的交易-请联系客服 59 有作弊嫌疑 交易失败-请联系发卡行 59交易失败-请联系客服 60 受卡方与安全保密部门联系 交易失败-请联系发卡行 60交易失败-请联系客服 61 超出取款金额限制 一次交易的金额太大 金额太大 61超交易限额-请联系客服或换卡重试 62 受限制的卡 交易失败-请联系发卡行 62卡片异常-请换卡重试 63 违反安全保密规定 违反安全保密规定 交易失败-请联系发卡行 63交易失败-请联系客服 64 原始金额不正确 原始金额不正确 交易失败-请联系发卡行 64原金额错误-请联系客服或重试 65 超出取款次数限制 超出取款次数限制 超出取款次数限制 65超交易次数-请联系客服 66 受卡方呼受理方安全保密部门 受卡方呼受理方安全保密部门 交易失败-请联系收单行或银联 66交易失败-请联系客服 67 捕捉（没收卡） 捕捉（没收卡） 没收卡 67卡片异常-请换卡重试 68 收到的回答太迟 发卡行规定时间内没有回答 交易超时-请重试 68交易超时-请重试 75 允许的输入PIN次数超限 允许的输入PIN次数超限 密码错误次数超限 75密码错误次数超限 76 76交易失败-请联系客服 77 需要向网络中心签到 POS批次与网络中心不一致 请向网络中心签到 77交易失败-请联系客服 78 78交易失败-请联系客服 79 脱机交易对账不平 POS终端上传的脱机数据对账不平 POS终端重传脱机数据 79对账不平-请联系客服 80 80交易失败-请联系客服 81 81交易失败-请联系客服 83 83交易失败-请联系客服 84 84交易失败-请联系客服 85 85交易失败-请联系客服 86 86交易失败-请联系客服 88 88交易失败-请联系客服 89 89交易失败-请联系客服 90 日期切换正在处理 日期切换正在处理 交易失败-请稍后重试 90交易失败-请稍后重试 91 发卡行或收单银行不能操作 电话查询发卡方或收单银行-可重作 交易失败-请稍后重试 91交易失败-请联系客服 92 金融机构或中间网络设施找不到或无法达到 电话查询发卡方或网络中心-可重作 交易失败-请稍后重试 92交易失败-请联系客服 93 交易违法、不能完成 交易违法、不能完成 交易失败-请联系发卡行 93交易失败-请联系客服 94 重复交易 查询网络中心-可重新签到作交易 交易失败-请稍后重试 94重复交易 95 调节控制错 调节控制错 交易失败-请稍后重试 95交易失败-请联系客服 96 系统异常、失效 发卡方或网络中心出现故障 交易失败-请稍后重试 96交易失败-请联系客服 97 POS终端号找不到 终端未在中心或银行登记 终端未登记-请联系收单行或银联 97无效终端-请联系客服或检查配置 98 收不到发卡行应答 收不到发卡行应答 交易超时-请重试 98交易超时-请重试 99 PIN格式错 可重新签到作交易 校验错-请重新签到 99交易失败-请联系客服 A0 MAC校验错 可重新签到作交易 校验错-请重新签到 A0请重新签到或联系客服 C1 卡券已被核销 C1卡券已被核销 C2 卡券已过期 C2卡券已过期 C3 无效的卡券 C3无效的卡券 09 处理中 正常应答-表明该交易需要输入密码-完成后发起查询确认交易状态 09处理中 Y1 商户密钥错误 核实商户交易密钥是否正确 12改为Y1 Y1交易失败-请联系客服 Y0 付款码错误或过期 刷新条码后-重新扫码-发起支付 14改为Y0 Y0付款码错误或过期 ZH 订单号重复 订单号重复-使用新订单号发起交易-建议订单号加上时间防止重复 19改为ZH ZH订单号重复 Y3 订单不存在 该订单系统不存在-不能进行相应操作 25改为Y3 Y3订单不存在 Y4 商户未申请开通此支付方式 查看商户是否提交该渠道申请-如以提交-核实是否有配置路由信息 31改为Y4 Y4不支持此支付方式 Y5 退款失败-商家账户余额不足 建议商家先进行一笔收款-再发起退款 61改为Y5 Y5退款失败-商家账户余额不足 Y6 退款金额超过原订单金额 退款金额需要小于等于可退款金额 64改为Y6 Y6退款金额超过原订单金额 Y7 外部系统错误 具体描述可返回渠道中文描述字段 91改为Y7 Y7交易失败-请联系客服 Y2 商户无此交易渠道权限 H1改为Y2 Y2未授权的交易 Y8 商户无此接口权限 核实该商户是否配置了该接口权限 H2改为Y8 Y8交易失败-请联系客服 Y9 订单已关闭或取消 订单已关闭或取消-不能进行相应操作 H3改为Y9 Y9订单已关闭或取消 YA [字段名]不能为空 检查出错字段 H4改为YA YA交易失败-请联系客服 YB [字段名]格式错误 检查出错字段 H5改为YB YB交易失败-请联系客服 YC 交易状态不合法 检查交易状态是否正常 H6改为YC YC交易失败-请联系客服 YD 交易信息中包含违禁词汇 检查交易信息中是否包含违禁词汇 H7改为YD YD交易失败-请联系客服 YE 原交易非支付交易 原交易非支付交易-不能执行此类操作 R1改为YE YE原交易非支付交易 YF 原交易未成功支付 原交易未成功支付-部分交易不能执行 R2改为YF YF原交易未成功支付 YG 原交易已退款 R3改为YG YG原交易已退款 YH 只能隔天退款 R4改为YH YH只能隔天退款 YJ 不支持的卡类型-请换卡或绑新卡 R5改为YJ YJ不支持的卡类型-请换卡或绑新卡 YK 只能撤销当天交易 R6改为YK YK只能撤销当天交易 YL 顾客账户状态异常 R7改为YL YL顾客账户状态异常 YM 商家账户状态异常 R8改为YM YM商家账户状态异常 YN 付款码与交易渠道不符 R9改为YN YN付款码与交易渠道不符 YP 分账信息不正确 S1改为YP YP交易失败-请联系客服 YQ 软件版本过低-请升级 S2改为YQ YQ软件版本过低-请升级 YR 付款金额小于最低限额 S3改为YR YR付款金额小于最低限额 YS Openid错误 S4改为YS YS交易失败-请联系客服 YT 姓名校验错误 S5改为YT YT姓名校验错误 YU 对同一用户操作过于频繁-请稍候重试 S6改为YU YU对同一用户操作过于频繁-请稍候重试 YV 购汇金额或币种错误 S7改为YV YV购汇金额或币种错误 YW 额度超限 S8改为YW YW额度超限 YX 顾客关闭相关功能 S9改为YX YX顾客关闭相关功能 YY 授权码code错误 J1改为YY YY交易失败-请联系客服 YZ 渠道商户秘钥未配置或配置错误 YZ交易失败-请联系客服 C0 核销失败 C0核销失败 C4 券状态异常 C4券状态异常 C5 未到卡券使用时间 请在卡券有效期内使用 C5未到卡券使用时间 C6 商户不能使用该卡券 C6商户不能使用该卡券 C7 金额达不到满足优惠条件的最小金额 C7金额太小-不可参与优惠 C8 此卡券不能使用此方式进行支付 请使用卡券指定的支付方式 C8此卡券不能使用此方式进行支付 Z0 渠道商户信息有误 检查系统渠道商户配置和渠道是否一致-或者看渠道商户具体应答 E0改为Z0 Z0交易失败-请联系客服 Z1 渠道受理机构信息配置有误 检查与渠道给出信息是否一致-或者看具体应答错误码 E1改为Z1 Z1交易失败-请联系客服 Z2 渠道不支持该业务 如不支持部分退款等 E2改为Z2 Z2未授权的交易-请联系客服 Z3 接入渠道IP验证异常 看渠道方是否有将我方IP配置 99改为Z3 Z3交易失败-请联系客服 Z4 门店状态异常 门店状态被改为异常状态 G1改为Z4 Z4交易失败-请联系客服 Z5 渠道商户状态异常 渠道商户状态被改为异常状态 G2改为Z5 Z5交易失败-请联系客服 Z6 卖家买家账号相同-不能进行交易 通知商户不能用自己账户进行交易-一定要使用其他人账户 G3改为Z6 Z6账号有误-请联系客服 Z7 没有签约扫码支付接口或签约失效 通知商户进行签约 G4改为Z7 Z7未授权的交易-请联系客服 Z8 支付失败-请顾客刷新付款码后重新收款-如再次收款失败-请联系管理员处理 重新扫码收款 G5改为Z8 Z8交易失败-请重试 Z9 未进行应用授权或授权已过期 通知商户重新进行授权操作 G6改为Z9 Z9未授权的交易-请联系客服 ZA 该银行卡已失效-请联系发卡行了解详情-或更换其他支付方式 更换其他支付方式-比如换一张卡或使用钱包余额支付 G7改为ZA ZA交易失败-请更换支付方式 ZB 内部系统操作超时 请重试交易 G9改为ZB ZB交易失败-请联系客服 ZC 渠道验签错误 请至支付宝后台上传公玥 K1改为ZC ZC交易失败-请联系客服 ZD 商户未签约该产品-请按流程完成签约 请按流程完成签约并确认签约成功 K2改为ZD ZD未授权交易-请联系客服 ZE 商户需授权服务商退款接口权限 请服务商按照指引流程-完成授权 K3改为ZE ZE未授权交易-请联系客服 ZF 交易失败-如顾客反馈扣款成功-款项将会在一段时间后退回 不进行发货处理-重新进行一笔收款 F1改为ZF ZF交易失败-请联系客服 ZG 交易失败-请重新发起交易 F8改为ZG ZG交易失败-请重试 E1 程序异常 E1交易失败-请联系客服 E2 配置错误 E2交易失败-请联系客服 E4 E4交易失败-请联系客服 L1 机构额度超限 L1交易失败-请联系客服 L2 商户额度单笔超限 L2交易失败-请联系客服 L3 商户额度单日超限 B1 卡片黑名单 B1交易失败-请联系客服 RA 规则预警 RA交易失败-请联系客服 RB 预警联机拒交易 RB交易失败-请联系客服 RC 预警降额拒交易类P RC交易失败-请联系客服 RD 预警降额拒交易类A RD交易失败-请联系客服 交易应答码表V1(传统POS) 交易返回合作方时都有 39 域，合作方和终端需根据应答码要采取相应的操作，可以把操作分为以下几类: A:交易成功 B:交易失败, 可重试 C:交易失败, 不需要重试 D:交易失败, 终端操作员处理 E:交易失败, 系统故障, 不需要重试 注 1: 如果 39 域的内容不能在下表中找到，就显示“交易失败” 注 2: 如果POS交易的批次号和网络中心批次号不一致时应答码会填 “77”，此时POS机应当提示操作员重新签到， 再作交易。 代码 意义 类别 原因/采取的措施 说明 00 承兑或交易成功 A 承兑或交易成功 交易成功 01 查发卡行 C 查发卡行 交易失败，请联系发卡行 02 查发卡行的特殊条件 C 可电话向发卡行查询 交易失败，请联系发卡行 03 无效商户 C 商户需要在银行或中心登记 商户未登记 04 没收卡 D 操作员没收卡 没收卡，请联系收单行 05 不予承兑 C 发卡不予承兑 交易失败，请联系发卡行 06 出错 E 发卡行故障 交易失败，请联系发卡行 07 特殊条件下没收卡 D 特殊条件下没收卡 没收卡，请联系收单行 09 请求正在处理中 B 重新提交交易请求 交易失败，请重试 12 无效交易 C 发卡行不支持的交易 交易失败，请联系发卡行 13 无效金额 B 金额为 0 或太大 交易金额超限，请重试 14 无效卡号 B 卡种未在中心登记或读卡号有误 无效卡号，请联系发卡行 15 无此发卡行 C 此发卡行未与中心开通业务 此卡不能受理 19 重新送入交易 C 刷卡读取数据有误，可重新刷卡 交易失败，请联系发卡行 20 无效应答 C 无效应答 交易失败，请联系发卡行 21 不做任何处理 C 不做任何处理 交易失败，请联系发卡行 22 怀疑操作有误 C POS 状态与中心不符，可重新签到 操作有误，请重试 23 不可接受的交易费 C 不可接受的交易费 交易失败，请联系发卡行 25 未能找到文件上记录 C 发卡行未能找到有关记录 交易失败，请联系发卡行 30 格式错误 C 格式错误 交易失败，请联系发卡行 31 不支持的银行 C 此发卡方未与中心开通业务 此卡不能受理 33 过期的卡 D 过期的卡，操作员可以没收 过期卡，请联系发卡行 34 有作弊嫌疑 D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 35 受卡方与安全保密部门联系 D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 36 受限制的卡 D 有作弊嫌疑的卡，操作员可以没收 此卡有误，请换卡重试 37 受卡方呼受理方安全保密部门(没收卡) D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 38 超过允许的 PIN 试输入 D 密码错次数超限，操作员可以没收 密码错误次数超限 39 无此信用卡账户 C 可能刷卡操作有误 交易失败，请联系发卡行 40 请求的功能尚不支持 C 发卡行不支持的交易类型 交易失败，请联系发卡行 41 丢失卡 D 挂失的卡，操作员可以没收 没收卡，请联系收单行 42 无此账户 B 发卡行找不到此账户 交易失败，请联系发卡方 43 被窃卡 D 被窃卡， 操作员可以没收 没收卡，请联系收单行 44 无此投资账户 C 可能刷卡操作有误 交易失败，请联系发卡行 51 无足够的存款 C 账户内余额不足 余额不足，请查询 52 无此支票账户 C 无此支票账户 交易失败，请联系发卡行 53 无此储蓄卡账户 C 无此储蓄卡账户 交易失败，请联系发卡行 54 过期的卡 C 过期的卡 过期卡，请联系发卡行 55 不正确的 PIN C 密码输错 密码错，请重试 56 无此卡记录 C 发卡行找不到此账户 交易失败，请联系发卡行 57 不允许持卡人进行的交易 C 不允许持卡人进行的交易 交易失败，请联系发卡行 58 不允许终端进行的交易 C 该商户不允许进行的交易 终端无效，请联系收单行或银联 59 有作弊嫌疑 C 交易失败，请联系发卡行 60 受卡方与安全保密部门联系 C 交易失败，请联系发卡行 61 超出取款金额限制 C 一次交易的金额太大 金额太大 62 受限制的卡 C 交易失败，请联系发卡行 63 违反安全保密规定 C 违反安全保密规定 交易失败，请联系发卡行 64 原始金额不正确 C 原始金额不正确 交易失败，请联系发卡行 65 超出取款次数限制 C 超出取款次数限制 超出取款次数限制 66 受卡方呼受理方安全保密部门 C 受卡方呼受理方安全保密部门 交易失败，请联系收单行或银联 67 捕捉(没收卡) C 捕捉(没收卡) 没收卡 68 收到的回答太迟 C 发卡行规定时间内没有回答 交易超时，请重试 75 允许的输入 PIN 次数超限 C 允许的输入 PIN 次数超限 密码错误次数超限 77 需要向网络中心签到 D POS 批次与网络中心不一致 请向网络中心签到 79 脱机交易对账不平 C POS 终端上传的脱机数据对账不 平 POS 终端重传脱机数据 90 日期切换正在处理 C 日期切换正在处理 交易失败，请稍后重试 91 发卡行或收单银行不能操作 C 电话查询发卡方或收单银行，可重作 交易失败，请稍后重试 92 金融机构或中间网络设施无法达到 C 电话查询发卡方或网络中心，可重 作 交易失败，请稍后重试 93 交易违法、不能完成 C 交易违法、不能完成 交易失败，请联系发卡行 94 重复交易 C 查询网络中心，可重新签到作交易 交易失败，请稍后重试 95 调节控制错 C 调节控制错 交易失败，请稍后重试 96 系统异常、失效 C 发卡方或网络中心出现故障 交易失败，请稍后重试 97 POS 终端号找不到 D 终端未在中心或银行登记 终端未登记，请联系收单行或银联 98 收不到发卡行应答 E 收不到发卡行应答 交易超时，请重试 99 PIN 格式错 B 可重新签到作交易 校验错，请重新签到 A0 MAC 校验错 B 可重新签到作交易 校验错，请重新签到 C1 卡券已被核销 C C2 卡券已过期 C C3 无效的卡券 C 交易处理标志 processflag取值如下，用于标记处理成功还是失败。 代码 意义 说明 0 成功 1 受理方拒绝 2 转发方失败 3 渠道拒绝 扫码交易，查询失败后超时选择该状态，表示该笔09应答码交易是失败交易 4 超时 5 处理中 6 落地 交易冲正标志 revflag取值如下，用于标记源交易。 代码 意义 说明 0 正常 1 冲正 2 撤销 3 退货 4 汇款 5 完成 6 手工退货 7 手工完成 8 手工撤销 签购单规范 小票（签购单）样例，银行卡类小票和扫码类小票： 其他说明 签购单中，可以有空行 交易金额显示，如为退货或撤销，均在金额前显示负号 卡号后面的一位字母，刷卡方式，取值：S（刷卡）、I(插卡)、M（无卡）、C（非接） 卡号后面的3位字母，卡品牌CUP 原凭证号：只有撤销或退货时显示 TAG：8583规范中的子域名，必须打印 各项内容必须完备，排版可以略有不同 标点符号全部为半角 银联卡消费打印的签购单中，必须要显示的内容： 内容 字段取值 备注 商户/持卡人/银行存根 固定文本 客户ID 0000000000 目前为10个0 商户名称 Config.IsoMsg.MERCHANT_NAME 商户号 response.getTrans().getCompInfoA2() 终端号 response.getTrans().getCompInfoA3() 卡号 response.getTrans().getCardNo() + response.getTrans().getCardType() + response.getTrans().getCardBrand() 卡号 + 刷卡方式(1S 2I 3C) + 卡品牌 有效期 response.getTrans().getCompExpirationDate() 需格式转换 MM/YY （为空不打印） 收单行 response.getTrans().compInfoA1() 发卡行 response.getTrans().getAdditionalResData() 交易类型 response.getTrans().getTransCode() 需转换，见下文'交易类型码表' 授权码 response.getTrans().getRevAuthCode() 批次号 response.getTrans().getBatchNum() 凭证号 response.getTrans().getTraceNum() 日期时间 response.getTrans().getTransDate() + response.getTrans().getTransDatetime() 需格式转换 参考号 response.getTrans().getRefNum() 交易金额 response.getTrans().getTransAmt() 小费（Tips） 签名 备注 版本 TAG 交易类型码表 transCode 意义 小票打印 PER 消费 PBI 余额查询 PEC 消费冲正 PVR 撤销 PVC 消费撤销冲正 CTH 退货 PPA 预授权 PNP 预授权撤销 ACR 预授权完成 PCR 预授权完成撤销 PPC 预授权冲正 PMC 预授权撤销冲正 PCC 预授权完成冲正 PRC 预授权完成撤销冲正 BPA 条码支付下单 BPP 条码支付预下单 BVD 条码支付撤销 BTH 条码支付退货 BVE 条码支付取消 BPI 条码支付查询 PER2EDC PER类交易DCC－EDC交易 ACR2EDC ACR类交易DCC－EDC交易 TTD 小费 TVD 小费撤销 CASH 现金交易 CCL 现金撤销 新大陆-打印规范 如果你想要自定义小票的样式，可以参考 新大陆 提供的打印文档，点击 新大陆-打印规范.doc 可以下载。 终端相应合规信息取值 按照银联最新规范，终端展示/打印信息需要根据8583报文中57域信息。因此，SDK中Trans新增部分字段 字段名 意义 compInfoA1 签购单收单行 compInfoA2 签购单商户号 compInfoA3 签购单终端号 compInfoA4 markup compInfoA6 借贷记标识 compInfoA7 营销信息 compInfoA8 二维码信息 详细字段信息可查看 javadoc 中com.cardinfolink.pos.sdk.model.Trans信息 币种代码对应表 我们提供了币种和代码对应的一个表格的 PDF 文档，点击 币种代码表20160913.pdf 可以下载。","text_tokens":["(","位置","相同","s8"," ","必须","39","yt","意义","一致","日期","插卡","91","h7","出错","详情","z6","完备","中","zy","c1","此卡券","做","订单","报文","94","应答","绑","--","下表中","太大","界面","37","钱包","51","21","一定","时","小费","44","yx","r2","被","受卡方呼","达","合作","yv","样例","pdf","53","印信","特殊","config","词汇","了解","联系","内","太迟","包含","需","指引","ym","取值","表明","为空","按","预警","自定","e","response","cup","c","56","yn","方式","yk","更新","的","没收","任何","错误","文件","读取","格式","如","新卡","yl","投资","[","gettranscode","隔天","ys","zz","compinfoa4","z5","67","doc","后台","限额","再","c0","无效","代码","条件","s7","98","买家","展示","34","s3","isomsg","进行","返回","了","都","字段","受限","getcardbrand","y5","e4","com","tag","作","cash","k3","签名","其他人","排版","失效","先","其他","直接","支持","正常","域名","对","卡人","要","中心","请求","限制","审核","/","使用","提供","用","账号","存款","联机",".","merchant","cth","ppc","g1","描述","表格","支付","rd","z9","pvc","zm","现金交易","打印信息","额度","合规","超过","域","单","持卡","\"","备注","文本","57","i","收不到","76","核销","再次","mm","源","客户","储蓄卡","新大陆","当天","64","v2","怀疑","86","88","换卡","太","防止","非接","pcr","软件","尚","下载","不能","04","见下文","compinfoa8","控制","优惠条件","20","58","gettrans","g2","8","per","规则","错误码","允许","刷新","zb","processflag","部门","不同","code","h6","model","冲正","y6","发起","标点符号","2","36","y3","e2","是否","发卡","a0","安全","类别","系统","此时","zr","bve","99","r5","acr2edc","c3","4","05","退回","下单","该","更换","终端","黑名单","会填","说明","方未","网络","通知","sdk","z7","45","03","有","作弊","c4","没有","s6","未到","取款","pmc","金融机构","未","c2","收到","将会","单中","s2","或","gettracenum","z1","65","名单","规范","d","compinfoa1","为","配置","前","银联卡","校验","mac","1","59","该卡","cc","可重","如下","cardinfolink","渠道","业务","不足","调节","。","撤销","78","公玥","电话","半角","提交","签购","13","e1","每日","样式","标识","b","嫌疑","pos","s9","h1","85","自己","大陆","zf","超","80","服务商","g4","重新","8583","银行卡","06","过于","权限","进入","稍候","卡","网络设施","一笔","接受","用户","用于","字段名","承兑","接口","参考","输错","读取数据","还是","足够","ya","应当","1s","r8","gettransdate","采取","有效期","根据","错","g9","显示","g3","12","采取相应","效期","现金","商家","分为","m","compinfoa7","略有","二维","ttd","因此","金额","y9","c8","出现","一张","yy","c5","ze","子","2i","transcode","s","单笔","服务","内容","63","cb","ppa","拒","客服","达到","5","35","原因","cd","name","或读","一次","各项","最小","下文","）","他人","反馈","略有不同","42","getrevauthcode","55","批次","如以","银行","收","id","v1","83","比如","误码","79","智能","ra","余额","y4","+","getcardtype","yq","68","h2","看","一段","回答","14","存在","getadditionalresdata","我方","正确","22","未登记","应用","gettransamt","确认","银联","getcompinfoa2","提示","75","名称","“","一个","bpi","zi","金融","revflag","券","大","中间","，","yw","切换","l1","消费","此类","该笔","选择","超出","getcardno","40","合法","收款","只有","稍后","zd","建议","有效","关闭","0000000000","02","y1","openid","秘钥","无卡","字母","y0","规定","h5","签约","商户","频繁","zp","r6","不符","b1","z0","07","pec","卡请","pcc","compinfoa3","6","gettransdatetime","20160811","92","c7","zg","传统","ip","姓名","单日","下","p","g6","参与","指定","版本","等于","tvd","详细","向","h4","过低","”","getbatchnum","per2edc","无此","yd","定义","送入","登记","zs","如为","相关","程序","受限制","找","无法","并","trans","新增","compinfoa2","实施","61","或者","计划","满足","开通","违反","几类","z3","00","注","不平","储蓄","最低","ye","z8","空行","段","e0","支付宝","联网","单行","y8","具体","数据","凭证","费","不予","已过期","bvd","41","需要","compinfoa6","核实","正在","验证","3","单号","平","成功","路由","不","k2","管理员","上","对应","失败","23","30","捕捉","上传","原","位","外部","：","bth","或太大","y2","此","zj","以下","交易类型","升级","单收","25","授权","改为","zv","是","'","96","机","l3","将","受理","目前","原始","zn","码表","密码","19","卡券","措施","借贷","z2","31","降额","二维码","新大","黑名","小票","查询","edc","点击","markup","g5","zu","33","挂失","－","超限","只能","门店","已","84","yj","退货","y7","被窃","合作方","zk","相应","功能","分账","一位","签到","执行","90","类型","3c","字","38","试","查看","yg","rb","g7","bpa","丢失","符号","不到","95","有关","操作员","换","太小","再作","bpp","我们","违禁","与","脱机","重试","超时","和","未找到","打印","无","rc","新","非","可能","f8","内部","c6","存根","个","在","检查","卡号","顾客","信息","扣款","流程","后","保密","部分","0","]","中文","10","yu","账户","密钥","记录","转换","次数","方","yp","r7","小于","机构","等","币种","s1","操作","yc","如果","ccl","标志","不可","有误","类","ca","卖家","信用","段时间","发货","01","取消","重传","把","想要","落地","yf","h3","输入","产品","退款","yz","（","申请","拒绝","全部","请","93","97","yr","支票","找到","自定义","转发","一段时间","验签","getcompinfoa3","zq","卡种","刷卡","表","给出","43","20160913","54","tips","就","暂无","javadoc","a","汇款","k1","均","标记","号","购汇","发卡行","款项","r3","r4","你","状态","可","手工","7","pin","60","可以","信用卡","15","订单号","52","受卡方","prc","系统故障","acr",",","77","区别","加上","zc","固定","收单","处理","yh","s5","表示","r9","付款","yb","r1","重作","持卡人","pbi","za","设施",":","v3","优惠","扫码","管理","交易","-","l2","f1","最新","负号","同一","过期","查","违法","至","81","zh","按照","xx","卡片","异常","时间","码","pvr","未能","预",")","营销","接入","对账","码后","文档","getcompexpirationdate","品牌","getrefnum","c9","记","09","89","zl","故障","j1","重复","提升","后面","标点","pnp","dcc","62","条码","完成","码要","66","z4","zt","此卡","s4","_","、"],"title":"Attachments","title_tokens":["attachments"]},{"location":"attached/attachments/#v320160811","text":"代码 POS显示(计划实施) 00 交易成功 01 \"01-交易失败请联系发卡行\" 02 \"02-交易失败请联系发卡行\" 03 \"03-无效商户请联系客服\" 04 \"04-卡片异常请换卡重试\" 05 \"05-交易失败请联系发卡行\" 06 \"06-交易失败请联系发卡行\" 07 \"07-卡片异常请换卡重试\" 09 \"09-交易失败请重试\" 12 \"12-发卡行不支持的交易\" 13 \"13-无效金额\" 14 \"14-无效卡号请联系发卡行或换卡重试\" 15 \"15-无此发卡行请换卡重试\" 19 \"19-交易失败请重试\" 20 \"20-交易失败请联系发卡行\" 21 \"21-交易失败请联系发卡行\" 22 \"22-操作有误请重试\" 23 \"23-交易失败请联系发卡行\" 25 \"25-未找到原交易请重试或联系客服\" 30 \"30-格式错误请联系客服\" 31 \"31-交易失败请联系客服\" 33 \"33-过期卡请换卡重试\" 34 \"34-卡片异常请联系发卡行\" 35 \"35-卡片异常请联系发卡行\" 36 \"36-卡片异常请联系发卡行\" 37 \"37-卡片异常请联系发卡行\" 38 \"38-密码错误次数超限\" 39 \"39-交易失败请换卡重试\" 40 \"40-不支持的交易类型请联系客服\" 41 \"41-卡片异常请联系发卡行\" 42 \"42-卡片异常请联系发卡行\" 43 \"43-卡片异常请联系发卡行\" 44 \"44-交易失败请联系发卡行\" 45 \"45-请插卡交易或联系客服\" 51 \"51-余额不足\" 52 \"52-交易失败请换卡重试\" 53 \"53-交易失败请换卡重试\" 54 \"54-过期卡请换卡重试\" 55 \"55-密码错误请重试\" 56 \"56-交易失败请换卡重试\" 57 \"57-卡片异常请联系客服或换卡重试\" 58 \"58-未授权的交易请联系客服\" 59 \"59-卡片异常请联系发卡行\" 60 \"60-卡片异常请联系发卡行\" 61 \"61-超出金额限制请联系客服或换卡重试\" 62 \"62-卡片异常请联系发卡行\" 63 \"63-交易失败请联系发卡行\" 64 \"64-交易失败请联系发卡行\" 65 \"65-交易次数超限请联系发卡行\" 66 \"66-交易失败请联系客服\" 67 \"67-卡片异常请联系发卡行\" 68 \"68-交易超时请重试\" 75 \"75-密码错误次数超限\" 76 \"76-交易失败请联系发卡行\" 77 \"77-交易失败请联系客服\" 78 \"78-交易失败请换卡重试\" 79 \"79-脱机交易对账不平请重传数据或联系客服\" 80 \"80-交易失败请联系客服\" 81 \"81-交易失败请联系客服\" 83 \"83-交易失败请联系客服\" 84 \"84-交易失败请联系客服\" 85 \"85-交易失败请联系客服\" 86 \"86-交易失败请联系客服\" 88 \"88-交易失败请联系客服\" 89 \"89-交易失败请联系客服\" 90 \"90-交易失败请稍后重试\" 91 \"91-交易失败请稍后重试\" 92 \"92-交易失败请稍后重试\" 93 \"93-交易失败请联系发卡行\" 94 \"94-交易失败请稍后重试\" 95 \"95-交易失败请稍后重试\" 96 \"96-系统异常请联系客服\" 97 \"97-无效终端请联系客服或检查配置\" 98 \"98-交易超时请重试\" 99 \"99-交易失败请联系客服\" A0 \"A0-请重新签到或联系客服\" B1 \"B1-卡片异常请联系客服或换卡重试\" C0 \"C0-核销失败\" C1 \"C1-卡券已被核销\" C2 \"C2-卡券已过期\" C3 \"C3-无效的卡券\" C4 \"C4-券状态异常\" C5 \"C5-未到卡券使用时间\" C6 \"C6-商户不能使用该卡券\" C7 \"C7-金额太小不可参与优惠\" C8 \"C8-此卡券不能使用此方式进行支付\" C9 \"C9-交易失败，请联系客服\" CA \"CA-付款码与卡券指定支付方式不符\" CB \"CB-卡券订单不存在\" CC \"CC-交易失败请联系客服\" CD \"CD-卡券订单已支付\" L1 \"L1-交易额度超限请联系客服\" L2 \"L2-交易额度超限请联系客服\" L3 \"L3-交易额度超限请联系客服\" RA \"RA-交易失败请联系客服\" RB \"RB-交易失败请联系客服\" RC \"RC-交易失败请联系客服\" RD \"RD-交易失败请联系客服\" Y0 \"Y0-付款码错误或过期，请重试\" Y1 \"Y1-交易失败请联系客服\" Y2 \"Y2-未开通此支付方式，请联系客服\" Y3 \"Y3-订单不存在，请重试\" Y4 \"Y4-未开通此支付方式，请联系客服\" Y5 \"Y5-退款失败，商家账户余额不足\" Y6 \"Y6-退款金额超过原订单金额\" Y7 \"Y7-交易失败请联系客服\" Y8 \"Y8-不支持的交易类型请联系客服\" Y9 \"Y9-订单已关闭或取消\" YA \"YA-交易失败请联系客服\" YB \"YB-交易失败请联系客服\" YC \"YC-交易失败请联系客服\" YD \"YD-交易失败请联系客服\" YE \"YE-该交易类型不能执行此操作\" YF \"YF-该交易类型不能执行此操作\" YG \"YG-原交易已退款\" YH \"YH-只能隔天退款\" YJ \"YJ-不支持的卡类型，请换卡或绑新卡\" YK \"YK-只能撤销当天交易\" YL \"YL-顾客账户状态异常\" YM \"YM-商家账户状态异常\" YN \"YN-付款码与交易渠道不符\" YP \"YP-交易失败请联系客服\" YQ \"YQ-软件版本过低，请升级\" YR \"YR-付款金额小于最低限额\" YS \"YS-交易失败请联系客服\" YT \"YT-姓名校验错误\" YU \"YU-对同一用户操作过于频繁，请稍后重试\" YV \"YV-购汇金额或币种错误\" YW \"YW-额度超限\" YX \"YX-顾客关闭相关功能\" YY \"YY-交易失败请重试\" YZ \"YZ-交易失败请联系客服\" Z0 \"Z0-交易失败请联系客服\" Z1 \"Z1-交易失败请联系客服\" Z2 \"Z2-未授权的交易请联系客服\" Z3 \"Z3-交易失败请联系客服\" Z4 \"Z4-交易失败请联系客服\" Z5 \"Z5-交易失败请联系客服\" Z6 \"Z6-卖家买家账号相同，不能进行交易\" Z7 \"Z7-商户未签约请联系客服\" Z8 \"Z8-交易失败请重试\" Z9 \"Z9-商户未授权请联系客服\" ZA \"ZA-交易失败，请更换支付方式\" ZB \"ZB-交易失败请重试或联系客服\" ZC \"ZC-交易失败请联系客服\" ZD \"ZD-未授权交易请联系客服\" ZE \"ZE-该商户暂无退款权限请联系客服\" ZF \"ZF-交易异常，如有扣款，款项稍后退回\" ZG \"ZG-交易失败，请重试\" ZH \"ZH-交易失败请联系客服\" ZI \"ZI-直接进入扫码流程显示流程界面\" ZJ \"ZJ-直接进入扫码流程显示流程界面\" ZK \"ZK-交易失败请联系客服\" ZL \"ZL-交易失败请联系客服\" ZM \"ZM-买家付款额度超限\" ZN \"ZN-商家收款额度超限\" ZP \"ZP-超出每日限额，请联系客服\" ZQ \"ZQ-提升限额申请正在审核中\" ZR \"ZR-交易失败，请联系客服\" ZS \"ZS-不支持该交易类型，请联系客服\" ZT \"ZT-交易失败请联系客服\" ZU \"ZU-交易失败请联系客服\" ZV \"ZV-未开通此支付方式，请联系客服\" ZY \"ZY-用户取消支付，请重新发起交易\" ZZ \"ZZ-交易失败请联系客服\"","text_tokens":["(","相同"," ","39","yt","插卡","91","z6","中","zy","c1","此卡券","订单","94","绑","界面","37","51","21","44","yx","被","yv","53","联系","ym","56","yn","方式","yk","的","错误","格式","如","新卡","yl","隔天","ys","zz","z5","67","限额","c0","无效","代码","98","买家","34","进行","y5","直接","支持","对","限制","审核","使用","账号","支付","rd","z9","zm","额度","超过","\"","57","76","核销","当天","64","86","88","换卡","软件","不能","04","20","58","zb","y6","发起","36","y3","发卡","a0","系统","zr","99","c3","05","退回","该","更换","终端","z7","45","03","有","c4","未到","未","c2","或","z1","65","配置","校验","59","该卡","cc","渠道","不足","撤销","78","13","每日","pos","85","zf","80","重新","06","过于","权限","进入","卡","用户","ya","显示","12","商家","金额","y9","c8","yy","c5","ze","63","cb","客服","35","cd","42","55","83","79","ra","余额","y4","yq","68","14","存在","22","75","zi","券","，","yw","l1","超出","40","收款","稍后","zd","关闭","02","y1","y0","签约","商户","频繁","zp","不符","b1","z0","07","卡请","92","c7","zg","姓名","参与","指定","版本","过低","无此","yd","zs","相关","实施","61","计划","开通","z3","00","不平","最低","ye","z8","y8","数据","已过期","41","正在","成功","不","失败","23","30","原","y2","此","zj","交易类型","升级","25","授权","zv","96","l3","zn","密码","19","卡券","z2","31","zu","33","超限","只能","已","84","yj","y7","zk","功能","签到","执行","90","类型","38","yg","rb","95","太小","与","脱机","重试","超时","未找到","rc","c6","检查","卡号","顾客","扣款","流程","yu","账户","次数","yp","小于","币种","操作","yc","不可","有误","ca","卖家","01","取消","重传","yf","退款","yz","申请","请","93","97","yr","找到","zq","43","54","暂无","购汇","发卡行","款项","状态","60","15","52","77","zc","yh","付款","yb","za","优惠","扫码","交易","-","l2","同一","过期","81","zh","卡片","异常","时间","码",")","对账","c9","09","89","zl","提升","62","66","z4","zt","此卡"],"title":"交易应答码表V3(20160811更新)","title_tokens":["(","20160811","应答","码表","v3","更新","交易",")"]},{"location":"attached/attachments/#v2pos","text":"注1:银行卡的09和扫码的09有区别 注2:位置应答码展示为 \"XX-交易失败-请联系客服\" 代码 意义 原因/采取的措施 说明 POS显示(计划实施) 00 承兑或交易成功 承兑或交易成功 交易成功 交易成功 01 查发卡行 查发卡行 交易失败-请联系发卡行 01交易失败-请联系客服 02 查发卡行的特殊条件 可电话向发卡行查询 交易失败-请联系发卡行 02交易失败-请联系客服 03 无效商户 商户需要在银行或中心登记 商户未登记 03无效商户-请联系客服 04 没收卡 操作员没收卡 没收卡-请联系收单行 04卡片异常-请联系客服或换卡重试 05 不予承兑 发卡不予承兑 交易失败-请联系发卡行 05交易失败-请联系客服 06 出错 发卡行故障 交易失败-请联系发卡行 06交易失败-请联系客服 07 特殊条件下没收卡 特殊条件下没收卡 没收卡-请联系收单行 07卡片异常-请联系客服或换卡重试 09 请求正在处理中 重新提交交易请求 交易失败-请重试 09请重新操作 12 无效交易 发卡行不支持的交易 交易失败-请联系发卡行 12无效交易-请联系客服 13 无效金额 金额为0 或太大 交易金额超限-请重试 13无效金额-请联系客服 14 无效卡号 卡种未在中心登记或读卡号有误 无效卡号-请联系发卡行 14无效卡号-请联系客服或换卡重试 15 无此发卡行 此发卡行未与中心开通业务 此卡不能受理 15无此发卡行-请联系客服或换卡重试 19 重新送入交易 刷卡读取数据有误-可重新刷卡 交易失败-请联系发卡行 19交易失败-请重试 20 无效应答 无效应答 交易失败-请联系发卡行 20交易失败-请联系客服 21 不做任何处理 不做任何处理 交易失败-请联系发卡行 21交易失败-请联系客服 22 怀疑操作有误 POS状态与中心不符-可重新签到 操作有误-请重试 22操作有误-请重试 23 不可接受的交易费 不可接受的交易费 交易失败-请联系发卡行 23交易失败-请联系客服 25 未能找到文件上记录 发卡行未能找到有关记录 交易失败-请联系发卡行 25无效交易-请联系客服 30 格式错误 格式错误 交易失败-请联系发卡行 30格式错误-请联系客服 31 不支持的银行 此发卡方未与中心开通业务 此卡不能受理 31银行未联网-请联系客服 33 过期的卡 过期的卡-操作员可以没收 过期卡-请联系发卡行 33过期卡-请换卡重试 34 有作弊嫌疑 有作弊嫌疑的卡-操作员可以没收 没收卡-请联系收单行 34卡片异常-请换卡重试 35 受卡方与安全保密部门联系 有作弊嫌疑的卡-操作员可以没收 没收卡-请联系收单行 35卡片异常--请换卡重试 36 受限制的卡 有作弊嫌疑的卡-操作员可以没收 此卡有误-请换卡重试 36卡片异常--请换卡重试 37 受卡方呼受理方安全保密部门(没收卡) 有作弊嫌疑的卡-操作员可以没收 没收卡-请联系收单行 37卡片异常-请换卡重试 38 超过允许的PIN试输入 密码错次数超限-操作员可以没收 密码错误次数超限 38密码错误次数超限 39 无此信用卡账户 可能刷卡操作有误 交易失败-请联系发卡行 39交易失败-请重试 40 请求的功能尚不支持 发卡行不支持的交易类型 交易失败-请联系发卡行 40不支持的交易类型 41 丢失卡 挂失的卡- 操作员可以没收 没收卡-请联系收单行 41卡片异常-请换卡重试 42 无此账户 发卡行找不到此账户 交易失败-请联系发卡方 42卡片异常-请联系客服 43 被窃卡 被窃卡- 操作员可以没收 没收卡-请联系收单行 43卡片异常-请换卡重试 44 无此投资账户 可能刷卡操作有误 交易失败-请联系发卡行 44交易失败-请联系客服或换卡重试 45 请插卡交易 45请插卡交易 51 无足够的存款 账户内余额不足 余额不足-请查询 51余额不足 52 无此支票账户 无此支票账户 交易失败-请联系发卡行 52交易失败-请联系客服 53 无此储蓄卡账户 无此储蓄卡账户 交易失败-请联系发卡行 53交易失败-请联系客服 54 过期的卡 过期的卡 过期卡-请联系发卡行 54过期卡-请换卡重试 55 不正确的PIN 密码输错 密码错-请重试 55密码错误-请重试 56 无此卡记录 发卡行找不到此账户 交易失败-请联系发卡行 56交易失败-请联系客服 57 不允许持卡人进行的交易 不允许持卡人进行的交易 交易失败-请联系发卡行 57未授权的交易-请联系客服 58 不允许终端进行的交易 该商户不允许进行的交易 终端无效-请联系收单行或银联 58未授权的交易-请联系客服 59 有作弊嫌疑 交易失败-请联系发卡行 59交易失败-请联系客服 60 受卡方与安全保密部门联系 交易失败-请联系发卡行 60交易失败-请联系客服 61 超出取款金额限制 一次交易的金额太大 金额太大 61超交易限额-请联系客服或换卡重试 62 受限制的卡 交易失败-请联系发卡行 62卡片异常-请换卡重试 63 违反安全保密规定 违反安全保密规定 交易失败-请联系发卡行 63交易失败-请联系客服 64 原始金额不正确 原始金额不正确 交易失败-请联系发卡行 64原金额错误-请联系客服或重试 65 超出取款次数限制 超出取款次数限制 超出取款次数限制 65超交易次数-请联系客服 66 受卡方呼受理方安全保密部门 受卡方呼受理方安全保密部门 交易失败-请联系收单行或银联 66交易失败-请联系客服 67 捕捉（没收卡） 捕捉（没收卡） 没收卡 67卡片异常-请换卡重试 68 收到的回答太迟 发卡行规定时间内没有回答 交易超时-请重试 68交易超时-请重试 75 允许的输入PIN次数超限 允许的输入PIN次数超限 密码错误次数超限 75密码错误次数超限 76 76交易失败-请联系客服 77 需要向网络中心签到 POS批次与网络中心不一致 请向网络中心签到 77交易失败-请联系客服 78 78交易失败-请联系客服 79 脱机交易对账不平 POS终端上传的脱机数据对账不平 POS终端重传脱机数据 79对账不平-请联系客服 80 80交易失败-请联系客服 81 81交易失败-请联系客服 83 83交易失败-请联系客服 84 84交易失败-请联系客服 85 85交易失败-请联系客服 86 86交易失败-请联系客服 88 88交易失败-请联系客服 89 89交易失败-请联系客服 90 日期切换正在处理 日期切换正在处理 交易失败-请稍后重试 90交易失败-请稍后重试 91 发卡行或收单银行不能操作 电话查询发卡方或收单银行-可重作 交易失败-请稍后重试 91交易失败-请联系客服 92 金融机构或中间网络设施找不到或无法达到 电话查询发卡方或网络中心-可重作 交易失败-请稍后重试 92交易失败-请联系客服 93 交易违法、不能完成 交易违法、不能完成 交易失败-请联系发卡行 93交易失败-请联系客服 94 重复交易 查询网络中心-可重新签到作交易 交易失败-请稍后重试 94重复交易 95 调节控制错 调节控制错 交易失败-请稍后重试 95交易失败-请联系客服 96 系统异常、失效 发卡方或网络中心出现故障 交易失败-请稍后重试 96交易失败-请联系客服 97 POS终端号找不到 终端未在中心或银行登记 终端未登记-请联系收单行或银联 97无效终端-请联系客服或检查配置 98 收不到发卡行应答 收不到发卡行应答 交易超时-请重试 98交易超时-请重试 99 PIN格式错 可重新签到作交易 校验错-请重新签到 99交易失败-请联系客服 A0 MAC校验错 可重新签到作交易 校验错-请重新签到 A0请重新签到或联系客服 C1 卡券已被核销 C1卡券已被核销 C2 卡券已过期 C2卡券已过期 C3 无效的卡券 C3无效的卡券 09 处理中 正常应答-表明该交易需要输入密码-完成后发起查询确认交易状态 09处理中 Y1 商户密钥错误 核实商户交易密钥是否正确 12改为Y1 Y1交易失败-请联系客服 Y0 付款码错误或过期 刷新条码后-重新扫码-发起支付 14改为Y0 Y0付款码错误或过期 ZH 订单号重复 订单号重复-使用新订单号发起交易-建议订单号加上时间防止重复 19改为ZH ZH订单号重复 Y3 订单不存在 该订单系统不存在-不能进行相应操作 25改为Y3 Y3订单不存在 Y4 商户未申请开通此支付方式 查看商户是否提交该渠道申请-如以提交-核实是否有配置路由信息 31改为Y4 Y4不支持此支付方式 Y5 退款失败-商家账户余额不足 建议商家先进行一笔收款-再发起退款 61改为Y5 Y5退款失败-商家账户余额不足 Y6 退款金额超过原订单金额 退款金额需要小于等于可退款金额 64改为Y6 Y6退款金额超过原订单金额 Y7 外部系统错误 具体描述可返回渠道中文描述字段 91改为Y7 Y7交易失败-请联系客服 Y2 商户无此交易渠道权限 H1改为Y2 Y2未授权的交易 Y8 商户无此接口权限 核实该商户是否配置了该接口权限 H2改为Y8 Y8交易失败-请联系客服 Y9 订单已关闭或取消 订单已关闭或取消-不能进行相应操作 H3改为Y9 Y9订单已关闭或取消 YA [字段名]不能为空 检查出错字段 H4改为YA YA交易失败-请联系客服 YB [字段名]格式错误 检查出错字段 H5改为YB YB交易失败-请联系客服 YC 交易状态不合法 检查交易状态是否正常 H6改为YC YC交易失败-请联系客服 YD 交易信息中包含违禁词汇 检查交易信息中是否包含违禁词汇 H7改为YD YD交易失败-请联系客服 YE 原交易非支付交易 原交易非支付交易-不能执行此类操作 R1改为YE YE原交易非支付交易 YF 原交易未成功支付 原交易未成功支付-部分交易不能执行 R2改为YF YF原交易未成功支付 YG 原交易已退款 R3改为YG YG原交易已退款 YH 只能隔天退款 R4改为YH YH只能隔天退款 YJ 不支持的卡类型-请换卡或绑新卡 R5改为YJ YJ不支持的卡类型-请换卡或绑新卡 YK 只能撤销当天交易 R6改为YK YK只能撤销当天交易 YL 顾客账户状态异常 R7改为YL YL顾客账户状态异常 YM 商家账户状态异常 R8改为YM YM商家账户状态异常 YN 付款码与交易渠道不符 R9改为YN YN付款码与交易渠道不符 YP 分账信息不正确 S1改为YP YP交易失败-请联系客服 YQ 软件版本过低-请升级 S2改为YQ YQ软件版本过低-请升级 YR 付款金额小于最低限额 S3改为YR YR付款金额小于最低限额 YS Openid错误 S4改为YS YS交易失败-请联系客服 YT 姓名校验错误 S5改为YT YT姓名校验错误 YU 对同一用户操作过于频繁-请稍候重试 S6改为YU YU对同一用户操作过于频繁-请稍候重试 YV 购汇金额或币种错误 S7改为YV YV购汇金额或币种错误 YW 额度超限 S8改为YW YW额度超限 YX 顾客关闭相关功能 S9改为YX YX顾客关闭相关功能 YY 授权码code错误 J1改为YY YY交易失败-请联系客服 YZ 渠道商户秘钥未配置或配置错误 YZ交易失败-请联系客服 C0 核销失败 C0核销失败 C4 券状态异常 C4券状态异常 C5 未到卡券使用时间 请在卡券有效期内使用 C5未到卡券使用时间 C6 商户不能使用该卡券 C6商户不能使用该卡券 C7 金额达不到满足优惠条件的最小金额 C7金额太小-不可参与优惠 C8 此卡券不能使用此方式进行支付 请使用卡券指定的支付方式 C8此卡券不能使用此方式进行支付 Z0 渠道商户信息有误 检查系统渠道商户配置和渠道是否一致-或者看渠道商户具体应答 E0改为Z0 Z0交易失败-请联系客服 Z1 渠道受理机构信息配置有误 检查与渠道给出信息是否一致-或者看具体应答错误码 E1改为Z1 Z1交易失败-请联系客服 Z2 渠道不支持该业务 如不支持部分退款等 E2改为Z2 Z2未授权的交易-请联系客服 Z3 接入渠道IP验证异常 看渠道方是否有将我方IP配置 99改为Z3 Z3交易失败-请联系客服 Z4 门店状态异常 门店状态被改为异常状态 G1改为Z4 Z4交易失败-请联系客服 Z5 渠道商户状态异常 渠道商户状态被改为异常状态 G2改为Z5 Z5交易失败-请联系客服 Z6 卖家买家账号相同-不能进行交易 通知商户不能用自己账户进行交易-一定要使用其他人账户 G3改为Z6 Z6账号有误-请联系客服 Z7 没有签约扫码支付接口或签约失效 通知商户进行签约 G4改为Z7 Z7未授权的交易-请联系客服 Z8 支付失败-请顾客刷新付款码后重新收款-如再次收款失败-请联系管理员处理 重新扫码收款 G5改为Z8 Z8交易失败-请重试 Z9 未进行应用授权或授权已过期 通知商户重新进行授权操作 G6改为Z9 Z9未授权的交易-请联系客服 ZA 该银行卡已失效-请联系发卡行了解详情-或更换其他支付方式 更换其他支付方式-比如换一张卡或使用钱包余额支付 G7改为ZA ZA交易失败-请更换支付方式 ZB 内部系统操作超时 请重试交易 G9改为ZB ZB交易失败-请联系客服 ZC 渠道验签错误 请至支付宝后台上传公玥 K1改为ZC ZC交易失败-请联系客服 ZD 商户未签约该产品-请按流程完成签约 请按流程完成签约并确认签约成功 K2改为ZD ZD未授权交易-请联系客服 ZE 商户需授权服务商退款接口权限 请服务商按照指引流程-完成授权 K3改为ZE ZE未授权交易-请联系客服 ZF 交易失败-如顾客反馈扣款成功-款项将会在一段时间后退回 不进行发货处理-重新进行一笔收款 F1改为ZF ZF交易失败-请联系客服 ZG 交易失败-请重新发起交易 F8改为ZG ZG交易失败-请重试 E1 程序异常 E1交易失败-请联系客服 E2 配置错误 E2交易失败-请联系客服 E4 E4交易失败-请联系客服 L1 机构额度超限 L1交易失败-请联系客服 L2 商户额度单笔超限 L2交易失败-请联系客服 L3 商户额度单日超限 B1 卡片黑名单 B1交易失败-请联系客服 RA 规则预警 RA交易失败-请联系客服 RB 预警联机拒交易 RB交易失败-请联系客服 RC 预警降额拒交易类P RC交易失败-请联系客服 RD 预警降额拒交易类A RD交易失败-请联系客服","text_tokens":["位置","(","相同","s8"," ","39","yt","意义","一致","日期","插卡","91","h7","出错","详情","z6","中","c1","此卡券","做","订单","94","应答","--","绑","太大","37","钱包","51","21","一定","44","yx","r2","受卡方呼","被","达","yv","53","特殊","词汇","了解","联系","内","太迟","包含","需","指引","ym","表明","为空","按","预警","56","yn","方式","yk","的","没收","任何","错误","文件","读取","格式","新卡","投资","[","yl","如","隔天","ys","z5","67","后台","限额","再","c0","无效","代码","条件","s7","展示","98","s3","34","买家","进行","返回","了","字段","受限","y5","e4","作","k3","其他人","失效","先","其他","支持","正常","对","卡人","要","中心","请求","限制","/","使用","用","账号","存款","联机","g1","描述","支付","rd","z9","额度","超过","持卡","\"","57","收不到","76","核销","再次","储蓄卡","当天","64","怀疑","86","88","换卡","太","防止","软件","尚","不能","04","控制","优惠条件","20","58","g2","规则","错误码","允许","刷新","zb","部门","code","h6","发起","y6","2","36","y3","e2","是否","发卡","a0","安全","系统","99","r5","c3","05","退回","该","更换","终端","黑名单","说明","方未","网络","通知","z7","45","有","03","作弊","没有","s6","c4","未到","取款","金融机构","未","c2","收到","将会","s2","或","z1","65","名单","为","配置","校验","mac","1","59","该卡","渠道","业务","不足","调节","撤销","78","公玥","电话","提交","13","e1","嫌疑","pos","s9","h1","85","自己","zf","超","80","服务商","g4","重新","银行卡","06","过于","权限","稍候","卡","网络设施","一笔","接受","用户","字段名","承兑","接口","输错","读取数据","足够","ya","r8","采取","有效期","错","g9","显示","g3","12","效期","商家","金额","y9","c8","出现","一张","yy","c5","ze","单笔","服务","63","拒","客服","达到","35","原因","或读","一次","最小","）","他人","反馈","42","55","批次","如以","银行","收","83","比如","误码","79","ra","余额","y4","yq","68","h2","看","一段","回答","14","存在","我方","正确","22","未登记","应用","确认","银联","75","金融","大","券","中间","切换","yw","l1","此类","超出","40","合法","收款","稍后","zd","建议","有效","关闭","02","y1","openid","秘钥","y0","规定","h5","签约","商户","频繁","r6","不符","b1","z0","07","92","c7","zg","ip","姓名","单日","下","p","g6","参与","指定","版本","等于","向","h4","过低","无此","yd","送入","登记","相关","程序","受限制","找","无法","并","实施","61","或者","计划","满足","开通","违反","z3","注","00","不平","储蓄","最低","ye","z8","段","e0","支付宝","联网","单行","具体","y8","数据","费","不予","已过期","41","需要","核实","正在","验证","单号","成功","路由","不","k2","管理员","上","失败","23","30","捕捉","上传","原","外部","或太大","y2","此","交易类型","升级","25","授权","改为","96","l3","将","受理","原始","密码","19","措施","卡券","z2","31","降额","黑名","查询","g5","33","挂失","超限","只能","门店","已","84","yj","被窃","y7","相应","分账","功能","签到","90","类型","执行","字","38","试","查看","yg","g7","rb","丢失","不到","95","有关","操作员","换","太小","违禁","与","脱机","重试","超时","和","无","rc","新","非","可能","f8","内部","c6","在","检查","卡号","顾客","信息","流程","部分","后","保密","扣款","0","]","中文","yu","账户","密钥","记录","次数","方","yp","r7","机构","小于","等","币种","s1","操作","yc","不可","有误","类","卖家","信用","段时间","发货","01","取消","重传","h3","yf","输入","产品","退款","yz","（","申请","请","支票","93","97","yr","找到","一段时间","验签","卡种","刷卡","给出","43","54","a","k1","号","购汇","发卡行","款项","r3","r4","可","状态","pin","可以","60","信用卡","15","订单号","受卡方","52","77","区别","加上","zc","收单","处理","yh","s5","r9","付款","yb","r1","重作","持卡人","za","设施",":","优惠","扫码","管理","f1","交易","-","l2","同一","查","过期","违法","至","81","zh","按照","xx","卡片","异常","时间","码","未能",")","接入","对账","码后","09","89","故障","j1","重复","62","条码","完成","66","s4","z4","此卡","、"],"title":"交易应答码表V2(智能POS)","title_tokens":["(","应答","码表","v2","交易","智能","pos",")"]},{"location":"attached/attachments/#v1pos","text":"交易返回合作方时都有 39 域，合作方和终端需根据应答码要采取相应的操作，可以把操作分为以下几类: A:交易成功 B:交易失败, 可重试 C:交易失败, 不需要重试 D:交易失败, 终端操作员处理 E:交易失败, 系统故障, 不需要重试 注 1: 如果 39 域的内容不能在下表中找到，就显示“交易失败” 注 2: 如果POS交易的批次号和网络中心批次号不一致时应答码会填 “77”，此时POS机应当提示操作员重新签到， 再作交易。 代码 意义 类别 原因/采取的措施 说明 00 承兑或交易成功 A 承兑或交易成功 交易成功 01 查发卡行 C 查发卡行 交易失败，请联系发卡行 02 查发卡行的特殊条件 C 可电话向发卡行查询 交易失败，请联系发卡行 03 无效商户 C 商户需要在银行或中心登记 商户未登记 04 没收卡 D 操作员没收卡 没收卡，请联系收单行 05 不予承兑 C 发卡不予承兑 交易失败，请联系发卡行 06 出错 E 发卡行故障 交易失败，请联系发卡行 07 特殊条件下没收卡 D 特殊条件下没收卡 没收卡，请联系收单行 09 请求正在处理中 B 重新提交交易请求 交易失败，请重试 12 无效交易 C 发卡行不支持的交易 交易失败，请联系发卡行 13 无效金额 B 金额为 0 或太大 交易金额超限，请重试 14 无效卡号 B 卡种未在中心登记或读卡号有误 无效卡号，请联系发卡行 15 无此发卡行 C 此发卡行未与中心开通业务 此卡不能受理 19 重新送入交易 C 刷卡读取数据有误，可重新刷卡 交易失败，请联系发卡行 20 无效应答 C 无效应答 交易失败，请联系发卡行 21 不做任何处理 C 不做任何处理 交易失败，请联系发卡行 22 怀疑操作有误 C POS 状态与中心不符，可重新签到 操作有误，请重试 23 不可接受的交易费 C 不可接受的交易费 交易失败，请联系发卡行 25 未能找到文件上记录 C 发卡行未能找到有关记录 交易失败，请联系发卡行 30 格式错误 C 格式错误 交易失败，请联系发卡行 31 不支持的银行 C 此发卡方未与中心开通业务 此卡不能受理 33 过期的卡 D 过期的卡，操作员可以没收 过期卡，请联系发卡行 34 有作弊嫌疑 D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 35 受卡方与安全保密部门联系 D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 36 受限制的卡 D 有作弊嫌疑的卡，操作员可以没收 此卡有误，请换卡重试 37 受卡方呼受理方安全保密部门(没收卡) D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 38 超过允许的 PIN 试输入 D 密码错次数超限，操作员可以没收 密码错误次数超限 39 无此信用卡账户 C 可能刷卡操作有误 交易失败，请联系发卡行 40 请求的功能尚不支持 C 发卡行不支持的交易类型 交易失败，请联系发卡行 41 丢失卡 D 挂失的卡，操作员可以没收 没收卡，请联系收单行 42 无此账户 B 发卡行找不到此账户 交易失败，请联系发卡方 43 被窃卡 D 被窃卡， 操作员可以没收 没收卡，请联系收单行 44 无此投资账户 C 可能刷卡操作有误 交易失败，请联系发卡行 51 无足够的存款 C 账户内余额不足 余额不足，请查询 52 无此支票账户 C 无此支票账户 交易失败，请联系发卡行 53 无此储蓄卡账户 C 无此储蓄卡账户 交易失败，请联系发卡行 54 过期的卡 C 过期的卡 过期卡，请联系发卡行 55 不正确的 PIN C 密码输错 密码错，请重试 56 无此卡记录 C 发卡行找不到此账户 交易失败，请联系发卡行 57 不允许持卡人进行的交易 C 不允许持卡人进行的交易 交易失败，请联系发卡行 58 不允许终端进行的交易 C 该商户不允许进行的交易 终端无效，请联系收单行或银联 59 有作弊嫌疑 C 交易失败，请联系发卡行 60 受卡方与安全保密部门联系 C 交易失败，请联系发卡行 61 超出取款金额限制 C 一次交易的金额太大 金额太大 62 受限制的卡 C 交易失败，请联系发卡行 63 违反安全保密规定 C 违反安全保密规定 交易失败，请联系发卡行 64 原始金额不正确 C 原始金额不正确 交易失败，请联系发卡行 65 超出取款次数限制 C 超出取款次数限制 超出取款次数限制 66 受卡方呼受理方安全保密部门 C 受卡方呼受理方安全保密部门 交易失败，请联系收单行或银联 67 捕捉(没收卡) C 捕捉(没收卡) 没收卡 68 收到的回答太迟 C 发卡行规定时间内没有回答 交易超时，请重试 75 允许的输入 PIN 次数超限 C 允许的输入 PIN 次数超限 密码错误次数超限 77 需要向网络中心签到 D POS 批次与网络中心不一致 请向网络中心签到 79 脱机交易对账不平 C POS 终端上传的脱机数据对账不 平 POS 终端重传脱机数据 90 日期切换正在处理 C 日期切换正在处理 交易失败，请稍后重试 91 发卡行或收单银行不能操作 C 电话查询发卡方或收单银行，可重作 交易失败，请稍后重试 92 金融机构或中间网络设施无法达到 C 电话查询发卡方或网络中心，可重 作 交易失败，请稍后重试 93 交易违法、不能完成 C 交易违法、不能完成 交易失败，请联系发卡行 94 重复交易 C 查询网络中心，可重新签到作交易 交易失败，请稍后重试 95 调节控制错 C 调节控制错 交易失败，请稍后重试 96 系统异常、失效 C 发卡方或网络中心出现故障 交易失败，请稍后重试 97 POS 终端号找不到 D 终端未在中心或银行登记 终端未登记，请联系收单行或银联 98 收不到发卡行应答 E 收不到发卡行应答 交易超时，请重试 99 PIN 格式错 B 可重新签到作交易 校验错，请重新签到 A0 MAC 校验错 B 可重新签到作交易 校验错，请重新签到 C1 卡券已被核销 C C2 卡券已过期 C C3 无效的卡券 C","text_tokens":["("," ","39","一致","意义","日期","91","出错","中","c1","做","下表中","应答","94","太大","37","51","21","时","44","合作","受卡方呼","被","53","特殊","联系","内","太迟","需","e","c","56","的","没收","任何","错误","文件","读取","格式","投资","67","无效","代码","条件","98","34","都","返回","进行","受限","作","失效","支持","卡人","中心","请求","限制","/","存款","域","超过","持卡","57","收不到","核销","储蓄卡","64","怀疑","换卡","太","尚","不能","04","控制","20","58","允许","部门","2","36","类别","发卡","安全","a0","系统","此时","99","c3","05","该","终端","会填","说明","网络","方未","有","03","作弊","没有","取款","金融机构","未","c2","收到","或","65","d","为","校验","mac","1","59","可重","业务","。","不足","调节","电话","提交","13","b","嫌疑","pos","重新","06","卡","网络设施","接受","承兑","输错","读取数据","足够","应当","采取","根据","错","显示","12","采取相应","分为","金额","出现","内容","63","达到","35","原因","或读","一次","42","55","批次","银行","收","79","余额","68","回答","14","正确","22","未登记","银联","提示","75","“","金融","大","中间","，","切换","超出","40","稍后","02","规定","商户","不符","07","92","下","向","”","无此","送入","登记","受限制","找","无法","61","开通","违反","几类","注","00","不平","储蓄","单行","数据","费","不予","已过期","41","需要","正在","平","成功","不","上","失败","23","30","捕捉","上传","或太大","此","以下","交易类型","25","机","96","受理","原始","密码","19","措施","卡券","31","查询","33","挂失","超限","已","被窃","合作方","相应","功能","签到","90","类型","38","试","丢失","不到","95","有关","操作员","再作","与","脱机","重试","超时","和","无","可能","在","卡号","保密","0","账户","记录","次数","方","机构","如果","操作","不可","有误","信用","01","把","重传","输入","请","支票","93","97","找到","卡种","刷卡","43","54","就","a","号","发卡行","可","状态","pin","可以","60","信用卡","15","受卡方","52","系统故障",",","77","收单","处理","重作","持卡人","设施",":","交易","查","过期","违法","异常","时间","码","未能",")","对账","09","故障","重复","62","码要","完成","66","、"],"title":"交易应答码表V1(传统POS)","title_tokens":["(","应答","码表","v1","交易","传统","pos",")"]},{"location":"attached/attachments/#_1","text":"processflag取值如下，用于标记处理成功还是失败。 代码 意义 说明 0 成功 1 受理方拒绝 2 转发方失败 3 渠道拒绝 扫码交易，查询失败后超时选择该状态，表示该笔09应答码交易是失败交易 4 超时 5 处理中 6 落地","text_tokens":["方","是","标记","码","取值","processflag"," ","5","状态","意义","受理","6","2","用于","，","超时","中","该笔","选择","落地","还是","处理","1","4","拒绝","如下","表示","应答","查询","该","09","3","渠道","成功","。","转发","说明","失败","后","0","代码","扫码","交易"],"title":"交易处理标志","title_tokens":["处理","标志","交易"]},{"location":"attached/attachments/#_2","text":"revflag取值如下，用于标记源交易。 代码 意义 说明 0 正常 1 冲正 2 撤销 3 退货 4 汇款 5 完成 6 手工退货 7 手工完成 8 手工撤销","text_tokens":["汇款","标记","8","取值"," ","5","手工","意义","冲正","7","6","revflag","2","用于","，","正常","源","1","4","如下","3","。","撤销","说明","退货","0","代码","完成","交易"],"title":"交易冲正标志","title_tokens":["标志","冲正","交易"]},{"location":"attached/attachments/#_3","text":"小票（签购单）样例，银行卡类小票和扫码类小票： 其他说明 签购单中，可以有空行 交易金额显示，如为退货或撤销，均在金额前显示负号 卡号后面的一位字母，刷卡方式，取值：S（刷卡）、I(插卡)、M（无卡）、C（非接） 卡号后面的3位字母，卡品牌CUP 原凭证号：只有撤销或退货时显示 TAG：8583规范中的子域名，必须打印 各项内容必须完备，排版可以略有不同 标点符号全部为半角 银联卡消费打印的签购单中，必须要显示的内容： 内容 字段取值 备注 商户/持卡人/银行存根 固定文本 客户ID 0000000000 目前为10个0 商户名称 Config.IsoMsg.MERCHANT_NAME 商户号 response.getTrans().getCompInfoA2() 终端号 response.getTrans().getCompInfoA3() 卡号 response.getTrans().getCardNo() + response.getTrans().getCardType() + response.getTrans().getCardBrand() 卡号 + 刷卡方式(1S 2I 3C) + 卡品牌 有效期 response.getTrans().getCompExpirationDate() 需格式转换 MM/YY （为空不打印） 收单行 response.getTrans().compInfoA1() 发卡行 response.getTrans().getAdditionalResData() 交易类型 response.getTrans().getTransCode() 需转换，见下文'交易类型码表' 授权码 response.getTrans().getRevAuthCode() 批次号 response.getTrans().getBatchNum() 凭证号 response.getTrans().getTraceNum() 日期时间 response.getTrans().getTransDate() + response.getTrans().getTransDatetime() 需格式转换 参考号 response.getTrans().getRefNum() 交易金额 response.getTrans().getTransAmt() 小费（Tips） 签名 备注 版本 TAG","text_tokens":["字","(","gettransamt","银联","gettrans","getcompinfoa2","符号","名称"," ","必须","不同","日期","插卡","标点符号","，","发卡","消费","完备","和","中","打印","getcardno","只有","0000000000","有效","终端","存根","个","在","时","小费","卡号","说明","无卡","样例","0","字母","10","有","config","商户","转换","需","单中","取值","为空","或","gettracenum","规范","response","类","gettransdatetime","cup","c","方式","compinfoa1","为","的","前","银联卡","格式","gettranscode","（","版本","全部","getbatchnum","撤销","半角","签购","getcompinfoa3","如为","刷卡","tips","isomsg","均","getcardbrand","号","发卡行","8583","银行卡","tag","签名","空行","可以","卡","排版","其他","段","单行","参考","凭证","固定","域名","要","卡人","1s","gettransdate","3","有效期","显示","/","不","持卡人",".","merchant","位","效期","m","原","：","扫码","略有","交易","交易类型","金额","负号","授权","yy","2i","子","s","时间","内容","'","码","单","持卡",")","目前","备注","文本","name","各项","下文","码表","i","）","mm","略有不同","getcompexpirationdate","getrevauthcode","品牌","客户","id","批次","银行","小票","收","getrefnum","后面","标点","+","退货","getcardtype","非接","一位","_","见下文","getadditionalresdata","类型","、","3c"],"title":"签购单规范","title_tokens":["单","签购","规范"]},{"location":"attached/attachments/#_4","text":"transCode 意义 小票打印 PER 消费 PBI 余额查询 PEC 消费冲正 PVR 撤销 PVC 消费撤销冲正 CTH 退货 PPA 预授权 PNP 预授权撤销 ACR 预授权完成 PCR 预授权完成撤销 PPC 预授权冲正 PMC 预授权撤销冲正 PCC 预授权完成冲正 PRC 预授权完成撤销冲正 BPA 条码支付下单 BPP 条码支付预下单 BVD 条码支付撤销 BTH 条码支付退货 BVE 条码支付取消 BPI 条码支付查询 PER2EDC PER类交易DCC－EDC交易 ACR2EDC ACR类交易DCC－EDC交易 TTD 小费 TVD 小费撤销 CASH 现金交易 CCL 现金撤销","text_tokens":["支付","transcode","pvc","现金交易","bpa","per","pvr","ppa","pec","预"," ","bpi","ccl","cash","pcc","bpp","意义","冲正","类","消费","prc","acr","取消","打印","bve","bvd","acr2edc","小票","tvd","查询","下单","edc","per2edc","撤销","dcc","余额","ppc","cth","pbi","pnp","－","小费","条码","退货","现金","bth","pcr","完成","交易","ttd","授权","pmc"],"title":"交易类型码表","title_tokens":["交易类型","码表","类型","交易"]},{"location":"attached/attachments/#-","text":"如果你想要自定义小票的样式，可以参考 新大陆 提供的打印文档，点击 新大陆-打印规范.doc 可以下载。","text_tokens":["大陆","如果"," ","你","自定","规范","可以","，","的","参考","打印","想要","文档","新大","小票","新大陆","点击","。","提供","自定义","定义",".","doc","样式","-","下载"],"title":"新大陆-打印规范","title_tokens":["大陆","新大","新大陆","-","打印","规范"]},{"location":"attached/attachments/#_5","text":"按照银联最新规范，终端展示/打印信息需要根据8583报文中57域信息。因此，SDK中Trans新增部分字段 字段名 意义 compInfoA1 签购单收单行 compInfoA2 签购单商户号 compInfoA3 签购单终端号 compInfoA4 markup compInfoA6 借贷记标识 compInfoA7 营销信息 compInfoA8 二维码信息 详细字段信息可查看 javadoc 中com.cardinfolink.pos.sdk.model.Trans信息","text_tokens":["compinfoa2","按照","字","查看","字段","银联","打印信息","号","8583","域","com","单"," ","可","意义","model","规范","compinfoa3","57","营销","段","，","字段名","compinfoa1","pos","单行","中","商户","打印","借贷","二维码","需要","报文","compinfoa6","记","cardinfolink","详细","终端","根据","compinfoa4","。","markup","/","信息","javadoc",".","部分","sdk","签购","compinfoa7","最新","印信","二维","标识","展示","因此","trans","新增","单收","compinfoa8"],"title":"终端相应合规信息取值","title_tokens":["合规","取值","终端","相应","信息"]},{"location":"attached/attachments/#_6","text":"我们提供了币种和代码对应的一个表格的 PDF 文档，点击 币种代码表20160913.pdf 可以下载。","text_tokens":["了","币种"," ","一个","我们","可以","，","的","和","文档","点击","。","提供","对应",".","表","pdf","代码","20160913","下载","表格"],"title":"币种代码对应表","title_tokens":["对应","币种","表","代码"]},{"location":"attached/fenghuAnserCode/","text":"交易应答码表V2(智能POS) 注1:银行卡的09和扫码的09有区别 注2:位置应答码展示为 \"XX-交易失败-请联系客服\" 代码 意义 原因/采取的措施 说明 POS显示(计划实施) 00 承兑或交易成功 承兑或交易成功 交易成功 交易成功 01 查发卡行 查发卡行 交易失败-请联系发卡行 01交易失败-请联系客服 02 查发卡行的特殊条件 可电话向发卡行查询 交易失败-请联系发卡行 02交易失败-请联系客服 03 无效商户 商户需要在银行或中心登记 商户未登记 03无效商户-请联系客服 04 没收卡 操作员没收卡 没收卡-请联系收单行 04卡片异常-请联系客服或换卡重试 05 不予承兑 发卡不予承兑 交易失败-请联系发卡行 05交易失败-请联系客服 06 出错 发卡行故障 交易失败-请联系发卡行 06交易失败-请联系客服 07 特殊条件下没收卡 特殊条件下没收卡 没收卡-请联系收单行 07卡片异常-请联系客服或换卡重试 09 请求正在处理中 重新提交交易请求 交易失败-请重试 09请重新操作 12 无效交易 发卡行不支持的交易 交易失败-请联系发卡行 12无效交易-请联系客服 13 无效金额 金额为0 或太大 交易金额超限-请重试 13无效金额-请联系客服 14 无效卡号 卡种未在中心登记或读卡号有误 无效卡号-请联系发卡行 14无效卡号-请联系客服或换卡重试 15 无此发卡行 此发卡行未与中心开通业务 此卡不能受理 15无此发卡行-请联系客服或换卡重试 19 重新送入交易 刷卡读取数据有误-可重新刷卡 交易失败-请联系发卡行 19交易失败-请重试 20 无效应答 无效应答 交易失败-请联系发卡行 20交易失败-请联系客服 21 不做任何处理 不做任何处理 交易失败-请联系发卡行 21交易失败-请联系客服 22 怀疑操作有误 POS状态与中心不符-可重新签到 操作有误-请重试 22操作有误-请重试 23 不可接受的交易费 不可接受的交易费 交易失败-请联系发卡行 23交易失败-请联系客服 25 未能找到文件上记录 发卡行未能找到有关记录 交易失败-请联系发卡行 25无效交易-请联系客服 30 格式错误 格式错误 交易失败-请联系发卡行 30格式错误-请联系客服 31 不支持的银行 此发卡方未与中心开通业务 此卡不能受理 31银行未联网-请联系客服 33 过期的卡 过期的卡-操作员可以没收 过期卡-请联系发卡行 33过期卡-请换卡重试 34 有作弊嫌疑 有作弊嫌疑的卡-操作员可以没收 没收卡-请联系收单行 34卡片异常-请换卡重试 35 受卡方与安全保密部门联系 有作弊嫌疑的卡-操作员可以没收 没收卡-请联系收单行 35卡片异常--请换卡重试 36 受限制的卡 有作弊嫌疑的卡-操作员可以没收 此卡有误-请换卡重试 36卡片异常--请换卡重试 37 受卡方呼受理方安全保密部门(没收卡) 有作弊嫌疑的卡-操作员可以没收 没收卡-请联系收单行 37卡片异常-请换卡重试 38 超过允许的PIN试输入 密码错次数超限-操作员可以没收 密码错误次数超限 38密码错误次数超限 39 无此信用卡账户 可能刷卡操作有误 交易失败-请联系发卡行 39交易失败-请重试 40 请求的功能尚不支持 发卡行不支持的交易类型 交易失败-请联系发卡行 40不支持的交易类型 41 丢失卡 挂失的卡- 操作员可以没收 没收卡-请联系收单行 41卡片异常-请换卡重试 42 无此账户 发卡行找不到此账户 交易失败-请联系发卡方 42卡片异常-请联系客服 43 被窃卡 被窃卡- 操作员可以没收 没收卡-请联系收单行 43卡片异常-请换卡重试 44 无此投资账户 可能刷卡操作有误 交易失败-请联系发卡行 44交易失败-请联系客服或换卡重试 45 请插卡交易 45请插卡交易 51 无足够的存款 账户内余额不足 余额不足-请查询 51余额不足 52 无此支票账户 无此支票账户 交易失败-请联系发卡行 52交易失败-请联系客服 53 无此储蓄卡账户 无此储蓄卡账户 交易失败-请联系发卡行 53交易失败-请联系客服 54 过期的卡 过期的卡 过期卡-请联系发卡行 54过期卡-请换卡重试 55 不正确的PIN 密码输错 密码错-请重试 55密码错误-请重试 56 无此卡记录 发卡行找不到此账户 交易失败-请联系发卡行 56交易失败-请联系客服 57 不允许持卡人进行的交易 不允许持卡人进行的交易 交易失败-请联系发卡行 57未授权的交易-请联系客服 58 不允许终端进行的交易 该商户不允许进行的交易 终端无效-请联系收单行或银联 58未授权的交易-请联系客服 59 有作弊嫌疑 交易失败-请联系发卡行 59交易失败-请联系客服 60 受卡方与安全保密部门联系 交易失败-请联系发卡行 60交易失败-请联系客服 61 超出取款金额限制 一次交易的金额太大 金额太大 61超交易限额-请联系客服或换卡重试 62 受限制的卡 交易失败-请联系发卡行 62卡片异常-请换卡重试 63 违反安全保密规定 违反安全保密规定 交易失败-请联系发卡行 63交易失败-请联系客服 64 原始金额不正确 原始金额不正确 交易失败-请联系发卡行 64原金额错误-请联系客服或重试 65 超出取款次数限制 超出取款次数限制 超出取款次数限制 65超交易次数-请联系客服 66 受卡方呼受理方安全保密部门 受卡方呼受理方安全保密部门 交易失败-请联系收单行或银联 66交易失败-请联系客服 67 捕捉（没收卡） 捕捉（没收卡） 没收卡 67卡片异常-请换卡重试 68 收到的回答太迟 发卡行规定时间内没有回答 交易超时-请重试 68交易超时-请重试 75 允许的输入PIN次数超限 允许的输入PIN次数超限 密码错误次数超限 75密码错误次数超限 76 76交易失败-请联系客服 77 需要向网络中心签到 POS批次与网络中心不一致 请向网络中心签到 77交易失败-请联系客服 78 78交易失败-请联系客服 79 脱机交易对账不平 POS终端上传的脱机数据对账不平 POS终端重传脱机数据 79对账不平-请联系客服 80 80交易失败-请联系客服 81 81交易失败-请联系客服 83 83交易失败-请联系客服 84 84交易失败-请联系客服 85 85交易失败-请联系客服 86 86交易失败-请联系客服 88 88交易失败-请联系客服 89 89交易失败-请联系客服 90 日期切换正在处理 日期切换正在处理 交易失败-请稍后重试 90交易失败-请稍后重试 91 发卡行或收单银行不能操作 电话查询发卡方或收单银行-可重作 交易失败-请稍后重试 91交易失败-请联系客服 92 金融机构或中间网络设施找不到或无法达到 电话查询发卡方或网络中心-可重作 交易失败-请稍后重试 92交易失败-请联系客服 93 交易违法、不能完成 交易违法、不能完成 交易失败-请联系发卡行 93交易失败-请联系客服 94 重复交易 查询网络中心-可重新签到作交易 交易失败-请稍后重试 94重复交易 95 调节控制错 调节控制错 交易失败-请稍后重试 95交易失败-请联系客服 96 系统异常、失效 发卡方或网络中心出现故障 交易失败-请稍后重试 96交易失败-请联系客服 97 POS终端号找不到 终端未在中心或银行登记 终端未登记-请联系收单行或银联 97无效终端-请联系客服或检查配置 98 收不到发卡行应答 收不到发卡行应答 交易超时-请重试 98交易超时-请重试 99 PIN格式错 可重新签到作交易 校验错-请重新签到 99交易失败-请联系客服 A0 MAC校验错 可重新签到作交易 校验错-请重新签到 A0请重新签到或联系客服 C1 卡券已被核销 C1卡券已被核销 C2 卡券已过期 C2卡券已过期 C3 无效的卡券 C3无效的卡券 09 处理中 正常应答-表明该交易需要输入密码-完成后发起查询确认交易状态 09处理中 Y1 商户密钥错误 核实商户交易密钥是否正确 12改为Y1 Y1交易失败-请联系客服 Y0 付款码错误或过期 刷新条码后-重新扫码-发起支付 14改为Y0 Y0付款码错误或过期 ZH 订单号重复 订单号重复-使用新订单号发起交易-建议订单号加上时间防止重复 19改为ZH ZH订单号重复 Y3 订单不存在 该订单系统不存在-不能进行相应操作 25改为Y3 Y3订单不存在 Y4 商户未申请开通此支付方式 查看商户是否提交该渠道申请-如以提交-核实是否有配置路由信息 31改为Y4 Y4不支持此支付方式 Y5 退款失败-商家账户余额不足 建议商家先进行一笔收款-再发起退款 61改为Y5 Y5退款失败-商家账户余额不足 Y6 退款金额超过原订单金额 退款金额需要小于等于可退款金额 64改为Y6 Y6退款金额超过原订单金额 Y7 外部系统错误 具体描述可返回渠道中文描述字段 91改为Y7 Y7交易失败-请联系客服 Y2 商户无此交易渠道权限 H1改为Y2 Y2未授权的交易 Y8 商户无此接口权限 核实该商户是否配置了该接口权限 H2改为Y8 Y8交易失败-请联系客服 Y9 订单已关闭或取消 订单已关闭或取消-不能进行相应操作 H3改为Y9 Y9订单已关闭或取消 YA [字段名]不能为空 检查出错字段 H4改为YA YA交易失败-请联系客服 YB [字段名]格式错误 检查出错字段 H5改为YB YB交易失败-请联系客服 YC 交易状态不合法 检查交易状态是否正常 H6改为YC YC交易失败-请联系客服 YD 交易信息中包含违禁词汇 检查交易信息中是否包含违禁词汇 H7改为YD YD交易失败-请联系客服 YE 原交易非支付交易 原交易非支付交易-不能执行此类操作 R1改为YE YE原交易非支付交易 YF 原交易未成功支付 原交易未成功支付-部分交易不能执行 R2改为YF YF原交易未成功支付 YG 原交易已退款 R3改为YG YG原交易已退款 YH 只能隔天退款 R4改为YH YH只能隔天退款 YJ 不支持的卡类型-请换卡或绑新卡 R5改为YJ YJ不支持的卡类型-请换卡或绑新卡 YK 只能撤销当天交易 R6改为YK YK只能撤销当天交易 YL 顾客账户状态异常 R7改为YL YL顾客账户状态异常 YM 商家账户状态异常 R8改为YM YM商家账户状态异常 YN 付款码与交易渠道不符 R9改为YN YN付款码与交易渠道不符 YP 分账信息不正确 S1改为YP YP交易失败-请联系客服 YQ 软件版本过低-请升级 S2改为YQ YQ软件版本过低-请升级 YR 付款金额小于最低限额 S3改为YR YR付款金额小于最低限额 YS Openid错误 S4改为YS YS交易失败-请联系客服 YT 姓名校验错误 S5改为YT YT姓名校验错误 YU 对同一用户操作过于频繁-请稍候重试 S6改为YU YU对同一用户操作过于频繁-请稍候重试 YV 购汇金额或币种错误 S7改为YV YV购汇金额或币种错误 YW 额度超限 S8改为YW YW额度超限 YX 顾客关闭相关功能 S9改为YX YX顾客关闭相关功能 YY 授权码code错误 J1改为YY YY交易失败-请联系客服 YZ 渠道商户秘钥未配置或配置错误 YZ交易失败-请联系客服 C0 核销失败 C0核销失败 C4 券状态异常 C4券状态异常 C5 未到卡券使用时间 请在卡券有效期内使用 C5未到卡券使用时间 C6 商户不能使用该卡券 C6商户不能使用该卡券 C7 金额达不到满足优惠条件的最小金额 C7金额太小-不可参与优惠 C8 此卡券不能使用此方式进行支付 请使用卡券指定的支付方式 C8此卡券不能使用此方式进行支付 Z0 渠道商户信息有误 检查系统渠道商户配置和渠道是否一致-或者看渠道商户具体应答 E0改为Z0 Z0交易失败-请联系客服 Z1 渠道受理机构信息配置有误 检查与渠道给出信息是否一致-或者看具体应答错误码 E1改为Z1 Z1交易失败-请联系客服 Z2 渠道不支持该业务 如不支持部分退款等 E2改为Z2 Z2未授权的交易-请联系客服 Z3 接入渠道IP验证异常 看渠道方是否有将我方IP配置 99改为Z3 Z3交易失败-请联系客服 Z4 门店状态异常 门店状态被改为异常状态 G1改为Z4 Z4交易失败-请联系客服 Z5 渠道商户状态异常 渠道商户状态被改为异常状态 G2改为Z5 Z5交易失败-请联系客服 Z6 卖家买家账号相同-不能进行交易 通知商户不能用自己账户进行交易-一定要使用其他人账户 G3改为Z6 Z6账号有误-请联系客服 Z7 没有签约扫码支付接口或签约失效 通知商户进行签约 G4改为Z7 Z7未授权的交易-请联系客服 Z8 支付失败-请顾客刷新付款码后重新收款-如再次收款失败-请联系管理员处理 重新扫码收款 G5改为Z8 Z8交易失败-请重试 Z9 未进行应用授权或授权已过期 通知商户重新进行授权操作 G6改为Z9 Z9未授权的交易-请联系客服 ZA 该银行卡已失效-请联系发卡行了解详情-或更换其他支付方式 更换其他支付方式-比如换一张卡或使用钱包余额支付 G7改为ZA ZA交易失败-请更换支付方式 ZB 内部系统操作超时 请重试交易 G9改为ZB ZB交易失败-请联系客服 ZC 渠道验签错误 请至支付宝后台上传公玥 K1改为ZC ZC交易失败-请联系客服 ZD 商户未签约该产品-请按流程完成签约 请按流程完成签约并确认签约成功 K2改为ZD ZD未授权交易-请联系客服 ZE 商户需授权服务商退款接口权限 请服务商按照指引流程-完成授权 K3改为ZE ZE未授权交易-请联系客服 ZF 交易失败-如顾客反馈扣款成功-款项将会在一段时间后退回 不进行发货处理-重新进行一笔收款 F1改为ZF ZF交易失败-请联系客服 ZG 交易失败-请重新发起交易 F8改为ZG ZG交易失败-请重试 E1 程序异常 E1交易失败-请联系客服 E2 配置错误 E2交易失败-请联系客服 E4 E4交易失败-请联系客服 L1 机构额度超限 L1交易失败-请联系客服 L2 商户额度单笔超限 L2交易失败-请联系客服 L3 商户额度单日超限 B1 卡片黑名单 B1交易失败-请联系客服 RA 规则预警 RA交易失败-请联系客服 RB 预警联机拒交易 RB交易失败-请联系客服 RC 预警降额拒交易类P RC交易失败-请联系客服 RD 预警降额拒交易类A RD交易失败-请联系客服","text_tokens":["(","位置","相同","s8"," ","39","yt","意义","一致","日期","插卡","91","h7","出错","详情","z6","中","c1","此卡券","做","订单","94","应答","--","绑","太大","37","钱包","51","21","一定","44","yx","r2","受卡方呼","被","达","yv","53","特殊","词汇","了解","联系","内","太迟","包含","需","指引","ym","表明","为空","按","预警","56","yn","方式","yk","的","没收","任何","错误","文件","读取","格式","新卡","投资","[","yl","如","隔天","ys","z5","67","后台","限额","再","c0","无效","代码","条件","s7","展示","98","s3","34","买家","进行","返回","了","字段","受限","y5","e4","作","k3","其他人","失效","先","其他","支持","正常","对","卡人","要","中心","请求","限制","/","使用","用","账号","存款","联机","g1","描述","支付","rd","z9","额度","超过","持卡","\"","57","收不到","76","核销","再次","储蓄卡","v2","64","当天","怀疑","86","88","换卡","太","防止","软件","尚","不能","04","控制","优惠条件","20","58","g2","规则","错误码","允许","刷新","zb","部门","code","h6","发起","y6","2","36","y3","e2","是否","发卡","a0","安全","系统","99","r5","c3","05","退回","该","更换","终端","黑名单","说明","方未","网络","通知","z7","45","有","03","作弊","没有","s6","c4","未到","取款","金融机构","未","c2","收到","将会","s2","或","z1","65","名单","为","配置","校验","mac","1","59","该卡","渠道","业务","不足","调节","撤销","78","公玥","电话","提交","13","e1","嫌疑","pos","s9","h1","85","自己","zf","超","80","服务商","g4","重新","银行卡","06","过于","权限","稍候","卡","网络设施","一笔","接受","用户","字段名","承兑","接口","输错","读取数据","足够","ya","r8","采取","有效期","错","g9","显示","g3","12","效期","商家","金额","y9","c8","出现","一张","yy","c5","ze","单笔","服务","63","拒","客服","达到","35","原因","或读","一次","最小","）","他人","反馈","42","55","批次","如以","银行","收","83","比如","误码","79","智能","ra","余额","y4","yq","68","h2","看","一段","回答","14","存在","我方","正确","22","未登记","应用","确认","银联","75","金融","大","券","中间","切换","yw","l1","此类","超出","40","合法","收款","稍后","zd","建议","有效","关闭","02","y1","openid","秘钥","y0","规定","h5","签约","商户","频繁","r6","不符","b1","z0","07","92","c7","zg","ip","姓名","单日","下","p","g6","参与","指定","版本","等于","向","h4","过低","无此","yd","送入","登记","相关","程序","受限制","找","无法","并","实施","61","或者","计划","满足","开通","违反","z3","注","00","不平","储蓄","最低","ye","z8","段","e0","支付宝","联网","单行","具体","y8","数据","费","不予","已过期","41","需要","核实","正在","验证","单号","成功","路由","不","k2","管理员","上","失败","23","30","捕捉","上传","原","外部","或太大","y2","此","交易类型","升级","25","授权","改为","96","l3","将","受理","原始","码表","密码","19","措施","卡券","z2","31","降额","黑名","查询","g5","33","挂失","超限","只能","门店","已","84","yj","被窃","y7","相应","分账","功能","签到","90","类型","执行","字","38","试","查看","yg","g7","rb","丢失","不到","95","有关","操作员","换","太小","违禁","与","脱机","重试","超时","和","无","rc","新","非","可能","f8","内部","c6","在","检查","卡号","顾客","信息","流程","部分","后","保密","扣款","0","]","中文","yu","账户","密钥","记录","次数","方","yp","r7","机构","小于","等","币种","s1","操作","yc","不可","有误","类","卖家","信用","段时间","发货","01","取消","重传","h3","yf","输入","产品","退款","yz","（","申请","请","支票","93","97","yr","找到","一段时间","验签","卡种","刷卡","给出","43","54","a","k1","号","购汇","发卡行","款项","r3","r4","可","状态","pin","可以","60","信用卡","15","订单号","受卡方","52","77","区别","加上","zc","收单","处理","yh","s5","r9","付款","yb","r1","重作","持卡人","za","设施",":","优惠","扫码","管理","f1","交易","-","l2","同一","查","过期","违法","至","81","zh","按照","xx","卡片","异常","时间","码","未能",")","接入","对账","码后","09","89","故障","j1","重复","62","条码","完成","66","s4","z4","此卡","、"],"title":"fenghuAnserCode","title_tokens":["fenghuansercode"]},{"location":"attached/sdkAnserCode/","text":"交易应答码表V3(20160811更新) 代码 POS显示(计划实施) 00 交易成功 01 \"01-交易失败请联系发卡行\" 02 \"02-交易失败请联系发卡行\" 03 \"03-无效商户请联系客服\" 04 \"04-卡片异常请换卡重试\" 05 \"05-交易失败请联系发卡行\" 06 \"06-交易失败请联系发卡行\" 07 \"07-卡片异常请换卡重试\" 09 \"09-交易失败请重试\" 12 \"12-发卡行不支持的交易\" 13 \"13-无效金额\" 14 \"14-无效卡号请联系发卡行或换卡重试\" 15 \"15-无此发卡行请换卡重试\" 19 \"19-交易失败请重试\" 20 \"20-交易失败请联系发卡行\" 21 \"21-交易失败请联系发卡行\" 22 \"22-操作有误请重试\" 23 \"23-交易失败请联系发卡行\" 25 \"25-未找到原交易请重试或联系客服\" 30 \"30-格式错误请联系客服\" 31 \"31-交易失败请联系客服\" 33 \"33-过期卡请换卡重试\" 34 \"34-卡片异常请联系发卡行\" 35 \"35-卡片异常请联系发卡行\" 36 \"36-卡片异常请联系发卡行\" 37 \"37-卡片异常请联系发卡行\" 38 \"38-密码错误次数超限\" 39 \"39-交易失败请换卡重试\" 40 \"40-不支持的交易类型请联系客服\" 41 \"41-卡片异常请联系发卡行\" 42 \"42-卡片异常请联系发卡行\" 43 \"43-卡片异常请联系发卡行\" 44 \"44-交易失败请联系发卡行\" 45 \"45-请插卡交易或联系客服\" 51 \"51-余额不足\" 52 \"52-交易失败请换卡重试\" 53 \"53-交易失败请换卡重试\" 54 \"54-过期卡请换卡重试\" 55 \"55-密码错误请重试\" 56 \"56-交易失败请换卡重试\" 57 \"57-卡片异常请联系客服或换卡重试\" 58 \"58-未授权的交易请联系客服\" 59 \"59-卡片异常请联系发卡行\" 60 \"60-卡片异常请联系发卡行\" 61 \"61-超出金额限制请联系客服或换卡重试\" 62 \"62-卡片异常请联系发卡行\" 63 \"63-交易失败请联系发卡行\" 64 \"64-交易失败请联系发卡行\" 65 \"65-交易次数超限请联系发卡行\" 66 \"66-交易失败请联系客服\" 67 \"67-卡片异常请联系发卡行\" 68 \"68-交易超时请重试\" 75 \"75-密码错误次数超限\" 76 \"76-交易失败请联系发卡行\" 77 \"77-交易失败请联系客服\" 78 \"78-交易失败请换卡重试\" 79 \"79-脱机交易对账不平请重传数据或联系客服\" 80 \"80-交易失败请联系客服\" 81 \"81-交易失败请联系客服\" 83 \"83-交易失败请联系客服\" 84 \"84-交易失败请联系客服\" 85 \"85-交易失败请联系客服\" 86 \"86-交易失败请联系客服\" 88 \"88-交易失败请联系客服\" 89 \"89-交易失败请联系客服\" 90 \"90-交易失败请稍后重试\" 91 \"91-交易失败请稍后重试\" 92 \"92-交易失败请稍后重试\" 93 \"93-交易失败请联系发卡行\" 94 \"94-交易失败请稍后重试\" 95 \"95-交易失败请稍后重试\" 96 \"96-系统异常请联系客服\" 97 \"97-无效终端请联系客服或检查配置\" 98 \"98-交易超时请重试\" 99 \"99-交易失败请联系客服\" A0 \"A0-请重新签到或联系客服\" B1 \"B1-卡片异常请联系客服或换卡重试\" C0 \"C0-核销失败\" C1 \"C1-卡券已被核销\" C2 \"C2-卡券已过期\" C3 \"C3-无效的卡券\" C4 \"C4-券状态异常\" C5 \"C5-未到卡券使用时间\" C6 \"C6-商户不能使用该卡券\" C7 \"C7-金额太小不可参与优惠\" C8 \"C8-此卡券不能使用此方式进行支付\" C9 \"C9-交易失败，请联系客服\" CA \"CA-付款码与卡券指定支付方式不符\" CB \"CB-卡券订单不存在\" CC \"CC-交易失败请联系客服\" CD \"CD-卡券订单已支付\" L1 \"L1-交易额度超限请联系客服\" L2 \"L2-交易额度超限请联系客服\" L3 \"L3-交易额度超限请联系客服\" RA \"RA-交易失败请联系客服\" RB \"RB-交易失败请联系客服\" RC \"RC-交易失败请联系客服\" RD \"RD-交易失败请联系客服\" Y0 \"Y0-付款码错误或过期，请重试\" Y1 \"Y1-交易失败请联系客服\" Y2 \"Y2-未开通此支付方式，请联系客服\" Y3 \"Y3-订单不存在，请重试\" Y4 \"Y4-未开通此支付方式，请联系客服\" Y5 \"Y5-退款失败，商家账户余额不足\" Y6 \"Y6-退款金额超过原订单金额\" Y7 \"Y7-交易失败请联系客服\" Y8 \"Y8-不支持的交易类型请联系客服\" Y9 \"Y9-订单已关闭或取消\" YA \"YA-交易失败请联系客服\" YB \"YB-交易失败请联系客服\" YC \"YC-交易失败请联系客服\" YD \"YD-交易失败请联系客服\" YE \"YE-该交易类型不能执行此操作\" YF \"YF-该交易类型不能执行此操作\" YG \"YG-原交易已退款\" YH \"YH-只能隔天退款\" YJ \"YJ-不支持的卡类型，请换卡或绑新卡\" YK \"YK-只能撤销当天交易\" YL \"YL-顾客账户状态异常\" YM \"YM-商家账户状态异常\" YN \"YN-付款码与交易渠道不符\" YP \"YP-交易失败请联系客服\" YQ \"YQ-软件版本过低，请升级\" YR \"YR-付款金额小于最低限额\" YS \"YS-交易失败请联系客服\" YT \"YT-姓名校验错误\" YU \"YU-对同一用户操作过于频繁，请稍后重试\" YV \"YV-购汇金额或币种错误\" YW \"YW-额度超限\" YX \"YX-顾客关闭相关功能\" YY \"YY-交易失败请重试\" YZ \"YZ-交易失败请联系客服\" Z0 \"Z0-交易失败请联系客服\" Z1 \"Z1-交易失败请联系客服\" Z2 \"Z2-未授权的交易请联系客服\" Z3 \"Z3-交易失败请联系客服\" Z4 \"Z4-交易失败请联系客服\" Z5 \"Z5-交易失败请联系客服\" Z6 \"Z6-卖家买家账号相同，不能进行交易\" Z7 \"Z7-商户未签约请联系客服\" Z8 \"Z8-交易失败请重试\" Z9 \"Z9-商户未授权请联系客服\" ZA \"ZA-交易失败，请更换支付方式\" ZB \"ZB-交易失败请重试或联系客服\" ZC \"ZC-交易失败请联系客服\" ZD \"ZD-未授权交易请联系客服\" ZE \"ZE-该商户暂无退款权限请联系客服\" ZF \"ZF-交易异常，如有扣款，款项稍后退回\" ZG \"ZG-交易失败，请重试\" ZH \"ZH-交易失败请联系客服\" ZI \"ZI-直接进入扫码流程显示流程界面\" ZJ \"ZJ-直接进入扫码流程显示流程界面\" ZK \"ZK-交易失败请联系客服\" ZL \"ZL-交易失败请联系客服\" ZM \"ZM-买家付款额度超限\" ZN \"ZN-商家收款额度超限\" ZP \"ZP-超出每日限额，请联系客服\" ZQ \"ZQ-提升限额申请正在审核中\" ZR \"ZR-交易失败，请联系客服\" ZS \"ZS-不支持该交易类型，请联系客服\" ZT \"ZT-交易失败请联系客服\" ZU \"ZU-交易失败请联系客服\" ZV \"ZV-未开通此支付方式，请联系客服\" ZY \"ZY-用户取消支付，请重新发起交易\" ZZ \"ZZ-交易失败请联系客服\"","text_tokens":["(","相同"," ","39","yt","插卡","91","z6","中","zy","c1","此卡券","订单","94","应答","绑","界面","37","51","21","44","yx","被","yv","53","联系","ym","56","yn","方式","yk","更新","的","错误","格式","如","新卡","yl","隔天","ys","zz","z5","67","限额","c0","无效","代码","98","买家","34","进行","y5","直接","支持","对","限制","审核","使用","账号","支付","rd","z9","zm","额度","超过","\"","57","76","核销","当天","64","86","88","换卡","软件","不能","04","20","58","zb","y6","发起","36","y3","发卡","a0","系统","zr","99","c3","05","退回","该","更换","终端","z7","45","03","有","c4","未到","未","c2","或","z1","65","配置","校验","59","该卡","cc","渠道","不足","撤销","78","13","每日","pos","85","zf","80","重新","06","过于","权限","进入","卡","用户","ya","显示","12","商家","金额","y9","c8","yy","c5","ze","63","cb","客服","35","cd","42","55","83","79","ra","余额","y4","yq","68","14","存在","22","75","zi","券","，","yw","l1","超出","40","收款","稍后","zd","关闭","02","y1","y0","签约","商户","频繁","zp","不符","b1","z0","07","卡请","20160811","92","c7","zg","姓名","参与","指定","版本","过低","无此","yd","zs","相关","实施","61","计划","开通","z3","00","不平","最低","ye","z8","y8","数据","已过期","41","正在","成功","不","失败","23","30","原","y2","此","zj","交易类型","升级","25","授权","zv","96","l3","zn","码表","密码","19","卡券","z2","31","zu","33","超限","只能","已","84","yj","y7","zk","功能","签到","执行","90","类型","38","yg","rb","95","太小","与","脱机","重试","超时","未找到","rc","c6","检查","卡号","顾客","扣款","流程","yu","账户","次数","yp","小于","币种","操作","yc","不可","有误","ca","卖家","01","取消","重传","yf","退款","yz","申请","请","93","97","yr","找到","zq","43","54","暂无","购汇","发卡行","款项","状态","60","15","52","77","zc","yh","付款","yb","za","v3","优惠","扫码","交易","-","l2","同一","过期","81","zh","卡片","异常","时间","码",")","对账","c9","09","89","zl","提升","62","66","z4","zt","此卡"],"title":"1. 应答码表:sdk应答码表","title_tokens":["1","sdk","应答","码表",":"," ","."]},{"location":"attached/symbol/","text":"交易处理标志 processflag取值如下，用于标记处理成功还是失败。 代码 意义 说明 0 成功 1 受理方拒绝 2 转发方失败 3 渠道拒绝 扫码交易，查询失败后超时选择该状态，表示该笔09应答码交易是失败交易 4 超时 5 处理中 6 落地 交易冲正标志 revflag取值如下，用于标记源交易。 代码 意义 说明 0 正常 1 冲正 2 撤销 3 退货 4 汇款 5 完成 6 手工退货 7 手工完成 8 手工撤销","text_tokens":["汇款","方","是","标记","码","8","取值","processflag"," ","5","状态","意义","标志","受理","冲正","6","手工","revflag","2","7","用于","，","超时","中","该笔","选择","落地","正常","还是","处理","1","源","4","拒绝","如下","表示","应答","查询","该","09","3","渠道","成功","。","撤销","转发","说明","失败","后","退货","0","代码","扫码","完成","交易"],"title":"2. 交易处理标志和冲正标志","title_tokens":["处理","2","交易","和"," ","标志","冲正","."]},{"location":"attached/symbol/#_1","text":"revflag取值如下，用于标记源交易。 代码 意义 说明 0 正常 1 冲正 2 撤销 3 退货 4 汇款 5 完成 6 手工退货 7 手工完成 8 手工撤销","text_tokens":["汇款","标记","8","取值"," ","5","手工","意义","冲正","7","6","revflag","2","用于","，","正常","源","1","4","如下","3","。","撤销","说明","退货","0","代码","完成","交易"],"title":"交易冲正标志","title_tokens":["标志","冲正","交易"]},{"location":"attached/ticket/","text":"签购单规范 小票（签购单）样例，银行卡类小票和扫码类小票： 其他说明 签购单中，可以有空行 交易金额显示，如为退货或撤销，均在金额前显示负号 卡号后面的一位字母，刷卡方式，取值：S（刷卡）、I(插卡)、M（无卡）、C（非接） 卡号后面的3位字母，卡品牌CUP 原凭证号：只有撤销或退货时显示 TAG：8583规范中的子域名，必须打印 各项内容必须完备，排版可以略有不同 标点符号全部为半角 银联卡消费打印的签购单中，必须要显示的内容： 内容 字段取值 备注 商户/持卡人/银行存根 固定文本 客户ID 0000000000 目前为10个0 商户名称 Config.IsoMsg.MERCHANT_NAME 商户号 response.getTrans().getCompInfoA2() 终端号 response.getTrans().getCompInfoA3() 卡号 response.getTrans().getCardNo() + response.getTrans().getCardType() + response.getTrans().getCardBrand() 卡号 + 刷卡方式(1S 2I 3C) + 卡品牌 有效期 response.getTrans().getCompExpirationDate() 需格式转换 MM/YY （为空不打印） 收单行 response.getTrans().compInfoA1() 发卡行 response.getTrans().getAdditionalResData() 交易类型 response.getTrans().getTransCode() 需转换，见下文'交易类型码表' 授权码 response.getTrans().getRevAuthCode() 批次号 response.getTrans().getBatchNum() 凭证号 response.getTrans().getTraceNum() 日期时间 response.getTrans().getTransDate() + response.getTrans().getTransDatetime() 需格式转换 参考号 response.getTrans().getRefNum() 交易金额 response.getTrans().getTransAmt() 小费（Tips） 签名 备注 版本 TAG 新大陆-打印规范 如果你想要自定义小票的样式，可以参考 新大陆 提供的打印文档，点击 新大陆-打印规范.doc 可以下载。 终端相应合规信息取值 按照银联最新规范，终端展示/打印信息需要根据8583报文中57域信息。因此，SDK中Trans新增部分字段 字段名 意义 compInfoA1 签购单收单行 compInfoA2 签购单商户号 compInfoA3 签购单终端号 compInfoA4 markup compInfoA6 借贷记标识 compInfoA7 营销信息 compInfoA8 二维码信息 详细字段信息可查看 javadoc 中com.cardinfolink.pos.sdk.model.Trans信息","text_tokens":["字","(","gettransamt","查看","银联","gettrans","getcompinfoa2","符号","名称"," ","必须","不同","日期","意义","model","插卡","标点符号","，","发卡","消费","完备","和","中","打印","getcardno","报文","只有","0000000000","有效","终端","存根","个","在","时","小费","卡号","说明","信息","部分","无卡","样例","0","字母","sdk","10","印信","有","config","商户","转换","需","单中","取值","为空","如果","或","gettracenum","自定","规范","compinfoa3","response","类","gettransdatetime","cup","c","方式","compinfoa1","为","的","前","银联卡","想要","格式","gettranscode","（","版本","cardinfolink","全部","详细","compinfoa4","。","getbatchnum","撤销","自定义","定义","doc","半角","签购","getcompinfoa3","如为","刷卡","样式","标识","展示","tips","trans","新增","compinfoa2","compinfoa8","pos","javadoc","isomsg","二维码","大陆","字段","均","getcardbrand","号","发卡行","8583","银行卡","com","tag","你","可","签名","空行","可以","卡","排版","其他","段","字段名","单行","参考","凭证","固定","域名","需要","要","卡人","1s","gettransdate","compinfoa6","3","有效期","根据","显示","/","不","提供","持卡人",".","merchant","位","效期","m","原","：","compinfoa7","最新","扫码","略有","二维","交易","-","交易类型","因此","金额","负号","单收","授权","yy","2i","子","按照","s","时间","内容","'","码","打印信息","合规","域","单","持卡",")","目前","备注","文本","57","营销","name","各项","下文","码表","i","）","借贷","mm","略有不同","文档","getcompexpirationdate","getrevauthcode","品牌","客户","新大","id","批次","银行","小票","收","getrefnum","新大陆","记","点击","markup","后面","标点","+","退货","getcardtype","非接","下载","相应","一位","_","见下文","getadditionalresdata","类型","、","3c"],"title":"3. 签购单规范","title_tokens":["签购","规范","3","单"," ","."]},{"location":"attached/ticket/#_1","text":"按照银联最新规范，终端展示/打印信息需要根据8583报文中57域信息。因此，SDK中Trans新增部分字段 字段名 意义 compInfoA1 签购单收单行 compInfoA2 签购单商户号 compInfoA3 签购单终端号 compInfoA4 markup compInfoA6 借贷记标识 compInfoA7 营销信息 compInfoA8 二维码信息 详细字段信息可查看 javadoc 中com.cardinfolink.pos.sdk.model.Trans信息","text_tokens":["compinfoa2","按照","字","查看","字段","银联","打印信息","号","8583","域","com","单"," ","可","意义","model","规范","compinfoa3","57","营销","段","，","字段名","compinfoa1","pos","单行","中","商户","打印","借贷","二维码","需要","报文","compinfoa6","记","cardinfolink","详细","终端","根据","compinfoa4","。","markup","/","信息","javadoc",".","部分","sdk","签购","compinfoa7","最新","印信","二维","标识","展示","因此","trans","新增","单收","compinfoa8"],"title":"终端相应合规信息取值","title_tokens":["合规","取值","终端","相应","信息"]},{"location":"attached/traditionAnserCode/","text":"交易应答码表V1(传统POS) 交易返回合作方时都有 39 域，合作方和终端需根据应答码要采取相应的操作，可以把操作分为以下几类: A:交易成功 B:交易失败, 可重试 C:交易失败, 不需要重试 D:交易失败, 终端操作员处理 E:交易失败, 系统故障, 不需要重试 注 1: 如果 39 域的内容不能在下表中找到，就显示“交易失败” 注 2: 如果POS交易的批次号和网络中心批次号不一致时应答码会填 “77”，此时POS机应当提示操作员重新签到， 再作交易。 代码 意义 类别 原因/采取的措施 说明 00 承兑或交易成功 A 承兑或交易成功 交易成功 01 查发卡行 C 查发卡行 交易失败，请联系发卡行 02 查发卡行的特殊条件 C 可电话向发卡行查询 交易失败，请联系发卡行 03 无效商户 C 商户需要在银行或中心登记 商户未登记 04 没收卡 D 操作员没收卡 没收卡，请联系收单行 05 不予承兑 C 发卡不予承兑 交易失败，请联系发卡行 06 出错 E 发卡行故障 交易失败，请联系发卡行 07 特殊条件下没收卡 D 特殊条件下没收卡 没收卡，请联系收单行 09 请求正在处理中 B 重新提交交易请求 交易失败，请重试 12 无效交易 C 发卡行不支持的交易 交易失败，请联系发卡行 13 无效金额 B 金额为 0 或太大 交易金额超限，请重试 14 无效卡号 B 卡种未在中心登记或读卡号有误 无效卡号，请联系发卡行 15 无此发卡行 C 此发卡行未与中心开通业务 此卡不能受理 19 重新送入交易 C 刷卡读取数据有误，可重新刷卡 交易失败，请联系发卡行 20 无效应答 C 无效应答 交易失败，请联系发卡行 21 不做任何处理 C 不做任何处理 交易失败，请联系发卡行 22 怀疑操作有误 C POS 状态与中心不符，可重新签到 操作有误，请重试 23 不可接受的交易费 C 不可接受的交易费 交易失败，请联系发卡行 25 未能找到文件上记录 C 发卡行未能找到有关记录 交易失败，请联系发卡行 30 格式错误 C 格式错误 交易失败，请联系发卡行 31 不支持的银行 C 此发卡方未与中心开通业务 此卡不能受理 33 过期的卡 D 过期的卡，操作员可以没收 过期卡，请联系发卡行 34 有作弊嫌疑 D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 35 受卡方与安全保密部门联系 D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 36 受限制的卡 D 有作弊嫌疑的卡，操作员可以没收 此卡有误，请换卡重试 37 受卡方呼受理方安全保密部门(没收卡) D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 38 超过允许的 PIN 试输入 D 密码错次数超限，操作员可以没收 密码错误次数超限 39 无此信用卡账户 C 可能刷卡操作有误 交易失败，请联系发卡行 40 请求的功能尚不支持 C 发卡行不支持的交易类型 交易失败，请联系发卡行 41 丢失卡 D 挂失的卡，操作员可以没收 没收卡，请联系收单行 42 无此账户 B 发卡行找不到此账户 交易失败，请联系发卡方 43 被窃卡 D 被窃卡， 操作员可以没收 没收卡，请联系收单行 44 无此投资账户 C 可能刷卡操作有误 交易失败，请联系发卡行 51 无足够的存款 C 账户内余额不足 余额不足，请查询 52 无此支票账户 C 无此支票账户 交易失败，请联系发卡行 53 无此储蓄卡账户 C 无此储蓄卡账户 交易失败，请联系发卡行 54 过期的卡 C 过期的卡 过期卡，请联系发卡行 55 不正确的 PIN C 密码输错 密码错，请重试 56 无此卡记录 C 发卡行找不到此账户 交易失败，请联系发卡行 57 不允许持卡人进行的交易 C 不允许持卡人进行的交易 交易失败，请联系发卡行 58 不允许终端进行的交易 C 该商户不允许进行的交易 终端无效，请联系收单行或银联 59 有作弊嫌疑 C 交易失败，请联系发卡行 60 受卡方与安全保密部门联系 C 交易失败，请联系发卡行 61 超出取款金额限制 C 一次交易的金额太大 金额太大 62 受限制的卡 C 交易失败，请联系发卡行 63 违反安全保密规定 C 违反安全保密规定 交易失败，请联系发卡行 64 原始金额不正确 C 原始金额不正确 交易失败，请联系发卡行 65 超出取款次数限制 C 超出取款次数限制 超出取款次数限制 66 受卡方呼受理方安全保密部门 C 受卡方呼受理方安全保密部门 交易失败，请联系收单行或银联 67 捕捉(没收卡) C 捕捉(没收卡) 没收卡 68 收到的回答太迟 C 发卡行规定时间内没有回答 交易超时，请重试 75 允许的输入 PIN 次数超限 C 允许的输入 PIN 次数超限 密码错误次数超限 77 需要向网络中心签到 D POS 批次与网络中心不一致 请向网络中心签到 79 脱机交易对账不平 C POS 终端上传的脱机数据对账不 平 POS 终端重传脱机数据 90 日期切换正在处理 C 日期切换正在处理 交易失败，请稍后重试 91 发卡行或收单银行不能操作 C 电话查询发卡方或收单银行，可重作 交易失败，请稍后重试 92 金融机构或中间网络设施无法达到 C 电话查询发卡方或网络中心，可重 作 交易失败，请稍后重试 93 交易违法、不能完成 C 交易违法、不能完成 交易失败，请联系发卡行 94 重复交易 C 查询网络中心，可重新签到作交易 交易失败，请稍后重试 95 调节控制错 C 调节控制错 交易失败，请稍后重试 96 系统异常、失效 C 发卡方或网络中心出现故障 交易失败，请稍后重试 97 POS 终端号找不到 D 终端未在中心或银行登记 终端未登记，请联系收单行或银联 98 收不到发卡行应答 E 收不到发卡行应答 交易超时，请重试 99 PIN 格式错 B 可重新签到作交易 校验错，请重新签到 A0 MAC 校验错 B 可重新签到作交易 校验错，请重新签到 C1 卡券已被核销 C C2 卡券已过期 C C3 无效的卡券 C","text_tokens":["("," ","39","一致","意义","日期","91","出错","中","c1","做","下表中","应答","94","太大","37","51","21","时","44","合作","受卡方呼","被","53","特殊","联系","内","太迟","需","e","c","56","的","没收","任何","错误","文件","读取","格式","投资","67","无效","代码","条件","98","34","都","返回","进行","受限","作","失效","支持","卡人","中心","请求","限制","/","存款","域","超过","持卡","57","收不到","核销","储蓄卡","64","怀疑","换卡","太","尚","不能","04","控制","20","58","允许","部门","2","36","类别","发卡","安全","a0","系统","此时","99","c3","05","该","终端","会填","说明","网络","方未","有","03","作弊","没有","取款","金融机构","未","c2","收到","或","65","d","为","校验","mac","1","59","可重","业务","。","不足","调节","电话","提交","13","b","嫌疑","pos","重新","06","卡","网络设施","接受","承兑","输错","读取数据","足够","应当","采取","根据","错","显示","12","采取相应","分为","金额","出现","内容","63","达到","35","原因","或读","一次","42","55","批次","银行","收","v1","79","余额","68","回答","14","正确","22","未登记","银联","提示","75","“","金融","大","中间","，","切换","超出","40","稍后","02","规定","商户","不符","07","92","传统","下","向","”","无此","送入","登记","受限制","找","无法","61","开通","违反","几类","注","00","不平","储蓄","单行","数据","费","不予","已过期","41","需要","正在","平","成功","不","上","失败","23","30","捕捉","上传","或太大","此","以下","交易类型","25","机","96","受理","原始","码表","密码","19","措施","卡券","31","查询","33","挂失","超限","已","被窃","合作方","相应","功能","签到","90","类型","38","试","丢失","不到","95","有关","操作员","再作","与","脱机","重试","超时","和","无","可能","在","卡号","保密","0","账户","记录","次数","方","机构","如果","操作","不可","有误","信用","01","把","重传","输入","请","支票","93","97","找到","卡种","刷卡","43","54","就","a","号","发卡行","可","状态","pin","可以","60","信用卡","15","受卡方","52","系统故障",",","77","收单","处理","重作","持卡人","设施",":","交易","查","过期","违法","异常","时间","码","未能",")","对账","09","故障","重复","62","码要","完成","66","、"],"title":"traditionAnserCode","title_tokens":["traditionansercode"]},{"location":"attached/traditionAnserCode/#v1pos","text":"交易返回合作方时都有 39 域，合作方和终端需根据应答码要采取相应的操作，可以把操作分为以下几类: A:交易成功 B:交易失败, 可重试 C:交易失败, 不需要重试 D:交易失败, 终端操作员处理 E:交易失败, 系统故障, 不需要重试 注 1: 如果 39 域的内容不能在下表中找到，就显示“交易失败” 注 2: 如果POS交易的批次号和网络中心批次号不一致时应答码会填 “77”，此时POS机应当提示操作员重新签到， 再作交易。 代码 意义 类别 原因/采取的措施 说明 00 承兑或交易成功 A 承兑或交易成功 交易成功 01 查发卡行 C 查发卡行 交易失败，请联系发卡行 02 查发卡行的特殊条件 C 可电话向发卡行查询 交易失败，请联系发卡行 03 无效商户 C 商户需要在银行或中心登记 商户未登记 04 没收卡 D 操作员没收卡 没收卡，请联系收单行 05 不予承兑 C 发卡不予承兑 交易失败，请联系发卡行 06 出错 E 发卡行故障 交易失败，请联系发卡行 07 特殊条件下没收卡 D 特殊条件下没收卡 没收卡，请联系收单行 09 请求正在处理中 B 重新提交交易请求 交易失败，请重试 12 无效交易 C 发卡行不支持的交易 交易失败，请联系发卡行 13 无效金额 B 金额为 0 或太大 交易金额超限，请重试 14 无效卡号 B 卡种未在中心登记或读卡号有误 无效卡号，请联系发卡行 15 无此发卡行 C 此发卡行未与中心开通业务 此卡不能受理 19 重新送入交易 C 刷卡读取数据有误，可重新刷卡 交易失败，请联系发卡行 20 无效应答 C 无效应答 交易失败，请联系发卡行 21 不做任何处理 C 不做任何处理 交易失败，请联系发卡行 22 怀疑操作有误 C POS 状态与中心不符，可重新签到 操作有误，请重试 23 不可接受的交易费 C 不可接受的交易费 交易失败，请联系发卡行 25 未能找到文件上记录 C 发卡行未能找到有关记录 交易失败，请联系发卡行 30 格式错误 C 格式错误 交易失败，请联系发卡行 31 不支持的银行 C 此发卡方未与中心开通业务 此卡不能受理 33 过期的卡 D 过期的卡，操作员可以没收 过期卡，请联系发卡行 34 有作弊嫌疑 D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 35 受卡方与安全保密部门联系 D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 36 受限制的卡 D 有作弊嫌疑的卡，操作员可以没收 此卡有误，请换卡重试 37 受卡方呼受理方安全保密部门(没收卡) D 有作弊嫌疑的卡，操作员可以没收 没收卡，请联系收单行 38 超过允许的 PIN 试输入 D 密码错次数超限，操作员可以没收 密码错误次数超限 39 无此信用卡账户 C 可能刷卡操作有误 交易失败，请联系发卡行 40 请求的功能尚不支持 C 发卡行不支持的交易类型 交易失败，请联系发卡行 41 丢失卡 D 挂失的卡，操作员可以没收 没收卡，请联系收单行 42 无此账户 B 发卡行找不到此账户 交易失败，请联系发卡方 43 被窃卡 D 被窃卡， 操作员可以没收 没收卡，请联系收单行 44 无此投资账户 C 可能刷卡操作有误 交易失败，请联系发卡行 51 无足够的存款 C 账户内余额不足 余额不足，请查询 52 无此支票账户 C 无此支票账户 交易失败，请联系发卡行 53 无此储蓄卡账户 C 无此储蓄卡账户 交易失败，请联系发卡行 54 过期的卡 C 过期的卡 过期卡，请联系发卡行 55 不正确的 PIN C 密码输错 密码错，请重试 56 无此卡记录 C 发卡行找不到此账户 交易失败，请联系发卡行 57 不允许持卡人进行的交易 C 不允许持卡人进行的交易 交易失败，请联系发卡行 58 不允许终端进行的交易 C 该商户不允许进行的交易 终端无效，请联系收单行或银联 59 有作弊嫌疑 C 交易失败，请联系发卡行 60 受卡方与安全保密部门联系 C 交易失败，请联系发卡行 61 超出取款金额限制 C 一次交易的金额太大 金额太大 62 受限制的卡 C 交易失败，请联系发卡行 63 违反安全保密规定 C 违反安全保密规定 交易失败，请联系发卡行 64 原始金额不正确 C 原始金额不正确 交易失败，请联系发卡行 65 超出取款次数限制 C 超出取款次数限制 超出取款次数限制 66 受卡方呼受理方安全保密部门 C 受卡方呼受理方安全保密部门 交易失败，请联系收单行或银联 67 捕捉(没收卡) C 捕捉(没收卡) 没收卡 68 收到的回答太迟 C 发卡行规定时间内没有回答 交易超时，请重试 75 允许的输入 PIN 次数超限 C 允许的输入 PIN 次数超限 密码错误次数超限 77 需要向网络中心签到 D POS 批次与网络中心不一致 请向网络中心签到 79 脱机交易对账不平 C POS 终端上传的脱机数据对账不 平 POS 终端重传脱机数据 90 日期切换正在处理 C 日期切换正在处理 交易失败，请稍后重试 91 发卡行或收单银行不能操作 C 电话查询发卡方或收单银行，可重作 交易失败，请稍后重试 92 金融机构或中间网络设施无法达到 C 电话查询发卡方或网络中心，可重 作 交易失败，请稍后重试 93 交易违法、不能完成 C 交易违法、不能完成 交易失败，请联系发卡行 94 重复交易 C 查询网络中心，可重新签到作交易 交易失败，请稍后重试 95 调节控制错 C 调节控制错 交易失败，请稍后重试 96 系统异常、失效 C 发卡方或网络中心出现故障 交易失败，请稍后重试 97 POS 终端号找不到 D 终端未在中心或银行登记 终端未登记，请联系收单行或银联 98 收不到发卡行应答 E 收不到发卡行应答 交易超时，请重试 99 PIN 格式错 B 可重新签到作交易 校验错，请重新签到 A0 MAC 校验错 B 可重新签到作交易 校验错，请重新签到 C1 卡券已被核销 C C2 卡券已过期 C C3 无效的卡券 C","text_tokens":["("," ","39","一致","意义","日期","91","出错","中","c1","做","下表中","应答","94","太大","37","51","21","时","44","合作","受卡方呼","被","53","特殊","联系","内","太迟","需","e","c","56","的","没收","任何","错误","文件","读取","格式","投资","67","无效","代码","条件","98","34","都","返回","进行","受限","作","失效","支持","卡人","中心","请求","限制","/","存款","域","超过","持卡","57","收不到","核销","储蓄卡","64","怀疑","换卡","太","尚","不能","04","控制","20","58","允许","部门","2","36","类别","发卡","安全","a0","系统","此时","99","c3","05","该","终端","会填","说明","网络","方未","有","03","作弊","没有","取款","金融机构","未","c2","收到","或","65","d","为","校验","mac","1","59","可重","业务","。","不足","调节","电话","提交","13","b","嫌疑","pos","重新","06","卡","网络设施","接受","承兑","输错","读取数据","足够","应当","采取","根据","错","显示","12","采取相应","分为","金额","出现","内容","63","达到","35","原因","或读","一次","42","55","批次","银行","收","79","余额","68","回答","14","正确","22","未登记","银联","提示","75","“","金融","大","中间","，","切换","超出","40","稍后","02","规定","商户","不符","07","92","下","向","”","无此","送入","登记","受限制","找","无法","61","开通","违反","几类","注","00","不平","储蓄","单行","数据","费","不予","已过期","41","需要","正在","平","成功","不","上","失败","23","30","捕捉","上传","或太大","此","以下","交易类型","25","机","96","受理","原始","密码","19","措施","卡券","31","查询","33","挂失","超限","已","被窃","合作方","相应","功能","签到","90","类型","38","试","丢失","不到","95","有关","操作员","再作","与","脱机","重试","超时","和","无","可能","在","卡号","保密","0","账户","记录","次数","方","机构","如果","操作","不可","有误","信用","01","把","重传","输入","请","支票","93","97","找到","卡种","刷卡","43","54","就","a","号","发卡行","可","状态","pin","可以","60","信用卡","15","受卡方","52","系统故障",",","77","收单","处理","重作","持卡人","设施",":","交易","查","过期","违法","异常","时间","码","未能",")","对账","09","故障","重复","62","码要","完成","66","、"],"title":"交易应答码表V1(传统POS)","title_tokens":["(","应答","码表","v1","交易","传统","pos",")"]},{"location":"attached/transType/","text":"交易类型码表 transCode 意义 小票打印 PER 消费 PBI 余额查询 PEC 消费冲正 PVR 撤销 PVC 消费撤销冲正 CTH 退货 PPA 预授权 PNP 预授权撤销 ACR 预授权完成 PCR 预授权完成撤销 PPC 预授权冲正 PMC 预授权撤销冲正 PCC 预授权完成冲正 PRC 预授权完成撤销冲正 BPA 条码支付下单 BPP 条码支付预下单 BVD 条码支付撤销 BTH 条码支付退货 BVE 条码支付取消 BPI 条码支付查询 PER2EDC PER类交易DCC－EDC交易 ACR2EDC ACR类交易DCC－EDC交易 TTD 小费 TVD 小费撤销 CASH 现金交易 CCL 现金撤销","text_tokens":["支付","transcode","pvc","现金交易","bpa","per","pvr","ppa","pec","预"," ","bpi","ccl","cash","pcc","bpp","意义","冲正","类","码表","消费","prc","acr","取消","打印","bve","bvd","acr2edc","小票","tvd","查询","下单","edc","per2edc","撤销","dcc","余额","ppc","cth","pbi","pnp","－","小费","条码","退货","现金","bth","pcr","完成","交易","ttd","交易类型","授权","pmc","类型"],"title":"4. 交易类型","title_tokens":["4","交易"," ","交易类型","类型","."]},{"location":"documentation/Qr/","text":"扫码交易 扫码相关的交易则是不依赖 POS 机器的读卡模块的,但是你需要将 微信 或者 支付宝 的二维码读出来传给扫码消费接口,扫码可以使用第三方库,如 zxing 。 扫码消费 CILRequest request = new CILRequest(); request.setAmount(amount);//交易金额 request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） CILSDK.consumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { // 处理扫码消费结果，字段说明见底部 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： // resultCode = response.getTrans().getRespCode(); // if (\"09\".equals(resultCode)) { // CILSDK.queryQr(); // `queryQr` 方法见下文 // } } @Override public void onError(Parcelable cilRequest, Exception e) { // 扫码消费出错 } }); 注意,如果应答码返回09或98，需要调用讯联扫码查询接口，查询该笔订单的实际状态。 扫码撤销 CILRequest request = new CILRequest(); request.setAmount(amount);//原交易金额 request.setBatchNum(batchNum);//原交易批次号 request.setTraceNum(traceNum);//原交易凭证(流水)号 request.setReferenceNumber(refNum); //原交易参考号 CILSDK.revokeConsumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 扫码退货 CILRequest request = new CILRequest(); request.setAmount(amount);//退款金额 request.setReferenceNumber(serialNum);//原交易参考号 request.setTransDatetime(tradeDate);//原交易时间 CILSDK.returnConsumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 扫码查询 CILRequest request = new CILRequest(); request.setBatchNum(response.getTrans().getBatchNum());//批次号 request.setTraceNum(response.getTrans().getTraceNum());//凭证号 request.setPeriod(10000L);//10s request.setLimitTime(6);//6 次 request.setReferenceNumber(response.getTrans().getRefNum());//参考号 request.setPosInputStyle(response.getTrans().getPosInputStyle());//pos输入服务方式码 request.setScanCodeId(response.getTrans().getScanCodeId());//扫码号 request.setAmount(response.getTrans().getTransAmt());//交易金额 CILSDK.queryQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 扫码消费查询,只查询一次，不含取消接口 CILRequest request = new CILRequest(); request.setBatchNum(response.getTrans().getBatchNum());//批次号 request.setTraceNum(response.getTrans().getTraceNum());//凭证号 request.setReferenceNumber(response.getTrans().getRefNum());//参考号 request.setPosInputStyle(response.getTrans().getPosInputStyle());//pos输入服务方式码 request.setScanCodeId(response.getTrans().getScanCodeId());//扫码号 CILSDK.queryQrJustOnce(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 扫码取消 /** * 扫码取消 * 对于09状态的消费订单，最终需要取消、关单 * @param request * @param listener */ CILRequest cilRequest = new CILRequest(); cilRequest.setOriginalTradeDate(response.getTrans().getTransDate());//原交易日期 cilRequest.setAmount(response.getTrans().getTransAmt());//交易金额 cilRequest.setBatchNum(response.getTrans().getBatchNum());//批次号 cilRequest.setTraceNum(response.getTrans().getTraceNum());//凭证号 cilRequest.setPosInputStyle(response.getTrans().getPosInputStyle());//pos输入服务方式码 cilRequest.setReferenceNumber(response.getTrans().getRefNum());//参考号 CILSDK.voidQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 扫码预授权 CILRequest request = new CILRequest(); request.setAmount(amount); request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） CILSDK.preAuthQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { // 处理扫码预授权结果 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： /** * resultCode = response.getTrans().getRespCode(); * if (\"09\".equals(resultCode) ) { * CILSDK.queryQr(); // `queryQr` 方法见下文 * } */ } @Override public void onError(Parcelable cilRequest, Exception e) { //扫码预授权出错 } }); 扫码预授权撤销 CILRequest request = new CILRequest(); request.setAmount(transAmt);//原预授权交易金额 request.setReferenceNumber(revAuthCode);//原预授权交易参考号 request.setTransDatetime(transDate);//原预授权交易时间 request.setBatchNum(curTrans.getBatchNum());//原预授权交易批次号 request.setTraceNum(curTrans.getTraceNum());//原预授权交易凭证（流水）号 CILSDK.revokePreAuthQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 扫码预授权完成 CILRequest request = new CILRequest(); request.setAmount(transAmt);//原预授权交易金额 request.setReferenceNumber(revAuthCode);//原预授权交易参考号 request.setTransDatetime(transDate);//原预授权交易时间 CILSDK.preAuthCompleteQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 扫码预授权完成撤销 CILRequest request = new CILRequest(); request.setAmount(transaction.getTransAmt());//原预授权完成交易金额 request.setBatchNum(transaction.getBatchNum());//原预授权完成交易批次号 request.setTraceNum(transaction.getTraceNum());//原预授权完成交易凭证（流水）号 request.setReferenceNumber(transaction.getRefNum());//原预授权完成交易参考号 CILSDK.revokePreAuthCompleteQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 单品券功能接入指引 注意：sdk v2.5.3及之后版本支持该功能 1. 扫码消费接口增加单品券核销功能，扫码消费接口增加入参两个参数，订单优惠标记（为配券时候的填的优惠标记）,商品列表； /** * 扫码消费 */ CILRequest request = new CILRequest(); request.setAmount(amount); request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） request.setOrderPromotionMark(orderPromotionMark);//订单优惠标记（类型String可选参数） request.setGoodsList(goodsList);//商品列表（类型String可选参数）详见下新增字段说明 CILSDK.consumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { // 处理扫码消费结果 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： /** * resultCode = response.getTrans().getRespCode(); * if (\"09\".equals(resultCode) ) { * CILSDK.queryQr(); // `queryQr` 方法见下文 * } */ } @Override public void onError(Parcelable cilRequest, Exception e) { // 扫码消费出错 } }); 新增字段说明 字段 类型 含义 是否可选 备注1 备注2 orderPromotionMark String 订单优惠标记 Y ans32 来源于配券时选填字段 goodsList String 商品列表 Y 最多9个商品 按照以下样例格式传输 报文样例： \"orderPromotionMark\":\"1111\", \"[ { \"goodsName\":\"小面包\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"1111\" }, { \"goodsName\":\"棒棒糖\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"2222\" }, { \"goodsName\":\"彩虹糖\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"3333\" }, { \"goodsName\":\"矿泉水\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"4444\" } ]\" 响应报文新增一个CouponInfo的实例,内部包含属性字段有： 字段 类型 含义 是否可选 备注 couponId String 优惠券id Y couponName String 优惠券名称 Y channelContribution String 渠道出资 Y MerchantContribution String 商家出资 Y otherContribution String 其它出资 Y discountType String 优惠类型 Y discountRange String 优惠范围 Y discountbatchaId String 优惠活动批次ID Y goodsList String 单品优惠商品列表 Y 单品优惠列表商品字段 字段 类型 含义 是否可选 备注 goodsBarCode String 商品条码号 Y goodsDiscount String 单品优惠金 Y CouponInfo响应报文样例： { \"MerchantContribution\":\"000000000100\", \"couponId\":\"9026256969\", \"couponName\":\"讯联满1.1减1 tag\", \"discountRange\":\"SINGLE\", \"discountType\":\"DISCOUNT\", \"discountbatchaId\":\"9803978\", \"goodsList\":\"[{\"goodsBarCode\":\"1111\",\"goodsDiscount\":\"000000000034\"}, {\"goodsBarCode\":\"2222\",\"goodsDiscount\":\"000000000034\"}, {\"goodsBarCode\":\"3333\",\"goodsDiscount\":\"000000000032\"}]\", \"otherContribution\":\"000000000000\" } 附：最多支持传入9个商品","text_tokens":["(","equals","调用"," ","goodslist","日期","出错","源于","结果","settracenum","订单","报文","入参","应答","传输","9803978","goodsdiscount","othercontribution","样例","方法","revokeconsumeqr","含义","包含","指引","底部","void","关单","时选","e","response","方式","preauthcompleteqr","的","格式","如","[","最多","配券","实际","次","98","setposinputstyle","返回","字段","setamount","*","tag","联满","setbatchnum","discountbatchaid","出来","setlimittime","支持","只","revauthcode","channelcontribution","returnconsumeqr","/","使用",".","支付","原预","10s","2222","填字","\"","之后","备注","详见","zxing","核销","setorderpromotionmark","金","出资","微信","对于","见下文","onresult","gettrans","code","2","是否","该","说明","sdk","则","有","矿泉水","v2.5","revokepreauthqr","或","gettracenum","为","4444","1","棒棒","如下","goodsnum","渠道","。","撤销","new","tradedate","onerror","pos","单品","setperiod","依赖","列表","preauthqr","注意","batchnum","...","setscancodeid","接口","参考","获取","parcelable","可选","gettransdate","transdate","商家","属性","二维","棒棒糖","、","金额","override","服务","传给","下文","一次","）","getposinputstyle","第三方","批次","id","callback","setgoodslist","优惠券","机器","revokepreauthcompleteqr","优惠活动","=","000000000032","goodsname","gettransamt","1111","名称","一个","setreferencenumber","，","消费","读卡","该笔","serialnum","y","setorderid","流水","矿泉","discountrange","泉水","两个","；","settransdatetime","最终","读出","6","000000000100","1.1","下","public","版本","single","getbatchnum","响应","`","相关","cilrequest","tracenum","新增","或者","单品券","curtrans","queryqrjustonce","3333","段","if","支付宝","及","凭证","consumeqr","需要","amount","@","增加","3","单号","第三","不","discounttype","原","外部","：","含","库","实例","9026256969","orderpromotionmark","以下","小面包","授权","request","模块","范围","是","面包","将","<","setoriginaltradedate","最","000000000034","二维码","查询","联扫码","彩虹","退货","讯","功能","类型","字","price","附",">","000000000000","活动","queryqr","voidqr","listener","discount","来源于","transaction","内部","个","见","]","goodsbarcode","resultcode","exception","getrespcode","如果","取消","10000l","输入","退款","（","merchantcontribution","getscancodeid","时候","}","ans32","result","couponid","传入","string","其它","标记","号","填","transamt","你","可","状态","可以","订单号","选","cilsdk",",","orderid","处理","9","couponinfo","参数","{",":","优惠","扫码","交易","多","商品","来源","按照","时间","码","预",")","接入","couponname","三方","param","cilresponse","但是","getrefnum","09","减","条码","糖","完成","读出来",";","refnum","goodsid"],"title":"Qr","title_tokens":["qr"]},{"location":"documentation/active/","text":"激活POS机 激活环节分为三步，分别是：激活，终端参数下载，终端密钥下载，三步都成功，表示激活成功，激活成功之后才能正常使用后面的交易流程。 激活 a、新激活接口（推荐） 根据用户反馈，为了简化激活流程，我们新增了激活码的方式激活，当你拿到 POS 机器之后，我们会为这个商户发放激活码，一个激活码可以激活一台 POS 机。 成功激活后，接口会返回商户号，终端号等信息，后续参数下载需要用到。 注意:一台终端能且仅能成功激活一次,无法重复进行激活操作。若有多次激活的需求(如debug阶段),请联系讯联客服。 //authCode 激活码（建议用扫码的方式得到激活码，避免让用户手输） CILSDK.activeWithCode(authCode, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { if (cilResponse.getStatus() == 0) { //激活成功 } else { //激活失败，失败原因见 cilResponse.getMessage() } } @Override public void onError(Parcelable cilRequest, Exception e) { //激活出错 } }); b、旧激活接口 第一次使用智能 POS 终端的时候,需要使用讯联下发的商户号 merCode 和终端号 termCode 激活 注意:一台终端能且仅能成功激活一次,无法重复进行激活操作。若有多次激活的需求(如debug阶段),请联系讯联客服。推荐APP本身能够保持设备是否已经激活标志 //merCode 讯联下发的商户号 //termCode 讯联下发的终端号 CILSDK.active(merCode, termCode, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { if (cilResponse.getStatus() == 0) { //激活成功 } else { //激活失败 } } @Override public void onError(Parcelable p, Exception e) { //激活出错 } }); 终端参数下载 激活成功之后,你的应用还需要下载一些交易时使用的参数,比如 交易地址和端口 、 交易超时时间 、 终端支持的功能 、 TPDU 等, 在你拿到 POS 终端之前,这些参数都会在讯联后台已经配置好,全部参数见 CILResponse.Info 返回值。下载成功之后 SKD 会 以json字符串的形式保存这些参数到 SharedPreference (请不要擅自改动这些参数值,以免导致交易失败) 。当然,在 onResult 中也会返回,你也可以自己选择性保存一些参数。另外, SDK 保存在 SharedPreference 里的值会提供接口 CILSDK.getSystemParams() 获取。 注意：正常情况下，此方法只需执行成功一次，但是后台参数配置可能会有改动，APP本身需要调用预留功能调用此方法 //merCode 讯联下发的商户号 激活成功之后可以确定商户号 //termCode 讯联下发的终端号 激活成功之后可以确定终端号 CILSDK.downloadParams(merCode, termCode, new com.cardinfolink.pos.listener.Callback<CILResponse>() { @Override public void onResult(CILResponse response) { if (0 == response.getStatus()) { //参数下载成功,具体返回的参数见 response.Info } else { //参数下载错误 } } @Override public void onError(Parcelable p, Exception e) { //下载出错 } }); 终端密钥下载 终端密钥下载只需要成功执行一次就可以,成功下载的密钥会被转载到POS硬件模块里面,后面就不需要再次调用了,建议你的应用可以在成功下载密钥之后持久化一个标志位, 下次进入应用就不再去下载密钥了。整个过程可能会需要1~2分钟左右(依赖当前的网络状况),会经历以下步骤: 请求讯联网关 RSA -> 装载 RSA -> 请求主密钥 -> 装载主密钥 -> 启用主密钥 -> 请求工作密钥(签到) -> 装载工作密钥 -> 下载 AID -> 装载 AID -> 下载 IC 公钥 -> 装载 IC 公钥。 建议APP本身存储设备是否已经初始化方法标志。 注意：此方法一般只需要安装后成功调用一次即可。但银行交互密钥有可能会更新，APP本身需要调用预留功能调用此方法 CILSDK.downloadParamsWithProgress(new ProgressCallback<CILResponse>() { @Override public void onProgressUpdate(int progress) { //progress下载密钥的进度 } @Override public void onResult(CILResponse response) { if (0 == response.getStatus()) //密钥下载成功。在这里可以持久化一个标志位 } @Override public void onError(Parcelable p, Exception e) { //下载密钥出错 } });","text_tokens":["(","应用","onresult","mercode",">","调用","推荐","若有","ic"," ","一个","保持","硬件","不再","我们","主","初始","json","不要","2","出错","是否","值会","，","形式","listener","能够","能且","保存","超时","downloadparamswithprogress","和","中","选择","即可","擅自","但","关","新","分钟","阶段","建议","可能","才能","终端","在","时","信息","流程","网络","后","见","getstatus","0","sdk","activewithcode","联","选择性","以","方法","被","改动","返回值","getsystemparams","环节","密钥","有","启用","仅","商户","分别","整个","联系","功能","装载","存储设备","progress","需","确定","步骤","exception","void","等","过程","操作","讯联","一台","标志","e","response","后续","方式","也","多次","的","更新","配置","能","错误","公钥","下","p","当前","如","到","化","1","（","一些","情况","public","cardinfolink","全部","请","持久","active","安装","。","时候","}","后台","getmessage","new","下发","onerror","cilrequest","拿到","无法","新增","b","pos","会","本身","会为","让","避免","设备","a","返回","了","进行","都","skd","自己","依赖","号","注意","aid","com","还","进入","你","下次","可以","用户","if","转载","联网","cilsdk","接口","进度","简化",",","具体","支持","parcelable","获取","正常","sharedpreference","需要","只","需求","表示","状况","@","请求","工作","存储","tpdu","里面","根据","成功","一般","/","使用","提供","用到","用","不","参数",".","失败","位","分为","{","：","初始化",":","扫码","得到","交易","地址","此","-","导致","当然","去","以下","第一","激活码","这里","之前","第一次","override","termcode","模块","三步","是","时间","就","机","客服","authcode","downloadparams",")","<","旧","这些","之后","原因","激活","发放","info","一次","）","~","cilresponse","else","端口","反馈","但是","再次","debug","以免","另外","rsa","交互","这个","银行","比如","左右","callback","字符串","智能","后面","重复","progresscallback","为了","经历","参数值","预留","机器","里","当","app","讯","=","手输","好","int","onprogressupdate","已经","数值","下载",";","字符","签到","执行","、"],"title":"Active","title_tokens":["active"]},{"location":"documentation/bill/","text":"账单查询 智能 POS SDK 分别提供了最多30天的 账单列表查询 和 账单统计接口 接口,接口会根据 type 值确定返回 银行卡账单 或 扫码账单 。 交易成功还是失败最终以返回账单中应答码为准，见 应答码表 。 交互设计建议：交易中，具体来说，调用CILSDK.consumeQr()或是CILSDK.consume()方法时，当因为网络中断进入onError callback时，建议在交互中加入 查询账单列表 的逻辑，这样交易失败后可方便收银员通过账单来确认这笔订单的实际状态。 注意：对于 09 （请求正在处理中）状态的交易账单数据，还需要看 处理标志位 才能判定此次交易成功与否，使用 getProcessFlag() 获取。 当 processFlag 为 '0' 时，此次交易成功；当 processFlag 为非'0' 时，此次交易失败，见 处理标志表 。 根据外部订单号获取该笔订单信息（同步） //outOrderNum为传入数据 CILSDK.getBillsAsync(outOrderNum, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }) 根据凭证号获取当前批次号下该笔订单详情(异步) /** * 依据凭证号，获取当前批次下的订单详情 回调在主线程 * 异步操作 * @param traceNum 凭证号 * @param listener */ CILSDK.getBillByTraceNum(traceNum, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 根据参考号获取当前批次下的订单详情（异步操作） /** * @param refNum 参考号 * @param callBackIsOnMainThread 是否在主线程中回调 */ CILSDK.getBillByRefNumAsync(refNum, callBackIsOnMainThread, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 根据批次号获取当前批次下的订单详情（异步操作） /** * @param refNum 批次号 * @param callBackIsOnMainThread 是否在主线程中回调 */ CILSDK.getBillByBatchNumAsync(batchNum, callBackIsOnMainThread, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 获取账单列表 1. 默认获取三十天的账单列表 /** * 获取账单列表 异步 * * @param int page 从0开始 * @param int size 每页返回的条数 * @param int type 账单类型(TransConstants.CARD_BILL, TransConstants.QR_BILL, TransConstants.ALL_BILL) * */ CILSDK.getBillsAsync(page, size, @BillType int type, new Callback<CILResponse>() { @Override public void onResult(final CILResponse response) { if (null != response && 0 == response.getStatus()) { //账单获取成功 Trans[] trans = response.getTxn(); //账单数据,字段详情见 Trans } } @Override public void onError(Parcelable p, Exception ex) { //账单获取出错 } }); 2. 获取指定区间的账单列表 /** * 获取账单列表 异步 * * @param page * @param size * @param startTime 查询订单开始时间，格式：yyyyMMdd * @param endTime 查询订单结束时间，格式：yyyyMMdd * @param type * @param callBackIsOnMainThread * @param listener * @return */ CILSDK.getBillsAsync(page, size, startTime, endTime, type, true, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 获取今日交易统计 /** * 获取今日交易统计 异步 * @param type 账单类型 * <ul> * <li>TransConstants.ALL_BILL:所有账单</li> * <li>TransConstants.CARD_BILL:银行卡账单</li> * <li>TransConstants.QR_BILL:扫码账单</li> * </ul> * */ CILSDK.getBillStatAsync(@BillType int type, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { if (null != response && 0 == response.getStatus()) { //今日交易统计获取成功 } } @Override public void onError(Parcelable p, Exception ex) { //今日交易统计获取出错 } }); SDK 的网络部分使用的是第三方库 okhttp ,以上账单接口分别还提供了相对应的同步接口 getBills 和 getBillStat 。 对于异步接口来说,都会返回一个 Call 对象,你可以在应用出错的时候调用 call.cancel() 取消这次请求,以免造成内存泄露。","text_tokens":["字","(","应用","onresult","确认","这笔","getbillbyrefnumasync","调用",">","li","processflag","billtype"," ","一个","2","出错","详情","来","是否","，","listener","和","中","该笔","值","cancel","泄露","订单","应答","非","建议","才能","在","时","依据","信息","因为","见","网络","后","账单","sdk","方法","0","getstatus","以","方便","]","starttime","yyyymmdd","分别","card","对象","确定","为准","通过","；","条数","内存","exception","void","最终","判定","操作","或","标志","e","response","以上","ul","同步","或是","为","的","设计","qr","主线","程","取消","endtime","下","当前","p","!","[","ex","三十天","1","（","回调","final","指定","call","public","银员","结束","。","时候","天","callbackisonmainthread","transconstants","}","所有","okhttp","new","应","表","实际","传入","onerror","cilrequest","tracenum","收银","还","trans","pos","会","都","返回","了","每页","今日","列表","*","号","注意","银行卡","十天","进入","你","getbillbytracenum","可","状态","null","getbillstat","batchnum","可以","中断","异步","段","...","if","订单号","开始","cilsdk","加入","接口","收银员","具体",",","数据","参考","获取","parcelable","consumeqr","getprocessflag","凭证","区间","还是","type","处理","需要","逻辑","请求","@","正在","格式","单号","根据","成功","outordernum","/","提供","使用","第三","getbills","这次",".","30","失败","位","程中","{","：","外部",":","size","扫码","库","交易","多","return","page","造成","bill","override","是","时间","码","'","getbillsasync","getbillbybatchnumasync","getbillstatasync","consume","&&",")","部分","<","统计","与否","三方","码表","gettxn","从","）","param","cilresponse","最","第三方","true","默认","这样","交互","以免","批次","银行","来说","查询","all","09","callback","三十","智能","相对","对于","当","看","=","int","此次",";","_","refnum","类型","具体来说"],"title":"Bill","title_tokens":["bill"]},{"location":"documentation/bluetooth/","text":"一、使用场景和流程 传统收银机需要连接讯联的智能 POS 进行收银，但是为了适应收银机上已有的一些业务系统，需要做到收银机唤起智能 POS， 同时接收来自收银机的一些参数，如金额，参考号等。待智能 POS 接收到请求并处理完毕之后，会立即将交易的处理结果返回给收银机。 需要下载风狐智能 POS 蓝牙版，才能具备串口唤起我们的应用功能，请扫描下方二维码，或 下载到本地 注：目前只支持新大陆 N900 智能 POS + 新大陆 N900 蓝牙底座 二、传输数据格式定义 //request 报文 (收银机 -> 智能 POS) { \"action\":\"CBANK\", //CBANK:银行卡消费, CQR:扫码消费, CANBANK:银行卡撤销, CANQR:扫码撤销, RETBANK:银行卡退货, RETQR:扫码退货, ORDER:订单查询 \"amount\":\"10.01\", //金额 \"extOrder\":\"1002016122912\", //外部订单号（可选） \"refNum\":\"361172435022\", //原交易参考号 \"revAuthCode\":\"012345\", //原交易授权码 \"batchNum\":\"000001\", //原交易批次号 \"traceNum\":\"000012\", //原交易凭证号 \"transDatetime\":\"1229\", //原交易日期(MMdd) \"page\":\"1\", //第几页（从1开始） \"size\":\"10\", //每页返回的条数 \"txnType\":\"QR\" //账单类型 CARD:银行卡账单, QR:扫码账单, ALL:银行卡和扫码账单 } //response 报文 (智能 POS -> 收银机) { \"status\":1, //状态 1 成功；0 失败； \"msg\":\"success\", //详细信息 \"data\":[ //数据 { //交易数据字段详情可见 javadoc \"additionalResData\": \"0102000010134001\",//附加响应数据 \"batchNum\": \"000001\", //批次号 \"billingAmt\": \"\", //持卡人扣帐金额 \"billingCurr\": \"\", //持卡人扣帐货币代码 \"cardBrand\": \"CUP\", //国际信用卡公司代码 \"cardNo\": \"6222042600001000\", //银行卡号(后续将会返回622204****1000形式) \"clearingDate\": \"0122\", //清算日期 \"localTransDate\": \"0122\", //受卡方所在地日期 \"localTransTime\": \"142139\", //受卡方所在地时间 \"merCode\": \"201605260000001\", //商户号 \"posInputStyle\": \"\", //服务点输入方式码 \"processflag\": \"0\", //交易处理标志 \"refNum\": \"022142445573\", //检索参考号 \"respCode\": \"00\", //应答码 \"revAuthCode\": \"007508\", //授权标识应答码 \"revFlag\": \"0\", //冲正标志 \"revInsCode\": \"0102000010134001\", //附加响应数据 \"scanCodeId\": \"\", //扫码号 \"termCode\": \"00000007\", //终端号 \"traceNum\": \"000037\", //凭证号 \"transAmt\": \"10.01\", //交易金额 \"transCode\": \"PER\", //交易类型码 \"transCurr\": \"156\", //交易货币代码 \"transDate\": \"20170122142141\", //原交易日期 \"transDatetime\": \"0122142139\", //受卡方所在地日期＋受卡方所在地时 \"transRate\": \"\", //持卡人扣帐汇率 \"merDiscount\":\"1.00\", //商家优惠金额 \"coupon\":\"0.01\" //支付宝/微信优惠金额 }, ... ] } 注意：respCode 应答码表可参见 交易应答码表V3 三、调试方法 将蓝牙底座和串口正确连接，并且将智能 POS 机上的蓝牙底座应用打开，找到底座蓝牙并且连接成功。然后就可以使用串口调试工具发送示例报文了。 四、交易报文示例 银行卡消费 //request { \"action\": \"CBANK\", \"amount\": \"10.01\", \"extOrder\":\"1002016122912\" } //response { \"data\": [ { \"additionalResData\": \"01020000 10134001 \", \"batchNum\": \"000001\", \"billingAmt\": \"\", \"billingCurr\": \"\", \"cardBrand\": \"CUP\", \"cardNo\": \"6222042600001000\", \"clearingDate\": \"0122\", \"localTransDate\": \"0122\", \"localTransTime\": \"142139\", \"merCode\": \"201605260000001\", \"posInputStyle\": \"\", \"processflag\": \"0\", \"refNum\": \"022142445573\", \"respCode\": \"00\", \"revAuthCode\": \"007508\", \"revFlag\": \"0\", \"revInsCode\": \"01020000 10134001 \", \"scanCodeId\": \"\", \"termCode\": \"00000007\", \"traceNum\": \"000037\", \"transAmt\": \"10.01\", \"transCode\": \"PER\", \"transCurr\": \"156\", \"transDate\": \"20170122142141\", \"transDatetime\": \"0122142139\", \"transRate\": \"\" } ], \"msg\": \"success\", \"status\": 1 } 银行卡撤销 //request { \"action\": \"CANBANK\", \"amount\": \"10.01\", \"traceNum\": \"000037\", \"extOrder\":\"1002016122912\" } //response { \"data\": [ { \"additionalResData\": \"01020000 10134001 \", \"batchNum\": \"000001\", \"billingAmt\": \"\", \"billingCurr\": \"\", \"cardBrand\": \"CUP\", \"cardNo\": \"6222042600001000\", \"clearingDate\": \"0122\", \"localTransDate\": \"0122\", \"localTransTime\": \"145536\", \"merCode\": \"201605260000001\", \"posInputStyle\": \"\", \"processflag\": \"0\", \"refNum\": \"022142445573\", \"respCode\": \"00\", \"revAuthCode\": \"007508\", \"revFlag\": \"0\", \"revInsCode\": \"01020000 10134001 \", \"scanCodeId\": \"\", \"termCode\": \"00000007\", \"traceNum\": \"000040\", \"transAmt\": \"10.01\", \"transCode\": \"PVR\", \"transCurr\": \"156\", \"transDate\": \"20170122145538\", \"transDatetime\": \"0122145536\", \"transRate\": \"\" } ], \"msg\": \"success\", \"status\": 1 } 银行卡退货 //request { \"action\": \"RETBANK\", \"amount\": \"10.01\", \"refNum\": \"022145445612\", \"transDatetime\": \"0122\", \"extOrder\":\"1002016122912\" } //response { \"data\": [ { \"additionalResData\": \"01020000 10134001 \", \"batchNum\": \"000001\", \"billingAmt\": \"\", \"billingCurr\": \"\", \"cardBrand\": \"CUP\", \"cardNo\": \"6222042600001000\", \"clearingDate\": \"0122\", \"localTransDate\": \"0122\", \"localTransTime\": \"150037\", \"merCode\": \"201605260000001\", \"posInputStyle\": \"\", \"processflag\": \"0\", \"refNum\": \"022145445612\", \"respCode\": \"00\", \"revAuthCode\": \"\", \"revFlag\": \"0\", \"revInsCode\": \"01020000 10134001 \", \"scanCodeId\": \"\", \"termCode\": \"00000007\", \"traceNum\": \"000042\", \"transAmt\": \"10.01\", \"transCode\": \"CTH\", \"transCurr\": \"156\", \"transDate\": \"20170122150039\", \"transDatetime\": \"0122150037\", \"transRate\": \"\" } ], \"msg\": \"success\", \"status\": 1 } 扫码消费 //request { \"action\": \"CQR\", \"amount\": \"0.01\", \"extOrder\":\"1002016122912\" } //response { \"data\": [ { \"additionalResData\": \"00000000 10134001 \", \"batchNum\": \"000001\", \"billingAmt\": \"\", \"billingCurr\": \"\", \"cardBrand\": \"ALP\", \"cardNo\": \"pho***@foxmail.com\", \"clearingDate\": \"\", \"localTransDate\": \"0122\", \"localTransTime\": \"145144\", \"merCode\": \"201605260000001\", \"posInputStyle\": \"040\", \"processflag\": \"0\", \"refNum\": \"022145445609\", \"respCode\": \"00\", \"revAuthCode\": \"\", \"revFlag\": \"0\", \"revInsCode\": \"00000000 10134001 \", \"revOrderNum\": \"2017012221001004480248605076\", \"scanCodeId\": \"E68890E58A9F\", \"termCode\": \"00000007\", \"traceNum\": \"000038\", \"transAmt\": \"0.01\", \"transCode\": \"BPA\", \"transCurr\": \"156\", \"transDate\": \"20170122145149\", \"transDatetime\": \"0122145144\", \"transRate\": \"\" } ], \"msg\": \"success\", \"status\": 1 } 扫码撤销 //request { \"action\": \"CANQR\", \"amount\": \"0.01\", \"traceNum\": \"000038\", \"extOrder\":\"1002016122912\" } //response { \"data\": [ { \"additionalResData\": \"00000000 10134001 \", \"batchNum\": \"000001\", \"billingAmt\": \"\", \"billingCurr\": \"\", \"cardBrand\": \"ALP\", \"cardNo\": \"pho***@foxmail.com\", \"clearingDate\": \"\", \"localTransDate\": \"0122\", \"localTransTime\": \"145411\", \"merCode\": \"201605260000001\", \"posInputStyle\": \"\", \"processflag\": \"0\", \"refNum\": \"022145445610\", \"respCode\": \"00\", \"revAuthCode\": \"\", \"revFlag\": \"0\", \"revInsCode\": \"00000000 10134001 \", \"revOrderNum\": \"2017012221001004480248605076\", \"scanCodeId\": \"E68890E58A9F\", \"termCode\": \"00000007\", \"traceNum\": \"000039\", \"transAmt\": \"0.01\", \"transCode\": \"BPA\", \"transCurr\": \"156\", \"transDate\": \"20170122145414\", \"transDatetime\": \"0122145411\", \"transRate\": \"\" } ], \"msg\": \"success\", \"status\": 1 } 扫码退货 //request { \"action\": \"RETQR\", \"amount\": \"0.01\", \"refNum\": \"022150445617\", \"transDatetime\": \"0122\", \"extOrder\":\"1002016122912\" } //response { \"data\": [ { \"additionalResData\": \"00000000 10134001 \", \"batchNum\": \"000001\", \"billingAmt\": \"\", \"billingCurr\": \"\", \"cardBrand\": \"ALP\", \"cardNo\": \"pho***@foxmail.com\", \"clearingDate\": \"\", \"localTransDate\": \"0122\", \"localTransTime\": \"150601\", \"merCode\": \"201605260000001\", \"posInputStyle\": \"\", \"processflag\": \"0\", \"refNum\": \"022150445618\", \"respCode\": \"00\", \"revAuthCode\": \"\", \"revFlag\": \"0\", \"revInsCode\": \"00000000 10134001 \", \"revOrderNum\": \"2017012221001004480248627853\", \"scanCodeId\": \"E68890E58A9F\", \"termCode\": \"00000007\", \"traceNum\": \"000044\", \"transAmt\": \"0.01\", \"transCode\": \"BPA\", \"transCurr\": \"156\", \"transDate\": \"20170122150605\", \"transDatetime\": \"0122150601\", \"transRate\": \"\" } ], \"msg\": \"success\", \"status\": 1 } 交易明细 //request { \"action\": \"ORDER\", \"page\": \"1\", \"size\": \"10\", \"txnType\": \"QR\" } //response { \"data\": [ { \"batchNum\": \"000001\", \"billingAmt\": \".01\", \"billingCurr\": \"156\", \"cardBrand\": \"ALP\", \"cardNo\": \"0000000000000000000\", \"insCode\": \"10134001\", \"merCode\": \"201605260000001\", \"processflag\": \"0\", \"refNum\": \"022150445618\", \"respCode\": \"00\", \"revAuthCode\": \" \", \"revFlag\": \"0\", \"revOrderNum\": \"2017012221001004480248627853\", \"termCode\": \"00000007\", \"traceNum\": \"000044\", \"transAmt\": \"0.01\", \"transCode\": \"BTH\", \"transCurr\": \"156\", \"transDate\": \"20170122\", \"transDatetime\": \"0122150601\", \"transRate\": \"30001000\" }, ... ], \"msg\": \"success\", \"status\": 1 } 会员卡（佰馏卡） //request { \"action\": \"VC_MEMBER\" } //response { \"extra\":{ \"amount\": \"100000\",//金额 \"balance\": \"10000\",//余额 \"points\": \"100\",//积分 \"cardNum\": \"0000000000000000000\",//卡号 \"requestType\": {}, \"response\": {},/消费返回信息 \"vcRespAggrRes\": {},//合计信息 \"vcRespInquiry\": {},//余额查询信息 \"originTransNum\": \"\"//原交易号 }, \"msg\": \"success\", \"status\": 1 } 五、错误码(TODO) 代码 意义 0 失败 1 成功 -1 请求为空 -11 金额格式不合法 -12 参数长度错误 -13 未知交易类型 -14 日期格式错误 -15 报文格式错误 -16 字段为空 -17 无权限 -2 设备被占用 六、Q&A (TODO) 1、为什么智能 POS 在有些界面接收到蓝牙发去的报文没任何反应呢？ 当 N900 处在刷卡，打印等情况时，设备会被占用，主要体现在刷卡界面，扫码界面等和打印凭条的时候， 所以当智能 POS 应用处于以下界面的时候，会不接收蓝牙发过来的交易请求： (为不和用户直接操作 POS 冲突，建议当应用处于主界面的时候发送请求) 扫码界面、等待刷卡界面、密码键盘界面、电子签名界面、交易成功界面、交易失败界面、订单详情界面、 设置界面、会员卡所有的界面、撤销确认界面、扫码退货界面、余额查询界面、DCC转EDC界面、收取小费界面、 小费撤销界面、收取小费确认界面、撤销小费确认界面、结算详情界面、历史结算详情界面、记账结算界面、 记账明细界面、现金结算界面、现金历史结算界面","text_tokens":["(","完毕","022145445609","150601","体现"," ","156","主","日期","意义","详情","transrate","结果","&","历史","022142445573","订单","报文","origintransnum","应答","000037","传输","界面","下方","respcode","发过来","时","小费","给","mmdd","被","方法","txntype","键盘","145144","记账","00000000","n900","来自","为空","处理完毕","response","040","后续","cup","方式","的","四","调试","任何","错误","什么","格式","如","到","[","情况","0122150037","空","0122","＋","所有","第几页","361172435022","代码","142139","工具","进行","返回","了","电子签名","字段","发去","*","merdiscount","com","几页","合计","签名","status","报文格式","开始","直接","清算","20170122145538","支持","cardno","呢","只","卡人","revauthcode","请求","points","/","使用","cth","10134001",".","点","20170122145149","发过","balance","cardbrand","支付","termcode","所以","持卡","extorder","\"","cardnum","之后","20170122142141","022150445618","新大陆","收银机","cbank","具备","待","微信","022150445617","0122145411","同时","下载","022145445612","per","错误码","本地","processflag","场景","数据格式","冲正","2","形式","1000","系统","立即","终端","1.00","q","vc","01020000","todo","做到","将会","处理结果","条数","处于","或","讯联","000039","汇率","msg","检索","为","150037","foxmail","会员卡","000012","1","底座","16","业务","。","撤销","145536","2017012221001004480248627853","cqr","13","标识","pos","20170122","大陆","0122145144","注意","银行卡","0122150601","201605260000001","权限","会员","10.01","batchnum","622204","...","用户","100","参考","明细","六","transdate","所在","12","现金","商家","145411","007508","示例","size","二维","金额","transcode","服务","打开","扣","国际","从","）","公司","批次","银行","误码","智能","余额","localtransdate","+","当","转","14","正确","pho","应用","确认","mercode","revflag","，","第几","消费","000044","合法","revordernum","建议","才能","等待","coupon","发送","11","canqr","000042","商户","收取","card","alp","0000000000000000000","order","；","0.01","additionalresdata","主要","机上","2017012221001004480248605076","长度","revinscode","clearingdate","传统","反应","所在地","五","详细","蓝牙","一","定义","为什么","响应","100000","处在","tracenum","收银","并","retbank","0122145536","已有","10000","canbank","注","00","段","支付宝","inscode","数据","凭证","success","需要","transcurr","amount","transdatetime","@","连接","单号","成功","不","上","000038","失败","原","bth","：","外部","extra","冲突","page","以下","交易类型","授权","request","requesttype","022145445610","20170122145414","posinputstyle","串口","将","目前","码表","可见","密码","retqr","二维码","新大","1229","查询","all","edc","风狐","为了","退货","佰馏卡","e68890e58a9f","并且","功能","类型","凭条","bpa","电子",">","我们","和","打印","无","没","在","卡号","适应","信息","流程","vcrespinquiry","账单","0","有些","]","10","参见","20170122150605","等","操作","版","数据字","标志","000040","信用","billingamt","qr","货币","01","localtranstime","1002016122912","输入","00000007","（","一些","请","结算","时候","找到","}","接收","刷卡","30001000","就","会","0122142139","javadoc","设备","a","每页","附加","号","？","transamt","现金结算","可","状态","17","三","billingcurr","可以","信用卡","15","订单号","受卡方","选",",","20170122150039","处理","member","6222042600001000","理完","二","持卡人","参数","{",":","优惠","扫码","v3","交易","-","过来","012345","设置","详细信息","data","时间","码","然后","pvr","未知",")","唤起","0102000010134001","000001","但是","action","帐","scancodeid","dcc","vcrespaggrres","占用","积分","扫描","_","refnum","、"],"title":"2. BLUETOOTH API","title_tokens":["api","2","bluetooth"," ","."]},{"location":"documentation/card/","text":"a、银行卡交易 由于银行卡交易逻辑有点复杂,讯联提供了一个 BaseCardActivity 基础类,你只需要继承这个类便可以做银行卡类的交易了。具体使用方法可以见 demo 里的 CommonCardHandlerActivity 类。下面给个大概说明: public class CommonCardHandlerActivity extends BaseCardActivity { @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); //... } /** * 必须传入金额 * * @return */ public String getAmount() { //在这里传入金额 } /** * 此方法为控制sdk内部是否开启DCC交易逻辑（sdk2.4.1版本及以上支持该方法） * *@return 需要进行DCC交易时，返回true，否则返回false */ public boolean isOpenDcc() { //只有刷卡消费和刷卡预授权才支持DCC交易 //如果接入方无需支持DCC，则此方法返回false即可 return false; } /** * 读卡的结果（sdk2.4.1版本及以上新增RateInfo参数，返回DCC读卡流程中进行汇率查询的结果） * * @param isSuccess 是否成功 * @param cardType 卡片种类(-1(unknow) 1(msc) 2(ic) 3(nfc) 4(scancode) 5(other)) * @param cardInfo 读取卡片信息 * @param rateInfo 汇率信息 */ public void cardReaderHandler(boolean isSuccess, @CardType.Type int cardType, CardInfo cardInfo, RateInfo rateInfo){ //读卡成功后才发起交易 if (!isSuccess || cardInfo == null) { Toast.makeText(getApplicationContext(), \"读卡失败\", Toast.LENGTH_SHORT).show(); initCardEvent(); return; } //1. 根据银联85号文规定，智能终端需上送经度，纬度，坐标系信息到卡组织 CILRequest request = new CILRequest(); request.setLongitude(121.600228);//设置经度 request.setLatitude(31.180606);//设置纬度 request.setCoordinates(\"GCJ02\");//设置坐标系 //关于坐标系，国内一些常用第三方取值：百度（BD09），高德、腾讯（GCJ02），GPS（WGS84）。 //一般第三方定位SDK都能从定位后返回的位置信息类中取到，详细可查看各第三方接入文档。 //2.如果接入方需要进行DCC交易，需将汇率信息填入request中，否则无需处理 CILRequest request = new CILRequest(); ... if (rateInfo != null) { request.setBillingAmt(rateInfo.getBillingAmt());//设置扣账金额 request.setBillingCurr(rateInfo.getBillingCurr());//设置扣账币种 request.setTransRate(rateInfo.getTransRate());//设置交易汇率 request.setBatchNum(rateInfo.getBatchNum());//设置汇率请求批次号 request.setTraceNum(rateInfo.getTraceNum());//设置汇率请求流水号 } //3. 在这里面发送银行卡相关的交易(如消费、消费撤销、退货、预授权、预授权撤销、预授权完成、预授权完成撤销、余额查询) //CILSDK.consume(request, cardType, new Callback<CILResponse>() //消费 } /** * 显示读卡时的缓冲页面 */ public void waitLoadingShow(){ } /** * 取消读卡时的缓冲页面 */ public void waitLoadingDismiss(){ } /** * 读卡失败 */ public void cardHandlerError(Exception e){ } } 注意: 调用银行卡类交易接口时，需要传入CILRequest以及CardType，且所有接口中CILRequest均需要传入以下信息： /** * @param: request:请求信息 * @param: cardType:卡片类型 */ request.setAmount(amount);//消费金额 /** * 刷卡获取的cardInfo信息 */ request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPinEmv(cardInfo.getPinBins());//卡bin request.setCardSequenceNumber(cardInfo.getSequenceSerialNum());//卡片序列号 request.setField55(cardInfo.getField55());//55域信息 request.setSecondTrack(cardInfo.getTrack2());//二磁道信息 request.setOrderId(orderId);//可选参数。（消费、退货、预授权、预授权完成、扫码下单、扫码退货） request.setLocation(location)//有终端具备获取位置信息能力时必选上送（ 用于消费 预授权） 1、消费 消费接口 request必须包含参数: CILSDK.consume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 2、撤销 撤销接口 request必须包含参数: /** * 撤销接口除基础信息外， * 还需要原交易信息 */ request.setReferenceNumber(transaction.getRefNum());//原交易参考号 request.setRevAuthCode(transaction.getRevAuthCode());//原交易授权码 request.setBatchNum(transaction.getBatchNum());//原交易批次号 request.setTraceNum(transaction.getTraceNum());//原交易凭证号 CILSDK.revokeConsume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 3、退货 退货接口 request必须包含参数: /** * 退货接口除基础信息外 * 还需要原交易信息 */ request.setReferenceNumber(referenceNumber); request.setTransDatetime(tradeDate); CILSDK.returnConsume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 4、余额查询 余额查询接口 request必须包含参数: CILSDK.checkBalance(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 5、卡预授权 预授权接口 request必须包含参数: request.setLocation(location)//有终端具备获取位置信息能力时必选上送（ 用于消费 预授权） CILSDK.preAuth(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 6、卡预授权撤销 预授权撤销接口 request必须包含参数: /** * 预授权撤销接口除基础信息外 * 还需要原预授权交易信息 */ request.setRevAuthCode(authCode);//原预授权交易授权码 request.setTransDatetime(originalTradeDate);//原预授权交易日期 CILSDK.revokePreAuth(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 7、卡预授权完成 预授权完成接口 request必须包含参数: /** * 预授权完成接口除基础信息外 * 还需要原预授权交易信息 */ request.setRevAuthCode(authCode);//原预授权交易授权码 request.setTransDatetime(originalTradeDate);//原预授权交易日期 CILSDK.preAuthComplete(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 8、卡预授权完成撤销 预授权完成撤销接口 request必须包含参数: /** * 预授权完成撤销接口除基础信息外 * 还需要原预授权完成交易信息 */ request.setReferenceNumber(refNum);//原预授权完成交易参考号 request.setRevAuthCode(authCode);//原预授权完成交易授权码 request.setTraceNum(traceNum);//原预授权完成交易凭证号 request.setBatchNum(batchNum);//原预授权完成交易批次号 request.setTransDatetime(originalTradeDate);//原预授权完成交易日期 CILSDK.revokePreAuthComplete(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 9、DCC转EDC 当交易卡片为外卡时，消费类（消费、预授权完成）交易可选择进行DCC转EDC。 CILRequest request = new CILRequest(); request.setCardNum(cardNum);//卡号 request.setTransDatetime(datetime);//原交易时间 request.setAmount(amount);//原交易金额 request.setBillingAmt(biilingAmt);//原扣币金额 request.setReferenceNumber(refNum);//原交易参考号 request.setRevAuthCode(revAuthCode);//原交易授权码 request.setBatchNum(batchNum);//原交易批次号 request.setTraceNum(traceNum);//原交易凭证号 request.setTransCurr(transCurr);//原交易币种 request.setBillingCurr(billingCurr);//原交易扣款币种 CILSDK.dccToEdc(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable p, Exception e) { ... } }); 交易结果字段说明 字段 类型 含义 备注 备注 additionalResData String 受理方标识码 无 afterTransCode String 原交易类型 无 batchNum String 批次号 无 billingAmt String 持卡人扣帐金额 无 billingCurr String 持卡人扣帐货币代码符号，三位字母 例如USD billingCurrNum String 持卡人扣帐货币代码,三位数字 无 cardBrand String 国际信用卡公司代码 无 cardNo String 银行卡号 无 cardType String 刷卡方式 无 cashierName String 收银员 无 cashierNum String 收银员号 无 clearingDate String 清算日期 无 compInfoA1 String 签购单收单行 无 compInfoA2 String 签购单商户号 无 compInfoA3 String 签购单终端号 无 compInfoA4 String markup 无 compInfoA6 String 借贷记标识 无 compInfoA7 String 营销信息 无 compInfoA8 String 二维码信息 无 coupon String 支付宝/微信优惠金额 无 field55 String IC卡交易的TAG信息 无 insCode String 受理方标识码 无 localTransDate String 受卡方所在地日期 无 localTransTime String 受卡方所在地时间 无 merCode String 受卡方标识码（商户号） 无 merDiscount String 商家优惠金额 无 originTraceNum String 原交易凭证号 无 outOrderNum String 外部订单号 无 posInputStyle String 服务点输入方式码 无 processflag String 扫码支付09状态的交易是否成功 附件表1 refNum String 检索参考号 无 respCode String 应答码 \"00\"表示成功 revAuthCode String 授权标识应答码 无 revInsCode String 附加响应数据 无 revOrderNum String 自定义域，用于扫码支付业务。 无 scanCodeId String 扫码号 无 termCode String 终端号 无 traceNum String 受卡方系统跟踪号 合作方交易流水 transAmt String 交易金额 无 transCode String 交易类型码 无 transCurr String 交易货币代码 无 transDate String 原交易日期 无 transDatetime String 受卡方所在地日期＋受卡方所在地时 无 transRate String 持卡人扣帐汇率 无","text_tokens":["(","位置","原扣币","调用","revokeconsume"," ","必须","且","日期","transrate","结果","中","settracenum","做","订单","开启","setcoordinates","应答","消费类","usd","respcode","length","时","给","31.180606","合作","getcardexpirationdate","方法","含义","class","unknow","包含","gcj02","需","大概","setlatitude","取值","void","e","方式","的","referencenumber","读取","到","如","msc","银员","short","compinfoa4","＋","所有","自","代码","revokepreauthcomplete","种类","还","进行","返回","了","都","settransrate","setamount","*","merdiscount","号文","tag","null","setbatchnum","送","setcardnumb","收银员","清算","便","坐标","支持","cardno","只","卡人","setrevauthcode","revauthcode","逻辑","请求","里面","一般","/","提供","使用",".","点","cardbrand","支付","无需","原预","biilingamt","termcode","域","单","consume","持卡","\"","cardnum","getamount","备注","setbillingcurr","cashiernum","基础","这个","具备","oncreate","protected","微信","cardinfo","aftertranscode","returnconsume","compinfoa8","isopendcc","控制","field55","onresult","8","setfield55","processflag","other","发起","2","是否","系统","demo","commoncardhandleractivity","页面","4","下单","该","datetime","终端","复杂","说明","wgs84","sdk","setpinemv","scancode","则","有","getpinbins","腾讯","gettracenum","讯联","汇率","compinfoa1","为","检索","revokepreauth","能","1","序列","定位","能力","业务","。","撤销","磁道","new","签购","tradedate","常用","onerror","标识","|","卡预","缓冲","85","maketext","注意","银行卡","basecardactivity","ic卡","batchnum","卡","...","用于","接口","setcardsequencenumber","附件","参考","获取","parcelable","initcardevent","type","transdate","有效期","根据","显示","经度","所在","流水号","效期","bin","商家","compinfoa7","二维","cardtype","boolean","金额","getbillingcurr","这里","transcode","override","服务","扣","5","国际","getfield55","cashiername","例如","从","）","公司","第三方","getrevauthcode","55","批次","银行","callback","preauthcomplete","智能","余额","localtransdate","由于","里","当","外","=","checkbalance","转","才","必选","银联","mercode","origintracenum","ic","一个","setreferencenumber","，","消费","读卡","waitloadingshow","getsequenceserialnum","即可","选择","setorderid","revordernum","只有","有效","gps","流水","coupon","发送","字母","show","规定","商户","billingcurrnum","settransdatetime","additionalresdata","compinfoa3","6","revinscode","clearingdate","p","所在地","!","setbillingamt","public","版本","详细","getbatchnum","setlongitude","定义","有点","响应","相关","sdk2.4","cilrequest","tracenum","收银","新增","compinfoa2","00","dcctoedc","getcardnumber","段","gettrack2","if","及","支付宝","单行","inscode","具体","数据","凭证","标识码","需要","compinfoa6","transcurr","amount","transdatetime","@","3","单号","成功","第三","上","失败","setlocation","原","：","外部","return","此","以下","交易类型","单收","下面","授权","request","nfc","posinputstyle","settranscurr","需上","跟踪","extends","将","<","受理","定义域","扣账","高德","类中取","getbillingamt","借贷","true","二维码","查询","issuccess","edc","markup","这","退货","除","合作方","int","类型","字","查看","false",">","符号","rateinfo","数字","和","无","setsecondtrack","transaction","内部","个","在","location","卡号","信息","流程","扣款","见","后","三位","方","originaltradedate","外卡","exception","如果","币种","各","类","以上","信用","billingamt","货币","localtranstime","取消","getapplicationcontext","组织","bd09","输入","（","cardreaderhandler","一些","toast","}","国内","表","刷卡","传入","string","纬度","以及","a","cardhandlererror","均","附加","号","transamt","你","可","状态","7","billingcurr","可以","信用卡","订单号","受卡方","选","cilsdk","super","填入",",","关于","否则","orderid","处理","9","表示","waitloadingdismiss","outordernum","二","持卡人","参数","setcardnum","{",":","优惠","扫码","交易","-","百度","设置","setcardexpirationdate","卡片","时间","码","预","gettransrate","坐标系","authcode",")","继承","接入","营销","三方","preauth","121.600228","param","cilresponse","savedinstancestate","文档","序列号","getrefnum","记","帐","09","scancodeid","dcc","bundle","完成",";","_","refnum","、"],"title":"Card","title_tokens":["card"]},{"location":"documentation/intergration/","text":"为了方便快速接入，提供了demo供接入参考 demo下载 本 SDK 已使用 jcenter 托管，配置如下 gradle: implementation 'com.cardinfolink.smart.pos:PosSDK:2.5.2' or maven: <dependency> <groupId>com.cardinfolink.smart.pos</groupId> <artifactId>PosSDK</artifactId> <version>2.5.2</version> <type>pom</type> </dependency> 如果想使用讯联集成的结算UI和逻辑，请配置 gradle: implementation 'com.cardinfolink.smart.pos:SDK-ZaiHui:1.1.1' or maven: <dependency> <groupId>com.cardinfolink.smart.pos</groupId> <artifactId>SDK-ZaiHui</artifactId> <version>1.1.1</version> <type>pom</type> </dependency>","text_tokens":["了","ui","本",">","'","com","or","如果"," ","smart","pom","讯联","<","接入","2","1.1","，","2.5","的","配置","dependency","demo","和","参考","type","1","zaihui","如下","jcenter","供","gradle","cardinfolink","逻辑","groupid","maven","结算","请","/","提供","使用","集成","为了",".","已","possdk","托管","快速","sdk",":","方便","version","-","artifactid","下载","想","pos","implementation"],"title":"Intergration","title_tokens":["intergration"]},{"location":"documentation/otherSetting/","text":"其他设置 考虑到使用 SDK 的时候可能还会有其他需求,比如 获取 POS 机的 SN 号 、 设置密钥索引 等,在这里,我们也提供了一部分接口。 获取 SDK 版本 //版本名 String versionName = CILSDK.VERSION_NAME; //版本号 int versionCode = CILSDK.VERSION_CODE; 获取 SN 号 //SN号 String snCode = CILSDK.getDeviceSN(); 设置流水号 //serialNum范围：1~999999 boolean isSuccess = CILSDK.setSerialNum(int serialNum); 获取流水号 //序列号 int serialNum = CILSDK.getSerialNum(); 设置批次号 //batchNum范围：1~999999 boolean isSuccess = CILSDK.setBatchNum(int batchNum); 获取批次号 //批次号 int batchNum = CILSDK.getBatchNum(); 设置联迪密钥区 //1-15的设值范围 CILSDK.setTingA8KeyIndex(2); 设置密钥索引 //分别对应MAIN MAC PIN MES //1-255的设值范围 //可以使用下方提供数值,也可以根据自身程序设值 CILSDK.setTingKeyIndex(4,101,10,150); 以上两个方法请在连接刷卡器(CILSDK.connect)之前使用 工具类 CILPayUtil /** * 将respCode翻译成对应中文解释 */ CILPayUtil.translate(context, respCode)); /** * 将Trans类中的transCode翻译成打印所需的对象 */ CILPayUtil.getFormatTransCode(transCode); /** * 根据billingCurr判断交易是否为外卡类的DCC交易 */ CILPayUtil.isDCCPay(billingCurr); /** * 判断交易是否成功 */ CILPayUtil.isTransSuccess(trans); /** * 根据Trans类中的transCode判断交易是否属于扫码类交易 */ CILPayUtil.isQrPay(transCode); ReceiptFormatUtils /** * 根据Trans类中的TransCode翻译成对应的中文解释 */ ReceiptFormatUtils.getTransType(transCode); /** * 将明文的卡号修改为\"前六后四中间为四个*\"的样式 */ ReceiptFormatUtils.handleCardNum(cardNum); 许可证 Copyright (c) 2016 cardinfolink.com JAVADOC java document 详情见 javadoc","text_tokens":["(","sn"," ","属于","一部","我们","code","2","详情","是否","中间","255","serialnum","打印","java","4","可能","流水","下方","在","respcode","卡号","部分","见","sdk","setserialnum","方法","10","中文","version","有","密钥","翻译成","versionname","分别","两个","对象","main","需","外卡","解释","handlecardnum","等","许可","getformattranscode","考虑","以上","类","c","也","999999","的","为","isdccpay","四","connect","到","mac","前六后","1","序列","许可证","gettranstype","翻译","版本","cardinfolink","请","。","getbatchnum","时候","区","设值","刷卡","样式","程序","string","工具","名","settinga8keyindex","trans","pos","javadoc","版本号","了","settingkeyindex","*","号","com","判断","batchnum","pin","可以","billingcurr","其他","15","cilsdk","setbatchnum","接口",",","获取","translate","versioncode","修改","需求","101","连接","译成","刷卡器","根据","四个","成功","document","/","使用","提供","对应",".","流水号","2016","：","扫码","交易","-","150","boolean","设置","联迪","这里","之前","transcode","范围","所","机","sncode","getdevicesn",")","将","\"","cardnum","类中","name","getserialnum","receiptformatutils","~","mes","cilpayutil","一部分","序列号","批次","还会","比如","issuccess","dcc","istranssuccess","copyright","=","int","索引","数值","context",";","_","isqrpay","自身","、","明文"],"title":"otherSetting","title_tokens":["othersetting"]},{"location":"documentation/print/","text":"打印 本模块可用于根据交易信息打印所需的消费票据。接口不仅提供了一套固定格式的小票样式，而且还可以根据需要自定义打印样式。 主要功能包括小票打印、二维码打印、条形码打印以及图片打印。 特别注意: 中国人民银行和中国银联为了规范市场上的POS机终端，要求终端打印的签购单必须合乎规范，规范内容包括必须打印的字段与正确的字段内容。 签购单规范详情见 签购单规范 打印银行卡类交易、扫码类交易小票 /** trans 交易信息,Trans类型 * lineBreak 小票结尾需要走纸换行的行数，int类型 * formatTransCode @FormatTransCode String类型，小票的交易类型 * kind @ReceiptSubtitle int类型，小票的子标题，判断是商户联或者是客户联 * isForeignTrans 是否是外卡类交易 * bitmap logo图标，没有直接传null */ CILSDK.printKindsReceipts(trans,lineBreak,formatTransCode, kind, isForeignTrans, bitmap, new Callback<PrinterResult>(){ @Override public void onResult(PrinterResult response) { if (null ！= printerResult && !\"打印成功\".equals(printerResult.toString())) { //打印成功 } } @Override public void onError(Parcelable cilRequest, Exception e) { //打印失败 } }); 打印结算小票 /** * 打印结算小票 * * transSettles 结算信息List * transDatetime 结算时间 * lineBreak 打印结尾换行数 * formatTransCode 结算类型；TransConstants.TRANS_SETTLE_DETAILS：结算详情小票；TransConstants.TRANS_SETTLE_TOTAL：结算统计小票 * callback 回调 */ CILSDK.printSettleReceipts(transSettles, transDatetime,batchNum, lineBreak, formatTransCode, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 自定义打印 注意：使用自定义打印方法时，若打印内容超过2000个字符，请使用分段打印方式，否则可能出现DeviceRTException /** * 根据二进制数据打印(根据打印规范用户自定义打印小票样式) * * buffer 打印内容 * lineBreak 换行数 * callback 回调 */ CILSDK.printBufferReceipt(buffer, lineBreak,new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印二维码 /** * 打印二维码 * * qrCode 二维码内容 * position 打印位置 0:左对齐；1居中；2：右对齐 * width 二维码宽度 * callback 回调 * */ CILSDK.printQRCode(qrCode,position,width,lineBreak,new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印条形码 /** * 打印条形码 * * barCode 条形码数字 * position 条形码位置 0:左对齐；1居中；2：右对齐 * lineBreak 换行数 * callback 回调 */ CILSDK.printBarCode(String barCode, int position, int lineBreak, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印图片 /** * 打印图片 * * bitmap 图片Bitmap * lineBreak 换行数 * offset 偏移量 * callback 回调 * */ CILSDK.printImage(bitmap, lineBreak, offset, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } });","text_tokens":["字","(","位置","onresult","银联","equals",">","中国人民银行"," ","必须","是否是","合乎","2","详情","是否","，","与","total","数字","消费","和","打印","details","printimage","kind","可能","规范市场","终端","width","时","信息","见","0","方法","联","printqrcode","没有","而且","商户","transsettles","需","若","外卡","一套","；","对齐","exception","position","logo","void","行数","自定","个字符","主要","规范","bitmap","response","类","e","方式","printbufferreceipt","左","的","条形码","printerresult","特别","格式","!","偏移量","settle","1","回调","public","请","结算","。","进制","自定义","定义","}","transconstants","result","new","签购","样式","qrcode","string","onerror","formattranscode","结尾","cilrequest","trans","还","pos","以及","或者","了","本","*","注意","银行卡","图标","判断","票据","传","2000","可","子标题","null","batchnum","可以","段","用于","if","用户","图片","偏移","二进制","cilsdk","直接","！","市场","形码","接口","printkindsreceipts",",","数据","固定","parcelable","否则","人民","需要","transdatetime","printsettlereceipts","@","要求","根据",";","成功","数","/","提供","使用","宽度","上",".","走纸","tostring","失败","{","：",":","扫码","二维","交易","交易类型","出现","linebreak","override","模块","是","时间","内容","list","所","机","超过","单","&&","offset",")","barcode","\"","条形","<","统计","标题","中国银联","receiptsubtitle","buffer","devicertexception","国人","二维码","客户","银行","小票","中国","callback","不仅","居中","右","换行","为了","isforeigntrans","=","int","分段","printbarcode","包括","功能","_","字符","类型","、","正确"],"title":"Print","title_tokens":["print"]},{"location":"documentation/quik/","text":"快速接入 为了方便快速接入，提供了demo供接入参考 demo下载 本 SDK 已使用 jcenter 托管，配置如下 gradle: implementation 'com.cardinfolink.smart.pos:PosSDK:2.5.2' 如果想使用讯联集成的结算UI和逻辑，请配置 gradle: implementation 'com.cardinfolink.smart.pos:SDK-ZaiHui:1.1.1' 初始化（连接POS机硬件） 使用 N900 智能 POS 机器, 首先需要连接 POS 机硬件, 使用 SDK 提供的 connect 方法连接。 建议在 Application 的 onCreate 方法中进行连接。 @Override public void onCreate() { super.onCreate(); ... CILSDK.setDebug(true);//调试阶段使用测试环境，发版时请改为 false CILSDK.connect(this); ... } 使用联迪A8设备的，联迪设备连接需要传入activity的context, 除了在 Application 的 onCreate 方法中进行连接，建议在每个可能调用设备刷卡、加密、打印的activity onCreat方法中再调用 CILSDK.connect(this)进行连接， 保证使用过程中设备连接不断开；另外推荐在ActivityLifecycleCallbacks中处理设备连接。 激活POS机 完整的激活环节分为三步，分别是：激活，终端参数下载，终端密钥下载，三步都成功，表示激活成功，激活成功之后才能正常使用后面的交易流程。 1、激活 * a、新激活流程（推荐） 根据用户反馈，为了简化激活流程，我们新增了激活码的方式激活，当你拿到 POS 机器之后，我们会为这个商户发放激活码，一个激活码只可以激活一台 POS 机。 建议先调用 根据激活码获取商户信息接口: （返回商户名商户号终端号等信息），确认信息无误后，在调用激活码激活接口激活。 注意:一台终端能且仅能成功激活一次,无法重复进行激活操作。若有多次激活的需求(如debug阶段),请联系讯联客服。 //authCode 激活码（建议用扫码的方式得到激活码，避免让用户手输） CILSDK.activeWithCode(authCode, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { if (cilResponse.getStatus() == 0) { //激活成功 } else { //激活失败，失败原因见 cilResponse.getMessage() } } @Override public void onError(Parcelable cilRequest, Exception e) { //激活出错 } }); b、旧激活流程 第一次使用智能 POS 终端的时候,需要使用讯联下发的商户号（merCode） 和终端号（termCode）激活 注意:一台终端能且仅能成功激活一次,无法重复进行激活操作。若有多次激活的需求(如debug阶段),请联系讯联客服。推荐APP本身能够保持设备是否已经激活标志 //merCode 讯联下发的商户号 //termCode 讯联下发的终端号 CILSDK.active(merCode, termCode, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { if (cilResponse.getStatus() == 0) { //激活成功 } else { //激活失败 } } @Override public void onError(Parcelable p, Exception e) { //激活出错 } }); 注意: 根据激活码获取商户详情接口： CILSDK.getMerchantInfo(HashUtils.encryptActiveCode(authCode), true, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { //success //you will get merName,merCode,termCode } @Override public void onError(Parcelable cilRequest, Exception e) { //failed } }); 2、终端参数下载 激活成功之后,你的应用还需要下载一些交易时使用的参数,比如 交易地址和端口 、 交易超时时间 、 终端支持的功能 、 TPDU 等, 在你拿到 POS 终端之前,这些参数都会在讯联后台已经配置好,全部参数见 CILResponse.Info 返回值。下载成功之后 SKD 会 以json字符串的形式保存这些参数到 SharedPreference (请不要擅自改动这些参数值,以免导致交易失败) 。当然,在 onResult 中也会返回,你也可以自己选择性保存一些参数。另外, SDK 保存在 SharedPreference 里的值会提供接口 CILSDK.getSystemParams() 获取。 注意：正常情况下，此方法只需执行成功一次，但是后台参数配置可能会有改动，APP本身需要调用预留功能调用此方法 //merCode 讯联下发的商户号 激活成功之后可以确定商户号 //termCode 讯联下发的终端号 激活成功之后可以确定终端号 CILSDK.downloadParams(merCode, termCode, new com.cardinfolink.pos.listener.Callback<CILResponse>() { @Override public void onResult(CILResponse response) { if (0 == response.getStatus()) { //参数下载成功,具体返回的参数见 response.Info } else { //参数下载错误 } } @Override public void onError(Parcelable p, Exception e) { //下载出错 } }); 3、终端密钥下载 终端密钥下载只需要成功执行一次就可以,成功下载的密钥会被转载到POS硬件模块里面,后面就不需要再次调用了,建议你的应用可以在成功下载密钥之后持久化一个标志位, 下次进入应用就不再去下载密钥了。整个过程可能会需要1~2分钟左右(依赖当前的网络状况),会经历以下步骤: 请求讯联网关 RSA -> 装载 RSA -> 请求主密钥 -> 装载主密钥 -> 启用主密钥 -> 请求工作密钥(签到) -> 装载工作密钥 -> 下载 AID -> 装载 AID -> 下载 IC 公钥 -> 装载 IC 公钥。 建议APP本身存储设备是否已经初始化方法标志。 注意：此方法一般只需要安装后成功调用一次即可。但银行交互密钥有可能会更新，APP本身需要调用预留功能调用此方法 CILSDK.downloadParamsWithProgress(new ProgressCallback<CILResponse>() { @Override public void onProgressUpdate(int progress) { //progress下载密钥的进度 } @Override public void onResult(CILResponse response) { if (0 == response.getStatus()) //密钥下载成功。在这里可以持久化一个标志位 } @Override public void onError(Parcelable p, Exception e) { //下载密钥出错 } }); 签到 签到其实也就是更新工作密钥的一个过程 ( 下载工作密钥+装载工作密钥 ),讯联网关平台要求应用需要每天签到一次。 CILSDK.signIn(new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { //签到成功 } @Override public void onError(Parcelable cilRequest, Exception e) { //签到出错 } }); 银行卡交易 由于银行卡交易逻辑有点复杂,讯联提供了一个 BaseCardActivity 基础类,你只需要继承这个类便可以做银行卡类的交易了。具体使用方法可以见 demo 里的 CommonCardHandlerActivity 类。下面给个大概说明: public class CommonCardHandlerActivity extends BaseCardActivity { @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); //... } /** * 必须传入金额 * * @return */ public String getAmount() { //在这里传入金额 } /** * 此方法为控制sdk内部是否开启DCC交易逻辑（sdk2.4.1版本及以上支持该方法） * *@return 需要进行DCC交易时，返回true，否则返回false */ public boolean isOpenDcc() { //如有DCC需求，因只有刷卡消费和刷卡预授权才支持DCC交易，此方法只需要在这两种交易类型返回true //如果接入方无需支持DCC，则此方法返回false即可 return false; } /** * 读卡的结果（sdk2.4.1版本及以上新增RateInfo参数，返回DCC读卡流程中进行汇率查询的结果） * * @param isSuccess 是否成功 * @param cardType 卡片种类(-1(unknow) 1(msc) 2(ic) 3(nfc) 4(scancode) 5(other)) * @param cardInfo 读取卡片信息 * @param rateInfo 汇率信息 */ public void cardReaderHandler(boolean isSuccess, @CardType.Type int cardType, CardInfo cardInfo, RateInfo rateInfo){ //读卡成功后才发起交易 if (!isSuccess || cardInfo == null) { Toast.makeText(getApplicationContext(), \"读卡失败\", Toast.LENGTH_SHORT).show(); initCardEvent(); return; } //1. 根据银联85号文规定，智能终端在消费和预授权完成交易需上送经度，纬度，坐标系信息到卡组织 CILRequest request = new CILRequest(); request.setLongitude(121.600228);//设置经度 request.setLatitude(31.180606);//设置纬度 request.setCoordinates(\"GCJ02\");//设置坐标系 //关于坐标系，国内一些常用第三方取值：百度（BD09），高德、腾讯（GCJ02），GPS（WGS84）。 //一般第三方定位SDK都能从定位后返回的位置信息类中取到，详细可查看各第三方接入文档。 //2.如果接入方需要进行DCC交易，在消费和预授权完成交易中需将汇率信息填入request中，否则无需处理 CILRequest request = new CILRequest(); ... if (rateInfo != null) { request.setBillingAmt(rateInfo.getBillingAmt());//设置扣账金额 request.setBillingCurr(rateInfo.getBillingCurr());//设置扣账币种 request.setTransRate(rateInfo.getTransRate());//设置交易汇率 request.setBatchNum(rateInfo.getBatchNum());//设置汇率请求批次号 request.setTraceNum(rateInfo.getTraceNum());//设置汇率请求流水号 } //3. 在这里面发送银行卡相关的交易(如消费、消费撤销、退货、预授权、预授权撤销、预授权完成、预授权完成撤销、余额查询) //CILSDK.consume(request, cardType, new Callback<CILResponse>() //消费 } /** * 自定义读卡时的缓冲页面 */ public void waitLoadingShow(){ } /** * 取消读卡时的缓冲页面 */ public void waitLoadingDismiss(){ } /** * 读卡失败 */ public void cardHandlerError(Exception e){ } } 注意: 调用银行卡类交易接口时，需要传入CILRequest以及CardType，且所有接口中CILRequest均需要传入以下信息： CILRequest request = new CILRequest(); request.setAmount(amount);//消费金额 /** * 复写的刷卡回调方法中获取到的cardInfo信息 */ request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPinEmv(cardInfo.getPinBins());//卡bin request.setCardSequenceNumber(cardInfo.getSequenceSerialNum());//卡片序列号 request.setField55(cardInfo.getField55());//55域信息 request.setSecondTrack(cardInfo.getTrack2());//二磁道信息 request.setOrderId(orderId);//可选参数。（消费、退货、预授权、预授权完成、扫码下单、扫码退货） request.setLocation(location)//有终端具备获取位置信息能力时必选上送（ 用于消费 预授权完成） 1、消费 消费接口 request必须包含参数: //除了request必须包含的参数外，还需要以下参数 //复写的刷卡回调的方法中会返回汇率信息 if (rateInfo != null) { request.setBillingAmt(rateInfo.getBillingAmt());//持卡人扣账金额 request.setBillingCurr(rateInfo.getBillingCurr());//持卡人扣账货币代码 request.setTransRate(rateInfo.getTransRate());//交易汇率 request.setBatchNum(rateInfo.getBatchNum());//汇率查询批次号 request.setTraceNum(rateInfo.getTraceNum());//汇率查询流水号 } //地理位置信息，需要调用方自行获取传入sdk request.setLongitude(location.getLongitude());//经度 request.setLatitude(location.getLatitude());//纬度 request.setCoordinates(location.getCoordinates());//坐标系 /** * 刷卡消费 * * @param request 请求参数 * @param cardType 卡片类型 CardType.MSC_CARD, CardType.IC_CARD, CardType.NFC_CARD... */ CILSDK.consume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 2、撤销 撤销接口 request必须包含参数: /** * 撤销接口除基础信息外， * 还需要原交易信息 */ request.setReferenceNumber(transaction.getRefNum());//原交易参考号 request.setRevAuthCode(transaction.getRevAuthCode());//原交易授权码 request.setBatchNum(transaction.getBatchNum());//原交易批次号 request.setTraceNum(transaction.getTraceNum());//原交易凭证号 CILSDK.revokeConsume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 3、退货 退货接口 request必须包含参数: /** * 退货接口除基础信息外 * 还需要原交易信息 */ request.setReferenceNumber(referenceNumber); request.setTransDatetime(tradeDate); CILSDK.returnConsume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 4、余额查询 余额查询接口 request必须包含参数: CILSDK.checkBalance(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 5、卡预授权 预授权接口 request必须包含参数: /** * 刷卡预授权 * * @param request 请求参数 * @param cardType 卡片类型 CardType.MSC_CARD, CardType.IC_CARD, CardType.NFC_CARD... */ CILSDK.preAuth(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 6、卡预授权撤销 预授权撤销接口 request必须包含参数: /** * 预授权撤销接口除基础信息外 * 还需要原预授权交易信息（需要输入的信息） */ request.setAmount(amount);//交易金额 request.setRevAuthCode(authCode);//原预授权交易授权码/参考号 request.setTransDatetime(originalTradeDate);//原预授权交易日期 CILSDK.revokePreAuth(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 7、卡预授权完成 预授权完成接口 request必须包含参数: 注意：预授权完成属于消费类型的交易，默认是做DCC的，在调用接口之前一定要将刷卡回调中的汇率信息设置给request，确保预授权完成的DCC交易能够顺利进行。 //除了request必须包含的参数外，还需要以下参数 //复写的刷卡回调的方法中会返回汇率信息 if (rateInfo != null) { request.setBillingAmt(rateInfo.getBillingAmt());//持卡人扣账金额 request.setBillingCurr(rateInfo.getBillingCurr());//持卡人扣账货币代码 request.setTransRate(rateInfo.getTransRate());//交易汇率 request.setBatchNum(rateInfo.getBatchNum());//汇率查询批次号 request.setTraceNum(rateInfo.getTraceNum());//汇率查询流水号 } //地理位置信息，需要调用方自行获取传入sdk request.setLongitude(location.getLongitude());//经度 request.setLatitude(location.getLatitude());//纬度 request.setCoordinates(location.getCoordinates());//坐标系 request.setAmount(amount);//交易金额 request.setRevAuthCode(authCode);//原预授权交易授权码 request.setTransDatetime(originalTradeDate);//原预授权交易日期 CILSDK.preAuthComplete(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 8、卡预授权完成撤销 预授权完成撤销接口 request必须包含参数: /** * 预授权完成撤销接口除基础信息外 * 还需要原预授权完成交易信息 */ request.setReferenceNumber(refNum);//原预授权完成交易参考号 request.setRevAuthCode(authCode);//原预授权完成交易授权码 request.setTraceNum(traceNum);//原预授权完成交易凭证号 request.setBatchNum(batchNum);//原预授权完成交易批次号 request.setTransDatetime(originalTradeDate);//原预授权完成交易日期 CILSDK.revokePreAuthComplete(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 9、DCC转EDC 当交易卡片为外卡时，消费类（消费、预授权完成）交易可选择进行DCC转EDC。 注意1：只有做了DCC的交易后才可能DCC转EDC成功，调用消费接口时如果持卡人的卡支持DCC，并且在刷卡页面复写的isOpenDcc方法中也返回true，sdk会优先执行DCC的逻辑，就是默认会走DCC的逻辑。 注意2：DCC转EDC无需刷卡，只需要使用消费成功的返回信息就可发起。 注意3：DCC转EDC成功后打印时，入参formatTransCode传PER,isForeignTrans传false CILRequest request = new CILRequest(); //以下参数取自原交易 request.setCardNum(cardNum);//卡号 request.setTransDatetime(datetime);//原交易时间 request.setAmount(amount);//原交易金额 request.setBillingAmt(biilingAmt);//原扣币金额 request.setReferenceNumber(refNum);//原交易参考号 request.setRevAuthCode(revAuthCode);//原交易授权码 request.setBatchNum(batchNum);//原交易批次号 request.setTraceNum(traceNum);//原交易凭证号 request.setTransCurr(transCurr);//原交易币种 request.setBillingCurr(billingCurr);//原交易扣款币种 CILSDK.dccToEdc(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable p, Exception e) { ... } }); 10、预授权手输卡号 ``` //需要手输的卡信息有卡号和卡有效期两个字段 CILRequest request = new CILRequest(); request.setAmount(amount); request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPosInputStyle(\"012\"); CILSDK.preAuth(request, CardType.MSC_CARD, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); ``` 11、预授权撤销手输卡号 CILRequest request = new CILRequest(); //卡信息两个字段通过手输代替刷卡 request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPosInputStyle(\"012\"); //下面三个字段可通过外界手输录入 request.setAmount(amount); request.setTransDatetime(originalTradeDate);//原始交易日期 request.setRevAuthCode(authCode);//授权码 CILSDK.revokePreAuth(request, CardType.MSC_CARD, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 12、预授权完成手输卡号 注意1：这个地方一定要进行DCC汇率查询，预授权完成属于消费类接口，默认是做Dcc的，同样如果需要做DCC转EDC,在预授权交易成功页面调用Dcc转EDC接口即可。 注意2：汇率查询一般sdk在刷卡的流程中自动完成，但是手输类的交易不走sdk的刷卡流程，需要调用方自行调用汇率查询api进行汇率查询，流程如下： graph LR 输入金额/原交易日期/授权码-->手输卡号和卡有效期 手输卡号和卡有效期--success-->DCC汇率查询 DCC汇率查询--succ or fail-->预授权完成 //1.进行DCC汇率查询 RateQueryListener listener = new RateQueryListener() { @Override public void onResult(boolean isSupport, RateInfo rateInfo) { //发预授权完成交易 } }; sendQueryRate(cardInfo.getCardNumber(), listener);//调用父类BaseCardActivity //2.发预授权交易 CILRequest request = new CILRequest(); request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPosInputStyle(\"012\"); //2.1 汇率 if (rateInfo != null) { request.setBillingAmt(rateInfo.getBillingAmt()); request.setBillingCurr(rateInfo.getBillingCurr()); request.setTransRate(rateInfo.getTransRate()); request.setBatchNum(rateInfo.getBatchNum()); request.setTraceNum(rateInfo.getTraceNum()); } //2.2地理位置信息，需要调用者自己获取传入 if (mLocationManager != null) { request.setLongitude(location.getLongitude()); request.setLatitude(location.getLatitude()); request.setCoordinates(location.getCoordinates()); } //以下信息可通过外界输入 request.setAmount(amount); request.setTransDatetime(originalTradeDate);//原始交易日期 request.setRevAuthCode(authCode);//授权码 CILSDK.preAuthComplete(request, CardType.MSC_CARD, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 13、预授权完成撤销手输卡号 CILRequest request = new CILRequest(); //卡信息两个字段通过手输代替刷卡 request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPosInputStyle(\"012\"); //下面三个字段可通过外界手输录入,也可通过本地数据库保存的交易信息查找 request.setAmount(amount); request.setReferenceNumber(refnum); request.setRevAuthCode(authcode;//授权码 request.setTraceNum(tracenum); request.setBatchNum(batchnum); request.setTransDatetime(originalTradeDate);//原始交易日期 CILSDK.revokePreAuthComplete(request, CardType.MSC_CARD, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 14、交易结果字段说明 字段 类型 含义 备注 备注 additionalResData String 受理方标识码 无 afterTransCode String 原交易类型 无 batchNum String 批次号 无 billingAmt String 持卡人扣帐金额 无 billingCurr String 持卡人扣帐货币代码符号，三位字母 例如USD billingCurrNum String 持卡人扣帐货币代码,三位数字 无 cardBrand String 国际信用卡公司代码 无 cardNo String 银行卡号 无 cardType String 刷卡方式 无 cashierName String 收银员 无 cashierNum String 收银员号 无 clearingDate String 清算日期 无 compInfoA1 String 签购单收单行 无 compInfoA2 String 签购单商户号 无 compInfoA3 String 签购单终端号 无 compInfoA4 String markup 无 compInfoA6 String 借贷记标识 无 compInfoA7 String 营销信息 无 compInfoA8 String 二维码信息 无 coupon String 支付宝/微信优惠金额 无 field55 String IC卡交易的TAG信息 无 insCode String 受理方标识码 无 localTransDate String 受卡方所在地日期 无 localTransTime String 受卡方所在地时间 无 merCode String 受卡方标识码（商户号） 无 merDiscount String 商家优惠金额 无 originTraceNum String 原交易凭证号 无 outOrderNum String 外部订单号 无 posInputStyle String 服务点输入方式码 无 processflag String 扫码支付09状态的交易是否成功 附件表1 refNum String 检索参考号 无 respCode String 应答码 \"00\"表示成功 revAuthCode String 授权标识应答码 无 revInsCode String 附加响应数据 无 revOrderNum String 自定义域，用于扫码支付业务。 无 scanCodeId String 扫码号 无 termCode String 终端号 无 traceNum String 受卡方系统跟踪号 合作方交易流水 transAmt String 交易金额 无 transCode String 交易类型码 无 transCurr String 交易货币代码 无 transDate String 原交易日期 无 transDatetime String 受卡方所在地日期＋受卡方所在地时 无 transRate String 持卡人扣帐汇率 无 扫码交易 扫码相关的交易则是不依赖 POS 机器的读卡模块的,但是你需要将 微信 或者 支付宝 的二维码读出来传给扫码消费接口,扫码可以使用第三方库,如 zxing 。 1、扫码消费 CILRequest request = new CILRequest(); request.setAmount(amount);//交易金额 request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） CILSDK.consumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { // 处理扫码消费结果，字段说明见底部 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： // resultCode = response.getTrans().getRespCode(); // if (\"09\".equals(resultCode)) { // CILSDK.queryQr(); // `queryQr` 方法见下文 // } } @Override public void onError(Parcelable cilRequest, Exception e) { // 扫码消费出错 } }); 注意,如果应答码返回09或98，需要调用讯联扫码查询接口，查询该笔订单的实际状态。 2、扫码撤销 CILRequest request = new CILRequest(); request.setAmount(amount);//原交易金额 request.setBatchNum(batchNum);//原交易批次号 request.setTraceNum(traceNum);//原交易凭证(流水)号 request.setReferenceNumber(refNum); //原交易参考号 CILSDK.revokeConsumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 3、扫码退货 CILRequest request = new CILRequest(); request.setAmount(amount);//退款金额 request.setReferenceNumber(serialNum);//原交易参考号 request.setTransDatetime(tradeDate);//原交易时间 CILSDK.returnConsumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 4、扫码查询 CILRequest request = new CILRequest(); request.setBatchNum(response.getTrans().getBatchNum());//批次号 request.setTraceNum(response.getTrans().getTraceNum());//凭证号 request.setPeriod(10000L);//10s request.setLimitTime(6);//6 次 request.setReferenceNumber(response.getTrans().getRefNum());//参考号 request.setPosInputStyle(response.getTrans().getPosInputStyle());//pos输入服务方式码 request.setScanCodeId(response.getTrans().getScanCodeId());//扫码号 request.setAmount(response.getTrans().getTransAmt());//交易金额 CILSDK.queryQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 5、扫码消费查询,只查询一次，不含取消接口 CILRequest request = new CILRequest(); request.setBatchNum(response.getTrans().getBatchNum());//批次号 request.setTraceNum(response.getTrans().getTraceNum());//凭证号 request.setReferenceNumber(response.getTrans().getRefNum());//参考号 request.setPosInputStyle(response.getTrans().getPosInputStyle());//pos输入服务方式码 request.setScanCodeId(response.getTrans().getScanCodeId());//扫码号 CILSDK.queryQrJustOnce(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 6、扫码取消 /** * 扫码取消 * 对于09状态的消费订单，最终需要取消、关单 * @param request * @param listener */ CILRequest cilRequest = new CILRequest(); cilRequest.setOriginalTradeDate(response.getTrans().getTransDate());//原交易日期 cilRequest.setAmount(response.getTrans().getTransAmt());//交易金额 cilRequest.setBatchNum(response.getTrans().getBatchNum());//批次号 cilRequest.setTraceNum(response.getTrans().getTraceNum());//凭证号 cilRequest.setPosInputStyle(response.getTrans().getPosInputStyle());//pos输入服务方式码 cilRequest.setReferenceNumber(response.getTrans().getRefNum());//参考号 CILSDK.voidQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 7、扫码预授权 CILRequest request = new CILRequest(); request.setAmount(amount); request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） CILSDK.preAuthQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { // 处理扫码预授权结果 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： /** * resultCode = response.getTrans().getRespCode(); * if (\"09\".equals(resultCode) ) { * CILSDK.queryQr(); // `queryQr` 方法见下文 * } */ } @Override public void onError(Parcelable cilRequest, Exception e) { //扫码预授权出错 } }); 8、扫码预授权撤销 CILRequest request = new CILRequest(); request.setAmount(transAmt);//原预授权交易金额 request.setReferenceNumber(revAuthCode);//原预授权交易参考号 request.setTransDatetime(transDate);//原预授权交易时间 request.setBatchNum(curTrans.getBatchNum());//原预授权交易批次号 request.setTraceNum(curTrans.getTraceNum());//原预授权交易凭证（流水）号 CILSDK.revokePreAuthQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 9、扫码预授权完成 CILRequest request = new CILRequest(); request.setAmount(transAmt);//原预授权交易金额 request.setReferenceNumber(revAuthCode);//原预授权交易参考号 request.setTransDatetime(transDate);//原预授权交易时间 CILSDK.preAuthCompleteQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 10、扫码预授权完成撤销 CILRequest request = new CILRequest(); request.setAmount(transaction.getTransAmt());//原预授权完成交易金额 request.setBatchNum(transaction.getBatchNum());//原预授权完成交易批次号 request.setTraceNum(transaction.getTraceNum());//原预授权完成交易凭证（流水）号 request.setReferenceNumber(transaction.getRefNum());//原预授权完成交易参考号 CILSDK.revokePreAuthCompleteQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 11、单品券功能接入指引 注意：sdk v2.5.3及之后版本支持该功能 1. 扫码消费接口增加单品券核销功能，扫码消费接口增加入参两个参数，订单优惠标记（为配券时候的填的优惠标记）,商品列表； /** * 扫码消费 */ CILRequest request = new CILRequest(); request.setAmount(amount); request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） request.setOrderPromotionMark(orderPromotionMark);//订单优惠标记（类型String可选参数） request.setGoodsList(goodsList);//商品列表（类型String可选参数）详见下新增字段说明 CILSDK.consumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { // 处理扫码消费结果 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： /** * resultCode = response.getTrans().getRespCode(); * if (\"09\".equals(resultCode) ) { * CILSDK.queryQr(); // `queryQr` 方法见下文 * } */ } @Override public void onError(Parcelable cilRequest, Exception e) { // 扫码消费出错 } }); 新增字段说明 字段 类型 含义 是否可选 备注1 备注2 orderPromotionMark String 订单优惠标记 Y ans32 来源于配券时选填字段 goodsList String 商品列表 Y 最多9个商品 按照以下样例格式传输 报文样例： \"orderPromotionMark\":\"1111\", \"[ { \"goodsName\":\"小面包\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"1111\" }, { \"goodsName\":\"棒棒糖\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"2222\" }, { \"goodsName\":\"彩虹糖\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"3333\" }, { \"goodsName\":\"矿泉水\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"4444\" } ]\" 响应报文新增一个CouponInfo的实例,内部包含属性字段有： 字段 类型 含义 是否可选 备注 couponId String 优惠券id Y couponName String 优惠券名称 Y channelContribution String 渠道出资 Y merchantContribution String 商家出资 Y otherContribution String 其它出资 Y discountType String 优惠类型 Y discountRange String 优惠范围 Y discountbatchaId String 优惠活动批次ID Y goodsList String 单品优惠商品列表 Y 单品优惠列表商品字段 字段 类型 含义 是否可选 备注 goodsBarCode String 商品条码号 Y goodsDiscount String 单品优惠金 Y CouponInfo响应报文样例： { \"MerchantContribution\":\"000000000100\", \"couponId\":\"9026256969\", \"couponName\":\"讯联满1.1减1 tag\", \"discountRange\":\"SINGLE\", \"discountType\":\"DISCOUNT\", \"discountbatchaId\":\"9803978\", \"goodsList\":\"[{\"goodsBarCode\":\"1111\",\"goodsDiscount\":\"000000000034\"}, {\"goodsBarCode\":\"2222\",\"goodsDiscount\":\"000000000034\"}, {\"goodsBarCode\":\"3333\",\"goodsDiscount\":\"000000000032\"}]\", \"otherContribution\":\"000000000000\" } 附：最多支持传入9个商品 账单查询 智能 POS SDK 分别提供了最多30天的 账单列表查询 和 账单统计接口 接口,接口会根据 type 值确定返回 银行卡账单 或 扫码账单 。 交易成功还是失败最终以返回账单中应答码为准，见 应答码表 。 交互设计建议：交易中，具体来说，调用CILSDK.consumeQr()或是CILSDK.consume()方法时，当因为网络中断进入onError callback时，建议在交互中加入 查询账单列表 的逻辑，这样交易失败后可方便收银员通过账单来确认这笔订单的实际状态。 注意：对于 09 （请求正在处理中）状态的交易账单数据，还需要看 处理标志位 才能判定此次交易成功与否，使用 getProcessFlag() 获取。 当 processFlag 为 '0' 时，此次交易成功；当 processFlag 为非'0' 时，此次交易失败，见 处理标志表 。 1、根据外部订单号获取该笔订单信息（同步） //outOrderNum为传入数据 CILSDK.getBillsAsync(outOrderNum, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }) 2、根据凭证号获取当前批次号下该笔订单详情(异步) /** * 依据凭证号，获取当前批次下的订单详情 回调在主线程 * 异步操作 * @param traceNum 凭证号 * @param listener */ CILSDK.getBillByTraceNum(traceNum, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 3、根据参考号获取当前批次下的订单详情（异步操作） /** * @param refNum 参考号 * @param callBackIsOnMainThread 是否在主线程中回调 */ CILSDK.getBillByRefNumAsync(refNum, callBackIsOnMainThread, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 4、根据批次号获取当前批次下的订单详情（异步操作） /** * @param refNum 批次号 * @param callBackIsOnMainThread 是否在主线程中回调 */ CILSDK.getBillByBatchNumAsync(batchNum, callBackIsOnMainThread, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 5、获取账单列表 1. 默认获取三十天的账单列表 /** * 获取账单列表 异步 * * @param int page 从0开始 * @param int size 每页返回的条数 * @param int type 账单类型(TransConstants.CARD_BILL, TransConstants.QR_BILL, TransConstants.ALL_BILL) * */ CILSDK.getBillsAsync(page, size, @BillType int type, new Callback<CILResponse>() { @Override public void onResult(final CILResponse response) { if (null != response && 0 == response.getStatus()) { //账单获取成功 Trans[] trans = response.getTxn(); //账单数据,字段详情见 Trans } } @Override public void onError(Parcelable p, Exception ex) { //账单获取出错 } }); 2. 获取指定区间的账单列表 /** * 获取账单列表 异步 * * @param page * @param size * @param startTime 查询订单开始时间，格式：yyyyMMdd * @param endTime 查询订单结束时间，格式：yyyyMMdd * @param type * @param callBackIsOnMainThread * @param listener * @return */ CILSDK.getBillsAsync(page, size, startTime, endTime, type, true, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 6、获取今日交易统计 /** * 获取今日交易统计 异步 * @param type 账单类型 * <ul> * <li>TransConstants.ALL_BILL:所有账单</li> * <li>TransConstants.CARD_BILL:银行卡账单</li> * <li>TransConstants.QR_BILL:扫码账单</li> * </ul> * */ CILSDK.getBillStatAsync(@BillType int type, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { if (null != response && 0 == response.getStatus()) { //今日交易统计获取成功 CILResponse.Info data = response.getData(); String transCount = data.getTransCount();//今日银行卡正向交易数量 String transAmtSum = data.getTransAmtSum();//今日银行卡正向总交易金额 String backTransCount = data.getBackTransCount();//今日银行卡负向交易数量 String backTransAmtSum = data.getBackTransAmtSum();//今日银行卡负向总交易金额 String sctTransCount = data.getSctTransCount();//今日扫码正向交易笔数 String sctTransAmtSum = data.getSctTransAmtSum();//今日扫码正向交易金额 String sctBackTransCount = data.getSctBackTransCount();//今日扫码负向交易笔数 String sctBackTransAmtSum = data.getSctBackTransAmtSum();//今日扫码负向交易金额 String tipsTransCount = data.getTipsTransCount();//今日收取小费笔数 String tipsTransAmtSum = data.getTipsTransAmtSum();//今日收取小费金额 } } @Override public void onError(Parcelable p, Exception ex) { //今日交易统计获取出错 } }); SDK 的网络部分使用的是第三方库 okhttp ,以上账单接口分别还提供了相对应的同步接口 getBills 和 getBillStat 。 对于异步接口来说,都会返回一个 Call 对象,你可以在应用出错的时候调用 call.cancel() 取消这次请求,以免造成内存泄露。 小费 注意: 通过对一笔交易收取小费。 小费最多收取交易金额的20% 小费只能成功收取一次 消费撤销后不能再次收取 1、小费 CILRequest request = new CILRequest(); request.setCardNum(cardNumber); request.setReferenceNumber(trans.getRefNum()); request.setBatchNum(trans.getBatchNum()); request.setTraceNum(trans.getTraceNum()); request.setTransDatetime(trans.getTransDatetime()); request.setRevAuthCode(trans.getRevAuthCode()); request.setAmount(amount);//小费金额 CILSDK.takeTip(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable parcelable, Exception e) { ... } }); 2、小费撤销 CILRequest request = new CILRequest(); request.setCardNum(cardNo); request.setAmount(trans.getTransAmt()); request.setReferenceNumber(trans.getRefNum()); request.setRevAuthCode(trans.getRevAuthCode()); request.setBatchNum(trans.getBatchNum()); request.setTraceNum(trans.getTraceNum()); request.setTransDatetime(trans.getTransDatetime()); CILSDK.revokeTip(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable parcelable, Exception e) { ... } }); 结算 结算需求主要用于每日交易结束时或收银员交接班时,对某段时间内的账款核对。商户每日交易结束后,收银员需要统计并核对所有的交易,核对交易统计准确后结算，打印出结算单。 结算会涉及到一个概念-- 批次号 ,我们在前面的交易都会传入一个批次号给 request ,调用结算之后,后续的交易需要将这个批次号加1,因为此批次已经打包结算掉了。 //batchNum 批次号 CILSDK.transSettleAsync(batchNum, new Callback<CILResponse>() { @Override public void onResult(final CILResponse response) { //打印结算单 } @Override public void onError(Parcelable cilRequest, Exception e) { //结算出错 } }); 如果使用讯联样式结算UI、逻辑直接使用 注意,使用SettleDaoUtil工具类是必须先初始化，SettleDaoUtil.getInstance().init(); SettleDaoUtil.getInstance().gotoLiquidation(context) 打印 本模块可用于根据交易信息打印所需的消费票据。接口不仅提供了一套固定格式的小票样式，而且还可以根据需要自定义打印样式。 主要功能包括小票打印、二维码打印、条形码打印以及图片打印。 特别注意: 中国人民银行和中国银联为了规范市场上的POS机终端，要求终端打印的签购单必须合乎规范，规范内容包括必须打印的字段与正确的字段内容。 签购单规范详情见 签购单规范 打印银行卡类交易、扫码类交易小票 /** trans 交易信息,Trans类型 * lineBreak 小票结尾需要走纸换行的行数，int类型 * formatTransCode @FormatTransCode String类型，小票的交易类型 * kind @ReceiptSubtitle int类型，小票的子标题，判断是商户联或者是客户联 * isForeignTrans 是否是外卡类交易 * bitmap logo图标，没有直接传null */ CILSDK.printKindsReceipts(trans,lineBreak,formatTransCode, kind, isForeignTrans, bitmap, new Callback<PrinterResult>(){ @Override public void onResult(PrinterResult response) { if (null ！= printerResult && !\"打印成功\".equals(printerResult.toString())) { //打印成功 } } @Override public void onError(Parcelable cilRequest, Exception e) { //打印失败 } }); 打印结算小票 /** * 打印结算小票 * * transSettles 结算信息List * transDatetime 结算时间 * lineBreak 打印结尾换行数 * formatTransCode 结算类型；TransConstants.TRANS_SETTLE_DETAILS：结算详情小票；TransConstants.TRANS_SETTLE_TOTAL：结算统计小票 * callback 回调 */ CILSDK.printSettleReceipts(transSettles, transDatetime,batchNum, lineBreak, formatTransCode, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 自定义打印 注意：使用自定义打印方法时，若打印内容超过2000个字符，请使用分段打印方式，否则可能出现DeviceRTException /** * 根据二进制数据打印(根据打印规范用户自定义打印小票样式) * * buffer 打印内容 * lineBreak 换行数 * callback 回调 */ CILSDK.printBufferReceipt(buffer, lineBreak,new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印二维码 /** * 打印二维码 * * qrCode 二维码内容 * position 打印位置 0:左对齐；1居中；2：右对齐 * width 二维码宽度 * callback 回调 * */ CILSDK.printQRCode(qrCode,position,width,lineBreak,new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印条形码 /** * 打印条形码 * * barCode 条形码数字 * position 条形码位置 0:左对齐；1居中；2：右对齐 * lineBreak 换行数 * callback 回调 */ CILSDK.printBarCode(String barCode, int position, int lineBreak, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印图片 /** * 打印图片 * * bitmap 图片Bitmap * lineBreak 换行数 * offset 偏移量 * callback 回调 * */ CILSDK.printImage(bitmap, lineBreak, offset, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 其他设置 考虑到使用 SDK 的时候可能还会有其他需求,比如 获取 POS 机的 SN 号 、 设置密钥索引 等,在这里,我们也提供了一部分接口。 获取 SDK 版本 //版本名 String versionName = CILSDK.VERSION_NAME; //版本号 int versionCode = CILSDK.VERSION_CODE; 获取 SN 号 //SN号 String snCode = CILSDK.getDeviceSN(); 设置流水号 //serialNum范围：1~999999 boolean isSuccess = CILSDK.setSerialNum(int serialNum); 获取流水号 //序列号 int serialNum = CILSDK.getSerialNum(); 设置批次号 //batchNum范围：1~999999 boolean isSuccess = CILSDK.setBatchNum(int batchNum); 获取批次号 //批次号 int batchNum = CILSDK.getBatchNum(); 设置联迪密钥区 //1-15的设值范围 CILSDK.setTingA8KeyIndex(2); 设置密钥索引 //分别对应MAIN MAC PIN MES //1-255的设值范围 //可以使用下方提供数值,也可以根据自身程序设值 CILSDK.setTingKeyIndex(4,101,10,150); 以上两个方法请在连接刷卡器(CILSDK.connect)之前使用 工具类 CILPayUtil /** * 将respCode翻译成对应中文解释 */ CILPayUtil.translate(context, respCode)); /** * 将Trans类中的transCode翻译成打印所需的对象 */ CILPayUtil.getFormatTransCode(transCode); /** * 根据billingCurr判断交易是否为外卡类的DCC交易 */ CILPayUtil.isDCCPay(billingCurr); /** * 判断交易是否成功 */ CILPayUtil.isTransSuccess(trans); /** * 根据Trans类中的transCode判断交易是否属于扫码类交易 */ CILPayUtil.isQrPay(transCode); ReceiptFormatUtils /** * 根据Trans类中的TransCode翻译成对应的中文解释 */ ReceiptFormatUtils.getTransType(transCode); /** * 将明文的卡号修改为\"前六后四中间为四个*\"的样式 */ ReceiptFormatUtils.handleCardNum(cardNum); 许可证 Copyright (c) 2016 cardinfolink.com JAVADOC java document 详情见 javadoc","text_tokens":["(","位置","录入","gettranscount","原扣币","equals","gettipstransamtsum","调用","revokeconsume","用者"," ","保持","必须","backtransamtsum","主","且","goodslist","日期","是否是","一部","this","出错","详情","来","downloadparamswithprogress","transrate","源于","结果","中","settracenum","三个","擅自","做","关","开启","订单","zaihui","setcoordinates","入参","应答","--","传输","消费类","报文","规范市场","下方","usd","respcode","length","时","一定","goodsdiscount","9803978","给","小费","31.180606","othercontribution","合作","样例","getstatus","被","方法","getcardexpirationdate","transsettleasync","revokeconsumeqr","以","方便","含义","改动","starttime","返回值","getsystemparams","class","负向","unknow","整个","versionname","前六后","优先","联系","内","implementation","transsettles","包含","对象","gcj02","存储设备","n900","需","指引","大概","setlatitude","通过","底部","取值","void","关单","手输类","时选","行数","自定","getformattranscode","e","response","后续","同步","c","或是","方式","preauthcompleteqr","也","更新","的","设计","左","referencenumber","调试","isdccpay","四","connect","错误","goodsid","读取","当前","格式","如","到","[","特别","情况","msc","最多","gettranstype","银员","short","compinfoa4","will","配券","＋","所有","9026256969","后台","区","再","某","自","实际","次","代码","工具","中需","revokepreauthcomplete","名","拿到","setposinputstyle","本身","还","种类","98","接班","skd","settinga8keyindex","避免","进行","都","了","返回","settransrate","字段","今日","settingkeyindex","setamount","*","merdiscount","com","号文","判断","tag","null","fail","先","联满","异步","page","其他","2.5","转载","开始","getscttranscount","setbatchnum","送","discountbatchaid","setcardnumb","直接","收银员","清算","便","坐标","出来","setlimittime","支持","cardno","正常","人民","versioncode","对","只","卡人","setrevauthcode","要","逻辑","请求","存储","revauthcode","012","setdebug","returnconsumeqr","channelcontribution","里面","四个","一般","/","提供","使用","get","用","这次",".","点","初始化","javadoc","当然","去","造成","概念","其实","联迪","cardbrand","linebreak","支付","之前","无需","原预","biilingamt","termcode","10s","三步","保证","域","2222","getbillsasync","单","consume","持卡","填字","downloadparams","所","超过","\"","cardnum","sncode","之后","getamount","备注","标题","与否","getbacktranscount","gettxn","详见","setbillingcurr","zxing","cashiernum","再次","基础","核销","hashutils","账款","客户","这个","就是","jcenter","getscttransamtsum","setorderpromotionmark","具备","金","三十","中国","右","oncreate","protected","出资","istranssuccess","微信","对于","参数值","cardinfo","好","ratequerylistener","aftertranscode","分段","地理","returnconsume","printbarcode","下载","不能","字符","见下文","compinfoa8","isopendcc","控制","field55","onresult","gettrans","8","per","li","setfield55","本地","processflag","开","billtype","code","other","发起","2","发预","是否","值会","形式","保存","total","系统","demo","255","首先","commoncardhandleractivity","java","details","页面","据库","4","getlongitude","下单","该","application","终端","datetime","父类","transcount","width","复杂","依据","说明","连接不断","网络","wgs84","快速","sdk","setserialnum","联","setpinemv","yyyymmdd","scancode","环节","有","启用","则","腾讯","getpinbins","矿泉水","v2.5","init","没有","翻译成","revokepreauthqr","步骤","发版时","为准","条数","内存","如有","handlecardnum","平台","gettracenum","或","讯联","个字符","规范","汇率","printbufferreceipt","compinfoa1","为","检索","配置","revokepreauth","地理位置","程","能","4444","公钥","ex","mac","1","序列","tipstransamtsum","棒棒","如下","定位","供","goodsnum","cardinfolink","涉及","号加","安装","能力","业务","。","渠道","撤销","同样","笔数","自行","磁道","okhttp","new","签购","tradedate","13","常用","每日","样式","设值","下发","onerror","标识","结尾","b","测试环境","|","pos","卡预","缓冲","单品","自己","本","依赖","85","setperiod","列表","preauthqr","maketext","注意","aid","银行卡","复写","取自","进入","basecardactivity","getbillbytracenum","ic卡","子标题","getbillstat","batchnum","卡","一笔","backtranscount","...","用户","用于","setscancodeid","偏移","加入","！","市场","接口","进度","setcardsequencenumber","参考","附件","获取","parcelable","可选","transamtsum","initcardevent","translate","还是","type","修改","gettransdate","需求","transdate","tpdu","无误","有效期","根据","数","刷卡器","掉","宽度","经度","所在","流水号","12","效期","bin","分为","商家","compinfoa7","属性","2016","size","得到","二维","cardtype","boolean","棒棒糖","金额","getbillingcurr","出现","这里","顺利","ui","transcode","测试","override","服务","内容","list","扣","传给","getbillstatasync","客服","5","offset","getdevicesn","国际","barcode","info","这些","加密","原因","getfield55","encryptactivecode","name","负","一次","cashiername","下文","例如","graph","从","）","公司","10000l","mes","端口","getposinputstyle","反馈","第三方","默认","另外","交互","55","getrevauthcode","这样","出","批次","id","银行","一部分","比如","还会","callback","preauthcomplete","不仅","智能","setgoodslist","总","余额","sctbacktranscount","localtransdate","预留","possdk","托管","机器","当","里","+","由于","外","isforeigntrans","=","checkbalance","revokepreauthcompleteqr","优惠活动","看","已经","转","14","000000000032","getdata","goodsname","包括","scttransamtsum","才","具体来说","正确","明文","应用","必选","gettransamt","确认","银联","mercode","1111","这笔","origintracenum","推荐","中国人民银行","名称","ic","一个","中间","setreferencenumber","，","消费","读卡","waitloadingshow","getsequenceserialnum","该笔","选择","即可","serialnum","cancel","但","y","setorderid","revordernum","只有","kind","建议","有效","才能","gps","流水","顺利进行","coupon","a8","发送","不再","11","字母","activewithcode","show","选择性","矿泉","规定","failed","2.1","商户","分别","收取","discountrange","settledaoutil","泉水","而且","card","两个","revoketip","150","装载","billingcurrnum","确定","环境","；","一套","settransdatetime","additionalresdata","最终","过程","smart","判定","许可","读出","准确","一台","每天","主要","compinfoa3","6","考虑","gettransdatetime","1.1","000000000100","revinscode","gettransamtsum","999999","clearingdate","getbacktransamtsum","下","p","所在地","!","setbillingamt","偏移量","三十天","call","final","指定","public","版本","优惠券","详细","single","向","持久","active","getbatchnum","setlongitude","issupport","天","定义","transconstants","getmessage","有点","响应","`","相关","程序","走","sdk2.4","formattranscode","cilrequest","tracenum","无法","新增","收银","oncreat","compinfoa2","trans","并","或者","交接班","完整","单品券","curtrans","queryqrjustonce","2000","3333","00","dcctoedc","getcardnumber","中断","段","gettrack2","cardnumber","if","及","支付宝","联网","getlatitude","二进制","每个","单行","inscode","形码","具体","数据","凭证","consumeqr","标识码","getprocessflag","success","需要","compinfoa6","transcurr","amount","transdatetime","状况","@","工作","增加","连接","3","要求","单号","正在","tipstranscount","成功","第三","不","上","对应","you","走纸","失败","位","因","setlocation","discounttype","原","30","：","外部","含","getsctbacktransamtsum","库","实例","地址","此","return","导致","以下","交易类型","单收","第一","sendqueryrate","激活码","orderpromotionmark","下面","授权","request","小面包","改为","taketip","模块","查找","nfc","posinputstyle","是","范围","面包","'","settranscurr","机","getbillbybatchnumasync","需上","跟踪","extends","将","<","旧","受理","原始","条形","定义域","中国银联","getserialnum","码表","扣账","高德","receiptsubtitle","getsctbacktranscount","类中取","getbillingamt","前面","打包","setoriginaltradedate","借贷","最","true","000000000034","buffer","devicertexception","cilpayutil","二维码","gettipstranscount","gradle","来说","查询","小票","all","issuccess","edc","联扫码","markup","彩虹","数量","signin","居中","progresscallback","集成","为了","这","已","只能","退货","除","copyright","讯","核对","合作方","手输","int","此次","onprogressupdate","索引","context","并且","功能","main","签到","isqrpay","执行","类型","自身","字","查看","false","sn","price","附",">","000000000000","符号","getbillbyrefnumasync","sctbacktransamtsum","getcoordinates","若有","活动","初始","属于","硬件","我们","queryqr","getinstance","succ","json","gotoliquidation","不要","rateinfo","合乎","voidqr","listener","能够","能且","数字","超时","与","和","discount","值","打印","无","printimage","泄露","新","分钟","来源于","setsecondtrack","阶段","可能","内部","transaction","非","个","在","location","自动","数据库","国人","卡号","信息","流程","扣款","后","见","外界","0","账单","因为","部分","printqrcode","]","10","中文","version","密钥","三位","goodsbarcode","仅","progress","方","resultcode","20%","2.2","originaltradedate","外卡","若","解释","对齐","exception","position","getrespcode","等","如果","币种","操作","or","logo","标志","bitmap","各","类","以上","ul","信用","billingamt","段时间","多次","货币","qr","条形码","mername","localtranstime","主线","printerresult","取消","两种","getapplicationcontext","组织","endtime","activity","bd09","输入","化","退款","（","cardreaderhandler","一些","除了","回调","toast","settle","翻译","正向","许可证","全部","merchantcontribution","请","结算","getscancodeid","进制","时候","自定义","callbackisonmainthread","}","101","ans32","国内","result","couponid","应","表","刷卡","qrcode","传入","activitylifecyclecallbacks","string","纬度","rsa","就","会","会为","让","设备","以及","a","调用者","其它","每页","cardhandlererror","版本号","均","附加","标记","号","图标","十天","传","填","票据","transamt","你","下次","可","状态","7","billingcurr","可以","代替","pin","信用卡","15","订单号","受卡方","图片","选","cilsdk","super","填入","printkindsreceipts","简化",",","mlocationmanager","区间","关于","否则","结束","orderid","固定","处理","sharedpreference","9","表示","printsettlereceipts","waitloadingdismiss","地方","译成","couponinfo","document","scttranscount","outordernum","二","getbills","持卡人","参数","setcardnum","tostring","api","程中","{",":","优惠","扫码","交易","-","多","商品","百度","设置","setcardexpirationdate","来源","bill","按照","第一次","卡片","data","时间","码","lr","确保","预","gettransrate","authcode","坐标系","&&",")","统计","激活","接入","发放","继承","营销","couponname","三方","类中","preauth","121.600228","receiptformatutils","param","~","cilresponse","else","savedinstancestate","但是","文档","debug","以免","序列号","getrefnum","记","帐","交接","09","左右","减","scancodeid","字符串","dcc","后面","重复","相对","bundle","换行","经历","条码","糖","不断","app","完成","数值","读出来","想",";","_","getmerchantinfo","refnum","、"],"title":"1. SDK API","title_tokens":["1","api","sdk"," ","."]},{"location":"documentation/quik/#_1","text":"为了方便快速接入，提供了demo供接入参考 demo下载 本 SDK 已使用 jcenter 托管，配置如下 gradle: implementation 'com.cardinfolink.smart.pos:PosSDK:2.5.2' 如果想使用讯联集成的结算UI和逻辑，请配置 gradle: implementation 'com.cardinfolink.smart.pos:SDK-ZaiHui:1.1.1'","text_tokens":["了","ui","本","'","com","如果"," ","smart","讯联","接入","2","1.1","，","2.5","的","配置","demo","和","参考","1","zaihui","如下","jcenter","供","gradle","cardinfolink","逻辑","请","结算","提供","使用","集成","为了",".","已","possdk","托管","快速","sdk",":","方便","-","下载","想","pos","implementation"],"title":"快速接入","title_tokens":["接入","快速"]},{"location":"documentation/quik/#pos","text":"使用 N900 智能 POS 机器, 首先需要连接 POS 机硬件, 使用 SDK 提供的 connect 方法连接。 建议在 Application 的 onCreate 方法中进行连接。 @Override public void onCreate() { super.onCreate(); ... CILSDK.setDebug(true);//调试阶段使用测试环境，发版时请改为 false CILSDK.connect(this); ... } 使用联迪A8设备的，联迪设备连接需要传入activity的context, 除了在 Application 的 onCreate 方法中进行连接，建议在每个可能调用设备刷卡、加密、打印的activity onCreat方法中再调用 CILSDK.connect(this)进行连接， 保证使用过程中设备连接不断开；另外推荐在ActivityLifecycleCallbacks中处理设备连接。","text_tokens":["(","false","调用","推荐","开"," ","硬件","this","，","中","首先","打印","阶段","建议","可能","application","在","a8","连接不断","sdk","方法","n900","发版时","环境","；","void","过程","的","调试","connect","activity","除了","public","请","。","}","再","刷卡","传入","activitylifecyclecallbacks","测试环境","oncreat","pos","设备","进行","...","cilsdk","每个","super",",","处理","需要","@","连接","setdebug","/","使用","提供",".","{","联迪","改为","测试","override","保证","机",")","加密","true","另外","智能","oncreate","机器","不断","context",";","、"],"title":"初始化（连接POS机硬件）","title_tokens":["（","初始化","连接","）","机","初始","硬件","pos"]},{"location":"documentation/quik/#pos_1","text":"完整的激活环节分为三步，分别是：激活，终端参数下载，终端密钥下载，三步都成功，表示激活成功，激活成功之后才能正常使用后面的交易流程。 1、激活 * a、新激活流程（推荐） 根据用户反馈，为了简化激活流程，我们新增了激活码的方式激活，当你拿到 POS 机器之后，我们会为这个商户发放激活码，一个激活码只可以激活一台 POS 机。 建议先调用 根据激活码获取商户信息接口: （返回商户名商户号终端号等信息），确认信息无误后，在调用激活码激活接口激活。 注意:一台终端能且仅能成功激活一次,无法重复进行激活操作。若有多次激活的需求(如debug阶段),请联系讯联客服。 //authCode 激活码（建议用扫码的方式得到激活码，避免让用户手输） CILSDK.activeWithCode(authCode, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { if (cilResponse.getStatus() == 0) { //激活成功 } else { //激活失败，失败原因见 cilResponse.getMessage() } } @Override public void onError(Parcelable cilRequest, Exception e) { //激活出错 } }); b、旧激活流程 第一次使用智能 POS 终端的时候,需要使用讯联下发的商户号（merCode） 和终端号（termCode）激活 注意:一台终端能且仅能成功激活一次,无法重复进行激活操作。若有多次激活的需求(如debug阶段),请联系讯联客服。推荐APP本身能够保持设备是否已经激活标志 //merCode 讯联下发的商户号 //termCode 讯联下发的终端号 CILSDK.active(merCode, termCode, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { if (cilResponse.getStatus() == 0) { //激活成功 } else { //激活失败 } } @Override public void onError(Parcelable p, Exception e) { //激活出错 } }); 注意: 根据激活码获取商户详情接口： CILSDK.getMerchantInfo(HashUtils.encryptActiveCode(authCode), true, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { //success //you will get merName,merCode,termCode } @Override public void onError(Parcelable cilRequest, Exception e) { //failed } }); 2、终端参数下载 激活成功之后,你的应用还需要下载一些交易时使用的参数,比如 交易地址和端口 、 交易超时时间 、 终端支持的功能 、 TPDU 等, 在你拿到 POS 终端之前,这些参数都会在讯联后台已经配置好,全部参数见 CILResponse.Info 返回值。下载成功之后 SKD 会 以json字符串的形式保存这些参数到 SharedPreference (请不要擅自改动这些参数值,以免导致交易失败) 。当然,在 onResult 中也会返回,你也可以自己选择性保存一些参数。另外, SDK 保存在 SharedPreference 里的值会提供接口 CILSDK.getSystemParams() 获取。 注意：正常情况下，此方法只需执行成功一次，但是后台参数配置可能会有改动，APP本身需要调用预留功能调用此方法 //merCode 讯联下发的商户号 激活成功之后可以确定商户号 //termCode 讯联下发的终端号 激活成功之后可以确定终端号 CILSDK.downloadParams(merCode, termCode, new com.cardinfolink.pos.listener.Callback<CILResponse>() { @Override public void onResult(CILResponse response) { if (0 == response.getStatus()) { //参数下载成功,具体返回的参数见 response.Info } else { //参数下载错误 } } @Override public void onError(Parcelable p, Exception e) { //下载出错 } }); 3、终端密钥下载 终端密钥下载只需要成功执行一次就可以,成功下载的密钥会被转载到POS硬件模块里面,后面就不需要再次调用了,建议你的应用可以在成功下载密钥之后持久化一个标志位, 下次进入应用就不再去下载密钥了。整个过程可能会需要1~2分钟左右(依赖当前的网络状况),会经历以下步骤: 请求讯联网关 RSA -> 装载 RSA -> 请求主密钥 -> 装载主密钥 -> 启用主密钥 -> 请求工作密钥(签到) -> 装载工作密钥 -> 下载 AID -> 装载 AID -> 下载 IC 公钥 -> 装载 IC 公钥。 建议APP本身存储设备是否已经初始化方法标志。 注意：此方法一般只需要安装后成功调用一次即可。但银行交互密钥有可能会更新，APP本身需要调用预留功能调用此方法 CILSDK.downloadParamsWithProgress(new ProgressCallback<CILResponse>() { @Override public void onProgressUpdate(int progress) { //progress下载密钥的进度 } @Override public void onResult(CILResponse response) { if (0 == response.getStatus()) //密钥下载成功。在这里可以持久化一个标志位 } @Override public void onError(Parcelable p, Exception e) { //下载密钥出错 } });","text_tokens":["(","应用","onresult","确认","mercode","调用",">","downloadparamswithprogress","推荐","若有","ic"," ","一个","保持","硬件","不再","我们","主","初始","json","不要","2","出错","详情","是否","值会","，","形式","listener","能够","能且","skd","超时","保存","和","中","选择","即可","擅自","但","关","新","分钟","阶段","建议","可能","才能","终端","在","时","信息","流程","网络","后","见","getstatus","0","sdk","activewithcode","联","选择性","以","方法","failed","改动","返回值","getsystemparams","环节","密钥","有","启用","仅","商户","分别","整个","联系","功能","装载","存储设备","progress","需","确定","步骤","exception","void","等","过程","操作","讯联","一台","标志","e","response","方式","也","多次","的","更新","配置","mername","能","错误","公钥","下","p","当前","如","到","化","1","（","一些","情况","public","cardinfolink","全部","请","持久","active","安装","。","will","时候","}","后台","getmessage","new","下发","onerror","名","拿到","无法","新增","cilrequest","pos","b","本身","会为","让","避免","设备","完整","返回","了","a","都","进行","自己","依赖","*","号","注意","aid","com","会","还","进入","你","下次","可以","先","用户","if","转载","联网","cilsdk","接口","进度","简化",",","具体","被","获取","parcelable","支持","正常","success","sharedpreference","需要","只","需求","表示","状况","@","请求","工作","存储","tpdu","无误","3","根据","里面","成功","一般","/","使用","get","提供","用","不","参数",".","you","失败","位","分为","{","：","初始化",":","扫码","得到","交易","地址","此","-","导致","当然","去","以下","第一","激活码","这里","之前","第一次","override","termcode","模块","三步","是","时间","就","机","客服","authcode","downloadparams",")","<","旧","这些","之后","原因","激活","发放","encryptactivecode","info","一次","）","~","cilresponse","else","端口","反馈","但是","true","再次","debug","hashutils","以免","另外","rsa","交互","这个","银行","比如","左右","callback","签到","字符串","智能","后面","重复","progresscallback","为了","经历","参数值","预留","机器","里","当","app","讯","=","手输","好","int","onprogressupdate","已经","数值","下载",";","字符","getmerchantinfo","执行","、"],"title":"激活POS机","title_tokens":["pos","激活","机"]},{"location":"documentation/quik/#_2","text":"签到其实也就是更新工作密钥的一个过程 ( 下载工作密钥+装载工作密钥 ),讯联网关平台要求应用需要每天签到一次。 CILSDK.signIn(new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { //签到成功 } @Override public void onError(Parcelable cilRequest, Exception e) { //签到出错 } });","text_tokens":["(","应用","override","装载","onresult",">","exception","void","平台","过程","一个"," ",")","每天","<","e","出错","一次","也","更新","的","联网","cilsdk","cilresponse",",","parcelable","关","需要","就是","public","工作","@","要求","callback","。","成功","signin","/","}",".","+","new","{","讯","onerror","密钥","cilrequest","下载",";","其实","签到"],"title":"签到","title_tokens":["签到"]},{"location":"documentation/quik/#_3","text":"由于银行卡交易逻辑有点复杂,讯联提供了一个 BaseCardActivity 基础类,你只需要继承这个类便可以做银行卡类的交易了。具体使用方法可以见 demo 里的 CommonCardHandlerActivity 类。下面给个大概说明: public class CommonCardHandlerActivity extends BaseCardActivity { @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); //... } /** * 必须传入金额 * * @return */ public String getAmount() { //在这里传入金额 } /** * 此方法为控制sdk内部是否开启DCC交易逻辑（sdk2.4.1版本及以上支持该方法） * *@return 需要进行DCC交易时，返回true，否则返回false */ public boolean isOpenDcc() { //如有DCC需求，因只有刷卡消费和刷卡预授权才支持DCC交易，此方法只需要在这两种交易类型返回true //如果接入方无需支持DCC，则此方法返回false即可 return false; } /** * 读卡的结果（sdk2.4.1版本及以上新增RateInfo参数，返回DCC读卡流程中进行汇率查询的结果） * * @param isSuccess 是否成功 * @param cardType 卡片种类(-1(unknow) 1(msc) 2(ic) 3(nfc) 4(scancode) 5(other)) * @param cardInfo 读取卡片信息 * @param rateInfo 汇率信息 */ public void cardReaderHandler(boolean isSuccess, @CardType.Type int cardType, CardInfo cardInfo, RateInfo rateInfo){ //读卡成功后才发起交易 if (!isSuccess || cardInfo == null) { Toast.makeText(getApplicationContext(), \"读卡失败\", Toast.LENGTH_SHORT).show(); initCardEvent(); return; } //1. 根据银联85号文规定，智能终端在消费和预授权完成交易需上送经度，纬度，坐标系信息到卡组织 CILRequest request = new CILRequest(); request.setLongitude(121.600228);//设置经度 request.setLatitude(31.180606);//设置纬度 request.setCoordinates(\"GCJ02\");//设置坐标系 //关于坐标系，国内一些常用第三方取值：百度（BD09），高德、腾讯（GCJ02），GPS（WGS84）。 //一般第三方定位SDK都能从定位后返回的位置信息类中取到，详细可查看各第三方接入文档。 //2.如果接入方需要进行DCC交易，在消费和预授权完成交易中需将汇率信息填入request中，否则无需处理 CILRequest request = new CILRequest(); ... if (rateInfo != null) { request.setBillingAmt(rateInfo.getBillingAmt());//设置扣账金额 request.setBillingCurr(rateInfo.getBillingCurr());//设置扣账币种 request.setTransRate(rateInfo.getTransRate());//设置交易汇率 request.setBatchNum(rateInfo.getBatchNum());//设置汇率请求批次号 request.setTraceNum(rateInfo.getTraceNum());//设置汇率请求流水号 } //3. 在这里面发送银行卡相关的交易(如消费、消费撤销、退货、预授权、预授权撤销、预授权完成、预授权完成撤销、余额查询) //CILSDK.consume(request, cardType, new Callback<CILResponse>() //消费 } /** * 自定义读卡时的缓冲页面 */ public void waitLoadingShow(){ } /** * 取消读卡时的缓冲页面 */ public void waitLoadingDismiss(){ } /** * 读卡失败 */ public void cardHandlerError(Exception e){ } } 注意: 调用银行卡类交易接口时，需要传入CILRequest以及CardType，且所有接口中CILRequest均需要传入以下信息： CILRequest request = new CILRequest(); request.setAmount(amount);//消费金额 /** * 复写的刷卡回调方法中获取到的cardInfo信息 */ request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPinEmv(cardInfo.getPinBins());//卡bin request.setCardSequenceNumber(cardInfo.getSequenceSerialNum());//卡片序列号 request.setField55(cardInfo.getField55());//55域信息 request.setSecondTrack(cardInfo.getTrack2());//二磁道信息 request.setOrderId(orderId);//可选参数。（消费、退货、预授权、预授权完成、扫码下单、扫码退货） request.setLocation(location)//有终端具备获取位置信息能力时必选上送（ 用于消费 预授权完成） 1、消费 消费接口 request必须包含参数: //除了request必须包含的参数外，还需要以下参数 //复写的刷卡回调的方法中会返回汇率信息 if (rateInfo != null) { request.setBillingAmt(rateInfo.getBillingAmt());//持卡人扣账金额 request.setBillingCurr(rateInfo.getBillingCurr());//持卡人扣账货币代码 request.setTransRate(rateInfo.getTransRate());//交易汇率 request.setBatchNum(rateInfo.getBatchNum());//汇率查询批次号 request.setTraceNum(rateInfo.getTraceNum());//汇率查询流水号 } //地理位置信息，需要调用方自行获取传入sdk request.setLongitude(location.getLongitude());//经度 request.setLatitude(location.getLatitude());//纬度 request.setCoordinates(location.getCoordinates());//坐标系 /** * 刷卡消费 * * @param request 请求参数 * @param cardType 卡片类型 CardType.MSC_CARD, CardType.IC_CARD, CardType.NFC_CARD... */ CILSDK.consume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 2、撤销 撤销接口 request必须包含参数: /** * 撤销接口除基础信息外， * 还需要原交易信息 */ request.setReferenceNumber(transaction.getRefNum());//原交易参考号 request.setRevAuthCode(transaction.getRevAuthCode());//原交易授权码 request.setBatchNum(transaction.getBatchNum());//原交易批次号 request.setTraceNum(transaction.getTraceNum());//原交易凭证号 CILSDK.revokeConsume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 3、退货 退货接口 request必须包含参数: /** * 退货接口除基础信息外 * 还需要原交易信息 */ request.setReferenceNumber(referenceNumber); request.setTransDatetime(tradeDate); CILSDK.returnConsume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 4、余额查询 余额查询接口 request必须包含参数: CILSDK.checkBalance(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 5、卡预授权 预授权接口 request必须包含参数: /** * 刷卡预授权 * * @param request 请求参数 * @param cardType 卡片类型 CardType.MSC_CARD, CardType.IC_CARD, CardType.NFC_CARD... */ CILSDK.preAuth(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 6、卡预授权撤销 预授权撤销接口 request必须包含参数: /** * 预授权撤销接口除基础信息外 * 还需要原预授权交易信息（需要输入的信息） */ request.setAmount(amount);//交易金额 request.setRevAuthCode(authCode);//原预授权交易授权码/参考号 request.setTransDatetime(originalTradeDate);//原预授权交易日期 CILSDK.revokePreAuth(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 7、卡预授权完成 预授权完成接口 request必须包含参数: 注意：预授权完成属于消费类型的交易，默认是做DCC的，在调用接口之前一定要将刷卡回调中的汇率信息设置给request，确保预授权完成的DCC交易能够顺利进行。 //除了request必须包含的参数外，还需要以下参数 //复写的刷卡回调的方法中会返回汇率信息 if (rateInfo != null) { request.setBillingAmt(rateInfo.getBillingAmt());//持卡人扣账金额 request.setBillingCurr(rateInfo.getBillingCurr());//持卡人扣账货币代码 request.setTransRate(rateInfo.getTransRate());//交易汇率 request.setBatchNum(rateInfo.getBatchNum());//汇率查询批次号 request.setTraceNum(rateInfo.getTraceNum());//汇率查询流水号 } //地理位置信息，需要调用方自行获取传入sdk request.setLongitude(location.getLongitude());//经度 request.setLatitude(location.getLatitude());//纬度 request.setCoordinates(location.getCoordinates());//坐标系 request.setAmount(amount);//交易金额 request.setRevAuthCode(authCode);//原预授权交易授权码 request.setTransDatetime(originalTradeDate);//原预授权交易日期 CILSDK.preAuthComplete(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 8、卡预授权完成撤销 预授权完成撤销接口 request必须包含参数: /** * 预授权完成撤销接口除基础信息外 * 还需要原预授权完成交易信息 */ request.setReferenceNumber(refNum);//原预授权完成交易参考号 request.setRevAuthCode(authCode);//原预授权完成交易授权码 request.setTraceNum(traceNum);//原预授权完成交易凭证号 request.setBatchNum(batchNum);//原预授权完成交易批次号 request.setTransDatetime(originalTradeDate);//原预授权完成交易日期 CILSDK.revokePreAuthComplete(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 9、DCC转EDC 当交易卡片为外卡时，消费类（消费、预授权完成）交易可选择进行DCC转EDC。 注意1：只有做了DCC的交易后才可能DCC转EDC成功，调用消费接口时如果持卡人的卡支持DCC，并且在刷卡页面复写的isOpenDcc方法中也返回true，sdk会优先执行DCC的逻辑，就是默认会走DCC的逻辑。 注意2：DCC转EDC无需刷卡，只需要使用消费成功的返回信息就可发起。 注意3：DCC转EDC成功后打印时，入参formatTransCode传PER,isForeignTrans传false CILRequest request = new CILRequest(); //以下参数取自原交易 request.setCardNum(cardNum);//卡号 request.setTransDatetime(datetime);//原交易时间 request.setAmount(amount);//原交易金额 request.setBillingAmt(biilingAmt);//原扣币金额 request.setReferenceNumber(refNum);//原交易参考号 request.setRevAuthCode(revAuthCode);//原交易授权码 request.setBatchNum(batchNum);//原交易批次号 request.setTraceNum(traceNum);//原交易凭证号 request.setTransCurr(transCurr);//原交易币种 request.setBillingCurr(billingCurr);//原交易扣款币种 CILSDK.dccToEdc(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable p, Exception e) { ... } }); 10、预授权手输卡号 ``` //需要手输的卡信息有卡号和卡有效期两个字段 CILRequest request = new CILRequest(); request.setAmount(amount); request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPosInputStyle(\"012\"); CILSDK.preAuth(request, CardType.MSC_CARD, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); ``` 11、预授权撤销手输卡号 CILRequest request = new CILRequest(); //卡信息两个字段通过手输代替刷卡 request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPosInputStyle(\"012\"); //下面三个字段可通过外界手输录入 request.setAmount(amount); request.setTransDatetime(originalTradeDate);//原始交易日期 request.setRevAuthCode(authCode);//授权码 CILSDK.revokePreAuth(request, CardType.MSC_CARD, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 12、预授权完成手输卡号 注意1：这个地方一定要进行DCC汇率查询，预授权完成属于消费类接口，默认是做Dcc的，同样如果需要做DCC转EDC,在预授权交易成功页面调用Dcc转EDC接口即可。 注意2：汇率查询一般sdk在刷卡的流程中自动完成，但是手输类的交易不走sdk的刷卡流程，需要调用方自行调用汇率查询api进行汇率查询，流程如下： graph LR 输入金额/原交易日期/授权码-->手输卡号和卡有效期 手输卡号和卡有效期--success-->DCC汇率查询 DCC汇率查询--succ or fail-->预授权完成 //1.进行DCC汇率查询 RateQueryListener listener = new RateQueryListener() { @Override public void onResult(boolean isSupport, RateInfo rateInfo) { //发预授权完成交易 } }; sendQueryRate(cardInfo.getCardNumber(), listener);//调用父类BaseCardActivity //2.发预授权交易 CILRequest request = new CILRequest(); request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPosInputStyle(\"012\"); //2.1 汇率 if (rateInfo != null) { request.setBillingAmt(rateInfo.getBillingAmt()); request.setBillingCurr(rateInfo.getBillingCurr()); request.setTransRate(rateInfo.getTransRate()); request.setBatchNum(rateInfo.getBatchNum()); request.setTraceNum(rateInfo.getTraceNum()); } //2.2地理位置信息，需要调用者自己获取传入 if (mLocationManager != null) { request.setLongitude(location.getLongitude()); request.setLatitude(location.getLatitude()); request.setCoordinates(location.getCoordinates()); } //以下信息可通过外界输入 request.setAmount(amount); request.setTransDatetime(originalTradeDate);//原始交易日期 request.setRevAuthCode(authCode);//授权码 CILSDK.preAuthComplete(request, CardType.MSC_CARD, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 13、预授权完成撤销手输卡号 CILRequest request = new CILRequest(); //卡信息两个字段通过手输代替刷卡 request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPosInputStyle(\"012\"); //下面三个字段可通过外界手输录入,也可通过本地数据库保存的交易信息查找 request.setAmount(amount); request.setReferenceNumber(refnum); request.setRevAuthCode(authcode;//授权码 request.setTraceNum(tracenum); request.setBatchNum(batchnum); request.setTransDatetime(originalTradeDate);//原始交易日期 CILSDK.revokePreAuthComplete(request, CardType.MSC_CARD, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 14、交易结果字段说明 字段 类型 含义 备注 备注 additionalResData String 受理方标识码 无 afterTransCode String 原交易类型 无 batchNum String 批次号 无 billingAmt String 持卡人扣帐金额 无 billingCurr String 持卡人扣帐货币代码符号，三位字母 例如USD billingCurrNum String 持卡人扣帐货币代码,三位数字 无 cardBrand String 国际信用卡公司代码 无 cardNo String 银行卡号 无 cardType String 刷卡方式 无 cashierName String 收银员 无 cashierNum String 收银员号 无 clearingDate String 清算日期 无 compInfoA1 String 签购单收单行 无 compInfoA2 String 签购单商户号 无 compInfoA3 String 签购单终端号 无 compInfoA4 String markup 无 compInfoA6 String 借贷记标识 无 compInfoA7 String 营销信息 无 compInfoA8 String 二维码信息 无 coupon String 支付宝/微信优惠金额 无 field55 String IC卡交易的TAG信息 无 insCode String 受理方标识码 无 localTransDate String 受卡方所在地日期 无 localTransTime String 受卡方所在地时间 无 merCode String 受卡方标识码（商户号） 无 merDiscount String 商家优惠金额 无 originTraceNum String 原交易凭证号 无 outOrderNum String 外部订单号 无 posInputStyle String 服务点输入方式码 无 processflag String 扫码支付09状态的交易是否成功 附件表1 refNum String 检索参考号 无 respCode String 应答码 \"00\"表示成功 revAuthCode String 授权标识应答码 无 revInsCode String 附加响应数据 无 revOrderNum String 自定义域，用于扫码支付业务。 无 scanCodeId String 扫码号 无 termCode String 终端号 无 traceNum String 受卡方系统跟踪号 合作方交易流水 transAmt String 交易金额 无 transCode String 交易类型码 无 transCurr String 交易货币代码 无 transDate String 原交易日期 无 transDatetime String 受卡方所在地日期＋受卡方所在地时 无 transRate String 持卡人扣帐汇率 无","text_tokens":["(","位置","录入","原扣币","调用","revokeconsume","用者"," ","必须","且","日期","transrate","结果","中","settracenum","三个","做","订单","开启","setcoordinates","入参","应答","--","消费类","usd","respcode","length","时","一定","给","31.180606","合作","getcardexpirationdate","方法","含义","class","unknow","优先","包含","gcj02","大概","setlatitude","通过","取值","void","手输类","自定","e","方式","也","的","referencenumber","读取","到","如","msc","银员","short","compinfoa4","＋","所有","自","代码","中需","revokepreauthcomplete","setposinputstyle","种类","还","进行","返回","了","都","settransrate","字段","setamount","*","merdiscount","号文","tag","null","setbatchnum","送","setcardnumb","收银员","清算","便","坐标","支持","cardno","只","卡人","setrevauthcode","要","逻辑","请求","revauthcode","012","里面","一般","/","提供","使用",".","点","cardbrand","支付","无需","原预","之前","biilingamt","termcode","域","单","consume","持卡","\"","cardnum","getamount","备注","setbillingcurr","cashiernum","基础","这个","就是","具备","oncreate","protected","微信","cardinfo","ratequerylistener","aftertranscode","地理","returnconsume","compinfoa8","isopendcc","控制","field55","onresult","8","per","setfield55","本地","processflag","other","发起","2","发预","是否","保存","系统","demo","commoncardhandleractivity","页面","据库","4","getlongitude","下单","该","datetime","终端","父类","复杂","说明","wgs84","sdk","setpinemv","scancode","则","有","getpinbins","腾讯","如有","gettracenum","讯联","汇率","compinfoa1","为","检索","revokepreauth","地理位置","能","1","序列","如下","定位","能力","业务","。","撤销","同样","自行","磁道","new","签购","tradedate","13","常用","onerror","标识","|","卡预","缓冲","85","自己","maketext","注意","银行卡","复写","取自","basecardactivity","ic卡","batchnum","卡","...","用于","接口","setcardsequencenumber","附件","参考","获取","parcelable","initcardevent","type","需求","transdate","有效期","根据","经度","所在","流水号","12","效期","bin","商家","compinfoa7","二维","cardtype","boolean","金额","getbillingcurr","这里","顺利","transcode","override","服务","扣","5","国际","getfield55","cashiername","例如","graph","从","）","公司","第三方","默认","getrevauthcode","55","批次","银行","callback","preauthcomplete","智能","余额","localtransdate","由于","里","当","外","isforeigntrans","=","checkbalance","转","14","才","必选","银联","mercode","origintracenum","ic","一个","setreferencenumber","，","消费","读卡","waitloadingshow","getsequenceserialnum","即可","选择","setorderid","revordernum","只有","有效","gps","流水","顺利进行","coupon","发送","11","字母","show","规定","2.1","商户","card","两个","billingcurrnum","settransdatetime","additionalresdata","compinfoa3","6","revinscode","clearingdate","p","所在地","!","setbillingamt","public","版本","详细","getbatchnum","setlongitude","issupport","定义","有点","响应","`","相关","走","sdk2.4","formattranscode","cilrequest","tracenum","收银","新增","compinfoa2","00","dcctoedc","getcardnumber","段","gettrack2","if","及","支付宝","getlatitude","单行","inscode","具体","数据","凭证","标识码","success","需要","compinfoa6","transcurr","amount","transdatetime","@","3","单号","成功","第三","不","上","因","失败","setlocation","原","：","外部","return","此","以下","交易类型","单收","sendqueryrate","下面","授权","request","查找","nfc","posinputstyle","是","settranscurr","需上","跟踪","extends","将","<","受理","原始","定义域","扣账","高德","类中取","getbillingamt","借贷","true","二维码","查询","issuccess","edc","markup","这","退货","除","合作方","int","手输","并且","类型","执行","字","查看","false",">","符号","getcoordinates","属于","succ","rateinfo","listener","能够","数字","和","打印","无","setsecondtrack","transaction","可能","内部","个","在","location","自动","数据库","卡号","信息","流程","扣款","见","后","外界","10","三位","方","2.2","originaltradedate","外卡","exception","or","如果","币种","各","类","以上","信用","billingamt","货币","localtranstime","取消","两种","getapplicationcontext","组织","bd09","输入","（","cardreaderhandler","一些","回调","除了","toast","自定义","}","国内","表","刷卡","传入","string","纬度","就","会","以及","调用者","cardhandlererror","均","附加","号","传","transamt","你","可","状态","7","billingcurr","可以","代替","信用卡","订单号","受卡方","选","cilsdk","super","填入",",","mlocationmanager","关于","否则","orderid","处理","9","表示","waitloadingdismiss","地方","outordernum","二","持卡人","参数","setcardnum","api","{",":","优惠","扫码","交易","-","百度","设置","setcardexpirationdate","卡片","时间","码","lr","确保","预","gettransrate","坐标系","authcode",")","继承","接入","营销","三方","preauth","121.600228","param","cilresponse","savedinstancestate","但是","文档","序列号","getrefnum","记","帐","09","scancodeid","dcc","bundle","完成",";","_","fail","refnum","、"],"title":"银行卡交易","title_tokens":["银行","银行卡","交易"]},{"location":"documentation/quik/#_4","text":"扫码相关的交易则是不依赖 POS 机器的读卡模块的,但是你需要将 微信 或者 支付宝 的二维码读出来传给扫码消费接口,扫码可以使用第三方库,如 zxing 。 1、扫码消费 CILRequest request = new CILRequest(); request.setAmount(amount);//交易金额 request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） CILSDK.consumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { // 处理扫码消费结果，字段说明见底部 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： // resultCode = response.getTrans().getRespCode(); // if (\"09\".equals(resultCode)) { // CILSDK.queryQr(); // `queryQr` 方法见下文 // } } @Override public void onError(Parcelable cilRequest, Exception e) { // 扫码消费出错 } }); 注意,如果应答码返回09或98，需要调用讯联扫码查询接口，查询该笔订单的实际状态。 2、扫码撤销 CILRequest request = new CILRequest(); request.setAmount(amount);//原交易金额 request.setBatchNum(batchNum);//原交易批次号 request.setTraceNum(traceNum);//原交易凭证(流水)号 request.setReferenceNumber(refNum); //原交易参考号 CILSDK.revokeConsumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 3、扫码退货 CILRequest request = new CILRequest(); request.setAmount(amount);//退款金额 request.setReferenceNumber(serialNum);//原交易参考号 request.setTransDatetime(tradeDate);//原交易时间 CILSDK.returnConsumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 4、扫码查询 CILRequest request = new CILRequest(); request.setBatchNum(response.getTrans().getBatchNum());//批次号 request.setTraceNum(response.getTrans().getTraceNum());//凭证号 request.setPeriod(10000L);//10s request.setLimitTime(6);//6 次 request.setReferenceNumber(response.getTrans().getRefNum());//参考号 request.setPosInputStyle(response.getTrans().getPosInputStyle());//pos输入服务方式码 request.setScanCodeId(response.getTrans().getScanCodeId());//扫码号 request.setAmount(response.getTrans().getTransAmt());//交易金额 CILSDK.queryQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 5、扫码消费查询,只查询一次，不含取消接口 CILRequest request = new CILRequest(); request.setBatchNum(response.getTrans().getBatchNum());//批次号 request.setTraceNum(response.getTrans().getTraceNum());//凭证号 request.setReferenceNumber(response.getTrans().getRefNum());//参考号 request.setPosInputStyle(response.getTrans().getPosInputStyle());//pos输入服务方式码 request.setScanCodeId(response.getTrans().getScanCodeId());//扫码号 CILSDK.queryQrJustOnce(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 6、扫码取消 /** * 扫码取消 * 对于09状态的消费订单，最终需要取消、关单 * @param request * @param listener */ CILRequest cilRequest = new CILRequest(); cilRequest.setOriginalTradeDate(response.getTrans().getTransDate());//原交易日期 cilRequest.setAmount(response.getTrans().getTransAmt());//交易金额 cilRequest.setBatchNum(response.getTrans().getBatchNum());//批次号 cilRequest.setTraceNum(response.getTrans().getTraceNum());//凭证号 cilRequest.setPosInputStyle(response.getTrans().getPosInputStyle());//pos输入服务方式码 cilRequest.setReferenceNumber(response.getTrans().getRefNum());//参考号 CILSDK.voidQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 7、扫码预授权 CILRequest request = new CILRequest(); request.setAmount(amount); request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） CILSDK.preAuthQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { // 处理扫码预授权结果 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： /** * resultCode = response.getTrans().getRespCode(); * if (\"09\".equals(resultCode) ) { * CILSDK.queryQr(); // `queryQr` 方法见下文 * } */ } @Override public void onError(Parcelable cilRequest, Exception e) { //扫码预授权出错 } }); 8、扫码预授权撤销 CILRequest request = new CILRequest(); request.setAmount(transAmt);//原预授权交易金额 request.setReferenceNumber(revAuthCode);//原预授权交易参考号 request.setTransDatetime(transDate);//原预授权交易时间 request.setBatchNum(curTrans.getBatchNum());//原预授权交易批次号 request.setTraceNum(curTrans.getTraceNum());//原预授权交易凭证（流水）号 CILSDK.revokePreAuthQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 9、扫码预授权完成 CILRequest request = new CILRequest(); request.setAmount(transAmt);//原预授权交易金额 request.setReferenceNumber(revAuthCode);//原预授权交易参考号 request.setTransDatetime(transDate);//原预授权交易时间 CILSDK.preAuthCompleteQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 10、扫码预授权完成撤销 CILRequest request = new CILRequest(); request.setAmount(transaction.getTransAmt());//原预授权完成交易金额 request.setBatchNum(transaction.getBatchNum());//原预授权完成交易批次号 request.setTraceNum(transaction.getTraceNum());//原预授权完成交易凭证（流水）号 request.setReferenceNumber(transaction.getRefNum());//原预授权完成交易参考号 CILSDK.revokePreAuthCompleteQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 11、单品券功能接入指引 注意：sdk v2.5.3及之后版本支持该功能 1. 扫码消费接口增加单品券核销功能，扫码消费接口增加入参两个参数，订单优惠标记（为配券时候的填的优惠标记）,商品列表； /** * 扫码消费 */ CILRequest request = new CILRequest(); request.setAmount(amount); request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） request.setOrderPromotionMark(orderPromotionMark);//订单优惠标记（类型String可选参数） request.setGoodsList(goodsList);//商品列表（类型String可选参数）详见下新增字段说明 CILSDK.consumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { // 处理扫码消费结果 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： /** * resultCode = response.getTrans().getRespCode(); * if (\"09\".equals(resultCode) ) { * CILSDK.queryQr(); // `queryQr` 方法见下文 * } */ } @Override public void onError(Parcelable cilRequest, Exception e) { // 扫码消费出错 } }); 新增字段说明 字段 类型 含义 是否可选 备注1 备注2 orderPromotionMark String 订单优惠标记 Y ans32 来源于配券时选填字段 goodsList String 商品列表 Y 最多9个商品 按照以下样例格式传输 报文样例： \"orderPromotionMark\":\"1111\", \"[ { \"goodsName\":\"小面包\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"1111\" }, { \"goodsName\":\"棒棒糖\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"2222\" }, { \"goodsName\":\"彩虹糖\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"3333\" }, { \"goodsName\":\"矿泉水\", \"price\":\"1\", \"goodsNum\":\"1\", \"goodsId\":\"4444\" } ]\" 响应报文新增一个CouponInfo的实例,内部包含属性字段有： 字段 类型 含义 是否可选 备注 couponId String 优惠券id Y couponName String 优惠券名称 Y channelContribution String 渠道出资 Y merchantContribution String 商家出资 Y otherContribution String 其它出资 Y discountType String 优惠类型 Y discountRange String 优惠范围 Y discountbatchaId String 优惠活动批次ID Y goodsList String 单品优惠商品列表 Y 单品优惠列表商品字段 字段 类型 含义 是否可选 备注 goodsBarCode String 商品条码号 Y goodsDiscount String 单品优惠金 Y CouponInfo响应报文样例： { \"MerchantContribution\":\"000000000100\", \"couponId\":\"9026256969\", \"couponName\":\"讯联满1.1减1 tag\", \"discountRange\":\"SINGLE\", \"discountType\":\"DISCOUNT\", \"discountbatchaId\":\"9803978\", \"goodsList\":\"[{\"goodsBarCode\":\"1111\",\"goodsDiscount\":\"000000000034\"}, {\"goodsBarCode\":\"2222\",\"goodsDiscount\":\"000000000034\"}, {\"goodsBarCode\":\"3333\",\"goodsDiscount\":\"000000000032\"}]\", \"otherContribution\":\"000000000000\" } 附：最多支持传入9个商品","text_tokens":["(","equals","调用"," ","goodslist","日期","出错","源于","结果","settracenum","订单","报文","入参","应答","传输","9803978","goodsdiscount","othercontribution","样例","方法","revokeconsumeqr","含义","包含","指引","底部","void","关单","时选","e","response","方式","preauthcompleteqr","的","格式","如","[","最多","配券","实际","次","98","setposinputstyle","返回","字段","setamount","*","tag","联满","setbatchnum","discountbatchaid","出来","setlimittime","支持","只","revauthcode","channelcontribution","returnconsumeqr","/","使用",".","支付","原预","10s","2222","填字","\"","之后","备注","详见","zxing","核销","setorderpromotionmark","金","出资","微信","对于","见下文","onresult","gettrans","8","code","2","是否","4","该","说明","sdk","则","有","矿泉水","v2.5","revokepreauthqr","或","gettracenum","为","4444","1","棒棒","如下","goodsnum","渠道","。","撤销","new","tradedate","onerror","pos","单品","setperiod","依赖","列表","preauthqr","注意","batchnum","...","setscancodeid","接口","参考","获取","parcelable","可选","gettransdate","transdate","商家","属性","二维","棒棒糖","、","金额","override","服务","传给","5","下文","一次","）","getposinputstyle","第三方","批次","id","callback","setgoodslist","优惠券","机器","revokepreauthcompleteqr","优惠活动","=","000000000032","goodsname","gettransamt","1111","名称","一个","setreferencenumber","，","消费","读卡","该笔","serialnum","y","setorderid","流水","11","矿泉","discountrange","泉水","两个","；","settransdatetime","最终","读出","6","000000000100","1.1","下","public","版本","single","getbatchnum","响应","`","相关","cilrequest","tracenum","新增","或者","单品券","curtrans","queryqrjustonce","3333","段","if","支付宝","及","凭证","consumeqr","需要","amount","@","增加","3","单号","第三","不","discounttype","原","外部","：","含","库","实例","9026256969","orderpromotionmark","以下","小面包","授权","request","模块","范围","是","面包","将","<","setoriginaltradedate","最","000000000034","二维码","查询","联扫码","彩虹","退货","讯","功能","类型","字","price","附",">","000000000000","活动","queryqr","voidqr","listener","discount","来源于","transaction","内部","个","见","]","10","goodsbarcode","resultcode","exception","getrespcode","如果","取消","10000l","输入","退款","（","merchantcontribution","getscancodeid","时候","}","ans32","result","couponid","传入","string","其它","标记","号","填","transamt","你","可","状态","7","可以","订单号","选","cilsdk",",","orderid","处理","9","couponinfo","参数","{",":","优惠","扫码","交易","多","商品","来源","按照","时间","码","预",")","接入","couponname","三方","param","cilresponse","但是","getrefnum","09","减","条码","糖","完成","读出来",";","refnum","goodsid"],"title":"扫码交易","title_tokens":["扫码","交易"]},{"location":"documentation/quik/#_5","text":"智能 POS SDK 分别提供了最多30天的 账单列表查询 和 账单统计接口 接口,接口会根据 type 值确定返回 银行卡账单 或 扫码账单 。 交易成功还是失败最终以返回账单中应答码为准，见 应答码表 。 交互设计建议：交易中，具体来说，调用CILSDK.consumeQr()或是CILSDK.consume()方法时，当因为网络中断进入onError callback时，建议在交互中加入 查询账单列表 的逻辑，这样交易失败后可方便收银员通过账单来确认这笔订单的实际状态。 注意：对于 09 （请求正在处理中）状态的交易账单数据，还需要看 处理标志位 才能判定此次交易成功与否，使用 getProcessFlag() 获取。 当 processFlag 为 '0' 时，此次交易成功；当 processFlag 为非'0' 时，此次交易失败，见 处理标志表 。 1、根据外部订单号获取该笔订单信息（同步） //outOrderNum为传入数据 CILSDK.getBillsAsync(outOrderNum, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }) 2、根据凭证号获取当前批次号下该笔订单详情(异步) /** * 依据凭证号，获取当前批次下的订单详情 回调在主线程 * 异步操作 * @param traceNum 凭证号 * @param listener */ CILSDK.getBillByTraceNum(traceNum, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 3、根据参考号获取当前批次下的订单详情（异步操作） /** * @param refNum 参考号 * @param callBackIsOnMainThread 是否在主线程中回调 */ CILSDK.getBillByRefNumAsync(refNum, callBackIsOnMainThread, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 4、根据批次号获取当前批次下的订单详情（异步操作） /** * @param refNum 批次号 * @param callBackIsOnMainThread 是否在主线程中回调 */ CILSDK.getBillByBatchNumAsync(batchNum, callBackIsOnMainThread, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 5、获取账单列表 1. 默认获取三十天的账单列表 /** * 获取账单列表 异步 * * @param int page 从0开始 * @param int size 每页返回的条数 * @param int type 账单类型(TransConstants.CARD_BILL, TransConstants.QR_BILL, TransConstants.ALL_BILL) * */ CILSDK.getBillsAsync(page, size, @BillType int type, new Callback<CILResponse>() { @Override public void onResult(final CILResponse response) { if (null != response && 0 == response.getStatus()) { //账单获取成功 Trans[] trans = response.getTxn(); //账单数据,字段详情见 Trans } } @Override public void onError(Parcelable p, Exception ex) { //账单获取出错 } }); 2. 获取指定区间的账单列表 /** * 获取账单列表 异步 * * @param page * @param size * @param startTime 查询订单开始时间，格式：yyyyMMdd * @param endTime 查询订单结束时间，格式：yyyyMMdd * @param type * @param callBackIsOnMainThread * @param listener * @return */ CILSDK.getBillsAsync(page, size, startTime, endTime, type, true, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 6、获取今日交易统计 /** * 获取今日交易统计 异步 * @param type 账单类型 * <ul> * <li>TransConstants.ALL_BILL:所有账单</li> * <li>TransConstants.CARD_BILL:银行卡账单</li> * <li>TransConstants.QR_BILL:扫码账单</li> * </ul> * */ CILSDK.getBillStatAsync(@BillType int type, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { if (null != response && 0 == response.getStatus()) { //今日交易统计获取成功 CILResponse.Info data = response.getData(); String transCount = data.getTransCount();//今日银行卡正向交易数量 String transAmtSum = data.getTransAmtSum();//今日银行卡正向总交易金额 String backTransCount = data.getBackTransCount();//今日银行卡负向交易数量 String backTransAmtSum = data.getBackTransAmtSum();//今日银行卡负向总交易金额 String sctTransCount = data.getSctTransCount();//今日扫码正向交易笔数 String sctTransAmtSum = data.getSctTransAmtSum();//今日扫码正向交易金额 String sctBackTransCount = data.getSctBackTransCount();//今日扫码负向交易笔数 String sctBackTransAmtSum = data.getSctBackTransAmtSum();//今日扫码负向交易金额 String tipsTransCount = data.getTipsTransCount();//今日收取小费笔数 String tipsTransAmtSum = data.getTipsTransAmtSum();//今日收取小费金额 } } @Override public void onError(Parcelable p, Exception ex) { //今日交易统计获取出错 } }); SDK 的网络部分使用的是第三方库 okhttp ,以上账单接口分别还提供了相对应的同步接口 getBills 和 getBillStat 。 对于异步接口来说,都会返回一个 Call 对象,你可以在应用出错的时候调用 call.cancel() 取消这次请求,以免造成内存泄露。","text_tokens":["字","(","应用","onresult","确认","gettranscount","这笔","getbillbyrefnumasync","调用",">","li","gettipstransamtsum","sctbacktransamtsum","processflag","billtype"," ","一个","backtransamtsum","2","出错","详情","来","是否","，","listener","和","中","该笔","值","cancel","泄露","订单","4","应答","非","建议","才能","transcount","在","时","依据","小费","信息","因为","见","网络","后","sdk","账单","方法","0","getstatus","以","方便","]","starttime","yyyymmdd","负向","收取","分别","scttransamtsum","card","对象","确定","为准","通过","；","条数","内存","exception","void","最终","判定","操作","或","标志","e","response","6","ul","以上","同步","或是","gettransamtsum","为","的","设计","qr","主线","程","getbacktransamtsum","取消","endtime","下","当前","p","!","[","ex","三十天","1","（","回调","final","指定","tipstransamtsum","public","call","银员","正向","向","结束","。","时候","天","callbackisonmainthread","transconstants","}","所有","笔数","okhttp","new","应","表","实际","传入","onerror","string","cilrequest","tracenum","收银","还","trans","pos","会","都","返回","了","每页","今日","列表","*","号","注意","银行卡","十天","进入","你","getbillbytracenum","可","状态","null","getbillstat","batchnum","可以","中断","异步","段","backtranscount","...","if","订单号","开始","getscttranscount","cilsdk","加入","接口","收银员","具体",",","数据","参考","获取","parcelable","consumeqr","getprocessflag","凭证","区间","还是","type","处理","transamtsum","需要","scttranscount","逻辑","请求","@","正在","tipstranscount","3","格式","单号","根据","成功","outordernum","/","提供","使用","第三","getbills","这次",".","30","失败","位","程中","{","：","外部","getsctbacktransamtsum",":","size","扫码","库","交易","多","return","page","造成","金额","bill","override","data","时间","码","'","是","getbillsasync","getbillbybatchnumasync","getbillstatasync","consume","5","&&",")","部分","<","info","统计","与否","负","getbacktranscount","三方","码表","gettxn","从","）","param","getsctbacktranscount","cilresponse","最","第三方","true","默认","这样","交互","以免","批次","gettipstranscount","银行","来说","getscttransamtsum","查询","all","09","数量","callback","三十","智能","总","相对","sctbacktranscount","对于","当","看","=","int","此次","getdata",";","_","refnum","类型","、","具体来说"],"title":"账单查询","title_tokens":["查询","账单"]},{"location":"documentation/quik/#_6","text":"注意: 通过对一笔交易收取小费。 小费最多收取交易金额的20% 小费只能成功收取一次 消费撤销后不能再次收取 1、小费 CILRequest request = new CILRequest(); request.setCardNum(cardNumber); request.setReferenceNumber(trans.getRefNum()); request.setBatchNum(trans.getBatchNum()); request.setTraceNum(trans.getTraceNum()); request.setTransDatetime(trans.getTransDatetime()); request.setRevAuthCode(trans.getRevAuthCode()); request.setAmount(amount);//小费金额 CILSDK.takeTip(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable parcelable, Exception e) { ... } }); 2、小费撤销 CILRequest request = new CILRequest(); request.setCardNum(cardNo); request.setAmount(trans.getTransAmt()); request.setReferenceNumber(trans.getRefNum()); request.setRevAuthCode(trans.getRevAuthCode()); request.setBatchNum(trans.getBatchNum()); request.setTraceNum(trans.getTraceNum()); request.setTransDatetime(trans.getTransDatetime()); CILSDK.revokeTip(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable parcelable, Exception e) { ... } });","text_tokens":["taketip","(","gettransamt","override","onresult","revoketip","20%","setamount","通过",">","注意","settransdatetime","exception","void"," ","gettracenum",")","<","e","gettransdatetime","不能","2","一笔","cardnumber","...","一次","setreferencenumber","的","setbatchnum","cilsdk","消费","settracenum","cilresponse","最","收取","再次",",","parcelable","cardno","getrevauthcode","1","对","getrefnum","setrevauthcode","amount","public","@","callback",";","。","成功","getbatchnum","撤销","/","小费","只能",".","setcardnum","}","后","new","{",":","=","onerror","交易","多","cilrequest","trans","金额","request","、"],"title":"小费","title_tokens":["小费"]},{"location":"documentation/quik/#_7","text":"结算需求主要用于每日交易结束时或收银员交接班时,对某段时间内的账款核对。商户每日交易结束后,收银员需要统计并核对所有的交易,核对交易统计准确后结算，打印出结算单。 结算会涉及到一个概念-- 批次号 ,我们在前面的交易都会传入一个批次号给 request ,调用结算之后,后续的交易需要将这个批次号加1,因为此批次已经打包结算掉了。 //batchNum 批次号 CILSDK.transSettleAsync(batchNum, new Callback<CILResponse>() { @Override public void onResult(final CILResponse response) { //打印结算单 } @Override public void onError(Parcelable cilRequest, Exception e) { //结算出错 } }); 如果使用讯联样式结算UI、逻辑直接使用 注意,使用SettleDaoUtil工具类是必须先初始化，SettleDaoUtil.getInstance().init(); SettleDaoUtil.getInstance().gotoLiquidation(context)","text_tokens":["(","onresult","调用",">"," ","一个","必须","初始","我们","getinstance","gotoliquidation","出错","，","打印","--","在","时","给","因为","后","transsettleasync","商户","settledaoutil","init","内","exception","void","如果","或","准确","讯联","主要","e","response","类","后续","段时间","的","到","1","final","涉及","public","号加","银员","结算","。","所有","}","某","new","每日","样式","传入","onerror","工具","cilrequest","收银","接班","并","会","交接班","都","了","号","注意","batchnum","先","用于","cilsdk","直接","收银员",",","结束","parcelable","对","需要","需求","逻辑","@","掉","/","使用",".","{","初始化","交易","此","概念","request","ui","override","是","时间","单","将",")","<","之后","统计","前面","cilresponse","打包","账款","出","批次","这个","交接","callback","核对","已经","context",";","、"],"title":"结算","title_tokens":["结算"]},{"location":"documentation/quik/#_8","text":"本模块可用于根据交易信息打印所需的消费票据。接口不仅提供了一套固定格式的小票样式，而且还可以根据需要自定义打印样式。 主要功能包括小票打印、二维码打印、条形码打印以及图片打印。 特别注意: 中国人民银行和中国银联为了规范市场上的POS机终端，要求终端打印的签购单必须合乎规范，规范内容包括必须打印的字段与正确的字段内容。 签购单规范详情见 签购单规范 打印银行卡类交易、扫码类交易小票 /** trans 交易信息,Trans类型 * lineBreak 小票结尾需要走纸换行的行数，int类型 * formatTransCode @FormatTransCode String类型，小票的交易类型 * kind @ReceiptSubtitle int类型，小票的子标题，判断是商户联或者是客户联 * isForeignTrans 是否是外卡类交易 * bitmap logo图标，没有直接传null */ CILSDK.printKindsReceipts(trans,lineBreak,formatTransCode, kind, isForeignTrans, bitmap, new Callback<PrinterResult>(){ @Override public void onResult(PrinterResult response) { if (null ！= printerResult && !\"打印成功\".equals(printerResult.toString())) { //打印成功 } } @Override public void onError(Parcelable cilRequest, Exception e) { //打印失败 } }); 打印结算小票 /** * 打印结算小票 * * transSettles 结算信息List * transDatetime 结算时间 * lineBreak 打印结尾换行数 * formatTransCode 结算类型；TransConstants.TRANS_SETTLE_DETAILS：结算详情小票；TransConstants.TRANS_SETTLE_TOTAL：结算统计小票 * callback 回调 */ CILSDK.printSettleReceipts(transSettles, transDatetime,batchNum, lineBreak, formatTransCode, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 自定义打印 注意：使用自定义打印方法时，若打印内容超过2000个字符，请使用分段打印方式，否则可能出现DeviceRTException /** * 根据二进制数据打印(根据打印规范用户自定义打印小票样式) * * buffer 打印内容 * lineBreak 换行数 * callback 回调 */ CILSDK.printBufferReceipt(buffer, lineBreak,new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印二维码 /** * 打印二维码 * * qrCode 二维码内容 * position 打印位置 0:左对齐；1居中；2：右对齐 * width 二维码宽度 * callback 回调 * */ CILSDK.printQRCode(qrCode,position,width,lineBreak,new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印条形码 /** * 打印条形码 * * barCode 条形码数字 * position 条形码位置 0:左对齐；1居中；2：右对齐 * lineBreak 换行数 * callback 回调 */ CILSDK.printBarCode(String barCode, int position, int lineBreak, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印图片 /** * 打印图片 * * bitmap 图片Bitmap * lineBreak 换行数 * offset 偏移量 * callback 回调 * */ CILSDK.printImage(bitmap, lineBreak, offset, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } });","text_tokens":["字","(","位置","onresult","银联","equals",">","中国人民银行"," ","必须","是否是","合乎","2","详情","是否","，","与","total","数字","消费","和","打印","details","printimage","kind","可能","规范市场","终端","width","时","信息","见","0","方法","联","printqrcode","没有","而且","商户","transsettles","需","若","外卡","一套","；","对齐","exception","position","logo","void","行数","自定","个字符","主要","规范","bitmap","response","类","e","方式","printbufferreceipt","左","的","条形码","printerresult","特别","格式","!","偏移量","settle","1","回调","public","请","结算","。","进制","自定义","定义","}","transconstants","result","new","签购","样式","qrcode","string","onerror","formattranscode","结尾","cilrequest","trans","还","pos","以及","或者","了","本","*","注意","银行卡","图标","判断","票据","传","2000","可","子标题","null","batchnum","可以","段","用于","if","用户","图片","偏移","二进制","cilsdk","直接","！","市场","形码","接口","printkindsreceipts",",","数据","固定","parcelable","否则","人民","需要","transdatetime","printsettlereceipts","@","要求","根据",";","成功","数","/","提供","使用","宽度","上",".","走纸","tostring","失败","{","：",":","扫码","二维","交易","交易类型","出现","linebreak","override","模块","是","时间","内容","list","所","机","超过","单","&&","offset",")","barcode","\"","条形","<","统计","标题","中国银联","receiptsubtitle","buffer","devicertexception","国人","二维码","客户","银行","小票","中国","callback","不仅","居中","右","换行","为了","isforeigntrans","=","int","分段","printbarcode","包括","功能","_","字符","类型","、","正确"],"title":"打印","title_tokens":["打印"]},{"location":"documentation/quik/#_9","text":"考虑到使用 SDK 的时候可能还会有其他需求,比如 获取 POS 机的 SN 号 、 设置密钥索引 等,在这里,我们也提供了一部分接口。 获取 SDK 版本 //版本名 String versionName = CILSDK.VERSION_NAME; //版本号 int versionCode = CILSDK.VERSION_CODE; 获取 SN 号 //SN号 String snCode = CILSDK.getDeviceSN(); 设置流水号 //serialNum范围：1~999999 boolean isSuccess = CILSDK.setSerialNum(int serialNum); 获取流水号 //序列号 int serialNum = CILSDK.getSerialNum(); 设置批次号 //batchNum范围：1~999999 boolean isSuccess = CILSDK.setBatchNum(int batchNum); 获取批次号 //批次号 int batchNum = CILSDK.getBatchNum(); 设置联迪密钥区 //1-15的设值范围 CILSDK.setTingA8KeyIndex(2); 设置密钥索引 //分别对应MAIN MAC PIN MES //1-255的设值范围 //可以使用下方提供数值,也可以根据自身程序设值 CILSDK.setTingKeyIndex(4,101,10,150); 以上两个方法请在连接刷卡器(CILSDK.connect)之前使用 工具类 CILPayUtil /** * 将respCode翻译成对应中文解释 */ CILPayUtil.translate(context, respCode)); /** * 将Trans类中的transCode翻译成打印所需的对象 */ CILPayUtil.getFormatTransCode(transCode); /** * 根据billingCurr判断交易是否为外卡类的DCC交易 */ CILPayUtil.isDCCPay(billingCurr); /** * 判断交易是否成功 */ CILPayUtil.isTransSuccess(trans); /** * 根据Trans类中的transCode判断交易是否属于扫码类交易 */ CILPayUtil.isQrPay(transCode); ReceiptFormatUtils /** * 根据Trans类中的TransCode翻译成对应的中文解释 */ ReceiptFormatUtils.getTransType(transCode); /** * 将明文的卡号修改为\"前六后四中间为四个*\"的样式 */ ReceiptFormatUtils.handleCardNum(cardNum); 许可证 Copyright (c) 2016 cardinfolink.com JAVADOC java document 详情见 javadoc","text_tokens":["(","sn"," ","属于","一部","我们","code","2","详情","是否","中间","255","serialnum","打印","java","4","可能","流水","下方","在","respcode","卡号","部分","见","sdk","setserialnum","方法","10","中文","version","有","密钥","翻译成","versionname","分别","两个","对象","main","需","外卡","解释","handlecardnum","等","许可","getformattranscode","考虑","以上","类","c","也","999999","的","为","isdccpay","四","connect","到","mac","前六后","1","序列","许可证","gettranstype","翻译","版本","cardinfolink","请","。","getbatchnum","时候","区","设值","刷卡","样式","程序","string","工具","名","settinga8keyindex","trans","pos","javadoc","版本号","了","settingkeyindex","*","号","com","判断","batchnum","pin","可以","billingcurr","其他","15","cilsdk","setbatchnum","接口",",","获取","translate","versioncode","修改","需求","101","连接","译成","刷卡器","根据","四个","成功","document","/","使用","提供","对应",".","流水号","2016","：","扫码","交易","-","150","boolean","设置","联迪","这里","之前","transcode","范围","所","机","sncode","getdevicesn",")","将","\"","cardnum","类中","name","getserialnum","receiptformatutils","~","mes","cilpayutil","一部分","序列号","批次","还会","比如","issuccess","dcc","istranssuccess","copyright","=","int","索引","数值","context",";","_","isqrpay","自身","、","明文"],"title":"其他设置","title_tokens":["其他","设置"]},{"location":"documentation/sdkapi/","text":"快速体验 讯联智能 POS SDK 为开发者准备了一个简单的 demo 程序,可以快速体验 SDK 接入流程。可以在这里 下载demo 。 下载 POS-demo 之后将整个目录导入到您的 Android Studio 之中。 快速集成 为了方便 SDK 的集成使用，本 SDK 已使用 jcenter 托管，配置如下 gradle: implementation 'com.cardinfolink.smart.pos:PosSDK:2.5.2' or maven: <dependency> <groupId>com.cardinfolink.smart.pos</groupId> <artifactId>PosSDK</artifactId> <version>2.5.2</version> <type>pom</type> </dependency> 如果想使用讯联集成的结算UI和逻辑，请配置 gradle: implementation 'com.cardinfolink.smart.pos:SDK-ZaiHui:1.1.1' or maven: <dependency> <groupId>com.cardinfolink.smart.pos</groupId> <artifactId>SDK-ZaiHui</artifactId> <version>1.1.1</version> <type>pom</type> </dependency> 读卡、输入密码的颜色取自colorPrimary。如果需要自定义样式，请参考 Demo ，下载源码修改 注意：1.1.1版本直接指定了PosSDK的版本号，不再使用默认最新版的PosSDK，如非必要，不要再配置PosSDK的版本 连接POS机 使用 N900 智能 POS 机器, 我们的应用首先需要连接 POS 机硬件, 使用 SDK 提供的 connect 方法连接。 建议在 Application 的 onCreate 方法中进行连接。 @Override public void onCreate() { super.onCreate(); ... CILSDK.setDebug(true);//发版时请改为 false CILSDK.connect(this); ... } 如果还适配了联迪A8设备的，联迪设备login需要传入activity的context, 建议在 主activity onCreate中 再调用 CILSDK.connect(this); 如果没有与app生命周期一致的activity,建议在每个可能调用设备刷卡、加密、打印的activity中再调用 CILSDK.connect(this)， 保证使用过程中设备连接不断开；另外推荐在ActivityLifecycleCallbacks中处理设备连接。 激活POS机 a、新激活接口（推荐） 根据用户反馈，为了简化激活流程，我们采取激活码的方式激活，当你拿到 POS 机器之后，我们会为这个商户发放激活码，一个激活码可以激活一台 POS 机。 成功激活后，接口会返回商户号，终端号等信息，后续参数下载需要用到。 注意:一台终端能且仅能成功激活一次,无法重复进行激活操作。若有多次激活的需求(如debug阶段),请联系讯联客服。 //authCode 激活码（建议用扫码的方式得到激活码，避免让用户手输） CILSDK.activeWithCode(authCode, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { if (cilResponse.getStatus() == 0) { //激活成功 } else { //激活失败，失败原因见 cilResponse.getMessage() } } @Override public void onError(Parcelable cilRequest, Exception e) { //激活出错 } }); b、旧激活接口 第一次使用智能 POS 终端的时候,需要使用讯联下发的商户号 merCode 和终端号 termCode 激活, 激活成功之后才能正常使用后面的交易流程。 注意:一台终端能且仅能成功激活一次,无法重复进行激活操作。若有多次激活的需求(如debug阶段),请联系讯联客服。推荐APP本身能够保持设备是否已经激活标志 //merCode 讯联下发的商户号 //termCode 讯联下发的终端号 CILSDK.active(merCode, termCode, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { if (cilResponse.getStatus() == 0) { //激活成功 } else { //激活失败 } } @Override public void onError(Parcelable p, Exception e) { //激活出错 } }); 终端参数下载 激活成功之后,你的应用还需要下载一些交易时使用的参数,比如 交易地址和端口 、 交易超时时间 、 终端支持的功能 、 TPDU 等, 在你拿到 POS 终端之前,这些参数都会在讯联后台已经配置好,全部参数见 CILResponse.Info 返回值。下载成功之后 SKD 会 以json字符串的形式保存这些参数到 SharedPreference (请不要擅自改动这些参数值,以免导致交易失败) 。当然,在 onResult 中也会返回,你也可以自己选择性保存一些参数。另外, SDK 保存在 SharedPreference 里的值会提供接口 CILSDK.getSystemParams() 获取。 注意：正常情况下，此方法只需执行成功一次，但是后台参数配置可能会有改动，APP本身需要调用预留功能调用此方法 //merCode 讯联下发的商户号 激活成功之后可以确定商户号 //termCode 讯联下发的终端号 激活成功之后可以确定终端号 CILSDK.downloadParams(merCode, termCode, new com.cardinfolink.pos.listener.Callback<CILResponse>() { @Override public void onResult(CILResponse response) { if (0 == response.getStatus()) { //参数下载成功,具体返回的参数见 response.Info } else { //参数下载错误 } } @Override public void onError(Parcelable p, Exception e) { //下载出错 } }); 终端密钥下载 终端密钥下载只需要成功执行一次就可以,成功下载的密钥会被转载到POS硬件模块里面,后面就不需要再次调用了,建议你的应用可以在成功下载密钥之后持久化一个标志位, 下次进入应用就不再去下载密钥了。整个过程可能会需要1~2分钟左右(依赖当前的网络状况),会经历以下步骤: 请求讯联网关 RSA -> 装载 RSA -> 请求主密钥 -> 装载主密钥 -> 启用主密钥 -> 请求工作密钥(签到) -> 装载工作密钥 -> 下载 AID -> 装载 AID -> 下载 IC 公钥 -> 装载 IC 公钥。 建议APP本身存储设备是否已经初始化方法标志。 注意：此方法一般只需要安装后成功调用一次即可。但银行交互密钥有可能会更新，APP本身需要调用预留功能调用此方法 CILSDK.downloadParamsWithProgress(new ProgressCallback<CILResponse>() { @Override public void onProgressUpdate(int progress) { //progress下载密钥的进度 } @Override public void onResult(CILResponse response) { if (0 == response.getStatus()) //密钥下载成功。在这里可以持久化一个标志位 } @Override public void onError(Parcelable p, Exception e) { //下载密钥出错 } }); 签到 签到其实也就是更新工作密钥的一个过程 ( 下载工作密钥+装载工作密钥 ),讯联网关平台要求应用需要每天签到一次。 CILSDK.signIn(new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { //签到成功 } @Override public void onError(Parcelable cilRequest, Exception e) { //签到出错 } }); 发起交易 SDK 将交易分为 银行卡交易 (刷卡、插卡和挥卡)和 扫码交易 (支付宝和微信)两种。银行卡相关交易需要POS机硬件模块读卡器,扫码相关交易则不需要。 a、银行卡交易 由于银行卡交易逻辑有点复杂,讯联提供了一个 BaseCardActivity 基础类,你只需要继承这个类便可以做银行卡类的交易了。具体使用方法可以见 demo 里的 CommonCardHandlerActivity 类。下面给个大概说明: public class CommonCardHandlerActivity extends BaseCardActivity { @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); //... } /** * 必须传入金额 * * @return */ public String getAmount() { //在这里传入金额 } /** * 此方法为控制sdk内部是否开启DCC交易逻辑（sdk2.4.1版本及以上支持该方法） * *@return 需要进行DCC交易时，返回true，否则返回false */ public boolean isOpenDcc() { //只有刷卡消费和刷卡预授权才支持DCC交易 //如果接入方无需支持DCC，则此方法返回false即可 return false; } /** * 读卡的结果（sdk2.4.1版本及以上新增RateInfo参数，返回DCC读卡流程中进行汇率查询的结果） * * @param isSuccess 是否成功 * @param cardType 卡片种类(-1(unknow) 1(msc) 2(ic) 3(nfc) 4(scancode) 5(other)) * @param cardInfo 读取卡片信息 * @param rateInfo 汇率信息 */ public void cardReaderHandler(boolean isSuccess, @CardType.Type int cardType, CardInfo cardInfo, RateInfo rateInfo){ //读卡成功后才发起交易 if (!isSuccess || cardInfo == null) { Toast.makeText(getApplicationContext(), \"读卡失败\", Toast.LENGTH_SHORT).show(); initCardEvent(); return; } //1. 根据银联85号文规定，智能终端需上送经度，纬度，坐标系信息到卡组织 CILRequest request = new CILRequest(); request.setLongitude(121.600228);//设置经度 request.setLatitude(31.180606);//设置纬度 request.setCoordinates(\"GCJ02\");//设置坐标系 //关于坐标系，国内一些常用第三方取值：百度（BD09），高德、腾讯（GCJ02），GPS（WGS84）。 //一般第三方定位SDK都能从定位后返回的位置信息类中取到，详细可查看各第三方接入文档。 //2.如果接入方需要进行DCC交易，需将汇率信息填入request中，否则无需处理 CILRequest request = new CILRequest(); ... if (rateInfo != null) { request.setBillingAmt(rateInfo.getBillingAmt());//设置扣账金额 request.setBillingCurr(rateInfo.getBillingCurr());//设置扣账币种 request.setTransRate(rateInfo.getTransRate());//设置交易汇率 request.setBatchNum(rateInfo.getBatchNum());//设置汇率请求批次号 request.setTraceNum(rateInfo.getTraceNum());//设置汇率请求流水号 } //3. 在这里面发送银行卡相关的交易(如消费、消费撤销、退货、预授权、预授权撤销、预授权完成、预授权完成撤销、余额查询) //CILSDK.consume(request, cardType, new Callback<CILResponse>() //消费 } /** * 显示读卡时的缓冲页面 */ public void waitLoadingShow(){ } /** * 取消读卡时的缓冲页面 */ public void waitLoadingDismiss(){ } /** * 读卡失败 */ public void cardHandlerError(Exception e){ } } 注意: 调用银行卡类交易接口时，需要传入CILRequest以及CardType，且所有接口中CILRequest均需要传入以下信息： /** * @param: request:请求信息 * @param: cardType:卡片类型 */ request.setAmount(amount);//消费金额 /** * 刷卡获取的cardInfo信息 */ request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPinEmv(cardInfo.getPinBins());//卡bin request.setCardSequenceNumber(cardInfo.getSequenceSerialNum());//卡片序列号 request.setField55(cardInfo.getField55());//55域信息 request.setSecondTrack(cardInfo.getTrack2());//二磁道信息 request.setOrderId(orderId);//可选参数。（消费、退货、预授权、预授权完成、扫码下单、扫码退货） request.setLocation(location)//有终端具备获取位置信息能力时必选上送（ 用于消费 预授权） 1、消费 消费接口 request必须包含参数: CILSDK.consume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 2、撤销 撤销接口 request必须包含参数: /** * 撤销接口除基础信息外， * 还需要原交易信息 */ request.setReferenceNumber(transaction.getRefNum());//原交易参考号 request.setRevAuthCode(transaction.getRevAuthCode());//原交易授权码 request.setBatchNum(transaction.getBatchNum());//原交易批次号 request.setTraceNum(transaction.getTraceNum());//原交易凭证号 CILSDK.revokeConsume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 3、退货 退货接口 request必须包含参数: /** * 退货接口除基础信息外 * 还需要原交易信息 */ request.setReferenceNumber(referenceNumber); request.setTransDatetime(tradeDate); CILSDK.returnConsume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 4、余额查询 余额查询接口 request必须包含参数: CILSDK.checkBalance(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 5、卡预授权 预授权接口 request必须包含参数: request.setLocation(location)//有终端具备获取位置信息能力时必选上送（ 用于消费 预授权） CILSDK.preAuth(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 6、卡预授权撤销 预授权撤销接口 request必须包含参数: /** * 预授权撤销接口除基础信息外 * 还需要原预授权交易信息 */ request.setRevAuthCode(authCode);//原预授权交易授权码 request.setTransDatetime(originalTradeDate);//原预授权交易日期 CILSDK.revokePreAuth(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 7、卡预授权完成 预授权完成接口 request必须包含参数: /** * 预授权完成接口除基础信息外 * 还需要原预授权交易信息 */ request.setRevAuthCode(authCode);//原预授权交易授权码 request.setTransDatetime(originalTradeDate);//原预授权交易日期 CILSDK.preAuthComplete(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 8、卡预授权完成撤销 预授权完成撤销接口 request必须包含参数: /** * 预授权完成撤销接口除基础信息外 * 还需要原预授权完成交易信息 */ request.setReferenceNumber(refNum);//原预授权完成交易参考号 request.setRevAuthCode(authCode);//原预授权完成交易授权码 request.setTraceNum(traceNum);//原预授权完成交易凭证号 request.setBatchNum(batchNum);//原预授权完成交易批次号 request.setTransDatetime(originalTradeDate);//原预授权完成交易日期 CILSDK.revokePreAuthComplete(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 9、DCC转EDC 当交易卡片为外卡时，消费类（消费、预授权完成）交易可选择进行DCC转EDC。 CILRequest request = new CILRequest(); request.setCardNum(cardNum);//卡号 request.setTransDatetime(datetime);//原交易时间 request.setAmount(amount);//原交易金额 request.setBillingAmt(biilingAmt);//原扣币金额 request.setReferenceNumber(refNum);//原交易参考号 request.setRevAuthCode(revAuthCode);//原交易授权码 request.setBatchNum(batchNum);//原交易批次号 request.setTraceNum(traceNum);//原交易凭证号 request.setTransCurr(transCurr);//原交易币种 request.setBillingCurr(billingCurr);//原交易扣款币种 CILSDK.dccToEdc(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable p, Exception e) { ... } }); 交易结果字段说明 字段 类型 含义 备注 备注 additionalResData String 受理方标识码 无 afterTransCode String 原交易类型 无 batchNum String 批次号 无 billingAmt String 持卡人扣帐金额 无 billingCurr String 持卡人扣帐货币代码符号，三位字母 例如USD billingCurrNum String 持卡人扣帐货币代码,三位数字 无 cardBrand String 国际信用卡公司代码 无 cardNo String 银行卡号 无 cardType String 刷卡方式 无 cashierName String 收银员 无 cashierNum String 收银员号 无 clearingDate String 清算日期 无 compInfoA1 String 签购单收单行 无 compInfoA2 String 签购单商户号 无 compInfoA3 String 签购单终端号 无 compInfoA4 String markup 无 compInfoA6 String 借贷记标识 无 compInfoA7 String 营销信息 无 compInfoA8 String 二维码信息 无 coupon String 支付宝/微信优惠金额 无 field55 String IC卡交易的TAG信息 无 insCode String 受理方标识码 无 localTransDate String 受卡方所在地日期 无 localTransTime String 受卡方所在地时间 无 merCode String 受卡方标识码（商户号） 无 merDiscount String 商家优惠金额 无 originTraceNum String 原交易凭证号 无 outOrderNum String 外部订单号 无 posInputStyle String 服务点输入方式码 无 processflag String 扫码支付09状态的交易是否成功 附件表1 refNum String 检索参考号 无 respCode String 应答码 \"00\"表示成功 revAuthCode String 授权标识应答码 无 revInsCode String 附加响应数据 无 revOrderNum String 自定义域，用于扫码支付业务。 无 scanCodeId String 扫码号 无 termCode String 终端号 无 traceNum String 受卡方系统跟踪号 合作方交易流水 transAmt String 交易金额 无 transCode String 交易类型码 无 transCurr String 交易货币代码 无 transDate String 原交易日期 无 transDatetime String 受卡方所在地日期＋受卡方所在地时 无 transRate String 持卡人扣帐汇率 无 10、CFCardSDK工具类 如果不需要自定义刷卡类、密码键盘样式。银行卡交易可直接使用CFCardSDK方法，在调用的Activity中onActivityResult中接收交易结果 /** * 银行卡消费 * * @param context context对象 * @param amount 消费金额 */ CFCardSDK.consumeOfBank(context, amount); /** * 银行卡撤销 * * @param context context对象 * @param trans 原交易信息 */ CFCardSDK.cancelOfBank(context, trans); /** * 银行卡退货 * * @param context context对象 * @param refNum 参考号 * @param tradeDate 交易时间 * @param tradeAmount 交易金额 */ CFCardSDK.refundOfBank(context,refNum,tradeDate,tradeAmount); /** * 银行卡余额查询 * * @param context context对象 */ CFCardSDK.balanceOfBank(context); /** * 预授权 * * @param context context对象 * @param amount 预授权金额 */ CFCardSDK.preAuth(context,amount); /** * 预授权撤销 * * @param context context对象 * @param amount 预授权金额 * @param tradeDate 预授权时间 * @param revAuthCode 授权码 */ CFCardSDK.preAuthCancel(context,amount,tradeDate,revAuthCode) ; /** * 预授权完成 * * @param context context对象 * @param amount 预授权金额 * @param tradeDate 预授权时间 * @param revAuthCode 授权码 */ CFCardSDK.preAuthComp(context, amount,tradeDate,revAuthCode) /** * 预授权完成撤销 * * @param context context对象 * @param trans 原预授权完成交易 */ CFCardSDK.preAuthCompCancel(context,trans) ; /** * dcc转edc * * @param context context对象 * @param trans 原交易 */ CFCardSDK.dcc2edc(context,trans); onActivityResult(int requestCode, int resultCode, Intent data) 信息含义与Extra信息获取方式 返回信息包括 resultCode 取值范围 Constants.RESULT_OK : 0x555;//交易有结果返回，但不代表本笔交易成功 Constants.RESULT_ERROR : 0x666;//交易出现异常 交易类型： int transType = intent.getIntExtra(Constants.TRANS_TYPE, Constants.UNKNOWN); transType 取值范围： Constants.BANK_CONSUME : 0x001; // 消费 Constants.QR_CONSUME : 0x002; // 扫码 Constants.DCC_TO_EDC : 0x003; // dcc转edc Constants.QR_CANCEL : 0x004; // 扫码撤销 Constants.BANK_CANCEL : 0x005; // 撤销 Constants.BANK_REFUND : 0x006; // 退货 Constants.BANK_BALANCE : 0x007; // 余额查询 Constants.BANK_AUTH : 0x008; // 预授权 Constants.BANK_AUTH_CANCEL : 0x009; // 预授权撤销 Constants.BANK_AUTH_COMP : 0x010; // 预授权完成 Constants.BANK_AUTH_COMP_CANCEL : 0x011; // 预授权完成取消 Constants.FROM_BANK_REFUND_ACTIVITY : 0x012; // 银行卡退货 Constants.FROM_QR_REFUND_ACTIVITY : 0x013; // 扫码退货 Constants.FROM_TIP_TAKE_ACTIVITY : 0x014; // 收取小费 Constants.FROM_TIP_REVOKE_ACTIVITY : 0x015; // 小费撤销 交易结果 当resultCode == Constants.RESULT_OK时，会有结果返回 Trans trans = data.getParcelableExtra(Constants.CONSUME_RESULT); Intent中Extra信息的Key由com.cardinfolink.sdk.constant.Constants获取 b、扫码交易 扫码相关的交易则是不依赖 POS 机器的读卡模块的,但是你需要将 微信 或者 支付宝 的二维码读出来传给扫码消费接口,扫码可以使用第三方库,如 zxing 。 /** * 扫码消费 */ CILRequest request = new CILRequest(); request.setAmount(amount); request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） CILSDK.consumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { // 处理扫码消费结果 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： /** * resultCode = response.getTrans().getRespCode(); * if (\"09\".equals(resultCode) ) { * CILSDK.queryQr(); // `queryQr` 方法见下文 * } */ } @Override public void onError(Parcelable cilRequest, Exception e) { // 扫码消费出错 } }); /** * 扫码撤销 */ request.setAmount(amount);//原交易金额 request.setBatchNum(batchNum);//原交易批次号 request.setTraceNum(traceNum);//原交易凭证(流水)号 request.setReferenceNumber(refNum); //原交易参考号 CILSDK.revokeConsumeQr(request, new Callback<CILResponse>()）{ ... } /** * 扫码退货 */ request.setAmount(amount);//退款金额 request.setReferenceNumber(serialNum);//原交易参考号 request.setTransDatetime(tradeDate);//原交易时间 CILSDK.returnConsumeQr(request, new Callback<CILResponse>()） /** * 扫码查询 */ request.setBatchNum(response.getTrans().getBatchNum()); request.setTraceNum(response.getTrans().getTraceNum()); request.setPeriod(10000L);//10s request.setLimitTime(6);//6 次 request.setReferenceNumber(response.getTrans().getRefNum()); request.setPosInputStyle(response.getTrans().getPosInputStyle()); request.setScanCodeId(response.getTrans().getScanCodeId()); request.setAmount(response.getTrans().getTransAmt()); CILSDK.queryQr(request, new Callback<CILResponse>() { ... } /** * 扫码消费查询,只查询一次，不含取消接口 * * @param request * @param listener */ CILRequest request = new CILRequest(); request.setBatchNum(response.getTrans().getBatchNum()); request.setTraceNum(response.getTrans().getTraceNum()); request.setReferenceNumber(response.getTrans().getRefNum()); request.setPosInputStyle(response.getTrans().getPosInputStyle()); request.setScanCodeId(response.getTrans().getScanCodeId()); public static void queryQrJustOnce(CILRequest request, Callback<CILResponse> listener) { ... } /** * 扫码取消 * 对于09状态的消费订单，最终需要取消、关单 * @param request * @param listener */ CILRequest cilRequest = new CILRequest(); cilRequest.setOriginalTradeDate(response.getTrans().getTransDate()); cilRequest.setAmount(response.getTrans().getTransAmt()); cilRequest.setBatchNum(response.getTrans().getBatchNum()); cilRequest.setTraceNum(response.getTrans().getTraceNum()); cilRequest.setPosInputStyle(response.getTrans().getPosInputStyle()); cilRequest.setReferenceNumber(response.getTrans().getRefNum()); public static void voidQr(CILRequest request, Callback<CILResponse> listener) { ... } /** * 扫码预授权 */ CILRequest request = new CILRequest(); request.setAmount(amount); request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） CILSDK.preAuthQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { // 处理扫码预授权结果 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： /** * resultCode = response.getTrans().getRespCode(); * if (\"09\".equals(resultCode) ) { * CILSDK.queryQr(); // `queryQr` 方法见下文 * } */ } @Override public void onError(Parcelable cilRequest, Exception e) { //扫码预授权出错 } }); /** * 扫码预授权撤销 */ CILRequest request = new CILRequest(); request.setAmount(transAmt);//原预授权交易金额 request.setReferenceNumber(revAuthCode);//原预授权交易参考号 request.setTransDatetime(transDate);//原预授权交易时间 request.setBatchNum(curTrans.getBatchNum());//原预授权交易批次号 request.setTraceNum(curTrans.getTraceNum());//原预授权交易凭证（流水）号 CILSDK.revokePreAuthQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); /** * 扫码预授权完成 */ CILRequest request = new CILRequest(); request.setAmount(transAmt);//原预授权交易金额 request.setReferenceNumber(revAuthCode);//原预授权交易参考号 request.setTransDatetime(transDate);//原预授权交易时间 CILSDK.preAuthCompleteQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); /** * 扫码预授权完成撤销 */ CILRequest request = new CILRequest(); request.setAmount(transaction.getTransAmt());//原预授权完成交易金额 request.setBatchNum(transaction.getBatchNum());//原预授权完成交易批次号 request.setTraceNum(transaction.getTraceNum());//原预授权完成交易凭证（流水）号 request.setReferenceNumber(transaction.getRefNum());//原预授权完成交易参考号 CILSDK.revokePreAuthCompleteQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); 账单查询 智能 POS SDK 分别提供了近7天的 账单列表查询 和 账单统计接口 接口,接口会根据 type 值确定返回 银行卡账单 或 扫码账单 。 交易成功还是失败最终以返回账单中应答码为准，见 应答码表 。 交互设计建议：交易中，具体来说，调用CILSDK.consumeQr()或是CILSDK.consume()方法时，当因为网络中断进入onError callback时，建议在交互中加入 查询账单列表 的逻辑，这样交易失败后可方便收银员通过账单来确认这笔订单的实际状态。 注意：对于 09 （请求正在处理中）状态的交易账单数据，还需要看 处理标志位 才能判定此次交易成功与否，使用 getProcessFlag() 获取。 当 processFlag 为 '0' 时，此次交易成功；当 processFlag 为非'0' 时，此次交易失败，见 处理标志表 。 /** * 获取账单列表 异步 * * @param page 从0开始 * @param size 每页返回的条数 * @param type 账单类型 * <ul> * <li>TransConstants.CARD_BILL:银行卡账单</li> * <li>TransConstants.QR_BILL:扫码账单</li> * </ul> * */ CILSDK.getBillsAsync(page, size,@BillType int txnType, new Callback<CILResponse>() { @Override public void onResult(final CILResponse response) { if (null != response && 0 == response.getStatus()) { //账单获取成功 Trans[] trans = response.getTxn(); //账单数据,字段详情见 Trans } } @Override public void onError(Parcelable p, Exception ex) { //账单获取出错 } }); /** * 获取账单统计信息 异步 * @param type 账单类型 * <ul> * <li>TransConstants.ALL_BILL:所有账单</li> * <li>TransConstants.CARD_BILL:银行卡账单</li> * <li>TransConstants.QR_BILL:扫码账单</li> * </ul> * */ CILSDK.getBillStatAsync(@BillType int txnType, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { if (null != response && 0 == response.getStatus()) { //账单获取成功 } } @Override public void onError(Parcelable p, Exception ex) { //账单获取出错 } }); /** * 依据凭证号，获取当前批次下的订单详情 * 异步操作 * * @param traceNum 凭证号 * @param listener * @return * @throws Exception */ CILSDK.getBillByTraceNumAsync(String traceNum, new Callback<CILResponse>(){ ... }); SDK 的网络部分使用的是第三方库 okhttp ,以上账单接口分别还提供了相对应的同步接口 getBills 和 getBillStat 。 对于异步接口来说,都会返回一个 Call 对象,你可以在应用出错的时候调用 call.cancel() 取消这次请求,以免造成内存泄露。 结算 结算需求主要用于每日交易结束时或收银员交接班时,对某段时间内的账款核对。商户每日交易结束后,收银员需要统计并核对所有的交易,核对交易统计准确后结算，打印出结算单。 结算会涉及到一个概念-- 批次号 ,我们在前面的交易都会传入一个批次号给 request ,调用结算之后,后续的交易需要将这个批次号加1,因为此批次已经打包结算掉了。 //batchNum 批次号 CILSDK.transSettleAsync(batchNum, new Callback<CILResponse>() { @Override public void onResult(final CILResponse response) { //打印结算单 } @Override public void onError(Parcelable cilRequest, Exception e) { //结算出错 } }); 如果使用讯联样式结算UI、逻辑直接使用 注意,使用SettleDaoUtil工具类是必须先初始化，SettleDaoUtil.getInstance().init(); SettleDaoUtil.getInstance().gotoLiquidation(context) 打印 本模块可用于根据交易信息打印所需的消费票据。接口不仅提供了一套固定格式的小票样式，而且还可以根据需要自定义打印样式。 主要功能包括小票打印、二维码打印、条形码打印以及图片打印。 特别注意: 中国人民银行和中国银联为了规范市场上的POS机终端，要求终端打印的签购单必须合乎规范，规范内容包括必须打印的字段与正确的字段内容。 签购单规范详情见 签购单规范 打印银行卡类交易、扫码类交易小票 /** trans 交易信息 * lineBreak 小票结尾需要走纸换行的行数 * formatTransCode @FormatTransCode String类型，小票的交易类型 * kind @ReceiptSubtitle int类型，小票的子标题，判断是商户联或者是客户联 * isForeignTrans 是否是外卡类交易 */ CILSDK.printKindsReceipts(trans,lineBreak,formatTransCode, kind, isForeignTrans, new Callback<PrinterResult>(){ @Override public void onResult(PrinterResult response) { if (null ！= printerResult && !\"打印成功\".equals(printerResult.toString())) { //打印成功 } } @Override public void onError(Parcelable cilRequest, Exception e) { //打印失败 } }); 打印结算小票 /** * 打印结算小票 * * transSettles 结算信息List * transDatetime 结算时间 * lineBreak 打印结尾换行数 * formatTransCode 结算类型；TransConstants.TRANS_SETTLE_DETAILS：结算详情小票；TransConstants.TRANS_SETTLE_TOTAL：结算统计小票 * callback 回调 */ CILSDK.printSettleReceipts(transSettles, transDatetime,batchNum, lineBreak, formatTransCode, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 自定义打印 注意：使用自定义打印方法时，若打印内容超过2000个字符，请使用分段打印方式，否则可能出现DeviceRTException /** * 根据二进制数据打印(根据打印规范用户自定义打印小票样式) * * buffer 打印内容 * lineBreak 换行数 * callback 回调 */ CILSDK.printBufferReceipt(buffer, lineBreak,new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印二维码 /** * 打印二维码 * * qrCode 二维码内容 * position 打印位置 0:左对齐；1居中；2：右对齐 * width 二维码宽度 * callback 回调 * */ CILSDK.printQRCode(qrCode,position,width,lineBreak,new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印条形码 /** * 打印条形码 * * barCode 条形码数字 * position 条形码位置 0:左对齐；1居中；2：右对齐 * lineBreak 换行数 * callback 回调 */ CILSDK.printBarCode(String barCode, int position, int lineBreak, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印图片 /** * 打印图片 * * bitmap 图片Bitmap * lineBreak 换行数 * offset 偏移量 * callback 回调 * */ CILSDK.printImage(bitmap, lineBreak, offset, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 其他设置 考虑到使用 SDK 的时候可能还会有其他需求,比如 获取 POS 机的 SN 号 、 设置密钥索引 等,在这里,我们也提供了一部分接口。 获取 SDK 版本 //版本名 String versionName = CILSDK.VERSION_NAME; //版本号 int versionCode = CILSDK.VERSION_CODE; 获取 SN 号 //SN号 String snCode = CILSDK.getDeviceSN(); 设置流水号 //serialNum范围：1~999999 boolean isSuccess = CILSDK.setSerialNum(int serialNum); 获取流水号 //序列号 int serialNum = CILSDK.getSerialNum(); 设置批次号 //batchNum范围：1~999999 boolean isSuccess = CILSDK.setBatchNum(int batchNum); 获取批次号 //批次号 int batchNum = CILSDK.getBatchNum(); 设置联迪密钥区 //1-15的设值范围 CILSDK.setTingA8KeyIndex(2); 设置密钥索引 //分别对应MAIN MAC PIN MES //1-255的设值范围 //可以使用下方提供数值,也可以根据自身程序设值 CILSDK.setTingKeyIndex(4,101,10,150); 以上两个方法请在连接刷卡器(CILSDK.connect)之前使用 工具类 CILPayUtil /** * 将respCode翻译成对应中文解释 */ CILPayUtil.translate(context, respCode)); /** * 将Trans类中的transCode翻译成打印所需的对象 */ CILPayUtil.getFormatTransCode(transCode); /** * 根据billingCurr判断交易是否为外卡类的DCC交易 */ CILPayUtil.isDCCPay(billingCurr); /** * 判断交易是否成功 */ CILPayUtil.isTransSuccess(trans); /** * 根据Trans类中的transCode判断交易是否属于扫码类交易 */ CILPayUtil.isQrPay(transCode); ReceiptFormatUtils /** * 根据Trans类中的TransCode翻译成对应的中文解释 */ ReceiptFormatUtils.getTransType(transCode); /** * 将明文的卡号修改为\"前六后四中间为四个*\"的样式 */ ReceiptFormatUtils.handleCardNum(cardNum); 许可证 Copyright (c) 2016 cardinfolink.com JAVADOC java document 详情见 javadoc","text_tokens":["(","位置","原扣币","equals","调用","revokeconsume"," ","保持","必须","主","且","一部","一致","日期","是否是","onactivityresult","插卡","本笔","this","出错","详情","来","downloadparamswithprogress","transrate","结果","中","读卡器","settracenum","擅自","做","关","开启","订单","zaihui","setcoordinates","应答","revoke","--","消费类","规范市场","下方","usd","respcode","length","时","小费","给","31.180606","合作","unknown","getstatus","被","方法","getcardexpirationdate","transsettleasync","0x009","以","方便","含义","改动","键盘","返回值","getsystemparams","class","revokeconsumeqr","unknow","整个","versionname","前六后","联系","内","implementation","transsettles","包含","对象","gcj02","存储设备","n900","需","大概","setlatitude","通过","取值","void","新版","关单","pom","代表","自定","行数","getformattranscode","e","response","后续","同步","c","或是","方式","preauthcompleteqr","也","更新","的","设计","左","referencenumber","from","isdccpay","周期","connect","四","错误","读取","当前","格式","如","到","[","特别","情况","msc","gettranstype","银员","tradeamount","short","compinfoa4","to","＋","所有","后台","区","再","某","自","实际","次","代码","工具","revokepreauthcomplete","名","拿到","setposinputstyle","还","本身","种类","接班","settinga8keyindex","skd","避免","进行","返回","了","都","settransrate","settingkeyindex","setamount","*","merdiscount","constants","com","号文","判断","tag","null","异步","先","其他","2.5","转载","开始","setbatchnum","直接","送","setcardnumb","收银员","清算","便","坐标","出来","setlimittime","支持","cardno","正常","人民","versioncode","对","只","卡人","setrevauthcode","revauthcode","逻辑","请求","存储","returnconsumeqr","setdebug","里面","四个","一般","/","使用","提供","preauthcompcancel","用","这次",".","点","初始化","当然","去","造成","概念","其实","balance","联迪","cardbrand","出现异常","支付","之前","无需","原预","biilingamt","termcode","10s","linebreak","studio","保证","域","getbillsasync","txntype","单","consume","持卡","key","downloadparams","所","超过","\"","cardnum","sncode","之后","getamount","备注","标题","与否","gettxn","setbillingcurr","zxing","0x015","cashiernum","再次","基础","账款","客户","这个","就是","jcenter","中国","具备","右","oncreate","protected","istranssuccess","微信","对于","参数值","cardinfo","好","aftertranscode","分段","returnconsume","printbarcode","下载","颜色","字符","见下文","compinfoa8","isopendcc","控制","field55","onresult","gettrans","8","li","setfield55","processflag","开","billtype","code","other","发起","2","是否","值会","形式","保存","准备","total","系统","demo","255","首先","commoncardhandleractivity","java","details","页面","最新版","4","下单","该","application","终端","datetime","0x010","width","复杂","依据","说明","连接不断","网络","wgs84","快速","sdk","一部分","联","setpinemv","开发","setserialnum","scancode","则","非必要","没有","有","启用","腾讯","getpinbins","翻译成","init","revokepreauthqr","步骤","发版时","balanceofbank","为准","条数","内存","handlecardnum","平台","生命","gettracenum","或","讯联","个字符","规范","汇率","printbufferreceipt","compinfoa1","为","检索","配置","revokepreauth","constant","能","公钥","ex","mac","1","序列","如下","定位","涉及","号加","cardinfolink","安装","能力","适配","。","业务","0x007","撤销","getparcelableextra","磁道","okhttp","new","签购","tradedate","cfcardsdk","常用","样式","每日","设值","下发","onerror","标识","结尾","b","|","take","pos","卡预","缓冲","自己","本","依赖","85","setperiod","列表","preauthqr","maketext","注意","aid","银行卡","取自","进入","basecardactivity","ic卡","子标题","error","getbillstat","batchnum","卡","...","用户","用于","setscancodeid","偏移","加入","！","dependency","市场","接口","进度","setcardsequencenumber","参考","附件","获取","parcelable","translate","initcardevent","修改","还是","type","gettransdate","需求","transdate","tpdu","采取","有效期","根据","数","刷卡器","掉","显示","宽度","经度","所在","流水号","效期","bin","分为","商家","compinfoa7","2016","size","得到","二维","简单","cardtype","0x003","boolean","金额","getbillingcurr","出现","这里","ui","transcode","override","服务","内容","list","扣","传给","0x002","getbillstatasync","客服","5","offset","getdevicesn","国际","barcode","这些","info","加密","原因","getfield55","name","一次","cashiername","下文","例如","从","）","公司","近","mes","端口","getposinputstyle","反馈","第三方","默认","另外","交互","55","getrevauthcode","这样","出","批次","国人","银行","0x006","intent","比如","还会","callback","preauthcomplete","不仅","智能","余额","localtransdate","预留","possdk","托管","机器","当","里","+","由于","外","revokepreauthcompleteqr","=","checkbalance","看","isforeigntrans","已经","转","包括","才","具体来说","正确","明文","应用","必选","gettransamt","确认","银联","mercode","这笔","origintracenum","tip","推荐","中国人民银行","ic","dcc2edc","一个","中间","setreferencenumber","，","消费","读卡","waitloadingshow","getsequenceserialnum","0x005","选择","即可","serialnum","cancel","但","setorderid","revordernum","只有","kind","建议","有效","才能","gps","流水","0x011","coupon","a8","发送","不再","字母","activewithcode","show","选择性","规定","商户","收取","分别","settledaoutil","而且","card","两个","装载","billingcurrnum","确定","；","一套","settransdatetime","additionalresdata","最终","过程","smart","判定","许可","读出","准确","一台","每天","主要","compinfoa3","6","考虑","1.1","revinscode","999999","clearingdate","之中","0x666","下","p","所在地","!","setbillingamt","偏移量","call","final","指定","public","版本","详细","持久","active","getbatchnum","setlongitude","天","定义","transconstants","getmessage","有点","响应","`","程序","相关","getintextra","sdk2.4","formattranscode","cilrequest","tracenum","无法","新增","收银","compinfoa2","trans","并","或者","交接班","colorprimary","curtrans","queryqrjustonce","2000","transtype","00","dcctoedc","getcardnumber","中断","段","gettrack2","if","支付宝","及","联网","二进制","每个","单行","inscode","cancelofbank","形码","具体","数据","凭证","consumeqr","标识码","getprocessflag","需要","compinfoa6","transcurr","amount","transdatetime","状况","@","工作","0x012","连接","maven","要求","3","单号","正在","成功","第三","不","上","对应","走纸","失败","位","setlocation","原","：","外部","含","extra","库","地址","此","return","导致","以下","交易类型","单收","第一","page","激活码","150","下面","授权","request","改为","模块","nfc","posinputstyle","范围","是","'","生命周期","settranscurr","机","需上","跟踪","将","extends","<","旧","受理","条形","定义域","中国银联","getserialnum","导入","码表","扣账","高德","密码","receiptsubtitle","类中取","getbillingamt","前面","打包","setoriginaltradedate","借贷","true","buffer","devicertexception","cilpayutil","二维码","gradle","来说","查询","小票","all","issuccess","edc","markup","居中","signin","progresscallback","集成","为了","这","已","退货","除","copyright","讯","核对","合作方","手输","int","此次","onprogressupdate","artifactid","索引","context","功能","main","签到","isqrpay","执行","类型","自身","0x014","字","0x008","查看","体验","false","sn",">","符号","auth","您","若有","初始","属于","硬件","我们","comp","queryqr","getinstance","json","gotoliquidation","不要","rateinfo","合乎","voidqr","与","能够","能且","listener","超时","数字","和","bank","导入到","值","打印","login","无","printimage","泄露","新","分钟","0x004","setsecondtrack","可能","阶段","内部","groupid","transaction","非","个","在","location","卡号","信息","流程","扣款","后","见","因为","0","账单","部分","printqrcode","]","10","中文","version","密钥","三位","仅","progress","方","resultcode","若","originaltradedate","外卡","解释","对齐","exception","position","getrespcode","or","android","如果","操作","等","币种","标志","bitmap","各","类","以上","ul","信用","billingamt","段时间","多次","货币","qr","条形码","localtranstime","printerresult","取消","两种","getapplicationcontext","组织","activity","0x555","输入","bd09","化","退款","（","cardreaderhandler","一些","10000l","settle","toast","回调","翻译","许可证","全部","0x013","请","结算","getscancodeid","preauthcancel","进制","时候","自定义","}","101","国内","result","应","接收","表","static","刷卡","qrcode","传入","activitylifecyclecallbacks","string","纬度","rsa","就","会","会为","让","版本号","设备","a","以及","requestcode","每页","cardhandlererror","javadoc","均","附加","号","必要","挥卡","票据","transamt","你","下次","可","状态","7","billingcurr","可以","pin","信用卡","15","订单号","受卡方","图片","选","cilsdk","super","填入","printkindsreceipts","简化",",","结束","关于","否则","固定","orderid","处理","sharedpreference","9","consumeofbank","表示","printsettlereceipts","waitloadingdismiss","refund","由","0x001","译成","document","outordernum","二","用到","getbills","目录","参数","setcardnum","持卡人","tostring","getbillbytracenumasync","{",":","最新","扫码","优惠","交易","-","百度","设置","setcardexpirationdate","bill","第一次","源码","卡片","ok","data","时间","码","异常","预","gettransrate","throws","authcode","坐标系","&&",")","统计","激活","接入","发放","继承","营销","类中","三方","preauth","121.600228","receiptformatutils","param","~","cilresponse","else","savedinstancestate","但是","文档","debug","以免","序列号","getrefnum","记","帐","交接","09","左右","scancodeid","字符串","dcc","重复","后面","相对","bundle","换行","开发者","经历","preauthcomp","app","不断","完成","数值","读出来","想","refundofbank",";","_","refnum","、"],"title":"Sdkapi","title_tokens":["sdkapi"]},{"location":"documentation/sdkapi/#_1","text":"讯联智能 POS SDK 为开发者准备了一个简单的 demo 程序,可以快速体验 SDK 接入流程。可以在这里 下载demo 。 下载 POS-demo 之后将整个目录导入到您的 Android Studio 之中。","text_tokens":["了","体验","studio","您","android"," ","一个","将","讯联","之后","可以","接入","导入","为","的","准备","之中","demo","导入到",",","。","在","智能","目录","开发者","流程","快速","sdk","开发","程序","简单","-","下载","整个","pos","这里"],"title":"快速体验","title_tokens":["快速","体验"]},{"location":"documentation/sdkapi/#_2","text":"为了方便 SDK 的集成使用，本 SDK 已使用 jcenter 托管，配置如下 gradle: implementation 'com.cardinfolink.smart.pos:PosSDK:2.5.2' or maven: <dependency> <groupId>com.cardinfolink.smart.pos</groupId> <artifactId>PosSDK</artifactId> <version>2.5.2</version> <type>pom</type> </dependency> 如果想使用讯联集成的结算UI和逻辑，请配置 gradle: implementation 'com.cardinfolink.smart.pos:SDK-ZaiHui:1.1.1' or maven: <dependency> <groupId>com.cardinfolink.smart.pos</groupId> <artifactId>SDK-ZaiHui</artifactId> <version>1.1.1</version> <type>pom</type> </dependency> 读卡、输入密码的颜色取自colorPrimary。如果需要自定义样式，请参考 Demo ，下载源码修改 注意：1.1.1版本直接指定了PosSDK的版本号，不再使用默认最新版的PosSDK，如非必要，不要再配置PosSDK的版本","text_tokens":[">"," ","不要","2","，","读卡","和","demo","最新版","zaihui","groupid","不再","sdk","方便","version","非必要","implementation","or","如果","新版","smart","pom","讯联","自定","1.1","的","配置","如","输入","1","指定","如下","版本","cardinfolink","请","结算","。","自定义","定义","再","样式","pos","版本号","了","本","colorprimary","必要","注意","com","取自","2.5","直接","dependency","参考","修改","type","需要","逻辑","maven","/","使用",".","：",":","最新","-","ui","源码","'","<","密码","默认","jcenter","gradle","集成","为了","已","possdk","托管","artifactid","想","颜色","下载","、"],"title":"快速集成","title_tokens":["集成","快速"]},{"location":"documentation/sdkapi/#pos","text":"使用 N900 智能 POS 机器, 我们的应用首先需要连接 POS 机硬件, 使用 SDK 提供的 connect 方法连接。 建议在 Application 的 onCreate 方法中进行连接。 @Override public void onCreate() { super.onCreate(); ... CILSDK.setDebug(true);//发版时请改为 false CILSDK.connect(this); ... } 如果还适配了联迪A8设备的，联迪设备login需要传入activity的context, 建议在 主activity onCreate中 再调用 CILSDK.connect(this); 如果没有与app生命周期一致的activity,建议在每个可能调用设备刷卡、加密、打印的activity中再调用 CILSDK.connect(this)， 保证使用过程中设备连接不断开；另外推荐在ActivityLifecycleCallbacks中处理设备连接。","text_tokens":["应用","(","false","调用","推荐","开"," ","硬件","主","我们","一致","this","，","与","中","首先","打印","login","可能","建议","application","在","a8","连接不断","sdk","方法","没有","n900","发版时","；","void","如果","过程","生命","的","周期","connect","activity","public","请","适配","。","}","再","刷卡","传入","activitylifecyclecallbacks","还","pos","设备","进行","了","...","cilsdk","每个","super",",","处理","需要","@","连接","setdebug","/","使用","提供",".","{","联迪","改为","override","生命周期","保证","机",")","加密","true","另外","智能","oncreate","机器","app","不断","context",";","、"],"title":"连接POS机","title_tokens":["pos","机","连接"]},{"location":"documentation/sdkapi/#pos_1","text":"a、新激活接口（推荐） 根据用户反馈，为了简化激活流程，我们采取激活码的方式激活，当你拿到 POS 机器之后，我们会为这个商户发放激活码，一个激活码可以激活一台 POS 机。 成功激活后，接口会返回商户号，终端号等信息，后续参数下载需要用到。 注意:一台终端能且仅能成功激活一次,无法重复进行激活操作。若有多次激活的需求(如debug阶段),请联系讯联客服。 //authCode 激活码（建议用扫码的方式得到激活码，避免让用户手输） CILSDK.activeWithCode(authCode, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { if (cilResponse.getStatus() == 0) { //激活成功 } else { //激活失败，失败原因见 cilResponse.getMessage() } } @Override public void onError(Parcelable cilRequest, Exception e) { //激活出错 } }); b、旧激活接口 第一次使用智能 POS 终端的时候,需要使用讯联下发的商户号 merCode 和终端号 termCode 激活, 激活成功之后才能正常使用后面的交易流程。 注意:一台终端能且仅能成功激活一次,无法重复进行激活操作。若有多次激活的需求(如debug阶段),请联系讯联客服。推荐APP本身能够保持设备是否已经激活标志 //merCode 讯联下发的商户号 //termCode 讯联下发的终端号 CILSDK.active(merCode, termCode, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { if (cilResponse.getStatus() == 0) { //激活成功 } else { //激活失败 } } @Override public void onError(Parcelable p, Exception e) { //激活出错 } });","text_tokens":["(","onresult","mercode",">","推荐","若有"," ","一个","保持","我们","出错","是否","，","能够","能且","和","新","阶段","建议","才能","终端","信息","流程","后","见","getstatus","0","activewithcode","仅","商户","联系","exception","void","等","操作","讯联","一台","标志","e","后续","方式","多次","的","能","p","如","（","public","请","active","。","时候","}","getmessage","new","下发","onerror","cilrequest","拿到","无法","b","本身","pos","会","会为","让","避免","设备","进行","返回","a","号","注意","你","可以","用户","if","cilsdk","接口","简化",",","parcelable","正常","需要","需求","@","采取","根据","成功","/","使用","用到","用","参数",".","失败","{",":","扫码","得到","交易","第一","激活码","第一次","override","termcode","机","客服","authcode",")","<","旧","之后","原因","激活","发放","一次","）","cilresponse","else","反馈","debug","这个","callback","智能","重复","后面","为了","机器","当","app","=","手输","已经","下载",";","、"],"title":"激活POS机","title_tokens":["pos","激活","机"]},{"location":"documentation/sdkapi/#_3","text":"激活成功之后,你的应用还需要下载一些交易时使用的参数,比如 交易地址和端口 、 交易超时时间 、 终端支持的功能 、 TPDU 等, 在你拿到 POS 终端之前,这些参数都会在讯联后台已经配置好,全部参数见 CILResponse.Info 返回值。下载成功之后 SKD 会 以json字符串的形式保存这些参数到 SharedPreference (请不要擅自改动这些参数值,以免导致交易失败) 。当然,在 onResult 中也会返回,你也可以自己选择性保存一些参数。另外, SDK 保存在 SharedPreference 里的值会提供接口 CILSDK.getSystemParams() 获取。 注意：正常情况下，此方法只需执行成功一次，但是后台参数配置可能会有改动，APP本身需要调用预留功能调用此方法 //merCode 讯联下发的商户号 激活成功之后可以确定商户号 //termCode 讯联下发的终端号 激活成功之后可以确定终端号 CILSDK.downloadParams(merCode, termCode, new com.cardinfolink.pos.listener.Callback<CILResponse>() { @Override public void onResult(CILResponse response) { if (0 == response.getStatus()) { //参数下载成功,具体返回的参数见 response.Info } else { //参数下载错误 } } @Override public void onError(Parcelable p, Exception e) { //下载出错 } });","text_tokens":["应用","(","onresult","mercode","调用",">"," ","json","不要","出错","值会","形式","，","listener","保存","超时","和","中","选择","擅自","可能","终端","在","时","见","getstatus","sdk","方法","联","0","选择性","以","改动","返回值","getsystemparams","有","商户","需","确定","exception","void","等","讯联","e","response","也","的","配置","错误","下","p","到","一些","情况","public","cardinfolink","全部","请","。","}","后台","new","下发","onerror","拿到","还","本身","pos","会","skd","都","返回","自己","号","注意","com","你","可以","if","cilsdk","接口","具体",",","支持","获取","parcelable","正常","sharedpreference","需要","只","@","tpdu",";","成功","/","使用","提供","参数",".","失败","{","：","交易","地址","此","导致","当然","之前","override","termcode","时间","downloadparams",")","这些","info","<","之后","激活","一次","cilresponse","else","端口","但是","以免","另外","比如","callback","字符串","参数值","预留","里","app","讯","=","好","已经","数值","下载","功能","字符","执行","、"],"title":"终端参数下载","title_tokens":["下载","参数","终端"]},{"location":"documentation/sdkapi/#_4","text":"终端密钥下载只需要成功执行一次就可以,成功下载的密钥会被转载到POS硬件模块里面,后面就不需要再次调用了,建议你的应用可以在成功下载密钥之后持久化一个标志位, 下次进入应用就不再去下载密钥了。整个过程可能会需要1~2分钟左右(依赖当前的网络状况),会经历以下步骤: 请求讯联网关 RSA -> 装载 RSA -> 请求主密钥 -> 装载主密钥 -> 启用主密钥 -> 请求工作密钥(签到) -> 装载工作密钥 -> 下载 AID -> 装载 AID -> 下载 IC 公钥 -> 装载 IC 公钥。 建议APP本身存储设备是否已经初始化方法标志。 注意：此方法一般只需要安装后成功调用一次即可。但银行交互密钥有可能会更新，APP本身需要调用预留功能调用此方法 CILSDK.downloadParamsWithProgress(new ProgressCallback<CILResponse>() { @Override public void onProgressUpdate(int progress) { //progress下载密钥的进度 } @Override public void onResult(CILResponse response) { if (0 == response.getStatus()) //密钥下载成功。在这里可以持久化一个标志位 } @Override public void onError(Parcelable p, Exception e) { //下载密钥出错 } });","text_tokens":["应用","(","onresult","调用",">","ic"," ","一个","硬件","初始","主","2","出错","是否","downloadparamswithprogress","，","即可","但","关","分钟","可能","建议","终端","在","网络","后","被","不再","方法","0","getstatus","密钥","启用","有","整个","装载","存储设备","progress","步骤","exception","void","过程","标志","e","response","更新","的","公钥","当前","p","到","化","1","public","持久","安装","。","}","new","onerror","rsa","本身","就","pos","会","设备","了","依赖","aid","注意","进入","你","下次","可以","if","转载","联网","cilsdk","进度",",","parcelable","需要","只","存储","状况","请求","工作","@","里面",";","成功","一般","/","不",".","位","{","初始化","：",":","-","此","去","以下","这里","override","模块",")","<","之后","一次","~","cilresponse","再次","交互","银行","左右","后面","progresscallback","经历","预留","app","讯","=","int","onprogressupdate","已经","下载","功能","签到","执行"],"title":"终端密钥下载","title_tokens":["密钥","下载","终端"]},{"location":"documentation/sdkapi/#_5","text":"签到其实也就是更新工作密钥的一个过程 ( 下载工作密钥+装载工作密钥 ),讯联网关平台要求应用需要每天签到一次。 CILSDK.signIn(new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { //签到成功 } @Override public void onError(Parcelable cilRequest, Exception e) { //签到出错 } });","text_tokens":["(","应用","override","装载","onresult",">","exception","void","平台","过程","一个"," ",")","每天","<","e","出错","一次","也","更新","的","联网","cilsdk","cilresponse",",","parcelable","关","需要","就是","public","工作","@","要求","callback","。","成功","signin","/","}",".","+","new","{","讯","onerror","密钥","cilrequest","下载",";","其实","签到"],"title":"签到","title_tokens":["签到"]},{"location":"documentation/sdkapi/#_6","text":"SDK 将交易分为 银行卡交易 (刷卡、插卡和挥卡)和 扫码交易 (支付宝和微信)两种。银行卡相关交易需要POS机硬件模块读卡器,扫码相关交易则不需要。","text_tokens":["支付","(","模块","挥卡","银行卡","机"," ","硬件","将",")","插卡","支付宝","读卡","和","读卡器",",","两种","需要","银行","。","不","微信","分为","sdk","刷卡","相关","扫码","交易","则","pos","、"],"title":"发起交易","title_tokens":["发起","交易"]},{"location":"documentation/sdkapi/#a","text":"由于银行卡交易逻辑有点复杂,讯联提供了一个 BaseCardActivity 基础类,你只需要继承这个类便可以做银行卡类的交易了。具体使用方法可以见 demo 里的 CommonCardHandlerActivity 类。下面给个大概说明: public class CommonCardHandlerActivity extends BaseCardActivity { @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); //... } /** * 必须传入金额 * * @return */ public String getAmount() { //在这里传入金额 } /** * 此方法为控制sdk内部是否开启DCC交易逻辑（sdk2.4.1版本及以上支持该方法） * *@return 需要进行DCC交易时，返回true，否则返回false */ public boolean isOpenDcc() { //只有刷卡消费和刷卡预授权才支持DCC交易 //如果接入方无需支持DCC，则此方法返回false即可 return false; } /** * 读卡的结果（sdk2.4.1版本及以上新增RateInfo参数，返回DCC读卡流程中进行汇率查询的结果） * * @param isSuccess 是否成功 * @param cardType 卡片种类(-1(unknow) 1(msc) 2(ic) 3(nfc) 4(scancode) 5(other)) * @param cardInfo 读取卡片信息 * @param rateInfo 汇率信息 */ public void cardReaderHandler(boolean isSuccess, @CardType.Type int cardType, CardInfo cardInfo, RateInfo rateInfo){ //读卡成功后才发起交易 if (!isSuccess || cardInfo == null) { Toast.makeText(getApplicationContext(), \"读卡失败\", Toast.LENGTH_SHORT).show(); initCardEvent(); return; } //1. 根据银联85号文规定，智能终端需上送经度，纬度，坐标系信息到卡组织 CILRequest request = new CILRequest(); request.setLongitude(121.600228);//设置经度 request.setLatitude(31.180606);//设置纬度 request.setCoordinates(\"GCJ02\");//设置坐标系 //关于坐标系，国内一些常用第三方取值：百度（BD09），高德、腾讯（GCJ02），GPS（WGS84）。 //一般第三方定位SDK都能从定位后返回的位置信息类中取到，详细可查看各第三方接入文档。 //2.如果接入方需要进行DCC交易，需将汇率信息填入request中，否则无需处理 CILRequest request = new CILRequest(); ... if (rateInfo != null) { request.setBillingAmt(rateInfo.getBillingAmt());//设置扣账金额 request.setBillingCurr(rateInfo.getBillingCurr());//设置扣账币种 request.setTransRate(rateInfo.getTransRate());//设置交易汇率 request.setBatchNum(rateInfo.getBatchNum());//设置汇率请求批次号 request.setTraceNum(rateInfo.getTraceNum());//设置汇率请求流水号 } //3. 在这里面发送银行卡相关的交易(如消费、消费撤销、退货、预授权、预授权撤销、预授权完成、预授权完成撤销、余额查询) //CILSDK.consume(request, cardType, new Callback<CILResponse>() //消费 } /** * 显示读卡时的缓冲页面 */ public void waitLoadingShow(){ } /** * 取消读卡时的缓冲页面 */ public void waitLoadingDismiss(){ } /** * 读卡失败 */ public void cardHandlerError(Exception e){ } } 注意: 调用银行卡类交易接口时，需要传入CILRequest以及CardType，且所有接口中CILRequest均需要传入以下信息： /** * @param: request:请求信息 * @param: cardType:卡片类型 */ request.setAmount(amount);//消费金额 /** * 刷卡获取的cardInfo信息 */ request.setCardNumb(cardInfo.getCardNumber());//卡号 request.setCardExpirationDate(cardInfo.getCardExpirationDate());//卡片有效期 request.setPinEmv(cardInfo.getPinBins());//卡bin request.setCardSequenceNumber(cardInfo.getSequenceSerialNum());//卡片序列号 request.setField55(cardInfo.getField55());//55域信息 request.setSecondTrack(cardInfo.getTrack2());//二磁道信息 request.setOrderId(orderId);//可选参数。（消费、退货、预授权、预授权完成、扫码下单、扫码退货） request.setLocation(location)//有终端具备获取位置信息能力时必选上送（ 用于消费 预授权）","text_tokens":["(","位置","查看","必选","false","银联",">","调用","setfield55","ic"," ","一个","必须","且","other","发起","rateinfo","2","是否","，","结果","消费","读卡","demo","和","中","commoncardhandleractivity","即可","settracenum","waitloadingshow","getsequenceserialnum","页面","做","setorderid","开启","4","只有","setcoordinates","setsecondtrack","下单","内部","该","终端","gps","流水","有效","个","在","location","length","复杂","时","给","卡号","说明","信息","流程","31.180606","见","后","wgs84","sdk","方法","发送","show","getcardexpirationdate","setpinemv","规定","scancode","class","则","有","unknow","腾讯","getpinbins","gcj02","方","需","大概","setlatitude","取值","exception","void","如果","币种","gettracenum","讯联","e","各","类","以上","汇率","为","的","能","取消","getapplicationcontext","读取","组织","!","到","bd09","setbillingamt","1","（","cardreaderhandler","msc","一些","如","public","版本","toast","定位","详细","short","能力","。","getbatchnum","撤销","setlongitude","序列","}","所有","国内","磁道","new","有点","常用","刷卡","相关","传入","string","纬度","sdk2.4","cilrequest","新增","种类","|","以及","进行","返回","了","85","都","settransrate","缓冲","cardhandlererror","均","setamount","*","号","maketext","注意","银行卡","号文","basecardactivity","你","null","可","getcardnumber","可以","卡","gettrack2","...","if","及","用于","选","setbatchnum","送","cilsdk","super","填入","接口","setcardnumb","setcardsequencenumber","便",",","具体","坐标","支持","否则","关于","获取","initcardevent","orderid","type","处理","需要","只","amount","逻辑","请求","@","waitloadingdismiss","3","里面","根据","有效期","成功","一般","/","提供","使用","第三","经度","显示","二","参数",".","流水号","失败","效期","setlocation","上","bin","{","：",":","扫码","交易","return","此","cardtype","-","百度","boolean","以下","金额","设置","getbillingcurr","setcardexpirationdate","下面","授权","request","这里","无需","override","卡片","nfc","才","域","预","gettransrate","需上","5","坐标系","consume","extends",")","\"","将","<","getamount","getfield55","继承","接入","三方","扣账","高德","121.600228","从","）","param","类中取","setbillingcurr","getbillingamt","cilresponse","savedinstancestate","基础","第三方","true","文档","55","这个","批次","银行","序列号","查询","issuccess","callback","具备","dcc","oncreate","protected","智能","余额","bundle","这","cardinfo","由于","里","退货","=","int","完成",";","_","isopendcc","类型","、","控制"],"title":"a、银行卡交易","title_tokens":["银行","交易","银行卡","、","a"]},{"location":"documentation/sdkapi/#1","text":"消费接口 request必须包含参数: CILSDK.consume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } });","text_tokens":["包含","(","override","onresult",">","exception","void","必须"," ","consume",")","<","e","...","cilsdk","消费","接口","cilresponse",",","parcelable","public","@","callback","参数",".","}","new","{",":","onerror","cardtype","cilrequest",";","request"],"title":"1、消费","title_tokens":["消费","1","、"]},{"location":"documentation/sdkapi/#2","text":"撤销接口 request必须包含参数: /** * 撤销接口除基础信息外， * 还需要原交易信息 */ request.setReferenceNumber(transaction.getRefNum());//原交易参考号 request.setRevAuthCode(transaction.getRevAuthCode());//原交易授权码 request.setBatchNum(transaction.getBatchNum());//原交易批次号 request.setTraceNum(transaction.getTraceNum());//原交易凭证号 CILSDK.revokeConsume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } });","text_tokens":["包含","(","override","onresult","*","号","码","revokeconsume",">","exception","void","必须"," ","gettracenum",")","<","e","...","setreferencenumber","，","setbatchnum","cilsdk","接口","settracenum","cilresponse","参考",",","基础","凭证","parcelable","getrevauthcode","需要","getrefnum","setrevauthcode","批次","public","transaction","@","callback","/","撤销","getbatchnum","参数","信息",".","}","除","new","原","外","{",":","onerror","交易","cardtype","cilrequest","还",";","授权","request"],"title":"2、撤销","title_tokens":["2","、","撤销"]},{"location":"documentation/sdkapi/#3","text":"退货接口 request必须包含参数: /** * 退货接口除基础信息外 * 还需要原交易信息 */ request.setReferenceNumber(referenceNumber); request.setTransDatetime(tradeDate); CILSDK.returnConsume(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } });","text_tokens":["包含","(","override","onresult","*",">","settransdatetime","exception","void"," ","必须",")","<","e","...","setreferencenumber","cilsdk","referencenumber","接口","cilresponse",",","基础","parcelable","需要","public","@","callback","/","参数",".","信息","}","退货","除","new","原","外","tradedate","{",":","onerror","交易","cardtype","returnconsume","cilrequest","还",";","request"],"title":"3、退货","title_tokens":["退货","、","3"]},{"location":"documentation/sdkapi/#4","text":"余额查询接口 request必须包含参数: CILSDK.checkBalance(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } });","text_tokens":["包含","(","override","onresult",">","exception","void"," ","必须",")","<","e","...","cilsdk","接口","cilresponse",",","parcelable","public","查询","@","callback","余额","参数",".","}","new","{",":","checkbalance","onerror","cardtype","cilrequest",";","request"],"title":"4、余额查询","title_tokens":["余额","查询","4","、"]},{"location":"documentation/sdkapi/#5","text":"预授权接口 request必须包含参数: request.setLocation(location)//有终端具备获取位置信息能力时必选上送（ 用于消费 预授权） CILSDK.preAuth(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } });","text_tokens":["包含","(","位置","必选","override","onresult",">","exception","预","void"," ","必须",")","<","e","用于","...","preauth","cilsdk","送","消费","）","接口","cilresponse",",","获取","parcelable","（","public","@","终端","callback","具备","能力","location","/","时","上","参数",".","信息","}","setlocation","new","{",":","onerror","cardtype","有","cilrequest",";","授权","request"],"title":"5、卡预授权","title_tokens":["卡预","授权","5","、"]},{"location":"documentation/sdkapi/#6","text":"预授权撤销接口 request必须包含参数: /** * 预授权撤销接口除基础信息外 * 还需要原预授权交易信息 */ request.setRevAuthCode(authCode);//原预授权交易授权码 request.setTransDatetime(originalTradeDate);//原预授权交易日期 CILSDK.revokePreAuth(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } });","text_tokens":["包含","原预","(","override","onresult","*","码","originaltradedate",">","settransdatetime","exception","预","void"," ","必须","authcode",")","日期","<","e","...","cilsdk","revokepreauth","接口","cilresponse",",","基础","parcelable","需要","setrevauthcode","public","@","callback","/","撤销","参数","信息",".","}","除","new","外","{",":","onerror","交易","cardtype","cilrequest","还",";","授权","request"],"title":"6、卡预授权撤销","title_tokens":["6","撤销","卡预","授权","、"]},{"location":"documentation/sdkapi/#7","text":"预授权完成接口 request必须包含参数: /** * 预授权完成接口除基础信息外 * 还需要原预授权交易信息 */ request.setRevAuthCode(authCode);//原预授权交易授权码 request.setTransDatetime(originalTradeDate);//原预授权交易日期 CILSDK.preAuthComplete(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } });","text_tokens":["包含","原预","(","override","onresult","*","码","originaltradedate",">","settransdatetime","exception","预","void"," ","必须","authcode",")","日期","<","e","...","cilsdk","接口","cilresponse",",","基础","parcelable","需要","setrevauthcode","public","@","preauthcomplete","callback","/","参数","信息",".","}","除","new","外","{",":","完成","交易","onerror","cardtype","cilrequest","还",";","授权","request"],"title":"7、卡预授权完成","title_tokens":["完成","卡预","授权","、","7"]},{"location":"documentation/sdkapi/#8","text":"预授权完成撤销接口 request必须包含参数: /** * 预授权完成撤销接口除基础信息外 * 还需要原预授权完成交易信息 */ request.setReferenceNumber(refNum);//原预授权完成交易参考号 request.setRevAuthCode(authCode);//原预授权完成交易授权码 request.setTraceNum(traceNum);//原预授权完成交易凭证号 request.setBatchNum(batchNum);//原预授权完成交易批次号 request.setTransDatetime(originalTradeDate);//原预授权完成交易日期 CILSDK.revokePreAuthComplete(request, cardType, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } });","text_tokens":["包含","原预","(","override","onresult","*","号","码","originaltradedate",">","settransdatetime","exception","预","void"," ","必须","authcode",")","日期","<","e","batchnum","...","setreferencenumber","refnum","setbatchnum","cilsdk","接口","settracenum","cilresponse","参考",",","基础","凭证","parcelable","需要","批次","setrevauthcode","public","@","callback","/","撤销","参数","信息",".","}","除","new","外","{",":","完成","交易","onerror","cardtype","revokepreauthcomplete","tracenum","cilrequest","还",";","授权","request"],"title":"8、卡预授权完成撤销","title_tokens":["8","完成","撤销","卡预","授权","、"]},{"location":"documentation/sdkapi/#9dccedc","text":"当交易卡片为外卡时，消费类（消费、预授权完成）交易可选择进行DCC转EDC。 CILRequest request = new CILRequest(); request.setCardNum(cardNum);//卡号 request.setTransDatetime(datetime);//原交易时间 request.setAmount(amount);//原交易金额 request.setBillingAmt(biilingAmt);//原扣币金额 request.setReferenceNumber(refNum);//原交易参考号 request.setRevAuthCode(revAuthCode);//原交易授权码 request.setBatchNum(batchNum);//原交易批次号 request.setTraceNum(traceNum);//原交易凭证号 request.setTransCurr(transCurr);//原交易币种 request.setBillingCurr(billingCurr);//原交易扣款币种 CILSDK.dccToEdc(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable p, Exception e) { ... } });","text_tokens":["(","onresult","原扣币",">"," ","setreferencenumber","，","消费","settracenum","选择","消费类","datetime","时","卡号","扣款","外卡","settransdatetime","exception","void","币种","e","为","p","setbillingamt","（","public","。","}","new","onerror","cilrequest","tracenum","进行","setamount","号","dcctoedc","可","batchnum","billingcurr","...","setbatchnum","cilsdk","参考",",","凭证","parcelable","setrevauthcode","amount","revauthcode","transcurr","@","/","setcardnum",".","原","{","交易","金额","授权","request","biilingamt","override","卡片","时间","码","settranscurr","预",")","cardnum","<","）","setbillingcurr","cilresponse","批次","edc","callback","dcc","当","=","完成","转",";","refnum","、"],"title":"9、DCC转EDC","title_tokens":["9","转","edc","dcc","、"]},{"location":"documentation/sdkapi/#_7","text":"字段 类型 含义 备注 备注 additionalResData String 受理方标识码 无 afterTransCode String 原交易类型 无 batchNum String 批次号 无 billingAmt String 持卡人扣帐金额 无 billingCurr String 持卡人扣帐货币代码符号，三位字母 例如USD billingCurrNum String 持卡人扣帐货币代码,三位数字 无 cardBrand String 国际信用卡公司代码 无 cardNo String 银行卡号 无 cardType String 刷卡方式 无 cashierName String 收银员 无 cashierNum String 收银员号 无 clearingDate String 清算日期 无 compInfoA1 String 签购单收单行 无 compInfoA2 String 签购单商户号 无 compInfoA3 String 签购单终端号 无 compInfoA4 String markup 无 compInfoA6 String 借贷记标识 无 compInfoA7 String 营销信息 无 compInfoA8 String 二维码信息 无 coupon String 支付宝/微信优惠金额 无 field55 String IC卡交易的TAG信息 无 insCode String 受理方标识码 无 localTransDate String 受卡方所在地日期 无 localTransTime String 受卡方所在地时间 无 merCode String 受卡方标识码（商户号） 无 merDiscount String 商家优惠金额 无 originTraceNum String 原交易凭证号 无 outOrderNum String 外部订单号 无 posInputStyle String 服务点输入方式码 无 processflag String 扫码支付09状态的交易是否成功 附件表1 refNum String 检索参考号 无 respCode String 应答码 \"00\"表示成功 revAuthCode String 授权标识应答码 无 revInsCode String 附加响应数据 无 revOrderNum String 自定义域，用于扫码支付业务。 无 scanCodeId String 扫码号 无 termCode String 终端号 无 traceNum String 受卡方系统跟踪号 合作方交易流水 transAmt String 交易金额 无 transCode String 交易类型码 无 transCurr String 交易货币代码 无 transDate String 原交易日期 无 transDatetime String 受卡方所在地日期＋受卡方所在地时 无 transRate String 持卡人扣帐汇率 无","text_tokens":["字","mercode","origintracenum","符号","processflag"," ","日期","是否","，","transrate","数字","系统","无","订单","revordernum","应答","终端","流水","coupon","usd","respcode","时","信息","合作","字母","含义","三位","商户","方","billingcurrnum","additionalresdata","compinfoa3","汇率","信用","billingamt","方式","compinfoa1","revinscode","检索","货币","clearingdate","的","localtranstime","所在地","输入","1","（","银员","业务","compinfoa4","。","定义","＋","签购","表","响应","自","刷卡","代码","string","标识","tracenum","收银","compinfoa2","附加","号","merdiscount","银行卡","tag","00","transamt","ic卡","状态","batchnum","billingcurr","段","信用卡","用于","支付宝","受卡方","订单号","单行","inscode","收银员","清算","附件",",","参考","数据","凭证","cardno","标识码","compinfoa6","卡人","revauthcode","transcurr","表示","transdatetime","transdate","单号","outordernum","成功","/","所在","持卡人","点","商家","原","compinfoa7","外部","优惠","扫码","二维","交易","cardtype","交易类型","单收","金额","授权","cardbrand","支付","transcode","termcode","posinputstyle","时间","服务","码","扣","单","持卡","跟踪","国际","\"","受理","备注","营销","定义域","cashiername","例如","）","公司","cashiernum","借贷","二维码","批次","银行","记","帐","09","markup","scancodeid","微信","localtransdate","合作方","aftertranscode","compinfoa8","refnum","类型","field55"],"title":"交易结果字段说明","title_tokens":["字","段","结果","交易","说明"]},{"location":"documentation/sdkapi/#10cfcardsdk","text":"如果不需要自定义刷卡类、密码键盘样式。银行卡交易可直接使用CFCardSDK方法，在调用的Activity中onActivityResult中接收交易结果 /** * 银行卡消费 * * @param context context对象 * @param amount 消费金额 */ CFCardSDK.consumeOfBank(context, amount); /** * 银行卡撤销 * * @param context context对象 * @param trans 原交易信息 */ CFCardSDK.cancelOfBank(context, trans); /** * 银行卡退货 * * @param context context对象 * @param refNum 参考号 * @param tradeDate 交易时间 * @param tradeAmount 交易金额 */ CFCardSDK.refundOfBank(context,refNum,tradeDate,tradeAmount); /** * 银行卡余额查询 * * @param context context对象 */ CFCardSDK.balanceOfBank(context); /** * 预授权 * * @param context context对象 * @param amount 预授权金额 */ CFCardSDK.preAuth(context,amount); /** * 预授权撤销 * * @param context context对象 * @param amount 预授权金额 * @param tradeDate 预授权时间 * @param revAuthCode 授权码 */ CFCardSDK.preAuthCancel(context,amount,tradeDate,revAuthCode) ; /** * 预授权完成 * * @param context context对象 * @param amount 预授权金额 * @param tradeDate 预授权时间 * @param revAuthCode 授权码 */ CFCardSDK.preAuthComp(context, amount,tradeDate,revAuthCode) /** * 预授权完成撤销 * * @param context context对象 * @param trans 原预授权完成交易 */ CFCardSDK.preAuthCompCancel(context,trans) ; /** * dcc转edc * * @param context context对象 * @param trans 原交易 */ CFCardSDK.dcc2edc(context,trans); onActivityResult(int requestCode, int resultCode, Intent data) 信息含义与Extra信息获取方式 返回信息包括 resultCode 取值范围 Constants.RESULT_OK : 0x555;//交易有结果返回，但不代表本笔交易成功 Constants.RESULT_ERROR : 0x666;//交易出现异常 交易类型： int transType = intent.getIntExtra(Constants.TRANS_TYPE, Constants.UNKNOWN); transType 取值范围： Constants.BANK_CONSUME : 0x001; // 消费 Constants.QR_CONSUME : 0x002; // 扫码 Constants.DCC_TO_EDC : 0x003; // dcc转edc Constants.QR_CANCEL : 0x004; // 扫码撤销 Constants.BANK_CANCEL : 0x005; // 撤销 Constants.BANK_REFUND : 0x006; // 退货 Constants.BANK_BALANCE : 0x007; // 余额查询 Constants.BANK_AUTH : 0x008; // 预授权 Constants.BANK_AUTH_CANCEL : 0x009; // 预授权撤销 Constants.BANK_AUTH_COMP : 0x010; // 预授权完成 Constants.BANK_AUTH_COMP_CANCEL : 0x011; // 预授权完成取消 Constants.FROM_BANK_REFUND_ACTIVITY : 0x012; // 银行卡退货 Constants.FROM_QR_REFUND_ACTIVITY : 0x013; // 扫码退货 Constants.FROM_TIP_TAKE_ACTIVITY : 0x014; // 收取小费 Constants.FROM_TIP_REVOKE_ACTIVITY : 0x015; // 小费撤销 交易结果 当resultCode == Constants.RESULT_OK时，会有结果返回 Trans trans = data.getParcelableExtra(Constants.CONSUME_RESULT); Intent中Extra信息的Key由com.cardinfolink.sdk.constant.Constants获取","text_tokens":["0x014","(","0x008","调用","auth","tip","dcc2edc"," ","comp","onactivityresult","本笔","，","与","结果","消费","中","bank","0x005","cancel","但","0x004","revoke","0x010","0x011","在","时","小费","信息","unknown","sdk","方法","0x009","含义","键盘","有","收取","对象","resultcode","balanceofbank","取值","如果","代表","自定","类","方式","的","qr","constant","from","取消","0x666","activity","0x555","cardinfolink","tradeamount","0x013","preauthcancel","。","to","0x007","撤销","自定义","getparcelableextra","定义","result","接收","tradedate","cfcardsdk","刷卡","样式","getintextra","trans","take","会","requestcode","返回","*","号","constants","银行卡","com","transtype","可","error","直接","cancelofbank","参考",",","获取","type","需要","consumeofbank","amount","revauthcode","@","refund","0x012","0x001","由","成功","/","不","使用","preauthcompcancel",".","原","：",":","extra","扫码","交易","0x003","交易类型","金额","授权","出现","出现异常","balance","原预","ok","范围","data","时间","码","异常","预","0x002","consume","key",")","密码","preauth","param","0x015","银行","0x006","intent","查询","edc","dcc","余额","退货","preauthcomp","当","=","int","完成","转","context","包括","refundofbank",";","_","refnum","类型","、"],"title":"10、CFCardSDK工具类","title_tokens":["类","cfcardsdk","10","工具","、"]},{"location":"documentation/sdkapi/#b","text":"扫码相关的交易则是不依赖 POS 机器的读卡模块的,但是你需要将 微信 或者 支付宝 的二维码读出来传给扫码消费接口,扫码可以使用第三方库,如 zxing 。 /** * 扫码消费 */ CILRequest request = new CILRequest(); request.setAmount(amount); request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） CILSDK.consumeQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { // 处理扫码消费结果 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： /** * resultCode = response.getTrans().getRespCode(); * if (\"09\".equals(resultCode) ) { * CILSDK.queryQr(); // `queryQr` 方法见下文 * } */ } @Override public void onError(Parcelable cilRequest, Exception e) { // 扫码消费出错 } }); /** * 扫码撤销 */ request.setAmount(amount);//原交易金额 request.setBatchNum(batchNum);//原交易批次号 request.setTraceNum(traceNum);//原交易凭证(流水)号 request.setReferenceNumber(refNum); //原交易参考号 CILSDK.revokeConsumeQr(request, new Callback<CILResponse>()）{ ... } /** * 扫码退货 */ request.setAmount(amount);//退款金额 request.setReferenceNumber(serialNum);//原交易参考号 request.setTransDatetime(tradeDate);//原交易时间 CILSDK.returnConsumeQr(request, new Callback<CILResponse>()） /** * 扫码查询 */ request.setBatchNum(response.getTrans().getBatchNum()); request.setTraceNum(response.getTrans().getTraceNum()); request.setPeriod(10000L);//10s request.setLimitTime(6);//6 次 request.setReferenceNumber(response.getTrans().getRefNum()); request.setPosInputStyle(response.getTrans().getPosInputStyle()); request.setScanCodeId(response.getTrans().getScanCodeId()); request.setAmount(response.getTrans().getTransAmt()); CILSDK.queryQr(request, new Callback<CILResponse>() { ... } /** * 扫码消费查询,只查询一次，不含取消接口 * * @param request * @param listener */ CILRequest request = new CILRequest(); request.setBatchNum(response.getTrans().getBatchNum()); request.setTraceNum(response.getTrans().getTraceNum()); request.setReferenceNumber(response.getTrans().getRefNum()); request.setPosInputStyle(response.getTrans().getPosInputStyle()); request.setScanCodeId(response.getTrans().getScanCodeId()); public static void queryQrJustOnce(CILRequest request, Callback<CILResponse> listener) { ... } /** * 扫码取消 * 对于09状态的消费订单，最终需要取消、关单 * @param request * @param listener */ CILRequest cilRequest = new CILRequest(); cilRequest.setOriginalTradeDate(response.getTrans().getTransDate()); cilRequest.setAmount(response.getTrans().getTransAmt()); cilRequest.setBatchNum(response.getTrans().getBatchNum()); cilRequest.setTraceNum(response.getTrans().getTraceNum()); cilRequest.setPosInputStyle(response.getTrans().getPosInputStyle()); cilRequest.setReferenceNumber(response.getTrans().getRefNum()); public static void voidQr(CILRequest request, Callback<CILResponse> listener) { ... } /** * 扫码预授权 */ CILRequest request = new CILRequest(); request.setAmount(amount); request.setScanCodeId(result);//二维码code request.setOrderId(orderId);//外部订单号（可选参数） CILSDK.preAuthQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { // 处理扫码预授权结果 // 如果结果返回`09`，需要查询该订单获取最终结果，如下： /** * resultCode = response.getTrans().getRespCode(); * if (\"09\".equals(resultCode) ) { * CILSDK.queryQr(); // `queryQr` 方法见下文 * } */ } @Override public void onError(Parcelable cilRequest, Exception e) { //扫码预授权出错 } }); /** * 扫码预授权撤销 */ CILRequest request = new CILRequest(); request.setAmount(transAmt);//原预授权交易金额 request.setReferenceNumber(revAuthCode);//原预授权交易参考号 request.setTransDatetime(transDate);//原预授权交易时间 request.setBatchNum(curTrans.getBatchNum());//原预授权交易批次号 request.setTraceNum(curTrans.getTraceNum());//原预授权交易凭证（流水）号 CILSDK.revokePreAuthQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); /** * 扫码预授权完成 */ CILRequest request = new CILRequest(); request.setAmount(transAmt);//原预授权交易金额 request.setReferenceNumber(revAuthCode);//原预授权交易参考号 request.setTransDatetime(transDate);//原预授权交易时间 CILSDK.preAuthCompleteQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } }); /** * 扫码预授权完成撤销 */ CILRequest request = new CILRequest(); request.setAmount(transaction.getTransAmt());//原预授权完成交易金额 request.setBatchNum(transaction.getBatchNum());//原预授权完成交易批次号 request.setTraceNum(transaction.getTraceNum());//原预授权完成交易凭证（流水）号 request.setReferenceNumber(transaction.getRefNum());//原预授权完成交易参考号 CILSDK.revokePreAuthCompleteQr(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable cilRequest, Exception e) { ... } });","text_tokens":["(","gettransamt","onresult","gettrans","equals",">"," ","code","queryqr","voidqr","出错","setreferencenumber","，","listener","结果","消费","读卡","settracenum","serialnum","setorderid","订单","transaction","该","流水","方法","revokeconsumeqr","则","revokepreauthqr","resultcode","exception","settransdatetime","void","getrespcode","如果","最终","关单","gettracenum","读出","e","response","6","preauthcompleteqr","的","取消","如","10000l","退款","（","public","如下","getscancodeid","。","getbatchnum","撤销","}","result","new","tradedate","static","`","相关","次","onerror","cilrequest","tracenum","setposinputstyle","pos","或者","返回","setperiod","依赖","setamount","*","号","preauthqr","curtrans","queryqrjustonce","transamt","你","可","状态","batchnum","可以","if","setscancodeid","支付宝","订单号","...","选","cilsdk","setbatchnum","接口","出来",",","参考","setlimittime","获取","parcelable","consumeqr","orderid","凭证","处理","需要","只","gettransdate","revauthcode","amount","returnconsumeqr","@","transdate","单号","第三","不","使用","/","参数",".","原","{","外部","：","含","扫码","二维","交易","库","金额","授权","request","支付","原预","override","模块","10s","是","时间","传给","预","将",")","\"","<","三方","下文","一次","）","zxing","param","cilresponse","getposinputstyle","setoriginaltradedate","但是","第三方","二维码","批次","getrefnum","查询","09","callback","微信","对于","退货","机器","revokepreauthcompleteqr","=","完成","读出来",";","见下文","refnum","、"],"title":"b、扫码交易","title_tokens":["扫码","b","、","交易"]},{"location":"documentation/sdkapi/#_8","text":"智能 POS SDK 分别提供了近7天的 账单列表查询 和 账单统计接口 接口,接口会根据 type 值确定返回 银行卡账单 或 扫码账单 。 交易成功还是失败最终以返回账单中应答码为准，见 应答码表 。 交互设计建议：交易中，具体来说，调用CILSDK.consumeQr()或是CILSDK.consume()方法时，当因为网络中断进入onError callback时，建议在交互中加入 查询账单列表 的逻辑，这样交易失败后可方便收银员通过账单来确认这笔订单的实际状态。 注意：对于 09 （请求正在处理中）状态的交易账单数据，还需要看 处理标志位 才能判定此次交易成功与否，使用 getProcessFlag() 获取。 当 processFlag 为 '0' 时，此次交易成功；当 processFlag 为非'0' 时，此次交易失败，见 处理标志表 。 /** * 获取账单列表 异步 * * @param page 从0开始 * @param size 每页返回的条数 * @param type 账单类型 * <ul> * <li>TransConstants.CARD_BILL:银行卡账单</li> * <li>TransConstants.QR_BILL:扫码账单</li> * </ul> * */ CILSDK.getBillsAsync(page, size,@BillType int txnType, new Callback<CILResponse>() { @Override public void onResult(final CILResponse response) { if (null != response && 0 == response.getStatus()) { //账单获取成功 Trans[] trans = response.getTxn(); //账单数据,字段详情见 Trans } } @Override public void onError(Parcelable p, Exception ex) { //账单获取出错 } }); /** * 获取账单统计信息 异步 * @param type 账单类型 * <ul> * <li>TransConstants.ALL_BILL:所有账单</li> * <li>TransConstants.CARD_BILL:银行卡账单</li> * <li>TransConstants.QR_BILL:扫码账单</li> * </ul> * */ CILSDK.getBillStatAsync(@BillType int txnType, new Callback<CILResponse>() { @Override public void onResult(CILResponse response) { if (null != response && 0 == response.getStatus()) { //账单获取成功 } } @Override public void onError(Parcelable p, Exception ex) { //账单获取出错 } }); /** * 依据凭证号，获取当前批次下的订单详情 * 异步操作 * * @param traceNum 凭证号 * @param listener * @return * @throws Exception */ CILSDK.getBillByTraceNumAsync(String traceNum, new Callback<CILResponse>(){ ... }); SDK 的网络部分使用的是第三方库 okhttp ,以上账单接口分别还提供了相对应的同步接口 getBills 和 getBillStat 。 对于异步接口来说,都会返回一个 Call 对象,你可以在应用出错的时候调用 call.cancel() 取消这次请求,以免造成内存泄露。","text_tokens":["字","(","应用","onresult","确认","这笔","调用",">","li","processflag","billtype"," ","一个","出错","详情","来","，","listener","和","中","值","cancel","泄露","订单","应答","非","建议","才能","在","时","依据","信息","因为","见","网络","后","sdk","账单","方法","0","txntype","以","方便","getstatus","]","分别","card","对象","确定","为准","通过","；","条数","内存","exception","void","最终","判定","操作","或","标志","response","以上","ul","同步","或是","为","的","设计","qr","取消","下","p","当前","!","[","ex","call","（","final","public","银员","。","时候","天","transconstants","}","所有","okhttp","new","应","表","实际","onerror","string","tracenum","收银","还","trans","pos","会","都","返回","了","每页","列表","*","号","注意","银行卡","进入","你","可","状态","null","getbillstat","7","可以","中断","异步","段","if","...","开始","cilsdk","加入","接口","收银员","具体",",","数据","获取","parcelable","consumeqr","getprocessflag","凭证","还是","type","处理","需要","逻辑","请求","@","正在","根据","成功","/","提供","使用","第三","getbills","这次",".","失败","位","getbillbytracenumasync","{","：",":","size","扫码","库","交易","return","page","造成","bill","override","是","码","'","getbillsasync","getbillstatasync","consume","&&","throws",")","部分","<","统计","与否","三方","码表","gettxn","从","近","）","param","cilresponse","第三方","以免","这样","交互","批次","银行","来说","查询","all","09","callback","智能","相对","对于","当","看","=","int","此次",";","_","类型","具体来说"],"title":"账单查询","title_tokens":["查询","账单"]},{"location":"documentation/sdkapi/#_9","text":"结算需求主要用于每日交易结束时或收银员交接班时,对某段时间内的账款核对。商户每日交易结束后,收银员需要统计并核对所有的交易,核对交易统计准确后结算，打印出结算单。 结算会涉及到一个概念-- 批次号 ,我们在前面的交易都会传入一个批次号给 request ,调用结算之后,后续的交易需要将这个批次号加1,因为此批次已经打包结算掉了。 //batchNum 批次号 CILSDK.transSettleAsync(batchNum, new Callback<CILResponse>() { @Override public void onResult(final CILResponse response) { //打印结算单 } @Override public void onError(Parcelable cilRequest, Exception e) { //结算出错 } }); 如果使用讯联样式结算UI、逻辑直接使用 注意,使用SettleDaoUtil工具类是必须先初始化，SettleDaoUtil.getInstance().init(); SettleDaoUtil.getInstance().gotoLiquidation(context)","text_tokens":["(","onresult","调用",">"," ","一个","必须","初始","我们","getinstance","gotoliquidation","出错","，","打印","--","在","时","给","因为","后","transsettleasync","商户","settledaoutil","init","内","exception","void","如果","或","准确","讯联","主要","e","response","类","后续","段时间","的","到","1","final","涉及","public","号加","银员","结算","。","所有","}","某","new","每日","样式","传入","onerror","工具","cilrequest","收银","接班","并","会","交接班","都","了","号","注意","batchnum","先","用于","cilsdk","直接","收银员",",","结束","parcelable","对","需要","需求","逻辑","@","掉","/","使用",".","{","初始化","交易","此","概念","request","ui","override","是","时间","单","将",")","<","之后","统计","前面","cilresponse","打包","账款","出","批次","这个","交接","callback","核对","已经","context",";","、"],"title":"结算","title_tokens":["结算"]},{"location":"documentation/sdkapi/#_10","text":"本模块可用于根据交易信息打印所需的消费票据。接口不仅提供了一套固定格式的小票样式，而且还可以根据需要自定义打印样式。 主要功能包括小票打印、二维码打印、条形码打印以及图片打印。 特别注意: 中国人民银行和中国银联为了规范市场上的POS机终端，要求终端打印的签购单必须合乎规范，规范内容包括必须打印的字段与正确的字段内容。 签购单规范详情见 签购单规范 打印银行卡类交易、扫码类交易小票 /** trans 交易信息 * lineBreak 小票结尾需要走纸换行的行数 * formatTransCode @FormatTransCode String类型，小票的交易类型 * kind @ReceiptSubtitle int类型，小票的子标题，判断是商户联或者是客户联 * isForeignTrans 是否是外卡类交易 */ CILSDK.printKindsReceipts(trans,lineBreak,formatTransCode, kind, isForeignTrans, new Callback<PrinterResult>(){ @Override public void onResult(PrinterResult response) { if (null ！= printerResult && !\"打印成功\".equals(printerResult.toString())) { //打印成功 } } @Override public void onError(Parcelable cilRequest, Exception e) { //打印失败 } }); 打印结算小票 /** * 打印结算小票 * * transSettles 结算信息List * transDatetime 结算时间 * lineBreak 打印结尾换行数 * formatTransCode 结算类型；TransConstants.TRANS_SETTLE_DETAILS：结算详情小票；TransConstants.TRANS_SETTLE_TOTAL：结算统计小票 * callback 回调 */ CILSDK.printSettleReceipts(transSettles, transDatetime,batchNum, lineBreak, formatTransCode, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 自定义打印 注意：使用自定义打印方法时，若打印内容超过2000个字符，请使用分段打印方式，否则可能出现DeviceRTException /** * 根据二进制数据打印(根据打印规范用户自定义打印小票样式) * * buffer 打印内容 * lineBreak 换行数 * callback 回调 */ CILSDK.printBufferReceipt(buffer, lineBreak,new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印二维码 /** * 打印二维码 * * qrCode 二维码内容 * position 打印位置 0:左对齐；1居中；2：右对齐 * width 二维码宽度 * callback 回调 * */ CILSDK.printQRCode(qrCode,position,width,lineBreak,new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印条形码 /** * 打印条形码 * * barCode 条形码数字 * position 条形码位置 0:左对齐；1居中；2：右对齐 * lineBreak 换行数 * callback 回调 */ CILSDK.printBarCode(String barCode, int position, int lineBreak, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } }); 打印图片 /** * 打印图片 * * bitmap 图片Bitmap * lineBreak 换行数 * offset 偏移量 * callback 回调 * */ CILSDK.printImage(bitmap, lineBreak, offset, new Callback<PrinterResult>() { @Override public void onResult(PrinterResult result) { if (null != result && !\"打印成功\".equals(result.toString())){ } } @Override public void onError(Parcelable cilRequest, Exception e) { } });","text_tokens":["字","(","位置","onresult","银联","equals",">","中国人民银行"," ","必须","是否是","合乎","2","详情","是否","，","与","total","数字","消费","和","打印","details","printimage","kind","可能","规范市场","终端","width","时","信息","见","0","方法","联","printqrcode","而且","商户","transsettles","需","若","外卡","一套","；","对齐","exception","position","void","行数","自定","个字符","主要","规范","e","response","类","bitmap","方式","printbufferreceipt","左","的","条形码","printerresult","特别","格式","!","偏移量","settle","1","回调","public","请","结算","。","进制","自定义","定义","}","transconstants","result","new","签购","样式","qrcode","string","onerror","formattranscode","结尾","cilrequest","trans","还","pos","以及","或者","了","本","*","注意","银行卡","判断","票据","2000","可","子标题","null","batchnum","可以","段","用于","if","用户","图片","偏移","二进制","cilsdk","！","市场","形码","接口","printkindsreceipts",",","数据","固定","parcelable","否则","人民","需要","transdatetime","printsettlereceipts","@","要求","根据",";","成功","数","/","提供","使用","宽度","上",".","走纸","tostring","失败","{","：",":","扫码","二维","交易","交易类型","出现","linebreak","override","模块","是","时间","内容","list","所","机","超过","单","&&","offset",")","barcode","\"","条形","<","统计","标题","中国银联","receiptsubtitle","buffer","devicertexception","国人","二维码","客户","银行","小票","中国","callback","不仅","居中","右","换行","为了","isforeigntrans","=","int","分段","printbarcode","包括","功能","_","字符","类型","、","正确"],"title":"打印","title_tokens":["打印"]},{"location":"documentation/sdkapi/#_11","text":"考虑到使用 SDK 的时候可能还会有其他需求,比如 获取 POS 机的 SN 号 、 设置密钥索引 等,在这里,我们也提供了一部分接口。 获取 SDK 版本 //版本名 String versionName = CILSDK.VERSION_NAME; //版本号 int versionCode = CILSDK.VERSION_CODE; 获取 SN 号 //SN号 String snCode = CILSDK.getDeviceSN(); 设置流水号 //serialNum范围：1~999999 boolean isSuccess = CILSDK.setSerialNum(int serialNum); 获取流水号 //序列号 int serialNum = CILSDK.getSerialNum(); 设置批次号 //batchNum范围：1~999999 boolean isSuccess = CILSDK.setBatchNum(int batchNum); 获取批次号 //批次号 int batchNum = CILSDK.getBatchNum(); 设置联迪密钥区 //1-15的设值范围 CILSDK.setTingA8KeyIndex(2); 设置密钥索引 //分别对应MAIN MAC PIN MES //1-255的设值范围 //可以使用下方提供数值,也可以根据自身程序设值 CILSDK.setTingKeyIndex(4,101,10,150); 以上两个方法请在连接刷卡器(CILSDK.connect)之前使用","text_tokens":["(","sn"," ","一部","我们","code","2","255","serialnum","4","可能","流水","下方","在","部分","sdk","setserialnum","方法","10","version","有","密钥","versionname","分别","两个","main","等","考虑","以上","也","999999","的","connect","到","mac","1","序列","版本","请","。","getbatchnum","时候","区","设值","刷卡","程序","string","名","settinga8keyindex","pos","版本号","了","settingkeyindex","号","batchnum","pin","可以","其他","15","cilsdk","setbatchnum","接口",",","获取","versioncode","需求","101","连接","刷卡器","根据","/","使用","提供","对应",".","流水号","：","-","150","boolean","设置","联迪","这里","之前","范围","机","sncode","getdevicesn",")","name","getserialnum","~","mes","一部分","序列号","批次","还会","比如","issuccess","=","int","索引","数值",";","_","自身","、"],"title":"其他设置","title_tokens":["其他","设置"]},{"location":"documentation/sdkapi/#_12","text":"CILPayUtil /** * 将respCode翻译成对应中文解释 */ CILPayUtil.translate(context, respCode)); /** * 将Trans类中的transCode翻译成打印所需的对象 */ CILPayUtil.getFormatTransCode(transCode); /** * 根据billingCurr判断交易是否为外卡类的DCC交易 */ CILPayUtil.isDCCPay(billingCurr); /** * 判断交易是否成功 */ CILPayUtil.isTransSuccess(trans); /** * 根据Trans类中的transCode判断交易是否属于扫码类交易 */ CILPayUtil.isQrPay(transCode); ReceiptFormatUtils /** * 根据Trans类中的TransCode翻译成对应的中文解释 */ ReceiptFormatUtils.getTransType(transCode); /** * 将明文的卡号修改为\"前六后四中间为四个*\"的样式 */ ReceiptFormatUtils.handleCardNum(cardNum);","text_tokens":["(","transcode","对象","需","*","外卡","解释","handlecardnum","所","判断"," ","属于","将",")","getformattranscode","\"","cardnum","billingcurr","类中","类","是否","中间","为","的","receiptformatutils","isdccpay","四",",","打印","translate","cilpayutil","修改","前六后","gettranstype","翻译","译成","根据","四个","成功","respcode","/","dcc","istranssuccess","对应","卡号",".","样式","中文","扫码","交易","context","翻译成","trans",";","isqrpay","明文"],"title":"工具类","title_tokens":["类","工具"]},{"location":"documentation/sdkapi/#_13","text":"Copyright (c) 2016 cardinfolink.com","text_tokens":["(","copyright","c","2016","cardinfolink","com"," ",")","."],"title":"许可证","title_tokens":["许可","许可证"]},{"location":"documentation/sdkapi/#javadoc","text":"java document 详情见 javadoc","text_tokens":["见","详情","document"," ","java","javadoc"],"title":"JAVADOC","title_tokens":["javadoc"]},{"location":"documentation/signIn/","text":"签到 签到其实也就是更新工作密钥的一个过程 ( 下载工作密钥+装载工作密钥 ),讯联网关平台要求应用需要每天签到一次。 CILSDK.signIn(new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { //签到成功 } @Override public void onError(Parcelable cilRequest, Exception e) { //签到出错 } });","text_tokens":["(","应用","override","装载","onresult",">","exception","void","平台"," ","一个","过程",")","每天","<","e","出错","一次","也","更新","的","联网","cilsdk","cilresponse",",","parcelable","关","需要","就是","public","工作","@","要求","callback","。","成功","signin","/","}",".","+","new","{","讯","onerror","密钥","cilrequest","下载",";","其实","签到"],"title":"signIn","title_tokens":["signin"]},{"location":"documentation/test/","text":"目录一 dd cc 目录二 dd cc 目录三","text_tokens":["cc","二"," ","dd","一","目录","三"],"title":"3. TEST","title_tokens":["test"," ",".","3"]},{"location":"documentation/test/#_1","text":"dd cc","text_tokens":["dd"," ","cc"],"title":"目录一","title_tokens":["一","目录"]},{"location":"documentation/test/#_2","text":"dd cc","text_tokens":["dd"," ","cc"],"title":"目录二","title_tokens":["二","目录"]},{"location":"documentation/test/#_3","text":"","text_tokens":[],"title":"目录三","title_tokens":["目录","三"]},{"location":"documentation/tip/","text":"小费 注意: 通过对一笔交易收取小费。 小费最多收取交易金额的20% 小费只能成功收取一次 消费撤销后不能再次收取 CILRequest request = new CILRequest(); request.setCardNum(cardNumber); request.setReferenceNumber(trans.getRefNum()); request.setBatchNum(trans.getBatchNum()); request.setTraceNum(trans.getTraceNum()); request.setTransDatetime(trans.getTransDatetime()); request.setRevAuthCode(trans.getRevAuthCode()); request.setAmount(amount);//小费金额 CILSDK.takeTip(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable parcelable, Exception e) { ... } }); 小费撤销 CILRequest request = new CILRequest(); request.setCardNum(cardNo); request.setAmount(trans.getTransAmt()); request.setReferenceNumber(trans.getRefNum()); request.setRevAuthCode(trans.getRevAuthCode()); request.setBatchNum(trans.getBatchNum()); request.setTraceNum(trans.getTraceNum()); request.setTransDatetime(trans.getTransDatetime()); CILSDK.revokeTip(request, new Callback<CILResponse>() { @Override public void onResult(CILResponse cilResponse) { ... } @Override public void onError(Parcelable parcelable, Exception e) { ... } });","text_tokens":["taketip","(","gettransamt","override","onresult","revoketip","20%","setamount","通过",">","注意","settransdatetime","exception","void"," ","gettracenum",")","<","e","gettransdatetime","不能","一笔","cardnumber","...","一次","setreferencenumber","的","setbatchnum","cilsdk","消费","settracenum","cilresponse","最","收取","再次",",","parcelable","cardno","getrevauthcode","对","getrefnum","setrevauthcode","amount","public","@","callback",";","。","成功","getbatchnum","撤销","/","小费","只能",".","setcardnum","}","后","new","{",":","=","onerror","交易","多","cilrequest","trans","金额","request"],"title":"Tip","title_tokens":["tip"]},{"location":"documentation/transSettle/","text":"结算 结算需求主要用于每日交易结束时或收银员交接班时,对某段时间内的账款核对。商户每日交易结束后,收银员需要统计并核对所有的交易,核对交易统计准确后结算，打印出结算单。 结算会涉及到一个概念-- 批次号 ,我们在前面的交易都会传入一个批次号给 request ,调用结算之后,后续的交易需要将这个批次号加1,因为此批次已经打包结算掉了。 //batchNum 批次号 CILSDK.transSettleAsync(batchNum, new Callback<CILResponse>() { @Override public void onResult(final CILResponse response) { //打印结算单 } @Override public void onError(Parcelable cilRequest, Exception e) { //结算出错 } }); 如果使用讯联样式结算UI、逻辑直接使用 注意,使用SettleDaoUtil工具类是必须先初始化，SettleDaoUtil.getInstance().init(); SettleDaoUtil.getInstance().gotoLiquidation(context)","text_tokens":["(","onresult","调用",">"," ","一个","必须","初始","我们","getinstance","gotoliquidation","出错","，","打印","--","在","时","给","因为","后","transsettleasync","商户","settledaoutil","init","内","exception","void","如果","或","准确","讯联","主要","e","response","类","后续","段时间","的","到","1","final","涉及","public","号加","银员","结算","。","所有","}","某","new","每日","样式","传入","onerror","工具","cilrequest","收银","接班","并","会","交接班","都","了","号","注意","batchnum","先","用于","cilsdk","直接","收银员",",","结束","parcelable","对","需要","需求","逻辑","@","掉","/","使用",".","{","初始化","交易","此","概念","request","ui","override","是","时间","单","将",")","<","之后","统计","前面","cilresponse","打包","账款","出","批次","这个","交接","callback","核对","已经","context",";","、"],"title":"transSettle","title_tokens":["transsettle"]},{"location":"flowChart/overview/","text":"一、激活环节 只需要在初次使用终端时操作一次，内容包括了激活、初始化、下载参数。 * 序列图 激活 激活设备，有老版和新版两种激活方式 新版激活接口(入参激活码)： CILSDK.activeWithCodeSync(activeCode, deviceToken, new Callback ()); 老版激活接口： CILSDK.active(merCode, termCode, new Callback<CILResponse>() 参数 参数名称 样例 备注 merCode 商户代码 021290050110001 15位数字，激活时必填 termCode 终端代码 00000001 8位数字，激活时必填 new Callback<CILResponse> 是回调函数 参数下载 参数下载在主要应用在以下两种情况： 1. 激活时下载参数 2. 参数修改后下载参数 CILSDK.downloadParams(merCode, termCode, new com.cardinfolink.pos.listener.Callback<CILResponse>() 其中， new com.cardinfolink.pos.listener.Callback<CILResponse>() 是回调函数 初始化 初始化主要是终端密钥下载，包含了主密钥下载和工作密钥下载。其主要应用在以下两种情况： 1.激活时初始化密钥 2.需要更新密钥时初始化 CILSDK.downloadParamsWithProgress(new ProgressCallback<CILResponse>() 二、签到 签到其实就是一个更新密钥的过程，激活时已经覆盖了每日一次签到的操作。 CILSDK.signIn(new Callback<CILResponse>() 三、配置 可配置参数 1. 批次号、流水号 批次号用于结算，流水号（凭证号）定位本批每一笔交易唯一索引； 设置批次号 boolean isSuccess = CILSDK.setBatchNum(int batchNum); 获取批次号 int batchNum = CILSDK.getBatchNum(); 设置流水号 boolean isSuccess = CILSDK.setSerialNum(int serialNum); 获取流水号 int serialNum = CILSDK.getSerialNum(); 四、打印 交易成功后，需要打印签购单，一般打印两联：商户联和客户联。商户联在持卡人签名后由商户保存。交易成功后，会自动打印商户联。 需要补打小票时，可以早交易明细中找到补打功能，打印商户联。 序列图 打印银行类／扫码交易小票 CILSDK.printKindsReceipts(trans,lineBreak,formatTransCode, kind, isForeignTrans, bitmap, new Callback<PrinterResult>() 参数 参数名称 trans 交易信息 lineBreak 小票结尾需要走纸换行的行数 formatTransCode 小票的交易类型（String类型） kind 小票的子标题，判断是商户联或者是客户联(int) isForeignTrans 是否是外卡类交易 bitmap logo图标 Callback 回调 打印结算小票 CILSDK.printSettleReceipts(transSettles, transDatetime,batchNum, lineBreak, formatTransCode, new Callback<PrinterResult>() 参数 参数名称 transSettles 结算信息List transDatetime 结算时间 batchNum 批次号 lineBreak 打印结尾换行数 formatTransCode 结算类型 Callback 回调 自定义打印 CILSDK.printBufferReceipt(buffer, lineBreak,new Callback<PrinterResult>() 参数 参数名称 buffer 打印内容 linebreak 打印结尾换行数 Callback 回调 打印二维码 CILSDK.printQRCode(qrCode,position,width,lineBreak,new Callback<PrinterResult>() 参数 参数名称 qrCode 二维码 position 二维码位置 width 二维码大小 lineBreak 打印结尾换行数 Callback 回调 打印条形码 CILSDK.printBarCode(String barCode, int position, int lineBreak, new Callback<PrinterResult>() 参数 参数名称 barCode 条形码数字 position 条形码位置 lineBreak 打印结尾换行数 Callback 回调 打印图片 CILSDK.printImage(bitmap, lineBreak, offset, new Callback<PrinterResult>() 参数 参数名称 bitmap 图片Bitmap lineBreak 换行数 offset 偏移量 callback 回调 五、消费 1. 消费（插卡、刷卡、挥卡、手机NFC ） 支持开发者调用接口实现商家银行卡收款需求。 主要类型包括刷卡、插卡、挥卡以及手机NFC支付。 序列图 APP界面输入消费金额，选择银行卡支付，发起银行卡付款请求 SDK处理交易，返回应答码 APP翻译应答码，输出结果 如果消费成功，APP发送打印请求 SDK返回打印结果 2. 消费【扫码】 支持开发者调用接口实现商家扫码收款需求。 主要类型包括微信扫码和支付宝扫码。 序列图 APP界面输入消费金额，扫描二维码获取付款码信息，发起扫码付款请求 SDK处理消费请求，返回应答码 APP翻译应答码，输出结果 如果消费成功，APP发送打印请求 SDK返回打印结果 六、撤销 支持开发者调用接口实现商家撤销当日交易需求。 包括银行卡撤销和扫码撤销。 序列图 APP界面输入原交易凭证号，核对该笔交易，发起撤销请求 SDK处理撤销请求，返回应答码 APP翻译应答码，输出结果 撤销成功时，APP发送打印请求 SDK返回打印结果 七、退货 支持开发者调用接口实现商家非当日交易的退货需求。 包括银行卡退货和扫码退货。 序列图 APP界面输入订单相关信息（参考号／交易日期／退货金额），核对该笔交易，发起退货请求 SDK处理退货请求，返回应答码 APP翻译应答码，输出结果 退货成功时，APP发送打印请求 SDK返回打印结果 八、预授权类 支持开发者调用接口实现部分商家（如酒店、租车）的预授权类需求。 支持银行卡和微信支付宝付款码业务。 卡预授权类 1. 卡预授权 支持开发者调用接口实现部分商家（如酒店、租车）的预授权需求。 持卡人在宾馆、酒店或出租公司消费，消费与结算不在同一时间完成，特约单位通过POS预先向发卡机构索要授权的行为。 * 序列图 APP界面输入消费金额，发起预授权请求 SDK处理预授权请求，返回应答码 APP翻译应答码，输出结果 如果预授权成功，APP发送打印请求 SDK返回打印结果 2. 卡预授权撤销 支持开发者调用接口实现部分商家（如酒店、租车）的预授权撤销需求。 预授权撤销用来撤销之前的预授权交易，不限制当日。 序列图 APP界面：输入原预授权信息（金额\\原交易日期\\授权码），核对该笔交易，发起预授权撤销请求 SDK处理撤销请求，返回应答码 APP翻译应答码，输出结果页面 预授权撤销成功时，APP发送打印请求 SDK返回打印结果 3. 卡预授权完成 支持开发者调用接口实现部分商家（如酒店、租车）的预授权完成需求。 预授权完成是持卡人消费完成并确定消费金额时，已取得预授权的特约商户在预授权金额或超出预授权金额一定比例的范围内，根据持卡人实际消费金额通过POS终端或手工方式完成持卡人付款的过程。 * 序列图 APP界面：输入预授权完成金额和原预授权信息（原交易日期\\授权码），核对该笔交易，发起预授权完成请求 SDK处理预授权完成请求，返回应答码 APP翻译应答码，输出结果 如果预授权完成成功，APP发送打印请求 SDK返回打印结果 4. 卡预授权完成撤销 支持开发者调用接口实现部分商家（如酒店、租车）的预授权完成撤销需求。 用来撤销已经成功的预授权完成交易。不限当日。要解冻相应的预授权交易金额，需要完成撤销预授权. 序列图 APP界面：输入原凭证号，找到该笔预授权完成，发起预授权完成撤销请求 SDK处理预授权完成撤销请求，返回应答码 APP翻译应答码，输出结果 预授权完成撤销成功时，APP发送打印请求 SDK返回打印结果 码预授权类 1. 码预授权 支持开发者调用接口实现部分商家（如酒店、租车）的预授权需求。 在宾馆、酒店或出租公司消费，消费与结算不在同一时间完成，特约单位通过POS预先向微信或支付宝冻结资金。 序列图 APP界面输入消费金额，发起预授权请求 SDK处理预授权请求，返回应答码 APP翻译应答码，输出结果 如果预授权成功，APP发送打印请求 SDK返回打印结果 2. 码预授权撤销 支持开发者调用接口实现部分商家（如酒店、租车）的预授权撤销需求。 预授权撤销用来撤销之前的预授权交易，不限制当日。 序列图 APP界面：输入原预授权信息（金额\\原交易日期\\授权码），核对该笔交易，发起预授权撤销请求 SDK处理撤销请求，返回应答码 APP翻译应答码，输出结果页面 预授权撤销成功时，APP发送打印请求 SDK返回打印结果 3. 码预授权完成 支持开发者调用接口实现部分商家（如酒店、租车）的预授权完成需求。 预授权完成是消费者消费完成并确定消费金额时，已取得预授权的特约商户在预授权金额或超出预授权金额一定比例的范围内，根据消费者实际消费金额通过POS终端或手工方式完成消费者付款的过程。 序列图 APP界面：输入预授权完成金额和原预授权信息（原交易日期\\授权码），核对该笔交易，发起预授权完成请求 SDK处理预授权完成请求，返回应答码 APP翻译应答码，输出结果 如果预授权完成成功，APP发送打印请求 SDK返回打印结果 4. 码预授权完成撤销 支持开发者调用接口实现部分商家（如酒店、租车）的预授权完成撤销需求。 用来撤销已经成功的预授权完成交易。不限当日。要解冻相应的预授权交易金额，需要完成撤销预授权. 序列图 APP界面：输入原凭证号，找到该笔预授权完成，发起预授权完成撤销请求 SDK处理预授权完成撤销请求，返回应答码 APP翻译应答码，输出结果 预授权完成撤销成功时，APP发送打印请求 SDK返回打印结果 九、交易明细 支持开发者调用接口实现商家查看交易订单需求，同时可以补打、撤销订单。 序列图 APP界面：发起查看交易明细请求 SDK处理请求，返回应答码 APP翻译应答码，输出交易明细结果 对某一笔订单，APP发送打印商户联请求 SDK返回打印商户联结果 对某一笔订单，APP发送撤销请求 SDK返回撤销结果 调用方法 CILSDK.getBillsAsync(page, size, startTime, endTime, @BillType int type, callBackIsOnMainThread, new Callback<CILResponse>() 参数 参数名称 page 从0开始 size 每页返回的条数 type 账单类型 callback 回调 十、结算 支持开发者调用接口实现商家结算需求。 结算需求主要用于每日交易结束时或收银员交接班时，对某段时间内的账款核对。 序列图 APP界面：点击【去结算】，核对交易明细无误后【结算】，发起结算请求 SDK处理结算请求，返回应答码 APP翻译应答码，输出结果 结算成功时，APP发送打印结算单请求 SDK返回打印结算单结果 调用方法 CILSDK.transSettleAsync(batchNum, new Callback<CILResponse>() 参数 参数名称 batchNum 批次号 Callback 回调函数","text_tokens":["(","位置","老版","调用"," ","主","日期","是否是","插卡","downloadparamswithprogress","结果","中","订单","入参","应答","界面","时","一定","样例","transsettleasync","方法","starttime","内","transsettles","包含","通过","新版","行数","自定","八","方式","更新","的","其中","四","手机","如","情况","比例","银员","\\","某","实际","代码","接班","返回","了","*","宾馆","com","判断","签名","开始","setbatchnum","收银员","单位","支持","对","只","卡人","要","请求","限制","一般","使用","租车",".","初始化","去","其实","linebreak","支付","之前","原预","termcode","／","特约","getbillsasync","单","持卡","downloadparams","预先","备注","标题","当日","资金","账款","客户","就是","用来","微信","一时","同时","printbarcode","下载","8","billtype","发起","2","是否","发卡","保存","行为","页面","4","终端","width","setserialnum","sdk","联","开发","环节","有","条数","或","printbufferreceipt","配置","唯一","序列","1","定位","cardinfolink","业务","。","撤销","new","签购","每日","十","解冻","结尾","pos","卡预","银行卡","出租","子标题","batchnum","一笔","021290050110001","用于","偏移","每","接口","参考","明细","获取","修改","type","需求","六","补打","无误","数","根据","流水号","商家","size","二维","两联","函数","boolean","金额","内容","list","offset","barcode","一次","从","）","公司","批次","银行","callback","索要","isforeigntrans","=","序列图","已经","包括","应用","mercode","名称","一个","，","消费","该笔","serialnum","选择","超出","限","收款","kind","流水","同一时间","发送","大小","商户","确定","；","devicetoken","过程","主要","发送打印","一时间","偏移量","五","冻结资金","输出","向","active","getbatchnum","一","定义","相关","formattranscode","trans","并","收银","或者","交接班","activecode","本批","00000001","支付宝","形码","凭证","码预","需要","transdatetime","工作","@","3","成功","不","走纸","位","原","：","初次","九","page","以下","交易类型","激活码","授权","nfc","范围","是","<","条形","getserialnum","必填","buffer","二维码","小票","覆盖","issuccess","点击","signin","progresscallback","已","退货","核对","int","索引","相应","功能","【","签到","类型","取得","查看",">","七","同一时","初始","listener","与","数字","和","打印","printimage","其","非","自动","在","实现","信息","部分","后","0","账单","printqrcode","密钥","外卡","机构","position","logo","如果","操作","bitmap","类","段时间","条形码","printerresult","两种","endtime","输入","（","回调","翻译","结算","早","找到","自定义","callbackisonmainthread","刷卡","qrcode","string","】","会","以及","设备","每页","号","挥卡","图标","可","手工","三","可以","15","图片","cilsdk","printkindsreceipts",",","消费者","结束","处理","printsettlereceipts","付款","由","二","持卡人","参数","冻结","扫码","交易","设置","同一","时间","码","预",")","激活","酒店","cilresponse","交接","换行","开发者","app","完成","扫描",";","activewithcodesync","、"],"title":"概述和序列图","title_tokens":["序列","和","概述","序列图"]},{"location":"flowChart/overview/#_1","text":"只需要在初次使用终端时操作一次，内容包括了激活、初始化、下载参数。 * 序列图","text_tokens":["了","*","内容","初始","操作"," ","激活","一次","，","序列","需要","只","终端","。","在","使用","时","参数","初始化","初次","序列图","包括","下载","、"],"title":"一、激活环节","title_tokens":["一","环节","激活","、"]},{"location":"flowChart/overview/#_2","text":"激活设备，有老版和新版两种激活方式 新版激活接口(入参激活码)： CILSDK.activeWithCodeSync(activeCode, deviceToken, new Callback ()); 老版激活接口： CILSDK.active(merCode, termCode, new Callback<CILResponse>() 参数 参数名称 样例 备注 merCode 商户代码 021290050110001 15位数字，激活时必填 termCode 终端代码 00000001 8位数字，激活时必填 new Callback<CILResponse> 是回调函数","text_tokens":["(","termcode","老版","mercode","是","8",">","名称","activecode","新版"," ","devicetoken",")","00000001","<","备注","激活","021290050110001","方式","，","15","必填","cilsdk","数字","和","接口","cilresponse",",","两种","商户","回调","入参","终端","callback","active","时","参数",".","位","样例","new","：","代码","有","函数",";","激活码","activewithcodesync","设备"],"title":"激活","title_tokens":["激活"]},{"location":"flowChart/overview/#_3","text":"参数下载在主要应用在以下两种情况： 1. 激活时下载参数 2. 参数修改后下载参数 CILSDK.downloadParams(merCode, termCode, new com.cardinfolink.pos.listener.Callback<CILResponse>() 其中， new com.cardinfolink.pos.listener.Callback<CILResponse>() 是回调函数","text_tokens":["应用","(","termcode","mercode","是",">","com"," ","downloadparams",")","主要","<","激活","2","，","listener","cilsdk","其中","cilresponse",",","两种","修改","1","回调","情况","cardinfolink","callback","在","时","参数",".","后","new","：","以下","下载","函数","pos"],"title":"参数下载","title_tokens":["下载","参数"]},{"location":"flowChart/overview/#_4","text":"初始化主要是终端密钥下载，包含了主密钥下载和工作密钥下载。其主要应用在以下两种情况： 1.激活时初始化密钥 2.需要更新密钥时初始化 CILSDK.downloadParamsWithProgress(new ProgressCallback<CILResponse>()","text_tokens":["了","包含","应用","(","是",">","初始"," ","主",")","主要","<","激活","2","downloadparamswithprogress","，","更新","cilsdk","和","cilresponse","两种","1","需要","情况","其","工作","终端","。","在","时","progresscallback",".","new","初始化","：","密钥","以下","下载"],"title":"初始化","title_tokens":["初始","初始化"]},{"location":"flowChart/overview/#_5","text":"签到其实就是一个更新密钥的过程，激活时已经覆盖了每日一次签到的操作。 CILSDK.signIn(new Callback<CILResponse>()","text_tokens":["了","(",">","过程","一个","操作"," ",")","<","激活","一次","，","更新","的","cilsdk","cilresponse","就是","覆盖","callback","。","signin","时",".","new","每日","已经","密钥","其实","签到"],"title":"二、签到","title_tokens":["二","签到","、"]},{"location":"flowChart/overview/#_6","text":"可配置参数 1. 批次号、流水号 批次号用于结算，流水号（凭证号）定位本批每一笔交易唯一索引； 设置批次号 boolean isSuccess = CILSDK.setBatchNum(int batchNum); 获取批次号 int batchNum = CILSDK.getBatchNum(); 设置流水号 boolean isSuccess = CILSDK.setSerialNum(int serialNum); 获取流水号 int serialNum = CILSDK.getSerialNum();","text_tokens":["(","号","；"," ","本批",")","可","batchnum","一笔","getserialnum","用于","，","cilsdk","配置","）","setbatchnum","每","serialnum","唯一","获取","凭证","1","（","批次","定位","流水","结算","issuccess",";","getbatchnum","参数",".","流水号","setserialnum","=","int","交易","索引","boolean","设置","、"],"title":"三、配置","title_tokens":["、","三","配置"]},{"location":"flowChart/overview/#_7","text":"交易成功后，需要打印签购单，一般打印两联：商户联和客户联。商户联在持卡人签名后由商户保存。交易成功后，会自动打印商户联。 需要补打小票时，可以早交易明细中找到补打功能，打印商户联。 序列图 打印银行类／扫码交易小票 CILSDK.printKindsReceipts(trans,lineBreak,formatTransCode, kind, isForeignTrans, bitmap, new Callback<PrinterResult>() 参数 参数名称 trans 交易信息 lineBreak 小票结尾需要走纸换行的行数 formatTransCode 小票的交易类型（String类型） kind 小票的子标题，判断是商户联或者是客户联(int) isForeignTrans 是否是外卡类交易 bitmap logo图标 Callback 回调 打印结算小票 CILSDK.printSettleReceipts(transSettles, transDatetime,batchNum, lineBreak, formatTransCode, new Callback<PrinterResult>() 参数 参数名称 transSettles 结算信息List transDatetime 结算时间 batchNum 批次号 lineBreak 打印结尾换行数 formatTransCode 结算类型 Callback 回调 自定义打印 CILSDK.printBufferReceipt(buffer, lineBreak,new Callback<PrinterResult>() 参数 参数名称 buffer 打印内容 linebreak 打印结尾换行数 Callback 回调 打印二维码 CILSDK.printQRCode(qrCode,position,width,lineBreak,new Callback<PrinterResult>() 参数 参数名称 qrCode 二维码 position 二维码位置 width 二维码大小 lineBreak 打印结尾换行数 Callback 回调 打印条形码 CILSDK.printBarCode(String barCode, int position, int lineBreak, new Callback<PrinterResult>() 参数 参数名称 barCode 条形码数字 position 条形码位置 lineBreak 打印结尾换行数 Callback 回调 打印图片 CILSDK.printImage(bitmap, lineBreak, offset, new Callback<PrinterResult>() 参数 参数名称 bitmap 图片Bitmap lineBreak 换行数 offset 偏移量 callback 回调","text_tokens":["(","位置",">","名称"," ","是否是","是否","，","保存","数字","和","中","打印","printimage","kind","自动","在","width","时","信息","后","联","printqrcode","大小","商户","transsettles","外卡","position","logo","行数","自定","bitmap","类","printbufferreceipt","的","条形码","printerresult","偏移量","序列","（","回调","结算","。","早","找到","自定义","定义","new","签购","qrcode","string","formattranscode","结尾","trans","会","或者","号","图标","判断","签名","子标题","batchnum","可以","偏移","图片","cilsdk","printkindsreceipts","形码",",","明细","需要","卡人","transdatetime","printsettlereceipts","补打","由","数","成功","一般","持卡人","参数",".","走纸","：","扫码","二维","交易","两联","交易类型","linebreak","／","是","时间","list","内容","单","持卡","offset",")","barcode","<","条形","标题","）","buffer","客户","二维码","批次","银行","小票","callback","换行","isforeigntrans","int","序列图","printbarcode","功能","类型"],"title":"四、打印","title_tokens":["打印","、","四"]},{"location":"flowChart/overview/#_8","text":"1. 消费（插卡、刷卡、挥卡、手机NFC ） 支持开发者调用接口实现商家银行卡收款需求。 主要类型包括刷卡、插卡、挥卡以及手机NFC支付。 序列图 APP界面输入消费金额，选择银行卡支付，发起银行卡付款请求 SDK处理交易，返回应答码 APP翻译应答码，输出结果 如果消费成功，APP发送打印请求 SDK返回打印结果 2. 消费【扫码】 支持开发者调用接口实现商家扫码收款需求。 主要类型包括微信扫码和支付宝扫码。 序列图 APP界面输入消费金额，扫描二维码获取付款码信息，发起扫码付款请求 SDK处理消费请求，返回应答码 APP翻译应答码，输出结果 如果消费成功，APP发送打印请求 SDK返回打印结果","text_tokens":["支付","返回","nfc","调用","码","挥卡","银行卡","如果"," ","主要","发送打印","发起","插卡","2","，","支付宝","）","消费","手机","结果","接口","和","选择","打印","支持","获取","输入","处理","1","（","序列","二维码","收款","需求","银行","应答","请求","翻译","付款","输出","界面","。","成功","实现","微信","开发者",".","信息","发送","商家","sdk","app","刷卡","开发","扫码","二维","序列图","交易","】","包括","扫描","金额","【","以及","类型","、"],"title":"五、消费","title_tokens":["消费","五","、"]},{"location":"flowChart/overview/#_9","text":"支持开发者调用接口实现商家撤销当日交易需求。 包括银行卡撤销和扫码撤销。 序列图 APP界面输入原交易凭证号，核对该笔交易，发起撤销请求 SDK处理撤销请求，返回应答码 APP翻译应答码，输出结果 撤销成功时，APP发送打印请求 SDK返回打印结果","text_tokens":["返回","调用","号","码","银行卡"," ","发送打印","发起","，","当日","结果","和","接口","该笔","打印","支持","凭证","输入","处理","序列","需求","银行","应答","请求","翻译","输出","界面","。","成功","撤销","实现","时","开发者","发送","商家","原","sdk","app","开发","核对","扫码","交易","序列图","包括"],"title":"六、撤销","title_tokens":["六","、","撤销"]},{"location":"flowChart/overview/#_10","text":"支持开发者调用接口实现商家非当日交易的退货需求。 包括银行卡退货和扫码退货。 序列图 APP界面输入订单相关信息（参考号／交易日期／退货金额），核对该笔交易，发起退货请求 SDK处理退货请求，返回应答码 APP翻译应答码，输出结果 退货成功时，APP发送打印请求 SDK返回打印结果","text_tokens":["返回","／","调用","号","码","银行卡"," ","日期","发送打印","发起","，","当日","的","）","结果","和","接口","该笔","参考","打印","支持","输入","处理","序列","订单","（","需求","银行","非","请求","应答","翻译","输出","界面","。","成功","实现","时","开发者","信息","退货","发送","商家","sdk","app","开发","核对","相关","扫码","交易","序列图","包括","金额"],"title":"七、退货","title_tokens":["退货","七","、"]},{"location":"flowChart/overview/#_11","text":"支持开发者调用接口实现部分商家（如酒店、租车）的预授权类需求。 支持银行卡和微信支付宝付款码业务。 卡预授权类 1. 卡预授权 支持开发者调用接口实现部分商家（如酒店、租车）的预授权需求。 持卡人在宾馆、酒店或出租公司消费，消费与结算不在同一时间完成，特约单位通过POS预先向发卡机构索要授权的行为。 * 序列图 APP界面输入消费金额，发起预授权请求 SDK处理预授权请求，返回应答码 APP翻译应答码，输出结果 如果预授权成功，APP发送打印请求 SDK返回打印结果 2. 卡预授权撤销 支持开发者调用接口实现部分商家（如酒店、租车）的预授权撤销需求。 预授权撤销用来撤销之前的预授权交易，不限制当日。 序列图 APP界面：输入原预授权信息（金额\\原交易日期\\授权码），核对该笔交易，发起预授权撤销请求 SDK处理撤销请求，返回应答码 APP翻译应答码，输出结果页面 预授权撤销成功时，APP发送打印请求 SDK返回打印结果 3. 卡预授权完成 支持开发者调用接口实现部分商家（如酒店、租车）的预授权完成需求。 预授权完成是持卡人消费完成并确定消费金额时，已取得预授权的特约商户在预授权金额或超出预授权金额一定比例的范围内，根据持卡人实际消费金额通过POS终端或手工方式完成持卡人付款的过程。 * 序列图 APP界面：输入预授权完成金额和原预授权信息（原交易日期\\授权码），核对该笔交易，发起预授权完成请求 SDK处理预授权完成请求，返回应答码 APP翻译应答码，输出结果 如果预授权完成成功，APP发送打印请求 SDK返回打印结果 4. 卡预授权完成撤销 支持开发者调用接口实现部分商家（如酒店、租车）的预授权完成撤销需求。 用来撤销已经成功的预授权完成交易。不限当日。要解冻相应的预授权交易金额，需要完成撤销预授权. 序列图 APP界面：输入原凭证号，找到该笔预授权完成，发起预授权完成撤销请求 SDK处理预授权完成撤销请求，返回应答码 APP翻译应答码，输出结果 预授权完成撤销成功时，APP发送打印请求 SDK返回打印结果 码预授权类 1. 码预授权 支持开发者调用接口实现部分商家（如酒店、租车）的预授权需求。 在宾馆、酒店或出租公司消费，消费与结算不在同一时间完成，特约单位通过POS预先向微信或支付宝冻结资金。 序列图 APP界面输入消费金额，发起预授权请求 SDK处理预授权请求，返回应答码 APP翻译应答码，输出结果 如果预授权成功，APP发送打印请求 SDK返回打印结果 2. 码预授权撤销 支持开发者调用接口实现部分商家（如酒店、租车）的预授权撤销需求。 预授权撤销用来撤销之前的预授权交易，不限制当日。 序列图 APP界面：输入原预授权信息（金额\\原交易日期\\授权码），核对该笔交易，发起预授权撤销请求 SDK处理撤销请求，返回应答码 APP翻译应答码，输出结果页面 预授权撤销成功时，APP发送打印请求 SDK返回打印结果 3. 码预授权完成 支持开发者调用接口实现部分商家（如酒店、租车）的预授权完成需求。 预授权完成是消费者消费完成并确定消费金额时，已取得预授权的特约商户在预授权金额或超出预授权金额一定比例的范围内，根据消费者实际消费金额通过POS终端或手工方式完成消费者付款的过程。 序列图 APP界面：输入预授权完成金额和原预授权信息（原交易日期\\授权码），核对该笔交易，发起预授权完成请求 SDK处理预授权完成请求，返回应答码 APP翻译应答码，输出结果 如果预授权完成成功，APP发送打印请求 SDK返回打印结果 4. 码预授权完成撤销 支持开发者调用接口实现部分商家（如酒店、租车）的预授权完成撤销需求。 用来撤销已经成功的预授权完成交易。不限当日。要解冻相应的预授权交易金额，需要完成撤销预授权. 序列图 APP界面：输入原凭证号，找到该笔预授权完成，发起预授权完成撤销请求 SDK处理预授权完成撤销请求，返回应答码 APP翻译应答码，输出结果 预授权完成撤销成功时，APP发送打印请求 SDK返回打印结果","text_tokens":["调用","同一时"," ","日期","发起","2","，","与","发卡","结果","消费","和","该笔","打印","行为","超出","页面","限","4","应答","终端","界面","在","实现","时","一定","信息","部分","同一时间","发送","sdk","开发","商户","内","确定","通过","机构","如果","过程","或","发送打印","类","方式","的","一时间","如","输入","1","（","序列","冻结资金","翻译","比例","向","结算","输出","业务","。","撤销","找到","\\","实际","解冻","并","pos","卡预","返回","宾馆","*","号","银行卡","出租","手工","支付宝","接口","单位","消费者","支持","凭证","码预","处理","需要","卡人","要","需求","请求","限制","付款","3","根据","成功","租车","不","持卡人",".","商家","原","冻结","：","交易","金额","同一","授权","支付","之前","原预","范围","是","时间","码","特约","预","持卡","预先","酒店","当日","）","公司","资金","银行","用来","微信","开发者","索要","已","app","一时","核对","完成","序列图","已经","相应","、","取得"],"title":"八、预授权类","title_tokens":["类","八","预","授权","、"]},{"location":"flowChart/overview/#_12","text":"支持开发者调用接口实现商家查看交易订单需求，同时可以补打、撤销订单。 序列图 APP界面：发起查看交易明细请求 SDK处理请求，返回应答码 APP翻译应答码，输出交易明细结果 对某一笔订单，APP发送打印商户联请求 SDK返回打印商户联结果 对某一笔订单，APP发送撤销请求 SDK返回撤销结果 调用方法 CILSDK.getBillsAsync(page, size, startTime, endTime, @BillType int type, callBackIsOnMainThread, new Callback<CILResponse>() 参数 参数名称 page 从0开始 size 每页返回的条数 type 账单类型 callback 回调","text_tokens":["返回","(","查看","每页","调用","码","new",">","条数","getbillsasync","名称","billtype"," ",")","<","发送打印","发起","可以","一笔","，","开始","0","cilsdk","结果","从","的","接口","cilresponse",",","打印","明细","支持","endtime","处理","序列","订单","对","type","回调","需求","翻译","应答","请求","补打","@","输出","界面","callback","。","撤销","实现","callbackisonmainthread","参数","开发者",".","发送","商家","sdk","某","app","：","开发","联","方法","size","starttime","int","交易","同时","序列图","page","账单","商户","类型","、"],"title":"九、交易明细","title_tokens":["明细","九","、","交易"]},{"location":"flowChart/overview/#_13","text":"支持开发者调用接口实现商家结算需求。 结算需求主要用于每日交易结束时或收银员交接班时，对某段时间内的账款核对。 序列图 APP界面：点击【去结算】，核对交易明细无误后【结算】，发起结算请求 SDK处理结算请求，返回应答码 APP翻译应答码，输出结果 结算成功时，APP发送打印结算单请求 SDK返回打印结算单结果 调用方法 CILSDK.transSettleAsync(batchNum, new Callback<CILResponse>() 参数 参数名称 batchNum 批次号 Callback 回调函数","text_tokens":["(","调用",">","名称"," ","发起","，","结果","打印","应答","界面","实现","时","后","transsettleasync","发送","sdk","方法","开发","内","或","主要","发送打印","段时间","的","序列","回调","翻译","银员","输出","结算","。","某","new","每日","】","收银","接班","交接班","返回","号","batchnum","用于","cilsdk","接口","收银员",",","结束","明细","支持","处理","对","需求","请求","无误","成功","参数",".","商家","：","交易","去","函数","时间","码","单",")","<","cilresponse","账款","批次","交接","点击","callback","开发者","app","核对","序列图","【"],"title":"十、结算","title_tokens":["结算","十","、"]},{"location":"flowChart/systemFlowChart/","text":"概要 本文档详细介绍了用户APP、SDK与后台之间的交互作用，用图形直观简洁的介绍每个功能，并附有详细的文字说明加以解释。 初始化 激活 CIL分配商户号、终端号；sdk从终端获取sn号验证身份，从云端获取devicetoken，将上述信息上传到管理平台验证身份，身份合格后将参数下载到sdk内。 主密钥下载 主密钥下载：采用非对称加密方式，获取主密钥KEY，并启动主密钥。 剩余工作密钥下载 剩余工作密钥下载：下载工作密钥并装载；下载aid并装载；下载ic公钥并装载。 消费 银行卡消费 银行卡消费：输入金额，刷卡操作后，读卡模块获取卡片信息，加密模块获得密码密文，同卡片信息一起，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 扫码消费 扫码消费：输入金额后，扫描消费者付款码，加上终端信息，全部报文经加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 撤销 银行卡撤销 银行卡撤销：输入凭证号本地获取原交易信息，刷卡操作后，读卡模块获取卡片信息，加密模块获得密码密文，同卡片信息一起，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 扫码撤销 扫码撤销：输入凭证号本地获取原交易信息，全部报文经加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 退货 银行卡退货 银行卡退货：输入金额、交易日期、参考号等获取原交易信息，刷卡操作后，读卡模块获取卡片信息，加密模块获得密码密文，同卡片信息一起，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 扫码退货 扫码撤销：输入金额、交易日期和参考号本地获取原交易信息，全部报文经加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 预授权类 卡预授权类 预授权 预授权：输入金额，刷卡操作后，读卡模块获取卡片信息，加密模块获得密码密文，同卡片信息一起，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 预授权撤销 预授权撤销：输入相关信息获取原交易，刷卡操作后，读卡模块获取卡片信息，加密模块获得密码密文，同卡片信息一起，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 预授权完成 预授权完成：输入相关信息获取预授权交易，输入预授权完成金额后，刷卡操作，读卡模块获取卡片信息，加密模块获得密码密文，同卡片信息一起，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 预授权完成撤销 预授权完成撤销：输入相关信息获取预授权完成交易，刷卡操作后，读卡模块获取卡片信息，加密模块获得密码密文，同卡片信息一起，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 码预授权类 * 扫码预授权 扫码预授权：输入金额后，扫描消费者付款码，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 扫码预授权撤销 扫码预授权撤销：输入相关信息获取原交易，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 扫码预授权完成 扫码预授权撤销：输入相关信息获取交易相关信息，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 扫码预授权完成撤销 扫码预授权完成撤销：输入相关信息获取交易相关信息，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文。 明细查询 明细查询 明细查询：发送终端信息到api，加密模块加密全部报文后返回mac数据，经过8583报文处理模块处理后，发送到管理平台，管理平台返回应答报文，终端显示。 结算 结算 结算：发送终端信息、商户号、结算批次号到api，加密模块加密全部报文后返回mac数据，经过8583报文处理模块处理后，发送到管理平台，管理平台返回应答报文，终端显示。 小费 收取小费 收取小费：app发起交易，将原交易信息、消费金额传送给api，加密模块加密全部报文后返回mac数据，经过8583报文处理模块处理后，发送到交易网关，交易网关返回应答报文，终端显示交易成功。 小费撤销 小费撤销：app发起交易，将原小费交易信息传送给api，加密模块加密全部报文后返回mac数据，经过8583报文处理模块处理后，发送到交易网关，交易网关返回应答报文，终端显示交易成功。 余额查询 余额查询 余额查询：app发起余额查询，刷卡后，读卡模块获取卡片信息，加密模块获得密码密文，同卡片信息一起，全部报文经过加密模块加密后返回mac数据，经过8583报文处理模块处理后，发送给交易网关，网关返回应答报文，app显示刷卡余额。","text_tokens":["cil","sn","本地","合格","ic"," ","初始","传送","直观","主","日期","发起","，","与","一起","消费","读卡","和","密文","剩余","文字","报文","应答","终端","经过","小费","给","说明","信息","后","发送","sdk","分配","密钥","采用","商户","收取","内","装载","；","解释","平台","等","devicetoken","身份","操作","上述","类","方式","的","介绍","网关","公钥","到","输入","mac","详细","全部","结算","。","经","撤销","作用","后台","概要","刷卡","非对称","相关","交互作用","并","卡预","返回","了","本","*","号","aid","获得","8583","银行卡","用户","每个","文字说明","对称","参考","消费者","数据","明细","获取","加上","凭证","码预","处理","工作","付款","验证","成功","显示","用","云端","上","参数","同","api","原","初始化","：","管理","扫码","交易","金额","授权","送给","之间","模块","卡片","附有","码","发送到","预","送到","key","将","图形","发送给","加密","激活","加以","传到","密码","从","文档","简洁","交互","批次","银行","查询","启动","余额","退货","app","完成","下载","扫描","功能","、"],"title":"系统交互图","title_tokens":["系统","交互","图"]}]}